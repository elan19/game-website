/**
 * @license
 * MIT License
 * 
 * Copyright (c) 2022 Uploadcare (hello@uploadcare.com). All rights reserved.
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 * 
 */
"use strict";var LR=(()=>{var ce=Object.defineProperty;var Po=Object.getOwnPropertyDescriptor;var Uo=Object.getOwnPropertyNames;var Ro=Object.prototype.hasOwnProperty;var Mo=(r,i,t)=>i in r?ce(r,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[i]=t;var l=(r,i)=>ce(r,"name",{value:i,configurable:!0});var Do=(r,i)=>{for(var t in i)ce(r,t,{get:i[t],enumerable:!0})},No=(r,i,t,e)=>{if(i&&typeof i=="object"||typeof i=="function")for(let s of Uo(i))!Ro.call(r,s)&&s!==t&&ce(r,s,{get:()=>i[s],enumerable:!(e=Po(i,s))||e.enumerable});return r};var Fo=r=>No(ce({},"__esModule",{value:!0}),r);var u=(r,i,t)=>(Mo(r,typeof i!="symbol"?i+"":i,t),t);var Ec={};Do(Ec,{ActivityBlock:()=>_,ActivityHeader:()=>Gi,BaseComponent:()=>Ot,Block:()=>y,CameraSource:()=>Me,CloudImageEditor:()=>qi,CloudImageEditorActivity:()=>ji,CloudImageEditorBlock:()=>ot,Config:()=>qn,ConfirmationDialog:()=>De,Copyright:()=>Wi,CropFrame:()=>Be,Data:()=>T,DropArea:()=>Zt,EditorCropButtonControl:()=>se,EditorFilterControl:()=>Mt,EditorImageCropper:()=>Ge,EditorImageFader:()=>zi,EditorOperationControl:()=>re,EditorScroller:()=>We,EditorSlider:()=>Ve,EditorToolbar:()=>Xe,ExternalSource:()=>Je,FileItem:()=>ee,FilePreview:()=>ie,FileUploaderInline:()=>ei,FileUploaderMinimal:()=>ti,FileUploaderRegular:()=>Qe,FormInput:()=>Hi,Icon:()=>qt,Img:()=>Pi,LineLoaderUi:()=>qe,LrBtnUi:()=>oe,Modal:()=>Pe,PACKAGE_NAME:()=>Ae,PACKAGE_VERSION:()=>Ee,PresenceToggle:()=>Ke,ProgressBar:()=>Fe,ProgressBarCommon:()=>Ne,Select:()=>Ze,SimpleBtn:()=>Yt,SliderUi:()=>Ye,SourceBtn:()=>Qt,SourceList:()=>Ui,StartFrom:()=>ke,Tabs:()=>le,UID:()=>It,UploadCtxProvider:()=>bo,UploadList:()=>Ue,UploaderBlock:()=>S,UrlSource:()=>Re,Video:()=>ae,connectBlocksFrom:()=>ko,defineLocale:()=>As,registerBlocks:()=>Ki,toKebabCase:()=>Wt});var Bo=Object.defineProperty,zo=l((r,i,t)=>i in r?Bo(r,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[i]=t,"__defNormalProp"),Zi=l((r,i,t)=>(zo(r,typeof i!="symbol"?i+"":i,t),t),"__publicField");function Vo(r){let i=l(t=>{var e;for(let s in t)((e=t[s])==null?void 0:e.constructor)===Object&&(t[s]=i(t[s]));return{...t}},"clone");return i(r)}l(Vo,"cloneObj");var ue,T=(ue=class{constructor(i){i.constructor===Object?this.store=Vo(i):(this._storeIsProxy=!0,this.store=i),this.callbackMap=Object.create(null)}static warn(i,t){console.warn(`Symbiote Data: cannot ${i}. Prop name: `+t)}read(i){return!this._storeIsProxy&&!this.store.hasOwnProperty(i)?(T.warn("read",i),null):this.store[i]}has(i){return this._storeIsProxy?this.store[i]!==void 0:this.store.hasOwnProperty(i)}add(i,t,e=!1){!e&&Object.keys(this.store).includes(i)||(this.store[i]=t,this.notify(i))}pub(i,t){if(!this._storeIsProxy&&!this.store.hasOwnProperty(i)){T.warn("publish",i);return}this.store[i]=t,this.notify(i)}multiPub(i){for(let t in i)this.pub(t,i[t])}notify(i){this.callbackMap[i]&&this.callbackMap[i].forEach(t=>{t(this.store[i])})}sub(i,t,e=!0){return!this._storeIsProxy&&!this.store.hasOwnProperty(i)?(T.warn("subscribe",i),null):(this.callbackMap[i]||(this.callbackMap[i]=new Set),this.callbackMap[i].add(t),e&&t(this.store[i]),{remove:()=>{this.callbackMap[i].delete(t),this.callbackMap[i].size||delete this.callbackMap[i]},callback:t})}static registerCtx(i,t=Symbol()){let e=T.globalStore.get(t);return e?console.warn('State: context UID "'+t+'" already in use'):(e=new T(i),T.globalStore.set(t,e)),e}static deleteCtx(i){T.globalStore.delete(i)}static getCtx(i,t=!0){return T.globalStore.get(i)||(t&&console.warn('State: wrong context UID - "'+i+'"'),null)}},l(ue,"Data"),ue);T.globalStore=new Map;var A=Object.freeze({BIND_ATTR:"set",ATTR_BIND_PRFX:"@",EXT_DATA_CTX_PRFX:"*",NAMED_DATA_CTX_SPLTR:"/",CTX_NAME_ATTR:"ctx-name",CTX_OWNER_ATTR:"ctx-owner",CSS_CTX_PROP:"--ctx-name",EL_REF_ATTR:"ref",AUTO_TAG_PRFX:"sym",REPEAT_ATTR:"repeat",REPEAT_ITEM_TAG_ATTR:"repeat-item-tag",SET_LATER_KEY:"__toSetLater__",USE_TPL:"use-template",ROOT_STYLE_ATTR_NAME:"sym-component"}),Nr="1234567890QWERTYUIOPASDFGHJKLZXCVBNMqwertyuiopasdfghjklzxcvbnm",jo=Nr.length-1,de,It=(de=class{static generate(i="XXXXXXXXX-XXX"){let t="";for(let e=0;e<i.length;e++)t+=i[e]==="-"?i[e]:Nr.charAt(Math.random()*jo);return t}},l(de,"UID"),de);function Fr(r,i,t){let e=!0,s,n=i.split(".");return n.forEach((o,a)=>{a<n.length-1?r=r[o]:s=o}),r?r[s]=t:e=!1,e}l(Fr,"setNestedProp");function Ho(r){return r.split("-").map((i,t)=>i&&t?i[0].toUpperCase()+i.slice(1):i).join("").split("_").map((i,t)=>i&&t?i.toUpperCase():i).join("")}l(Ho,"kebabToCamel");function Go(r,i){[...r.querySelectorAll(`[${A.REPEAT_ATTR}]`)].forEach(t=>{var o;let e=t.getAttribute(A.REPEAT_ITEM_TAG_ATTR),s;if(e&&(s=window.customElements.get(e)),!s){s=(o=class extends i.BaseComponent{constructor(){super(),e||(this.style.display="contents")}},l(o,"itemClass"),o);let a=t.innerHTML;s.template=a,s.reg(e)}for(;t.firstChild;)t.firstChild.remove();let n=t.getAttribute(A.REPEAT_ATTR);i.sub(n,a=>{if(!a){for(;t.firstChild;)t.firstChild.remove();return}let c=[...t.children],h,d=l(p=>{p.forEach((g,m)=>{if(c[m])if(c[m].set$)setTimeout(()=>{c[m].set$(g)});else for(let b in g)c[m][b]=g[b];else{h||(h=new DocumentFragment);let b=new s;Object.assign(b.init$,g),h.appendChild(b)}}),h&&t.appendChild(h);let f=c.slice(p.length,c.length);for(let g of f)g.remove()},"fillItems");if(a.constructor===Array)d(a);else if(a.constructor===Object){let p=[];for(let f in a){let g=a[f];Object.defineProperty(g,"_KEY_",{value:f,enumerable:!0}),p.push(g)}d(p)}else console.warn("Symbiote repeat data type error:"),console.log(a)}),t.removeAttribute(A.REPEAT_ATTR),t.removeAttribute(A.REPEAT_ITEM_TAG_ATTR)})}l(Go,"repeatProcessor");var Mr="__default__";function Wo(r,i){if(i.shadowRoot)return;let t=[...r.querySelectorAll("slot")];if(!t.length)return;let e={};t.forEach(s=>{let n=s.getAttribute("name")||Mr;e[n]={slot:s,fr:document.createDocumentFragment()}}),i.initChildren.forEach(s=>{var n;let o=Mr;s instanceof Element&&s.hasAttribute("slot")&&(o=s.getAttribute("slot"),s.removeAttribute("slot")),(n=e[o])==null||n.fr.appendChild(s)}),Object.values(e).forEach(s=>{if(s.fr.childNodes.length)s.slot.parentNode.replaceChild(s.fr,s.slot);else if(s.slot.childNodes.length){let n=document.createDocumentFragment();n.append(...s.slot.childNodes),s.slot.parentNode.replaceChild(n,s.slot)}else s.slot.remove()})}l(Wo,"slotProcessor");function Xo(r,i){[...r.querySelectorAll(`[${A.EL_REF_ATTR}]`)].forEach(t=>{let e=t.getAttribute(A.EL_REF_ATTR);i.ref[e]=t,t.removeAttribute(A.EL_REF_ATTR)})}l(Xo,"refProcessor");function qo(r,i){[...r.querySelectorAll(`[${A.BIND_ATTR}]`)].forEach(t=>{let s=t.getAttribute(A.BIND_ATTR).split(";");[...t.attributes].forEach(n=>{if(n.name.startsWith("-")&&n.value){let o=Ho(n.name.replace("-",""));s.push(o+":"+n.value),t.removeAttribute(n.name)}}),s.forEach(n=>{if(!n)return;let o=n.split(":").map(d=>d.trim()),a=o[0],c;a.indexOf(A.ATTR_BIND_PRFX)===0&&(c=!0,a=a.replace(A.ATTR_BIND_PRFX,""));let h=o[1].split(",").map(d=>d.trim());for(let d of h){let p;d.startsWith("!!")?(p="double",d=d.replace("!!","")):d.startsWith("!")&&(p="single",d=d.replace("!","")),i.sub(d,f=>{p==="double"?f=!!f:p==="single"&&(f=!f),c?(f==null?void 0:f.constructor)===Boolean?f?t.setAttribute(a,""):t.removeAttribute(a):t.setAttribute(a,f):Fr(t,a,f)||(t[A.SET_LATER_KEY]||(t[A.SET_LATER_KEY]=Object.create(null)),t[A.SET_LATER_KEY][a]=f)})}}),t.removeAttribute(A.BIND_ATTR)})}l(qo,"domSetProcessor");var ii="{{",he="}}",Ko="skip-text";function Yo(r){let i,t=[],e=document.createTreeWalker(r,NodeFilter.SHOW_TEXT,{acceptNode:s=>{var n;return!((n=s.parentElement)!=null&&n.hasAttribute(Ko))&&s.textContent.includes(ii)&&s.textContent.includes(he)&&1}});for(;i=e.nextNode();)t.push(i);return t}l(Yo,"getTextNodesWithTokens");var Jo=l(function(r,i){Yo(r).forEach(e=>{let s=[],n;for(;e.textContent.includes(he);)e.textContent.startsWith(ii)?(n=e.textContent.indexOf(he)+he.length,e.splitText(n),s.push(e)):(n=e.textContent.indexOf(ii),e.splitText(n)),e=e.nextSibling;s.forEach(o=>{let a=o.textContent.replace(ii,"").replace(he,"");o.textContent="",i.sub(a,c=>{o.textContent=c})})})},"txtNodesProcessor"),Zo=[Go,Wo,Xo,qo,Jo],si="'",Nt='"',Qo=/\\([0-9a-fA-F]{1,6} ?)/g;function tl(r){return(r[0]===Nt||r[0]===si)&&(r[r.length-1]===Nt||r[r.length-1]===si)}l(tl,"hasLeadingTrailingQuotes");function el(r){return(r[0]===Nt||r[0]===si)&&(r=r.slice(1)),(r[r.length-1]===Nt||r[r.length-1]===si)&&(r=r.slice(0,-1)),r}l(el,"trimQuotes");function il(r){let i="",t="";for(var e=0;e<r.length;e++){let s=r[e+1];r[e]==="\\"&&s==='"'?(i+='\\"',e++):r[e]==='"'&&t!=="\\"?i+='\\"':i+=r[e],t=r[e]}return i}l(il,"escapeQuotes");function sl(r){let i=r;tl(r)&&(i=el(i),i=i.replace(Qo,(t,e)=>String.fromCodePoint(parseInt(e.trim(),16))),i=i.replaceAll(`\\
`,"\\n"),i=il(i),i=Nt+i+Nt);try{return JSON.parse(i)}catch{throw new Error(`Failed to parse CSS property value: ${i}. Original input: ${r}`)}}l(sl,"parseCssPropertyValue");var Dr=0,Dt=null,ht=null,pe,bt=(pe=class extends HTMLElement{constructor(){super(),Zi(this,"updateCssData",()=>{var i;this.dropCssDataCache(),(i=this.__boundCssProps)==null||i.forEach(t=>{let e=this.getCssData(this.__extractCssName(t),!0);e!==null&&this.$[t]!==e&&(this.$[t]=e)})}),this.init$=Object.create(null),this.cssInit$=Object.create(null),this.tplProcessors=new Set,this.ref=Object.create(null),this.allSubs=new Set,this.pauseRender=!1,this.renderShadow=!1,this.readyToDestroy=!0,this.processInnerHtml=!1,this.allowCustomTemplate=!1,this.ctxOwner=!1}get BaseComponent(){return bt}initCallback(){}__initCallback(){var i;this.__initialized||(this.__initialized=!0,(i=this.initCallback)==null||i.call(this))}render(i,t=this.renderShadow){let e;if((t||this.constructor.__shadowStylesUrl)&&!this.shadowRoot&&this.attachShadow({mode:"open"}),this.allowCustomTemplate){let n=this.getAttribute(A.USE_TPL);if(n){let o=this.getRootNode(),a=(o==null?void 0:o.querySelector(n))||document.querySelector(n);a?i=a.content.cloneNode(!0):console.warn(`Symbiote template "${n}" is not found...`)}}if(this.processInnerHtml)for(let n of this.tplProcessors)n(this,this);if(i||this.constructor.template){if(this.constructor.template&&!this.constructor.__tpl&&(this.constructor.__tpl=document.createElement("template"),this.constructor.__tpl.innerHTML=this.constructor.template),(i==null?void 0:i.constructor)===DocumentFragment)e=i;else if((i==null?void 0:i.constructor)===String){let n=document.createElement("template");n.innerHTML=i,e=n.content.cloneNode(!0)}else this.constructor.__tpl&&(e=this.constructor.__tpl.content.cloneNode(!0));for(let n of this.tplProcessors)n(e,this)}let s=l(()=>{e&&(t&&this.shadowRoot.appendChild(e)||this.appendChild(e)),this.__initCallback()},"addFr");if(this.constructor.__shadowStylesUrl){t=!0;let n=document.createElement("link");n.rel="stylesheet",n.href=this.constructor.__shadowStylesUrl,n.onload=s,this.shadowRoot.prepend(n)}else s()}addTemplateProcessor(i){this.tplProcessors.add(i)}get autoCtxName(){return this.__autoCtxName||(this.__autoCtxName=It.generate(),this.style.setProperty(A.CSS_CTX_PROP,`'${this.__autoCtxName}'`)),this.__autoCtxName}get cssCtxName(){return this.getCssData(A.CSS_CTX_PROP,!0)}get ctxName(){var i;let t=((i=this.getAttribute(A.CTX_NAME_ATTR))==null?void 0:i.trim())||this.cssCtxName||this.__cachedCtxName||this.autoCtxName;return this.__cachedCtxName=t,t}get localCtx(){return this.__localCtx||(this.__localCtx=T.registerCtx({},this)),this.__localCtx}get nodeCtx(){return T.getCtx(this.ctxName,!1)||T.registerCtx({},this.ctxName)}static __parseProp(i,t){let e,s;if(i.startsWith(A.EXT_DATA_CTX_PRFX))e=t.nodeCtx,s=i.replace(A.EXT_DATA_CTX_PRFX,"");else if(i.includes(A.NAMED_DATA_CTX_SPLTR)){let n=i.split(A.NAMED_DATA_CTX_SPLTR);e=T.getCtx(n[0]),s=n[1]}else e=t.localCtx,s=i;return{ctx:e,name:s}}sub(i,t,e=!0){let s=l(o=>{this.isConnected&&t(o)},"subCb"),n=bt.__parseProp(i,this);n.ctx.has(n.name)?this.allSubs.add(n.ctx.sub(n.name,s,e)):window.setTimeout(()=>{this.allSubs.add(n.ctx.sub(n.name,s,e))})}notify(i){let t=bt.__parseProp(i,this);t.ctx.notify(t.name)}has(i){let t=bt.__parseProp(i,this);return t.ctx.has(t.name)}add(i,t,e=!1){let s=bt.__parseProp(i,this);s.ctx.add(s.name,t,e)}add$(i,t=!1){for(let e in i)this.add(e,i[e],t)}get $(){if(!this.__stateProxy){let i=Object.create(null);this.__stateProxy=new Proxy(i,{set:(t,e,s)=>{let n=bt.__parseProp(e,this);return n.ctx.pub(n.name,s),!0},get:(t,e)=>{let s=bt.__parseProp(e,this);return s.ctx.read(s.name)}})}return this.__stateProxy}set$(i,t=!1){for(let e in i){let s=i[e];t||![String,Number,Boolean].includes(s==null?void 0:s.constructor)?this.$[e]=s:this.$[e]!==s&&(this.$[e]=s)}}get __ctxOwner(){return this.ctxOwner||this.hasAttribute(A.CTX_OWNER_ATTR)&&this.getAttribute(A.CTX_OWNER_ATTR)!=="false"}__initDataCtx(){let i=this.constructor.__attrDesc;if(i)for(let t of Object.values(i))Object.keys(this.init$).includes(t)||(this.init$[t]="");for(let t in this.init$)if(t.startsWith(A.EXT_DATA_CTX_PRFX))this.nodeCtx.add(t.replace(A.EXT_DATA_CTX_PRFX,""),this.init$[t],this.__ctxOwner);else if(t.includes(A.NAMED_DATA_CTX_SPLTR)){let e=t.split(A.NAMED_DATA_CTX_SPLTR),s=e[0].trim(),n=e[1].trim();if(s&&n){let o=T.getCtx(s,!1);o||(o=T.registerCtx({},s)),o.add(n,this.init$[t])}}else this.localCtx.add(t,this.init$[t]);for(let t in this.cssInit$)this.bindCssData(t,this.cssInit$[t]);this.__dataCtxInitialized=!0}connectedCallback(){var i;if(this.isConnected){if(this.__disconnectTimeout&&window.clearTimeout(this.__disconnectTimeout),!this.connectedOnce){let t=(i=this.getAttribute(A.CTX_NAME_ATTR))==null?void 0:i.trim();if(t&&this.style.setProperty(A.CSS_CTX_PROP,`'${t}'`),this.__initDataCtx(),this[A.SET_LATER_KEY]){for(let e in this[A.SET_LATER_KEY])Fr(this,e,this[A.SET_LATER_KEY][e]);delete this[A.SET_LATER_KEY]}this.initChildren=[...this.childNodes];for(let e of Zo)this.addTemplateProcessor(e);if(this.pauseRender)this.__initCallback();else if(this.constructor.__rootStylesLink){let e=this.getRootNode();if(!e)return;if(e==null?void 0:e.querySelector(`link[${A.ROOT_STYLE_ATTR_NAME}="${this.constructor.is}"]`)){this.render();return}let n=this.constructor.__rootStylesLink.cloneNode(!0);n.setAttribute(A.ROOT_STYLE_ATTR_NAME,this.constructor.is),n.onload=()=>{this.render()},e.nodeType===Node.DOCUMENT_NODE?e.head.appendChild(n):e.prepend(n)}else this.render()}this.connectedOnce=!0}}destroyCallback(){}disconnectedCallback(){this.connectedOnce&&(this.dropCssDataCache(),this.readyToDestroy&&(this.__disconnectTimeout&&window.clearTimeout(this.__disconnectTimeout),this.__disconnectTimeout=window.setTimeout(()=>{this.destroyCallback();for(let i of this.allSubs)i.remove(),this.allSubs.delete(i);for(let i of this.tplProcessors)this.tplProcessors.delete(i);ht==null||ht.delete(this.updateCssData),ht!=null&&ht.size||(Dt==null||Dt.disconnect(),Dt=null,ht=null)},100)))}static reg(i,t=!1){i||(Dr++,i=`${A.AUTO_TAG_PRFX}-${Dr}`),this.__tag=i;let e=window.customElements.get(i);if(e){!t&&e!==this&&console.warn([`Element with tag name "${i}" already registered.`,`You're trying to override it with another class "${this.name}".`,"This is most likely a mistake.","New element will not be registered."].join(`
`));return}window.customElements.define(i,t?class extends this{}:this)}static get is(){return this.__tag||this.reg(),this.__tag}static bindAttributes(i){this.observedAttributes=Object.keys(i),this.__attrDesc=i}attributeChangedCallback(i,t,e){var s;if(t===e)return;let n=(s=this.constructor.__attrDesc)==null?void 0:s[i];n?this.__dataCtxInitialized?this.$[n]=e:this.init$[n]=e:this[i]=e}getCssData(i,t=!1){if(this.__cssDataCache||(this.__cssDataCache=Object.create(null)),!Object.keys(this.__cssDataCache).includes(i)){this.__computedStyle||(this.__computedStyle=window.getComputedStyle(this));let e=this.__computedStyle.getPropertyValue(i).trim();try{this.__cssDataCache[i]=sl(e)}catch{!t&&console.warn(`CSS Data error: ${i}`),this.__cssDataCache[i]=null}}return this.__cssDataCache[i]}__extractCssName(i){return i.split("--").map((t,e)=>e===0?"":t).join("--")}__initStyleAttrObserver(){ht||(ht=new Set),ht.add(this.updateCssData),Dt||(Dt=new MutationObserver(i=>{i[0].type==="attributes"&&ht.forEach(t=>{t()})}),Dt.observe(document,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["style"]}))}bindCssData(i,t=""){this.__boundCssProps||(this.__boundCssProps=new Set),this.__boundCssProps.add(i);let e=this.getCssData(this.__extractCssName(i),!0);e===null&&(e=t),this.add(i,e),this.__initStyleAttrObserver()}dropCssDataCache(){this.__cssDataCache=null,this.__computedStyle=null}defineAccessor(i,t,e){let s="__"+i;this[s]=this[i],Object.defineProperty(this,i,{set:n=>{this[s]=n,e?window.setTimeout(()=>{t==null||t(n)}):t==null||t(n)},get:()=>this[s]}),this[i]=this[s]}static set shadowStyles(i){let t=new Blob([i],{type:"text/css"});this.__shadowStylesUrl=URL.createObjectURL(t)}static set rootStyles(i){if(!this.__rootStylesLink){let t=new Blob([i],{type:"text/css"}),e=URL.createObjectURL(t),s=document.createElement("link");s.href=e,s.rel="stylesheet",this.__rootStylesLink=s}}},l(pe,"_BaseComponent"),pe),Ot=bt;Zi(Ot,"template");var fe,Ji=(fe=class{static _print(i){console.warn(i)}static setDefaultTitle(i){this.defaultTitle=i}static setRoutingMap(i){Object.assign(this.appMap,i);for(let t in this.appMap)!this.defaultRoute&&this.appMap[t].default===!0?this.defaultRoute=t:!this.errorRoute&&this.appMap[t].error===!0&&(this.errorRoute=t)}static set routingEventName(i){this.__routingEventName=i}static get routingEventName(){return this.__routingEventName||"sym-on-route"}static readAddressBar(){let i={route:null,options:{}};return window.location.search.split(this.separator).forEach(e=>{if(e.includes("?"))i.route=e.replace("?","");else if(e.includes("=")){let s=e.split("=");i.options[s[0]]=decodeURI(s[1])}else i.options[e]=!0}),i}static notify(){let i=this.readAddressBar(),t=this.appMap[i.route];if(t&&t.title&&(document.title=t.title),i.route===null&&this.defaultRoute){this.applyRoute(this.defaultRoute);return}else if(!t&&this.errorRoute){this.applyRoute(this.errorRoute);return}else if(!t&&this.defaultRoute){this.applyRoute(this.defaultRoute);return}else if(!t){this._print(`Route "${i.route}" not found...`);return}let e=new CustomEvent(Ji.routingEventName,{detail:{route:i.route,options:Object.assign(t||{},i.options)}});window.dispatchEvent(e)}static reflect(i,t={}){let e=this.appMap[i];if(!e){this._print("Wrong route: "+i);return}let s="?"+i;for(let o in t)t[o]===!0?s+=this.separator+o:s+=this.separator+o+`=${t[o]}`;let n=e.title||this.defaultTitle||"";window.history.pushState(null,n,s),document.title=n}static applyRoute(i,t={}){this.reflect(i,t),this.notify()}static setSeparator(i){this._separator=i}static get separator(){return this._separator||"&"}static createRouterData(i,t){this.setRoutingMap(t);let e=T.registerCtx({route:null,options:null,title:null},i);return window.addEventListener(this.routingEventName,s=>{var n;e.multiPub({route:s.detail.route,options:s.detail.options,title:((n=s.detail.options)==null?void 0:n.title)||this.defaultTitle||""})}),Ji.notify(),this.initPopstateListener(),e}static initPopstateListener(){this.__onPopstate||(this.__onPopstate=()=>{this.notify()},window.addEventListener("popstate",this.__onPopstate))}static removePopstateListener(){window.removeEventListener("popstate",this.__onPopstate),this.__onPopstate=null}},l(fe,"AppRouter"),fe);Ji.appMap=Object.create(null);function Qi(r,i){for(let t in i)t.includes("-")?r.style.setProperty(t,i[t]):r.style[t]=i[t]}l(Qi,"applyStyles");function rl(r,i){for(let t in i)i[t].constructor===Boolean?i[t]?r.setAttribute(t,""):r.removeAttribute(t):r.setAttribute(t,i[t])}l(rl,"applyAttributes");function be(r={tag:"div"}){let i=document.createElement(r.tag);if(r.attributes&&rl(i,r.attributes),r.styles&&Qi(i,r.styles),r.properties)for(let t in r.properties)i[t]=r.properties[t];return r.processors&&r.processors.forEach(t=>{t(i)}),r.children&&r.children.forEach(t=>{let e=be(t);i.appendChild(e)}),i}l(be,"create");var Br="idb-store-ready",nl="symbiote-db",ol="symbiote-idb-update_",me,ll=(me=class{_notifyWhenReady(i=null){window.dispatchEvent(new CustomEvent(Br,{detail:{dbName:this.name,storeName:this.storeName,event:i}}))}get _updEventName(){return ol+this.name}_getUpdateEvent(i){return new CustomEvent(this._updEventName,{detail:{key:this.name,newValue:i}})}_notifySubscribers(i){window.localStorage.removeItem(this.name),window.localStorage.setItem(this.name,i),window.dispatchEvent(this._getUpdateEvent(i))}constructor(i,t){this.name=i,this.storeName=t,this.version=1,this.request=window.indexedDB.open(this.name,this.version),this.request.onupgradeneeded=e=>{this.db=e.target.result,this.objStore=this.db.createObjectStore(t,{keyPath:"_key"}),this.objStore.transaction.oncomplete=s=>{this._notifyWhenReady(s)}},this.request.onsuccess=e=>{this.db=e.target.result,this._notifyWhenReady(e)},this.request.onerror=e=>{console.error(e)},this._subscriptionsMap={},this._updateHandler=e=>{e.key===this.name&&this._subscriptionsMap[e.newValue]&&this._subscriptionsMap[e.newValue].forEach(async n=>{n(await this.read(e.newValue))})},this._localUpdateHandler=e=>{this._updateHandler(e.detail)},window.addEventListener("storage",this._updateHandler),window.addEventListener(this._updEventName,this._localUpdateHandler)}read(i){let e=this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName).get(i);return new Promise((s,n)=>{e.onsuccess=o=>{var a;(a=o.target.result)!=null&&a._value?s(o.target.result._value):(s(null),console.warn(`IDB: cannot read "${i}"`))},e.onerror=o=>{n(o)}})}write(i,t,e=!1){let s={_key:i,_value:t},o=this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName).put(s);return new Promise((a,c)=>{o.onsuccess=h=>{e||this._notifySubscribers(i),a(h.target.result)},o.onerror=h=>{c(h)}})}delete(i,t=!1){let s=this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName).delete(i);return new Promise((n,o)=>{s.onsuccess=a=>{t||this._notifySubscribers(i),n(a)},s.onerror=a=>{o(a)}})}getAll(){let t=this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName).getAll();return new Promise((e,s)=>{t.onsuccess=n=>{let o=n.target.result;e(o.map(a=>a._value))},t.onerror=n=>{s(n)}})}subscribe(i,t){this._subscriptionsMap[i]||(this._subscriptionsMap[i]=new Set);let e=this._subscriptionsMap[i];return e.add(t),{remove:()=>{e.delete(t),e.size||delete this._subscriptionsMap[i]}}}stop(){window.removeEventListener("storage",this._updateHandler),this._subscriptionsMap=null,zr.clear(this.name)}},l(me,"DbInstance"),me),ge,zr=(ge=class{static get readyEventName(){return Br}static open(i=nl,t="store"){let e=i+"/"+t;return this._reg[e]||(this._reg[e]=new ll(i,t)),this._reg[e]}static clear(i){window.indexedDB.deleteDatabase(i);for(let t in this._reg)t.split("/")[0]===i&&delete this._reg[t]}},l(ge,"IDB"),ge);Zi(zr,"_reg",Object.create(null));var I=Object.freeze({FILE_ADDED:"file-added",FILE_REMOVED:"file-removed",FILE_UPLOAD_START:"file-upload-start",FILE_UPLOAD_PROGRESS:"file-upload-progress",FILE_UPLOAD_SUCCESS:"file-upload-success",FILE_UPLOAD_FAILED:"file-upload-failed",FILE_URL_CHANGED:"file-url-changed",MODAL_OPEN:"modal-open",MODAL_CLOSE:"modal-close",DONE_CLICK:"done-click",UPLOAD_CLICK:"upload-click",ACTIVITY_CHANGE:"activity-change",COMMON_UPLOAD_START:"common-upload-start",COMMON_UPLOAD_PROGRESS:"common-upload-progress",COMMON_UPLOAD_SUCCESS:"common-upload-success",COMMON_UPLOAD_FAILED:"common-upload-failed",CHANGE:"change",GROUP_CREATED:"group-created"}),ts=class ts{constructor(i){u(this,"_timeoutStore",new Map);u(this,"_targets",new Set);u(this,"_debugPrint",null);this._debugPrint=i}bindTarget(i){this._targets.add(i)}unbindTarget(i){this._targets.delete(i)}_dispatch(i,t){var e;for(let s of this._targets)s.dispatchEvent(new CustomEvent(i,{detail:t}));(e=this._debugPrint)==null||e.call(this,()=>{let s=t&&typeof t=="object"?{...t}:t;return[`event "${i}"`,s]})}emit(i,t,{debounce:e}={}){if(typeof e!="number"&&!e){this._dispatch(i,typeof t=="function"?t():t);return}this._timeoutStore.has(i)&&window.clearTimeout(this._timeoutStore.get(i));let s=typeof e=="number"?e:20,n=window.setTimeout(()=>{this._dispatch(i,typeof t=="function"?t():t),this._timeoutStore.delete(i)},s);this._timeoutStore.set(i,n)}};l(ts,"EventEmitter");var ri=ts;function k(r,i){let t,e=l((...s)=>{clearTimeout(t),t=setTimeout(()=>r(...s),i)},"debounced");return e.cancel=()=>{clearTimeout(t)},e}l(k,"debounce");var Vr="--uploadcare-blocks-window-height",_e=class _e{static registerClient(i){this.clientsRegistry.size===0&&this.attachTracker(),this.clientsRegistry.add(i)}static unregisterClient(i){this.clientsRegistry.delete(i),this.clientsRegistry.size===0&&this.detachTracker()}static attachTracker(){window.addEventListener("resize",this.flush,{passive:!0,capture:!0}),this.flush()}static detachTracker(){window.removeEventListener("resize",this.flush,{capture:!0}),document.documentElement.style.removeProperty(Vr)}};l(_e,"WindowHeightTracker"),u(_e,"clientsRegistry",new Set),u(_e,"flush",k(()=>{document.documentElement.style.setProperty(Vr,`${window.innerHeight}px`)},100));var ye=_e;var jr=l(r=>{var e;let i=new Intl.Locale(r),t="ltr";return typeof i.getTextInfo=="function"&&i.getTextInfo().direction?t=i.getTextInfo().direction:"textInfo"in i&&((e=i.textInfo)!=null&&e.direction)&&(t=i.textInfo.direction),t},"getLocaleDirection");var ni=l((r,i)=>new Intl.PluralRules(r).select(i),"getPluralForm");var al=l(r=>r,"DEFAULT_TRANSFORMER"),es="{{",Gr="}}",Hr="plural:";function ve(r,i,t={}){var o;let{openToken:e=es,closeToken:s=Gr,transform:n=al}=t;for(let a in i){let c=(o=i[a])==null?void 0:o.toString();r=r.replaceAll(e+a+s,typeof c=="string"?n(c):c)}return r}l(ve,"applyTemplateData");function Wr(r){let i=[],t=r.indexOf(es);for(;t!==-1;){let e=r.indexOf(Gr,t),s=r.substring(t+2,e);if(s.startsWith(Hr)){let n=r.substring(t+2,e).replace(Hr,""),o=n.substring(0,n.indexOf("(")),a=n.substring(n.indexOf("(")+1,n.indexOf(")"));i.push({variable:s,pluralKey:o,countVariable:a})}t=r.indexOf(es,e)}return i}l(Wr,"getPluralObjects");var Xr=l(({element:r,attribute:i,onSuccess:t,onTimeout:e,timeout:s=300})=>{let n=r.getAttribute(i);if(n!==null){t(n);return}let o=new MutationObserver(h=>{let d=h[h.length-1];c(d)});o.observe(r,{attributes:!0,attributeFilter:[i]});let a=setTimeout(()=>{o.disconnect(),e()},s),c=l(h=>{let d=r.getAttribute(i);h.type==="attributes"&&h.attributeName===i&&d!==null&&(clearTimeout(a),o.disconnect(),t(d))},"handleMutation")},"waitForAttribute");function qr(r){return Object.prototype.toString.call(r)==="[object Object]"}l(qr,"isObject");var cl=/\W|_/g;function hl(r){return r.split(cl).map((i,t)=>i.charAt(0)[t>0?"toUpperCase":"toLowerCase"]()+i.slice(1)).join("")}l(hl,"camelizeString");function Kr(r,{ignoreKeys:i}={ignoreKeys:[]}){return Array.isArray(r)?r.map(t=>pt(t,{ignoreKeys:i})):r}l(Kr,"camelizeArrayItems");function pt(r,{ignoreKeys:i}={ignoreKeys:[]}){if(Array.isArray(r))return Kr(r,{ignoreKeys:i});if(!qr(r))return r;let t={};for(let e of Object.keys(r)){let s=r[e];if(i.includes(e)){t[e]=s;continue}qr(s)?s=pt(s,{ignoreKeys:i}):Array.isArray(s)&&(s=Kr(s,{ignoreKeys:i})),t[hl(e)]=s}return t}l(pt,"camelizeKeys");var ul=l(r=>new Promise(i=>setTimeout(i,r)),"delay");function as({libraryName:r,libraryVersion:i,userAgent:t,publicKey:e="",integration:s=""}){let n="JavaScript";if(typeof t=="string")return t;if(typeof t=="function")return t({publicKey:e,libraryName:r,libraryVersion:i,languageName:n,integration:s});let o=[r,i,e].filter(Boolean).join("/"),a=[n,s].filter(Boolean).join("; ");return`${o} (${a})`}l(as,"getUserAgent$1");var dl={factor:2,time:100};function pl(r,i=dl){let t=0;function e(s){let n=Math.round(i.time*i.factor**t);return s({attempt:t,retry:l(a=>ul(a!=null?a:n).then(()=>(t+=1,e(s))),"retry")})}return l(e,"runAttempt"),e(r)}l(pl,"retrier");var fs=class fs extends Error{};l(fs,"UploadcareError");var Ce=fs,li=class li extends Ce{constructor(t){super();u(this,"originalProgressEvent");this.name="NetworkError",this.message="Network error",Object.setPrototypeOf(this,li.prototype),this.originalProgressEvent=t}};l(li,"NetworkError");var Ft=li,hi=l((r,i)=>{r&&(r.aborted?Promise.resolve().then(i):r.addEventListener("abort",()=>i(),{once:!0}))},"onCancel"),ai=class ai extends Ce{constructor(t="Request canceled"){super(t);u(this,"isCancel",!0);this.name="CancelError",Object.setPrototypeOf(this,ai.prototype)}};l(ai,"CancelError");var _t=ai,fl=500,Jr=l(({check:r,interval:i=fl,timeout:t,signal:e})=>new Promise((s,n)=>{let o,a;hi(e,()=>{o&&clearTimeout(o),n(new _t("Poll cancelled"))}),t&&(a=setTimeout(()=>{o&&clearTimeout(o),n(new _t("Timed out"))},t));let c=l(()=>{try{Promise.resolve(r(e)).then(h=>{h?(a&&clearTimeout(a),s(h)):o=setTimeout(c,i)}).catch(h=>{a&&clearTimeout(a),n(h)})}catch(h){a&&clearTimeout(a),n(h)}},"tick");o=setTimeout(c,0)}),"poll"),$={baseCDN:"https://ucarecdn.com",baseURL:"https://upload.uploadcare.com",maxContentLength:50*1024*1024,retryThrottledRequestMaxTimes:1,retryNetworkErrorMaxTimes:3,multipartMinFileSize:25*1024*1024,multipartChunkSize:5*1024*1024,multipartMinLastPartSize:1024*1024,maxConcurrentRequests:4,pollingTimeoutMilliseconds:1e4,pusherKey:"79ae88bd931ea68464d9"},ui="application/octet-stream",Zr="original",yt=l(({method:r,url:i,data:t,headers:e={},signal:s,onProgress:n})=>new Promise((o,a)=>{let c=new XMLHttpRequest,h=(r==null?void 0:r.toUpperCase())||"GET",d=!1;c.open(h,i,!0),e&&Object.entries(e).forEach(p=>{let[f,g]=p;typeof g!="undefined"&&!Array.isArray(g)&&c.setRequestHeader(f,g)}),c.responseType="text",hi(s,()=>{d=!0,c.abort(),a(new _t)}),c.onload=()=>{if(c.status!=200)a(new Error(`Error ${c.status}: ${c.statusText}`));else{let p={method:h,url:i,data:t,headers:e||void 0,signal:s,onProgress:n},f=c.getAllResponseHeaders().trim().split(/[\r\n]+/),g={};f.forEach(function(v){let x=v.split(": "),C=x.shift(),E=x.join(": ");C&&typeof C!="undefined"&&(g[C]=E)});let m=c.response,b=c.status;o({request:p,data:m,headers:g,status:b})}},c.onerror=p=>{d||a(new Ft(p))},n&&typeof n=="function"&&(c.upload.onprogress=p=>{p.lengthComputable?n({isComputable:!0,value:p.loaded/p.total}):n({isComputable:!1})}),t?c.send(t):c.send()}),"request");function ml(r,...i){return r}l(ml,"identity");var gl=l(({name:r})=>r?[r]:[],"getFileOptions"),bl=ml,_l=l(()=>new FormData,"getFormData"),Qr=l(r=>!1,"isBuffer"),di=l(r=>typeof Blob!="undefined"&&r instanceof Blob,"isBlob"),pi=l(r=>typeof File!="undefined"&&r instanceof File,"isFile"),fi=l(r=>!!r&&typeof r=="object"&&!Array.isArray(r)&&"uri"in r&&typeof r.uri=="string","isReactNativeAsset"),Bt=l(r=>di(r)||pi(r)||Qr()||fi(r),"isFileData"),yl=l(r=>typeof r=="string"||typeof r=="number"||typeof r=="undefined","isSimpleValue"),vl=l(r=>!!r&&typeof r=="object"&&!Array.isArray(r),"isObjectValue"),Cl=l(r=>!!r&&typeof r=="object"&&"data"in r&&Bt(r.data),"isFileValue");function tn(r,i,t){if(Array.isArray(t))for(let e of t)tn(r,`${i}[]`,e);else if(Cl(t)){let{name:e,contentType:s}=t,n=bl(t.data,e,s!=null?s:ui),o=gl({name:e,contentType:s});r.push([i,n,...o])}else if(vl(t))for(let[e,s]of Object.entries(t))typeof s!="undefined"&&r.push([`${i}[${e}]`,String(s)]);else yl(t)&&t&&r.push([i,t.toString()])}l(tn,"collectParams");function wl(r){let i=[];for(let[t,e]of Object.entries(r))tn(i,t,e);return i}l(wl,"getFormDataParams");function mi(r){let i=_l(),t=wl(r);for(let e of t){let[s,n,...o]=e;i.append(s,n,...o)}return i}l(mi,"buildFormData");var ci=class ci extends Ce{constructor(t,e,s,n,o){super();u(this,"code");u(this,"request");u(this,"response");u(this,"headers");this.name="UploadError",this.message=t,this.code=e,this.request=s,this.response=n,this.headers=o,Object.setPrototypeOf(this,ci.prototype)}};l(ci,"UploadError");var N=ci,Al=l(r=>{let i=new URLSearchParams;for(let[t,e]of Object.entries(r))e&&typeof e=="object"&&!Array.isArray(e)?Object.entries(e).filter(s=>{var n;return(n=s[1])!=null?n:!1}).forEach(s=>i.set(`${t}[${s[0]}]`,String(s[1]))):Array.isArray(e)?e.forEach(s=>{i.append(`${t}[]`,s)}):typeof e=="string"&&e?i.set(t,e):typeof e=="number"&&i.set(t,e.toString());return i.toString()},"buildSearchParams"),ut=l((r,i,t)=>{let e=new URL(r);return e.pathname=(e.pathname+i).replace("//","/"),t&&(e.search=Al(t)),e.toString()},"getUrl"),El="6.14.1",xl="UploadcareUploadClient",Tl=El;function kt(r){return as({libraryName:xl,libraryVersion:Tl,...r})}l(kt,"getUserAgent");var Sl="RequestThrottledError",Yr=15e3,$l=1e3;function Il(r){let{headers:i}=r||{};if(!i||typeof i["retry-after"]!="string")return Yr;let t=parseInt(i["retry-after"],10);return Number.isFinite(t)?t*1e3:Yr}l(Il,"getTimeoutFromThrottledRequest");function vt(r,i){let{retryThrottledRequestMaxTimes:t,retryNetworkErrorMaxTimes:e}=i;return pl(({attempt:s,retry:n})=>r().catch(o=>{if("response"in o&&(o==null?void 0:o.code)===Sl&&s<t)return n(Il(o));if(o instanceof Ft&&s<e)return n((s+1)*$l);throw o}))}l(vt,"retryIfFailed");var en=l(r=>{let i="";return(di(r)||pi(r)||fi(r))&&(i=r.type),i||ui},"getContentType"),sn=l(r=>{let i="";return pi(r)&&r.name?i=r.name:di(r)||Qr()?i="":fi(r)&&r.name&&(i=r.name),i||Zr},"getFileName");function cs(r){return typeof r=="undefined"||r==="auto"?"auto":r?"1":"0"}l(cs,"getStoreValue");function Ol(r,{publicKey:i,fileName:t,contentType:e,baseURL:s=$.baseURL,secureSignature:n,secureExpire:o,store:a,signal:c,onProgress:h,source:d="local",integration:p,userAgent:f,retryThrottledRequestMaxTimes:g=$.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:m=$.retryNetworkErrorMaxTimes,metadata:b}){return vt(()=>yt({method:"POST",url:ut(s,"/base/",{jsonerrors:1}),headers:{"X-UC-User-Agent":kt({publicKey:i,integration:p,userAgent:f})},data:mi({file:{data:r,name:t||sn(r),contentType:e||en(r)},UPLOADCARE_PUB_KEY:i,UPLOADCARE_STORE:cs(a),signature:n,expire:o,source:d,metadata:b}),signal:c,onProgress:h}).then(({data:v,headers:x,request:C})=>{let E=pt(JSON.parse(v));if("error"in E)throw new N(E.error.content,E.error.errorCode,C,E,x);return E}),{retryNetworkErrorMaxTimes:m,retryThrottledRequestMaxTimes:g})}l(Ol,"base");var rs;(function(r){r.Token="token",r.FileInfo="file_info"})(rs||(rs={}));function kl(r,{publicKey:i,baseURL:t=$.baseURL,store:e,fileName:s,checkForUrlDuplicates:n,saveUrlForRecurrentUploads:o,secureSignature:a,secureExpire:c,source:h="url",signal:d,integration:p,userAgent:f,retryThrottledRequestMaxTimes:g=$.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:m=$.retryNetworkErrorMaxTimes,metadata:b}){return vt(()=>yt({method:"POST",headers:{"X-UC-User-Agent":kt({publicKey:i,integration:p,userAgent:f})},url:ut(t,"/from_url/",{jsonerrors:1,pub_key:i,source_url:r,store:cs(e),filename:s,check_URL_duplicates:n?1:void 0,save_URL_duplicates:o?1:void 0,signature:a,expire:c,source:h,metadata:b}),signal:d}).then(({data:v,headers:x,request:C})=>{let E=pt(JSON.parse(v));if("error"in E)throw new N(E.error.content,E.error.errorCode,C,E,x);return E}),{retryNetworkErrorMaxTimes:m,retryThrottledRequestMaxTimes:g})}l(kl,"fromUrl");var j;(function(r){r.Unknown="unknown",r.Waiting="waiting",r.Progress="progress",r.Error="error",r.Success="success"})(j||(j={}));var Ll=l(r=>"status"in r&&r.status===j.Error,"isErrorResponse");function Pl(r,{publicKey:i,baseURL:t=$.baseURL,signal:e,integration:s,userAgent:n,retryThrottledRequestMaxTimes:o=$.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:a=$.retryNetworkErrorMaxTimes}={}){return vt(()=>yt({method:"GET",headers:i?{"X-UC-User-Agent":kt({publicKey:i,integration:s,userAgent:n})}:void 0,url:ut(t,"/from_url/status/",{jsonerrors:1,token:r}),signal:e}).then(({data:c,headers:h,request:d})=>{let p=pt(JSON.parse(c));if("error"in p&&!Ll(p))throw new N(p.error.content,p.error.errorCode,d,p,h);return p}),{retryNetworkErrorMaxTimes:a,retryThrottledRequestMaxTimes:o})}l(Pl,"fromUrlStatus");function Ul(r,{publicKey:i,baseURL:t=$.baseURL,jsonpCallback:e,secureSignature:s,secureExpire:n,signal:o,source:a,integration:c,userAgent:h,retryThrottledRequestMaxTimes:d=$.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:p=$.retryNetworkErrorMaxTimes}){return vt(()=>yt({method:"POST",headers:{"X-UC-User-Agent":kt({publicKey:i,integration:c,userAgent:h})},url:ut(t,"/group/",{jsonerrors:1}),data:mi({files:r,callback:e,pub_key:i,signature:s,expire:n,source:a}),signal:o}).then(({data:f,headers:g,request:m})=>{let b=pt(JSON.parse(f));if("error"in b)throw new N(b.error.content,b.error.errorCode,m,b,g);return b}),{retryNetworkErrorMaxTimes:p,retryThrottledRequestMaxTimes:d})}l(Ul,"group");function rn(r,{publicKey:i,baseURL:t=$.baseURL,signal:e,source:s,integration:n,userAgent:o,retryThrottledRequestMaxTimes:a=$.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:c=$.retryNetworkErrorMaxTimes}){return vt(()=>yt({method:"GET",headers:{"X-UC-User-Agent":kt({publicKey:i,integration:n,userAgent:o})},url:ut(t,"/info/",{jsonerrors:1,pub_key:i,file_id:r,source:s}),signal:e}).then(({data:h,headers:d,request:p})=>{let f=pt(JSON.parse(h));if("error"in f)throw new N(f.error.content,f.error.errorCode,p,f,d);return f}),{retryThrottledRequestMaxTimes:a,retryNetworkErrorMaxTimes:c})}l(rn,"info");function Rl(r,{publicKey:i,contentType:t,fileName:e,multipartChunkSize:s=$.multipartChunkSize,baseURL:n="",secureSignature:o,secureExpire:a,store:c,signal:h,source:d="local",integration:p,userAgent:f,retryThrottledRequestMaxTimes:g=$.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:m=$.retryNetworkErrorMaxTimes,metadata:b}){return vt(()=>yt({method:"POST",url:ut(n,"/multipart/start/",{jsonerrors:1}),headers:{"X-UC-User-Agent":kt({publicKey:i,integration:p,userAgent:f})},data:mi({filename:e||Zr,size:r,content_type:t||ui,part_size:s,UPLOADCARE_STORE:cs(c),UPLOADCARE_PUB_KEY:i,signature:o,expire:a,source:d,metadata:b}),signal:h}).then(({data:v,headers:x,request:C})=>{let E=pt(JSON.parse(v));if("error"in E)throw new N(E.error.content,E.error.errorCode,C,E,x);return E.parts=Object.keys(E.parts).map(z=>E.parts[Number(z)]),E}),{retryThrottledRequestMaxTimes:g,retryNetworkErrorMaxTimes:m})}l(Rl,"multipartStart");function Ml(r,i,{contentType:t,signal:e,onProgress:s,retryThrottledRequestMaxTimes:n=$.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:o=$.retryNetworkErrorMaxTimes}){return vt(()=>yt({method:"PUT",url:i,data:r,onProgress:s,signal:e,headers:{"Content-Type":t||ui}}).then(a=>(s&&s({isComputable:!0,value:1}),a)).then(({status:a})=>({code:a})),{retryThrottledRequestMaxTimes:n,retryNetworkErrorMaxTimes:o})}l(Ml,"multipartUpload");function Dl(r,{publicKey:i,baseURL:t=$.baseURL,source:e="local",signal:s,integration:n,userAgent:o,retryThrottledRequestMaxTimes:a=$.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:c=$.retryNetworkErrorMaxTimes}){return vt(()=>yt({method:"POST",url:ut(t,"/multipart/complete/",{jsonerrors:1}),headers:{"X-UC-User-Agent":kt({publicKey:i,integration:n,userAgent:o})},data:mi({uuid:r,UPLOADCARE_PUB_KEY:i,source:e}),signal:s}).then(({data:h,headers:d,request:p})=>{let f=pt(JSON.parse(h));if("error"in f)throw new N(f.error.content,f.error.errorCode,p,f,d);return f}),{retryThrottledRequestMaxTimes:a,retryNetworkErrorMaxTimes:c})}l(Dl,"multipartComplete");function hs(r,{publicKey:i,baseURL:t,source:e,integration:s,userAgent:n,retryThrottledRequestMaxTimes:o,retryNetworkErrorMaxTimes:a,signal:c,onProgress:h}){return Jr({check:d=>rn(r,{publicKey:i,baseURL:t,signal:d,source:e,integration:s,userAgent:n,retryThrottledRequestMaxTimes:o,retryNetworkErrorMaxTimes:a}).then(p=>p.isReady?p:(h&&h({isComputable:!0,value:1}),!1)),signal:c})}l(hs,"isReadyPoll");function Nl(r){return"defaultEffects"in r}l(Nl,"isGroupFileInfo");var ms=class ms{constructor(i,{baseCDN:t=$.baseCDN,fileName:e}={}){u(this,"uuid");u(this,"name",null);u(this,"size",null);u(this,"isStored",null);u(this,"isImage",null);u(this,"mimeType",null);u(this,"cdnUrl",null);u(this,"s3Url",null);u(this,"originalFilename",null);u(this,"imageInfo",null);u(this,"videoInfo",null);u(this,"contentInfo",null);u(this,"metadata",null);u(this,"s3Bucket",null);u(this,"defaultEffects",null);let{uuid:s,s3Bucket:n}=i,o=ut(t,`${s}/`),a=n?ut(`https://${n}.s3.amazonaws.com/`,`${s}/${i.filename}`):null;this.uuid=s,this.name=e||i.filename,this.size=i.size,this.isStored=i.isStored,this.isImage=i.isImage,this.mimeType=i.mimeType,this.cdnUrl=o,this.originalFilename=i.originalFilename,this.imageInfo=i.imageInfo,this.videoInfo=i.videoInfo,this.contentInfo=i.contentInfo,this.metadata=i.metadata||null,this.s3Bucket=n||null,this.s3Url=a,Nl(i)&&(this.defaultEffects=i.defaultEffects)}};l(ms,"UploadcareFile");var dt=ms,Fl=l((r,{publicKey:i,fileName:t,baseURL:e,secureSignature:s,secureExpire:n,store:o,contentType:a,signal:c,onProgress:h,source:d,integration:p,userAgent:f,retryThrottledRequestMaxTimes:g,retryNetworkErrorMaxTimes:m,baseCDN:b,metadata:v})=>Ol(r,{publicKey:i,fileName:t,contentType:a,baseURL:e,secureSignature:s,secureExpire:n,store:o,signal:c,onProgress:h,source:d,integration:p,userAgent:f,retryThrottledRequestMaxTimes:g,retryNetworkErrorMaxTimes:m,metadata:v}).then(({file:x})=>hs(x,{publicKey:i,baseURL:e,source:d,integration:p,userAgent:f,retryThrottledRequestMaxTimes:g,retryNetworkErrorMaxTimes:m,onProgress:h,signal:c})).then(x=>new dt(x,{baseCDN:b})),"uploadDirect"),Bl=l((r,{publicKey:i,fileName:t,baseURL:e,signal:s,onProgress:n,source:o,integration:a,userAgent:c,retryThrottledRequestMaxTimes:h,retryNetworkErrorMaxTimes:d,baseCDN:p})=>rn(r,{publicKey:i,baseURL:e,signal:s,source:o,integration:a,userAgent:c,retryThrottledRequestMaxTimes:h,retryNetworkErrorMaxTimes:d}).then(f=>new dt(f,{baseCDN:p,fileName:t})).then(f=>(n&&n({isComputable:!0,value:1}),f)),"uploadFromUploaded"),zl=l((r,{signal:i}={})=>{let t=null,e=null,s=r.map(()=>new AbortController),n=l(o=>()=>{e=o,s.forEach((a,c)=>c!==o&&a.abort())},"createStopRaceCallback");return hi(i,()=>{s.forEach(o=>o.abort())}),Promise.all(r.map((o,a)=>{let c=n(a);return Promise.resolve().then(()=>o({stopRace:c,signal:s[a].signal})).then(h=>(c(),h)).catch(h=>(t=h,null))})).then(o=>{if(e===null)throw t;return o[e]})},"race"),Vl=window.WebSocket,gs=class gs{constructor(){u(this,"events",Object.create({}))}emit(i,t){var e;(e=this.events[i])==null||e.forEach(s=>s(t))}on(i,t){this.events[i]=this.events[i]||[],this.events[i].push(t)}off(i,t){t?this.events[i]=this.events[i].filter(e=>e!==t):this.events[i]=[]}};l(gs,"Events");var ns=gs,jl=l((r,i)=>r==="success"?{status:j.Success,...i}:r==="progress"?{status:j.Progress,...i}:{status:j.Error,...i},"response"),bs=class bs{constructor(i,t=3e4){u(this,"key");u(this,"disconnectTime");u(this,"ws");u(this,"queue",[]);u(this,"isConnected",!1);u(this,"subscribers",0);u(this,"emmitter",new ns);u(this,"disconnectTimeoutId",null);this.key=i,this.disconnectTime=t}connect(){if(this.disconnectTimeoutId&&clearTimeout(this.disconnectTimeoutId),!this.isConnected&&!this.ws){let i=`wss://ws.pusherapp.com/app/${this.key}?protocol=5&client=js&version=1.12.2`;this.ws=new Vl(i),this.ws.addEventListener("error",t=>{this.emmitter.emit("error",new Error(t.message))}),this.emmitter.on("connected",()=>{this.isConnected=!0,this.queue.forEach(t=>this.send(t.event,t.data)),this.queue=[]}),this.ws.addEventListener("message",t=>{let e=JSON.parse(t.data.toString());switch(e.event){case"pusher:connection_established":{this.emmitter.emit("connected",void 0);break}case"pusher:ping":{this.send("pusher:pong",{});break}case"progress":case"success":case"fail":this.emmitter.emit(e.channel,jl(e.event,JSON.parse(e.data)))}})}}disconnect(){let i=l(()=>{var t;(t=this.ws)==null||t.close(),this.ws=void 0,this.isConnected=!1},"actualDisconect");this.disconnectTime?this.disconnectTimeoutId=setTimeout(()=>{i()},this.disconnectTime):i()}send(i,t){var s;let e=JSON.stringify({event:i,data:t});(s=this.ws)==null||s.send(e)}subscribe(i,t){this.subscribers+=1,this.connect();let e=`task-status-${i}`,s={event:"pusher:subscribe",data:{channel:e}};this.emmitter.on(e,t),this.isConnected?this.send(s.event,s.data):this.queue.push(s)}unsubscribe(i){this.subscribers-=1;let t=`task-status-${i}`,e={event:"pusher:unsubscribe",data:{channel:t}};this.emmitter.off(t),this.isConnected?this.send(e.event,e.data):this.queue=this.queue.filter(s=>s.data.channel!==t),this.subscribers===0&&this.disconnect()}onError(i){return this.emmitter.on("error",i),()=>this.emmitter.off("error",i)}};l(bs,"Pusher");var os=bs,is=null,us=l(r=>{if(!is){let i=typeof window=="undefined"?0:3e4;is=new os(r,i)}return is},"getPusher"),Hl=l(r=>{us(r).connect()},"preconnect");function Gl({token:r,publicKey:i,baseURL:t,integration:e,userAgent:s,retryThrottledRequestMaxTimes:n,retryNetworkErrorMaxTimes:o,onProgress:a,signal:c}){return Jr({check:h=>Pl(r,{publicKey:i,baseURL:t,integration:e,userAgent:s,retryThrottledRequestMaxTimes:n,retryNetworkErrorMaxTimes:o,signal:h}).then(d=>{switch(d.status){case j.Error:return new N(d.error,d.errorCode);case j.Waiting:return!1;case j.Unknown:return new N(`Token "${r}" was not found.`);case j.Progress:return a&&(d.total==="unknown"?a({isComputable:!1}):a({isComputable:!0,value:d.done/d.total})),!1;case j.Success:return a&&a({isComputable:!0,value:d.done/d.total}),d;default:throw new Error("Unknown status")}}),signal:c})}l(Gl,"pollStrategy");var Wl=l(({token:r,pusherKey:i,signal:t,onProgress:e})=>new Promise((s,n)=>{let o=us(i),a=o.onError(n),c=l(()=>{a(),o.unsubscribe(r)},"destroy");hi(t,()=>{c(),n(new _t("pusher cancelled"))}),o.subscribe(r,h=>{switch(h.status){case j.Progress:{e&&(h.total==="unknown"?e({isComputable:!1}):e({isComputable:!0,value:h.done/h.total}));break}case j.Success:{c(),e&&e({isComputable:!0,value:h.done/h.total}),s(h);break}case j.Error:c(),n(new N(h.msg,h.error_code))}})}),"pushStrategy"),Xl=l((r,{publicKey:i,fileName:t,baseURL:e,baseCDN:s,checkForUrlDuplicates:n,saveUrlForRecurrentUploads:o,secureSignature:a,secureExpire:c,store:h,signal:d,onProgress:p,source:f,integration:g,userAgent:m,retryThrottledRequestMaxTimes:b,pusherKey:v=$.pusherKey,metadata:x})=>Promise.resolve(Hl(v)).then(()=>kl(r,{publicKey:i,fileName:t,baseURL:e,checkForUrlDuplicates:n,saveUrlForRecurrentUploads:o,secureSignature:a,secureExpire:c,store:h,signal:d,source:f,integration:g,userAgent:m,retryThrottledRequestMaxTimes:b,metadata:x})).catch(C=>{let E=us(v);return E==null||E.disconnect(),Promise.reject(C)}).then(C=>C.type===rs.FileInfo?C:zl([({signal:E})=>Gl({token:C.token,publicKey:i,baseURL:e,integration:g,userAgent:m,retryThrottledRequestMaxTimes:b,onProgress:p,signal:E}),({signal:E})=>Wl({token:C.token,pusherKey:v,signal:E,onProgress:p})],{signal:d})).then(C=>{if(C instanceof N)throw C;return C}).then(C=>hs(C.uuid,{publicKey:i,baseURL:e,integration:g,userAgent:m,retryThrottledRequestMaxTimes:b,onProgress:p,signal:d})).then(C=>new dt(C,{baseCDN:s})),"uploadFromUrl"),ss=new WeakMap,ql=l(async r=>{if(ss.has(r))return ss.get(r);let i=await fetch(r.uri).then(t=>t.blob());return ss.set(r,i),i},"getBlobFromReactNativeAsset"),nn=l(async r=>{if(pi(r)||di(r))return r.size;if(fi(r))return(await ql(r)).size;throw new Error("Unknown file type. Cannot determine file size.")},"getFileSize"),Kl=l((r,i=$.multipartMinFileSize)=>r>=i,"isMultipart"),on=l(r=>{let i="[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}",t=new RegExp(i);return!Bt(r)&&t.test(r)},"isUuid"),ds=l(r=>{let i="^(?:\\w+:)?\\/\\/([^\\s\\.]+\\.\\S{2}|localhost[\\:?\\d]*)\\S*$",t=new RegExp(i);return!Bt(r)&&t.test(r)},"isUrl"),Yl=l((r,i)=>new Promise((t,e)=>{let s=[],n=!1,o=i.length,a=[...i],c=l(()=>{let h=i.length-a.length,d=a.shift();d&&d().then(p=>{n||(s[h]=p,o-=1,o?c():t(s))}).catch(p=>{n=!0,e(p)})},"run");for(let h=0;h<r;h++)c()}),"runWithConcurrency"),Jl=l((r,i,t,e)=>{let s=e*i,n=Math.min(s+e,t);return r.slice(s,n)},"sliceChunk"),Zl=l(async(r,i,t)=>e=>Jl(r,e,i,t),"prepareChunks"),Ql=l((r,i,{publicKey:t,contentType:e,onProgress:s,signal:n,integration:o,retryThrottledRequestMaxTimes:a,retryNetworkErrorMaxTimes:c})=>Ml(r,i,{publicKey:t,contentType:e,onProgress:s,signal:n,integration:o,retryThrottledRequestMaxTimes:a,retryNetworkErrorMaxTimes:c}),"uploadPart"),ta=l(async(r,{publicKey:i,fileName:t,fileSize:e,baseURL:s,secureSignature:n,secureExpire:o,store:a,signal:c,onProgress:h,source:d,integration:p,userAgent:f,retryThrottledRequestMaxTimes:g,retryNetworkErrorMaxTimes:m,contentType:b,multipartChunkSize:v=$.multipartChunkSize,maxConcurrentRequests:x=$.maxConcurrentRequests,baseCDN:C,metadata:E})=>{let z=e!=null?e:await nn(r),at,$t=l((U,V)=>{if(!h)return;at||(at=Array(U).fill(0));let Z=l(tt=>tt.reduce((ct,Yi)=>ct+Yi,0),"sum");return tt=>{tt.isComputable&&(at[V]=tt.value,h({isComputable:!0,value:Z(at)/U}))}},"createProgressHandler");return b||(b=en(r)),Rl(z,{publicKey:i,contentType:b,fileName:t||sn(r),baseURL:s,secureSignature:n,secureExpire:o,store:a,signal:c,source:d,integration:p,userAgent:f,retryThrottledRequestMaxTimes:g,retryNetworkErrorMaxTimes:m,metadata:E}).then(async({uuid:U,parts:V})=>{let Z=await Zl(r,z,v);return Promise.all([U,Yl(x,V.map((tt,ct)=>()=>Ql(Z(ct),tt,{publicKey:i,contentType:b,onProgress:$t(V.length,ct),signal:c,integration:p,retryThrottledRequestMaxTimes:g,retryNetworkErrorMaxTimes:m})))])}).then(([U])=>Dl(U,{publicKey:i,baseURL:s,source:d,integration:p,userAgent:f,retryThrottledRequestMaxTimes:g,retryNetworkErrorMaxTimes:m})).then(U=>U.isReady?U:hs(U.uuid,{publicKey:i,baseURL:s,source:d,integration:p,userAgent:f,retryThrottledRequestMaxTimes:g,retryNetworkErrorMaxTimes:m,onProgress:h,signal:c})).then(U=>new dt(U,{baseCDN:C}))},"uploadMultipart");async function ps(r,{publicKey:i,fileName:t,baseURL:e=$.baseURL,secureSignature:s,secureExpire:n,store:o,signal:a,onProgress:c,source:h,integration:d,userAgent:p,retryThrottledRequestMaxTimes:f,retryNetworkErrorMaxTimes:g,contentType:m,multipartMinFileSize:b,multipartChunkSize:v,maxConcurrentRequests:x,baseCDN:C=$.baseCDN,checkForUrlDuplicates:E,saveUrlForRecurrentUploads:z,pusherKey:at,metadata:$t}){if(Bt(r)){let U=await nn(r);return Kl(U,b)?ta(r,{publicKey:i,contentType:m,multipartChunkSize:v,fileSize:U,fileName:t,baseURL:e,secureSignature:s,secureExpire:n,store:o,signal:a,onProgress:c,source:h,integration:d,userAgent:p,maxConcurrentRequests:x,retryThrottledRequestMaxTimes:f,retryNetworkErrorMaxTimes:g,baseCDN:C,metadata:$t}):Fl(r,{publicKey:i,fileName:t,contentType:m,baseURL:e,secureSignature:s,secureExpire:n,store:o,signal:a,onProgress:c,source:h,integration:d,userAgent:p,retryThrottledRequestMaxTimes:f,retryNetworkErrorMaxTimes:g,baseCDN:C,metadata:$t})}if(ds(r))return Xl(r,{publicKey:i,fileName:t,baseURL:e,baseCDN:C,checkForUrlDuplicates:E,saveUrlForRecurrentUploads:z,secureSignature:s,secureExpire:n,store:o,signal:a,onProgress:c,source:h,integration:d,userAgent:p,retryThrottledRequestMaxTimes:f,retryNetworkErrorMaxTimes:g,pusherKey:at,metadata:$t});if(on(r))return Bl(r,{publicKey:i,fileName:t,baseURL:e,signal:a,onProgress:c,source:h,integration:d,userAgent:p,retryThrottledRequestMaxTimes:f,retryNetworkErrorMaxTimes:g,baseCDN:C});throw new TypeError(`File uploading from "${r}" is not supported`)}l(ps,"uploadFile");var _s=class _s{constructor(i,{baseCDN:t=$.baseCDN}={}){u(this,"uuid");u(this,"filesCount");u(this,"totalSize");u(this,"isStored");u(this,"isImage");u(this,"cdnUrl");u(this,"files");u(this,"createdAt");u(this,"storedAt",null);this.uuid=i.id,this.filesCount=i.filesCount;let e=i.files.filter(Boolean);this.totalSize=Object.values(e).reduce((s,n)=>s+n.size,0),this.isStored=!!i.datetimeStored,this.isImage=!!Object.values(e).filter(s=>s.isImage).length,this.cdnUrl=i.cdnUrl,this.files=e.map(s=>new dt(s,{baseCDN:t})),this.createdAt=i.datetimeCreated,this.storedAt=i.datetimeStored}};l(_s,"UploadcareGroup");var ls=_s,ea=l(r=>{for(let i of r)if(!Bt(i))return!1;return!0},"isFileDataArray"),ia=l(r=>{for(let i of r)if(!on(i))return!1;return!0},"isUuidArray"),sa=l(r=>{for(let i of r)if(!ds(i))return!1;return!0},"isUrlArray");function ln(r,{publicKey:i,fileName:t,baseURL:e=$.baseURL,secureSignature:s,secureExpire:n,store:o,signal:a,onProgress:c,source:h,integration:d,userAgent:p,retryThrottledRequestMaxTimes:f,retryNetworkErrorMaxTimes:g,contentType:m,multipartChunkSize:b=$.multipartChunkSize,baseCDN:v=$.baseCDN,checkForUrlDuplicates:x,saveUrlForRecurrentUploads:C,jsonpCallback:E}){if(!ea(r)&&!sa(r)&&!ia(r))throw new TypeError(`Group uploading from "${r}" is not supported`);let z,at=!0,$t=r.length,U=l((V,Z)=>{if(!c)return;z||(z=Array(V).fill(0));let tt=l(ct=>ct.reduce((Yi,Lo)=>Yi+Lo)/V,"normalize");return ct=>{if(!ct.isComputable||!at){at=!1,c({isComputable:!1});return}z[Z]=ct.value,c({isComputable:!0,value:tt(z)})}},"createProgressHandler");return Promise.all(r.map((V,Z)=>Bt(V)||ds(V)?ps(V,{publicKey:i,fileName:t,baseURL:e,secureSignature:s,secureExpire:n,store:o,signal:a,onProgress:U($t,Z),source:h,integration:d,userAgent:p,retryThrottledRequestMaxTimes:f,retryNetworkErrorMaxTimes:g,contentType:m,multipartChunkSize:b,baseCDN:v,checkForUrlDuplicates:x,saveUrlForRecurrentUploads:C}).then(tt=>tt.uuid):V)).then(V=>Ul(V,{publicKey:i,baseURL:e,jsonpCallback:E,secureSignature:s,secureExpire:n,signal:a,source:h,integration:d,userAgent:p,retryThrottledRequestMaxTimes:f,retryNetworkErrorMaxTimes:g}).then(Z=>new ls(Z,{baseCDN:v})).then(Z=>(c&&c({isComputable:!0,value:1}),Z)))}l(ln,"uploadFileGroup");var ys=class ys{constructor(i){u(this,"_concurrency",1);u(this,"_pending",[]);u(this,"_running",0);u(this,"_resolvers",new Map);u(this,"_rejectors",new Map);this._concurrency=i}_run(){let i=this._concurrency-this._running;for(let t=0;t<i;t++){let e=this._pending.shift();if(!e)return;let s=this._resolvers.get(e),n=this._rejectors.get(e);if(!s||!n)throw new Error("Unexpected behavior: resolver or rejector is undefined");this._running+=1,e().finally(()=>{this._resolvers.delete(e),this._rejectors.delete(e),this._running-=1,this._run()}).then(o=>s(o)).catch(o=>n(o))}}add(i){return new Promise((t,e)=>{this._resolvers.set(i,t),this._rejectors.set(i,e),this._pending.push(i),this._run()})}get pending(){return this._pending.length}get running(){return this._running}set concurrency(i){this._concurrency=i,this._run()}get concurrency(){return this._concurrency}};l(ys,"Queue");var oi=ys;var vs=l(()=>({}),"blockCtx"),Cs=l(r=>({...vs(),"*currentActivity":"","*currentActivityParams":{},"*history":[],"*historyBack":null,"*closeModal":()=>{r.set$({"*modalActive":!1,"*currentActivity":""})}}),"activityBlockCtx"),gi=l(r=>({...Cs(r),"*commonProgress":0,"*uploadList":[],"*focusedEntry":null,"*uploadMetadata":null,"*uploadQueue":new oi(1),"*uploadCollection":null,"*collectionErrors":[],"*collectionState":null,"*groupInfo":null,"*uploadTrigger":new Set}),"uploaderBlockCtx");var we={"locale-id":"en","social-source-lang":"en","upload-file":"Upload file","upload-files":"Upload files","choose-file":"Choose file","choose-files":"Choose files","drop-files-here":"Drop files here","select-file-source":"Select file source",selected:"Selected",upload:"Upload","add-more":"Add more",cancel:"Cancel","start-from-cancel":"Cancel",clear:"Clear","camera-shot":"Shot","upload-url":"Import","upload-url-placeholder":"Paste link here","edit-image":"Edit image","edit-detail":"Details",back:"Back",done:"Done",ok:"Ok","remove-from-list":"Remove",no:"No",yes:"Yes","confirm-your-action":"Confirm your action","are-you-sure":"Are you sure?","selected-count":"Selected:","upload-error":"Upload error","validation-error":"Validation error","no-files":"No files selected",browse:"Browse","not-uploaded-yet":"Not uploaded yet...",file__one:"file",file__other:"files",error__one:"error",error__other:"errors","header-uploading":"Uploading {{count}} {{plural:file(count)}}","header-failed":"{{count}} {{plural:error(count)}}","header-succeed":"{{count}} {{plural:file(count)}} uploaded","header-total":"{{count}} {{plural:file(count)}} selected","src-type-local":"From device","src-type-from-url":"From link","src-type-camera":"Camera","src-type-draw":"Draw","src-type-facebook":"Facebook","src-type-dropbox":"Dropbox","src-type-gdrive":"Google Drive","src-type-gphotos":"Google Photos","src-type-instagram":"Instagram","src-type-flickr":"Flickr","src-type-vk":"VK","src-type-evernote":"Evernote","src-type-box":"Box","src-type-onedrive":"Onedrive","src-type-huddle":"Huddle","src-type-other":"Other","caption-from-url":"Import from link","caption-camera":"Camera","caption-draw":"Draw","caption-edit-file":"Edit file","file-no-name":"No name...","toggle-fullscreen":"Toggle fullscreen","toggle-guides":"Toggle guides",rotate:"Rotate","flip-vertical":"Flip vertical","flip-horizontal":"Flip horizontal",apply:"Apply",brightness:"Brightness",contrast:"Contrast",saturation:"Saturation",exposure:"Exposure",gamma:"Gamma",vibrance:"Vibrance",warmth:"Warmth",enhance:"Enhance",original:"Original",resize:"Resize image",crop:"Crop","select-color":"Select color",text:"Text",draw:"Draw","cancel-edit":"Cancel edit","tab-view":"Preview","tab-details":"Details","file-name":"Name","file-size":"Size","cdn-url":"CDN URL","file-size-unknown":"Unknown","camera-permissions-denied":"Camera access denied","camera-permissions-prompt":"Please allow access to the camera","camera-permissions-request":"Request access","files-count-limit-error-title":"Files count limit overflow","files-count-limit-error-too-few":"You\u2019ve chosen {{total}} {{plural:file(total)}}. At least {{min}} {{plural:file(min)}} required.","files-count-limit-error-too-many":"You\u2019ve chosen too many files. {{max}} {{plural:file(max)}} is maximum.","files-max-size-limit-error":"File is too big. Max file size is {{maxFileSize}}.","has-validation-errors":"File validation error ocurred. Please, check your files before upload.","images-only-accepted":"Only image files are accepted.","file-type-not-allowed":"Uploading of these file types is not allowed.","some-files-were-not-uploaded":"Some files were not uploaded."};var bi=new Map,ws=new Map,an=l((r,i)=>{bi.has(r)&&console.log(`Locale ${r} is already defined. Overwriting...`),bi.set(r,{...we,...i})},"defineLocaleSync"),ra=l((r,i)=>{ws.set(r,i)},"defineLocaleAsync"),As=l((r,i)=>{typeof i=="function"?ra(r,i):an(r,i)},"defineLocale"),cn=l(async r=>{if(!bi.has(r)){if(!ws.has(r))throw new Error(`Locale ${r} is not defined`);let t=await ws.get(r)();an(r,t)}return bi.get(r)},"resolveLocaleDefinition");As("en",we);var ft=l(r=>`*l10n/${r}`,"localeStateKey"),na="en",Es=class Es{constructor(i){u(this,"_blockInstance",null);u(this,"_localeName","");u(this,"_callbacks",new Set);u(this,"_boundBlocks",new Map);this._blockInstance=i;for(let[t,e]of Object.entries(we))this._blockInstance.add(ft(t),e,!1);setTimeout(()=>{i.subConfigValue("localeName",async t=>{var n;if(!this._blockInstance||!t)return;this._localeName=t;let e=await cn(t);if(t!==na&&this._localeName!==t)return;let s=(n=this._blockInstance.cfg.localeDefinitionOverride)==null?void 0:n[t];for(let[o,a]of Object.entries(e)){let c=s==null?void 0:s[o];this._blockInstance.add(ft(o),c!=null?c:a,!0);for(let h of this._callbacks)h()}}),i.subConfigValue("localeDefinitionOverride",t=>{var s;if(!t)return;let e=t[this._localeName];if(e)for(let[n,o]of Object.entries(e)){(s=this._blockInstance)==null||s.add(ft(n),o,!0);for(let a of this._callbacks)a()}})})}onLocaleChange(i){let t=k(i,0);return this._callbacks.add(t),()=>{this._callbacks.delete(t)}}bindL10n(i,t,e){var n,o,a;i.$[t]=e(),this._boundBlocks.has(i)||this._boundBlocks.set(i,new Map),(o=(n=this._boundBlocks.get(i))==null?void 0:n.get(t))==null||o();let s=this.onLocaleChange(()=>{i.$[t]=e()});(a=this._boundBlocks.get(i))==null||a.set(t,s)}destroyL10nBindings(i){let t=this._boundBlocks.get(i);if(t){for(let e of t.values())e();this._boundBlocks.delete(i)}}destroy(){this._callbacks.clear()}};l(Es,"LocaleManager");var _i=Es;function hn(r,i){[...r.querySelectorAll("[l10n]")].forEach(t=>{let e=t.getAttribute("l10n");if(!e)return;let s="textContent",n=!1;if(e.includes(":")){let c=e.split(":");s=c[0],e=c[1],s.startsWith("@")&&(s=s.slice(1),n=!0)}let o=e;i.has(o)&&i.sub(o,c=>{if(!c)return;i.l10nProcessorSubs.has(o)||i.l10nProcessorSubs.set(o,new Set);let h=i.l10nProcessorSubs.get(o);h==null||h.forEach(f=>{f.remove(),h.delete(f),i.allSubs.delete(f)});let d=ft(c).replace("*","");i.nodeCtx.has(d)||i.nodeCtx.add(d,c);let p=i.nodeCtx.sub(d,()=>{t[s]=i.l10n(c)});h==null||h.add(p),i.allSubs.add(p),t.removeAttribute("l10n")});let a=ft(e);i.has(a)||i.add(a,""),i.sub(a,()=>{e=e,n?t.setAttribute(s,i.l10n(e)):t[s]=i.l10n(e)}),t.removeAttribute("l10n")})}l(hn,"l10nProcessor");var H=l(r=>`*cfg/${r}`,"sharedConfigKey");var Ae="blocks",Ee="0.39.1";var un=l(r=>{if(typeof r!="string"||!r)return"";let i=r.trim();return i.startsWith("-/")?i=i.slice(2):i.startsWith("/")&&(i=i.slice(1)),i.endsWith("/")&&(i=i.slice(0,i.length-1)),i},"normalizeCdnOperation"),yi=l((...r)=>r.filter(i=>typeof i=="string"&&i).map(i=>un(i)).join("/-/"),"joinCdnOperations"),F=l((...r)=>{let i=yi(...r);return i?`-/${i}/`:""},"createCdnUrlModifiers");function dn(r){let i=new URL(r),t=i.pathname+i.search+i.hash,e=t.lastIndexOf("http"),s=t.lastIndexOf("/"),n="";return e>=0?n=t.slice(e):s>=0&&(n=t.slice(s+1)),n}l(dn,"extractFilename");function pn(r){let i=new URL(r),{pathname:t}=i,e=t.indexOf("/"),s=t.indexOf("/",e+1);return t.substring(e+1,s)}l(pn,"extractUuid");function fn(r){let i=mn(r),t=new URL(i),e=t.pathname.indexOf("/-/");return e===-1?[]:t.pathname.substring(e).split("/-/").filter(Boolean).map(n=>un(n))}l(fn,"extractOperations");function mn(r){let i=new URL(r),t=dn(r),e=gn(t)?bn(t).pathname:t;return i.pathname=i.pathname.replace(e,""),i.search="",i.hash="",i.toString()}l(mn,"trimFilename");function gn(r){return r.startsWith("http")}l(gn,"isFileUrl");function bn(r){let i=new URL(r);return{pathname:i.origin+i.pathname||"",search:i.search||"",hash:i.hash||""}}l(bn,"splitFileUrl");var L=l((r,i,t)=>{let e=new URL(mn(r));if(t=t||dn(r),e.pathname.startsWith("//")&&(e.pathname=e.pathname.replace("//","/")),gn(t)){let s=bn(t);e.pathname=e.pathname+(i||"")+(s.pathname||""),e.search=s.search,e.hash=s.hash}else e.pathname=e.pathname+(i||"")+(t||"");return e.toString()},"createCdnUrl"),Ct=l((r,i)=>{let t=new URL(r);return t.pathname=i+"/",t.toString()},"createOriginalUrl");var R=l((r,i=",")=>r.trim().split(i).map(t=>t.trim()).filter(t=>t.length>0),"stringToArray");var q=Object.freeze({brightness:0,exposure:0,gamma:100,contrast:0,saturation:0,vibrance:0,warmth:0,enhance:0,filter:0,rotate:0,mirror:!1,flip:!1,crop:void 0}),yn=["enhance","brightness","exposure","gamma","contrast","saturation","vibrance","warmth","filter","mirror","flip","rotate","crop"];function oa(r,i){if(typeof i=="number"){let t=i;return q[r]!==t?`${r}/${t}`:""}if(typeof i=="boolean"){let t=i;return q[r]!==t?`${r}`:""}if(r==="filter"&&i){let{name:t,amount:e}=i;return q.filter===e?"":`${r}/${t}/${e}`}if(r==="crop"&&i){let{dimensions:t,coords:e}=i;return`${r}/${t.join("x")}/${e.join(",")}`}return""}l(oa,"transformationToStr");function wt(r){return yi(...yn.filter(i=>typeof r[i]!="undefined"&&r[i]!==null).map(i=>{let t=r[i];return oa(i,t)}).filter(i=>!!i))}l(wt,"transformationsToOperations");var vi=yi("format/auto","progressive/yes"),mt=l(([r])=>typeof r!="undefined"?Number(r):void 0,"asNumber"),_n=l(()=>!0,"asBoolean"),la=l(([r,i])=>({name:r,amount:typeof i!="undefined"?Number(i):100}),"asFilter"),aa=l(([r,i])=>{if(!/\d+x\d+/.test(r)||!/\d+,\d+/.test(i))throw new Error("Crop by aspect ratio, percentage or alignment shortcuts is not supported.");return{dimensions:R(r,"x").map(Number),coords:R(i).map(Number)}},"asCrop"),ca=Object.freeze({enhance:mt,brightness:mt,exposure:mt,gamma:mt,contrast:mt,saturation:mt,vibrance:mt,warmth:mt,filter:la,mirror:_n,flip:_n,rotate:mt,crop:aa});function vn(r){let i={};for(let t of r){let[e,...s]=t.split("/");if(!yn.includes(e))continue;let n=e,o=ca[n];try{let a=o(s);i[n]=a}catch(a){console.warn([`Failed to parse URL operation "${t}". It will be ignored.`,a instanceof Error?`Error message: "${a.message}"`:a,"If you need this functionality, please feel free to open an issue at https://github.com/uploadcare/blocks/issues/new"].join(`
`))}}return i}l(vn,"operationsToTransformations");var P=Object.freeze({CROP:"crop",TUNING:"tuning",FILTERS:"filters"}),G=[P.CROP,P.TUNING,P.FILTERS],Cn=["brightness","exposure","gamma","contrast","saturation","vibrance","warmth","enhance"],wn=["adaris","briaril","calarel","carris","cynarel","cyren","elmet","elonni","enzana","erydark","fenralan","ferand","galen","gavin","gethriel","iorill","iothari","iselva","jadis","lavra","misiara","namala","nerion","nethari","pamaya","sarnar","sedis","sewen","sorahel","sorlen","tarian","thellassan","varriel","varven","vevera","virkas","yedis","yllara","zatvel","zevcen"],An=["rotate","mirror","flip"],et=Object.freeze({brightness:{zero:q.brightness,range:[-100,100],keypointsNumber:2},exposure:{zero:q.exposure,range:[-500,500],keypointsNumber:2},gamma:{zero:q.gamma,range:[0,1e3],keypointsNumber:2},contrast:{zero:q.contrast,range:[-100,500],keypointsNumber:2},saturation:{zero:q.saturation,range:[-100,500],keypointsNumber:1},vibrance:{zero:q.vibrance,range:[-100,500],keypointsNumber:1},warmth:{zero:q.warmth,range:[-100,100],keypointsNumber:1},enhance:{zero:q.enhance,range:[0,100],keypointsNumber:1},filter:{zero:q.filter,range:[0,100],keypointsNumber:1}});var En=l(r=>r?r.split(",").map(i=>i.trim()):[],"deserealizeCsv"),zt=l(r=>r?r.join(","):"","serializeCsv");var ha="https://ucarecdn.com",ua="https://upload.uploadcare.com",da="https://social.uploadcare.com",Q={pubkey:"",multiple:!0,multipleMin:0,multipleMax:Number.MAX_SAFE_INTEGER,confirmUpload:!1,imgOnly:!1,accept:"",externalSourcesPreferredTypes:"",store:"auto",cameraMirror:!1,cameraCapture:"",sourceList:"local, url, camera, dropbox, gdrive",cloudImageEditorTabs:zt(G),maxLocalFileSizeBytes:0,thumbSize:76,showEmptyList:!1,useLocalImageEditor:!1,useCloudImageEditor:!0,removeCopyright:!1,cropPreset:"",imageShrink:"",modalScrollLock:!0,modalBackdropStrokes:!1,sourceListWrap:!0,remoteTabSessionKey:"",cdnCname:ha,baseUrl:ua,socialBaseUrl:da,secureSignature:"",secureExpire:"",secureDeliveryProxy:"",retryThrottledRequestMaxTimes:1,multipartMinFileSize:26214400,multipartChunkSize:5242880,maxConcurrentRequests:10,multipartMaxConcurrentRequests:4,multipartMaxAttempts:3,checkForUrlDuplicates:!1,saveUrlForRecurrentUploads:!1,groupOutput:!1,userAgentIntegration:"",debug:!1,metadata:null,localeName:"en",localeDefinitionOverride:null};var xs="lr-",xe=class xe extends Ot{constructor(){super();u(this,"requireCtxName",!1);u(this,"allowCustomTemplate",!0);u(this,"activityType",null);u(this,"init$",vs());this.l10nProcessorSubs=new Map,this.addTemplateProcessor(hn)}l10n(t,e={}){if(!t)return"";let s=this.$[ft(t)]||t,n=Wr(s);for(let a of n)e[a.variable]=this.pluralize(a.pluralKey,Number(e[a.countVariable]));return ve(s,e)}pluralize(t,e){let s=this.l10n("locale-id")||"en",n=ni(s,e);return this.l10n(`${t}__${n}`)}bindL10n(t,e){var s;(s=this.localeManager)==null||s.bindL10n(this,t,e)}emit(t,e,s){let n=this.has("*eventEmitter")&&this.$["*eventEmitter"];n&&n.emit(t,e,s)}hasBlockInCtx(t){let e=this.$["*blocksRegistry"];for(let s of e)if(t(s))return!0;return!1}setOrAddState(t,e){this.add$({[t]:e},!0)}setActivity(t){if(this.hasBlockInCtx(e=>e.activityType===t)){this.$["*currentActivity"]=t;return}console.warn(`Activity type "${t}" not found in the context`)}connectedCallback(){let t=this.constructor.className;t&&this.classList.toggle(`${xs}${t}`,!0),this.hasAttribute("retpl")&&(this.constructor.template=null,this.processInnerHtml=!0),this.requireCtxName?Xr({element:this,attribute:"ctx-name",onSuccess:()=>{super.connectedCallback()},onTimeout:()=>{console.error("Attribute `ctx-name` is required and it is not set.")}}):super.connectedCallback(),ye.registerClient(this)}disconnectedCallback(){super.disconnectedCallback(),ye.unregisterClient(this)}initCallback(){this.has("*blocksRegistry")||this.add("*blocksRegistry",new Set),this.$["*blocksRegistry"].add(this),this.has("*eventEmitter")||this.add("*eventEmitter",new ri(this.debugPrint.bind(this))),this.has("*localeManager")||this.add("*localeManager",new _i(this)),this.sub(ft("locale-id"),e=>{this.style.direction=jr(e)})}get localeManager(){return this.has("*localeManager")?this.$["*localeManager"]:null}destroyCallback(){var e;let t=this.$["*blocksRegistry"];t.delete(this),(e=this.localeManager)==null||e.destroyL10nBindings(this),this.l10nProcessorSubs=new Map,T.deleteCtx(this),t.size===0&&setTimeout(()=>{this.destroyCtxCallback()},0)}destroyCtxCallback(){var t;T.deleteCtx(this.ctxName),(t=this.localeManager)==null||t.destroy()}fileSizeFmt(t,e=2){let s=["B","KB","MB","GB","TB"];if(t===0)return`0 ${s[0]}`;let n=1024,o=e<0?0:e,a=Math.floor(Math.log(t)/Math.log(n));return parseFloat((t/n**a).toFixed(o))+" "+s[a]}proxyUrl(t){let e=this.cfg.secureDeliveryProxy;return e?ve(e,{previewUrl:t},{transform:s=>window.encodeURIComponent(s)}):t}get cfg(){if(!this.__cfgProxy){let t=Object.create(null);this.__cfgProxy=new Proxy(t,{set:(e,s,n)=>{if(typeof s!="string")return!1;let o=H(s);return this.has(o)||this.add(o,Q[s]),this.$[o]=n,!0},get:(e,s)=>{let n=H(s);return this.has(n)||this.add(n,Q[s]),this.$[H(s)]}})}return this.__cfgProxy}subConfigValue(t,e){let s=H(t);this.has(s)||this.add(s,Q[t]),this.sub(s,e)}debugPrint(...t){if(!this.cfg.debug)return;let e=t;if(typeof(t==null?void 0:t[0])=="function"){let s=t[0];e=s()}console.log(`[${this.ctxName}]`,...e)}static reg(t){if(!t){super.reg();return}super.reg(t.startsWith(xs)?t:xs+t)}};l(xe,"Block"),u(xe,"StateConsumerScope",null),u(xe,"className","");var y=xe;var xn="active",Te="___ACTIVITY_IS_ACTIVE___",it=class it extends y{constructor(){super(...arguments);u(this,"historyTracked",!1);u(this,"init$",Cs(this));u(this,"_debouncedHistoryFlush",k(this._historyFlush.bind(this),10))}_deactivate(){var e;let t=it._activityCallbacks.get(this);this[Te]=!1,this.removeAttribute(xn),(e=t==null?void 0:t.deactivateCallback)==null||e.call(t)}_activate(){var e;let t=it._activityCallbacks.get(this);this.$["*historyBack"]=this.historyBack.bind(this),this[Te]=!0,this.setAttribute(xn,""),(e=t==null?void 0:t.activateCallback)==null||e.call(t),this._debouncedHistoryFlush(),this.emit(I.ACTIVITY_CHANGE,{activity:this.activityType})}initCallback(){super.initCallback(),this.hasAttribute("current-activity")&&this.sub("*currentActivity",t=>{this.setAttribute("current-activity",t)}),this.activityType&&(this.hasAttribute("activity")||this.setAttribute("activity",this.activityType),this.sub("*currentActivity",t=>{this.activityType!==t&&this[Te]?this._deactivate():this.activityType===t&&!this[Te]&&this._activate(),t||(this.$["*history"]=[])}),this.has("*modalActive")&&this.sub("*modalActive",t=>{!t&&this.activityType===this.$["*currentActivity"]&&(this.$["*currentActivity"]=null)}))}_historyFlush(){let t=this.$["*history"];t&&(t.length>10&&(t=t.slice(t.length-11,t.length-1)),this.historyTracked&&t[t.length-1]!==this.activityType&&t.push(this.activityType),this.$["*history"]=t)}_isActivityRegistered(){return this.activityType&&it._activityCallbacks.has(this)}get isActivityActive(){return this[Te]}get couldOpenActivity(){return!0}registerActivity(t,e={}){let{onActivate:s,onDeactivate:n}=e;it._activityCallbacks.set(this,{activateCallback:s,deactivateCallback:n})}unregisterActivity(){this.isActivityActive&&this._deactivate(),it._activityCallbacks.delete(this)}destroyCallback(){super.destroyCallback(),this._isActivityRegistered()&&this.unregisterActivity();let t=this.$["*currentActivity"];!![...this.$["*blocksRegistry"]].find(n=>n instanceof it&&n.activityType===t)||(this.$["*currentActivity"]=null)}get activityKey(){return this.ctxName+this.activityType}get activityParams(){return this.$["*currentActivityParams"]}get initActivity(){return this.getCssData("--cfg-init-activity")}get doneActivity(){return this.getCssData("--cfg-done-activity")}historyBack(){var e;let t=this.$["*history"];if(t){let s=t.pop();for(;s===this.activityType;)s=t.pop();let n=!!s;if(s){let a=[...this.$["*blocksRegistry"]].find(c=>c.activityType===s);n=(e=a==null?void 0:a.couldOpenActivity)!=null?e:!1}s=n?s:void 0,this.$["*currentActivity"]=s,this.$["*history"]=t,s||this.setOrAddState("*modalActive",!1)}}};l(it,"ActivityBlock"),u(it,"_activityCallbacks",new Map);var _=it;_.activities=Object.freeze({START_FROM:"start-from",CAMERA:"camera",DRAW:"draw",UPLOAD_LIST:"upload-list",URL:"url",CONFIRMATION:"confirmation",CLOUD_IMG_EDIT:"cloud-image-edit",EXTERNAL:"external",DETAILS:"details"});var Se=33.333333333333336,w=1,Ts=24,Tn=6;function Lt(r,i){for(let t in i)r.setAttributeNS(null,t,i[t].toString())}l(Lt,"setSvgNodeAttrs");function Y(r,i={}){let t=document.createElementNS("http://www.w3.org/2000/svg",r);return Lt(t,i),t}l(Y,"createSvgNode");function Sn(r,i,t){let{x:e,y:s,width:n,height:o}=r,a=i.includes("w")?0:1,c=i.includes("n")?0:1,h=[-1,1][a],d=[-1,1][c],p=[e+a*n+1.5*h,s+c*o+1.5*d-24*t*d],f=[e+a*n+1.5*h,s+c*o+1.5*d],g=[e+a*n-24*t*h+1.5*h,s+c*o+1.5*d];return{d:`M ${p[0]} ${p[1]} L ${f[0]} ${f[1]} L ${g[0]} ${g[1]}`,center:f}}l(Sn,"cornerPath");function $n(r,i,t){let{x:e,y:s,width:n,height:o}=r,a=["n","s"].includes(i)?.5:{w:0,e:1}[i],c=["w","e"].includes(i)?.5:{n:0,s:1}[i],h=[-1,1][a],d=[-1,1][c],p,f;["n","s"].includes(i)?(p=[e+a*n-34*t/2,s+c*o+1.5*d],f=[e+a*n+34*t/2,s+c*o+1.5*d]):(p=[e+a*n+1.5*h,s+c*o-34*t/2],f=[e+a*n+1.5*h,s+c*o+34*t/2]);let g=`M ${p[0]} ${p[1]} L ${f[0]} ${f[1]}`,m=[f[0]-(f[0]-p[0])/2,f[1]-(f[1]-p[1])/2];return{d:g,center:m}}l($n,"sidePath");function In(r){return r===""?"move":["e","w"].includes(r)?"ew-resize":["n","s"].includes(r)?"ns-resize":["nw","se"].includes(r)?"nwse-resize":"nesw-resize"}l(In,"thumbCursor");function On({rect:r,delta:[i,t],imageBox:e}){return jt({...r,x:r.x+i,y:r.y+t},e)}l(On,"moveRect");function jt(r,i){let{x:t}=r,{y:e}=r;return r.x<i.x?t=i.x:r.x+r.width>i.x+i.width&&(t=i.x+i.width-r.width),r.y<i.y?e=i.y:r.y+r.height>i.y+i.height&&(e=i.y+i.height-r.height),{...r,x:t,y:e}}l(jt,"constraintRect");function pa({rect:r,delta:i,aspectRatio:t,imageBox:e}){let[,s]=i,{y:n,width:o,height:a}=r;n+=s,a-=s,t&&(o=a*t);let c=r.x+r.width/2-o/2;return n<=e.y&&(n=e.y,a=r.y+r.height-n,t&&(o=a*t,c=r.x+r.width/2-o/2)),c<=e.x&&(c=e.x,n=r.y+r.height-a),c+o>=e.x+e.width&&(c=Math.max(e.x,e.x+e.width-o),o=e.x+e.width-c,t&&(a=o/t),n=r.y+r.height-a),a<w&&(a=w,t&&(o=a*t,c=r.x+r.width/2-o/2),n=r.y+r.height-a),o<w&&(o=w,t&&(a=o/t,c=r.x+r.width/2-o/2),n=r.y+r.height-a),{x:c,y:n,width:o,height:a}}l(pa,"resizeNorth");function fa({rect:r,delta:i,aspectRatio:t,imageBox:e}){let[s]=i,{x:n,width:o,height:a}=r;n+=s,o-=s,t&&(a=o/t);let c=r.y+r.height/2-a/2;return n<=e.x&&(n=e.x,o=r.x+r.width-n,t&&(a=o/t,c=r.y+r.height/2-a/2)),c<=e.y&&(c=e.y,n=r.x+r.width-o),c+a>=e.y+e.height&&(c=Math.max(e.y,e.y+e.height-a),a=e.y+e.height-c,t&&(o=a*t),n=r.x+r.width-o),a<w&&(a=w,t&&(o=a*t),c=r.y+r.height/2-a/2,n=r.x+r.width-o),o<w&&(o=w,t&&(a=o/t),c=r.y+r.height/2-a/2,n=r.x+r.width-o),{x:n,y:c,width:o,height:a}}l(fa,"resizeWest");function ma({rect:r,delta:i,aspectRatio:t,imageBox:e}){let[,s]=i,{y:n,width:o,height:a}=r;a+=s,t&&(o=a*t);let c=r.x+r.width/2-o/2;return n+a>=e.y+e.height&&(a=e.y+e.height-n,t&&(o=a*t),c=r.x+r.width/2-o/2),c<=e.x&&(c=e.x,n=r.y),c+o>=e.x+e.width&&(c=Math.max(e.x,e.x+e.width-o),o=e.x+e.width-c,t&&(a=o/t),n=r.y),a<w&&(a=w,t&&(o=a*t),c=r.x+r.width/2-o/2),o<w&&(o=w,t&&(a=o/t),c=r.x+r.width/2-o/2),{x:c,y:n,width:o,height:a}}l(ma,"resizeSouth");function ga({rect:r,delta:i,aspectRatio:t,imageBox:e}){let[s]=i,{x:n,width:o,height:a}=r;o+=s,t&&(a=o/t);let c=r.y+r.height/2-a/2;return n+o>=e.x+e.width&&(o=e.x+e.width-n,t&&(a=o/t),c=r.y+r.height/2-a/2),c<=e.y&&(c=e.y,n=r.x),c+a>=e.y+e.height&&(c=Math.max(e.y,e.y+e.height-a),a=e.y+e.height-c,t&&(o=a*t),n=r.x),a<w&&(a=w,t&&(o=a*t),c=r.y+r.height/2-a/2),o<w&&(o=w,t&&(a=o/t),c=r.y+r.height/2-a/2),{x:n,y:c,width:o,height:a}}l(ga,"resizeEast");function ba({rect:r,delta:i,aspectRatio:t,imageBox:e}){let[s,n]=i,{x:o,y:a,width:c,height:h}=r;return o+s<e.x&&(s=e.x-o),a+n<e.y&&(n=e.y-a),o+=s,c-=s,a+=n,h-=n,t&&Math.abs(c/h)>t?(n=c/t-h,h+=n,a-=n,a<=e.y&&(h=h-(e.y-a),c=h*t,o=r.x+r.width-c,a=e.y)):t&&(s=h*t-c,c=c+s,o-=s,o<=e.x&&(c=c-(e.x-o),h=c/t,o=e.x,a=r.y+r.height-h)),h<w&&(h=w,t&&(c=h*t),o=r.x+r.width-c,a=r.y+r.height-h),c<w&&(c=w,t&&(h=c/t),o=r.x+r.width-c,a=r.y+r.height-h),{x:o,y:a,width:c,height:h}}l(ba,"resizeNorthWest");function _a({rect:r,delta:i,aspectRatio:t,imageBox:e}){let[s,n]=i,{x:o,y:a,width:c,height:h}=r;return o+c+s>e.x+e.width&&(s=e.x+e.width-o-c),a+n<e.y&&(n=e.y-a),c+=s,a+=n,h-=n,t&&Math.abs(c/h)>t?(n=c/t-h,h+=n,a-=n,a<=e.y&&(h=h-(e.y-a),c=h*t,o=r.x,a=e.y)):t&&(s=h*t-c,c+=s,o+c>=e.x+e.width&&(c=e.x+e.width-o,h=c/t,o=e.x+e.width-c,a=r.y+r.height-h)),h<w&&(h=w,t&&(c=h*t),a=r.y+r.height-h),c<w&&(c=w,t&&(h=c/t),a=r.y+r.height-h),{x:o,y:a,width:c,height:h}}l(_a,"resizeNorthEast");function ya({rect:r,delta:i,aspectRatio:t,imageBox:e}){let[s,n]=i,{x:o,y:a,width:c,height:h}=r;return o+s<e.x&&(s=e.x-o),a+h+n>e.y+e.height&&(n=e.y+e.height-a-h),o+=s,c-=s,h+=n,t&&Math.abs(c/h)>t?(n=c/t-h,h+=n,a+h>=e.y+e.height&&(h=e.y+e.height-a,c=h*t,o=r.x+r.width-c,a=e.y+e.height-h)):t&&(s=h*t-c,c+=s,o-=s,o<=e.x&&(c=c-(e.x-o),h=c/t,o=e.x,a=r.y)),h<w&&(h=w,t&&(c=h*t),o=r.x+r.width-c),c<w&&(c=w,t&&(h=c/t),o=r.x+r.width-c),{x:o,y:a,width:c,height:h}}l(ya,"resizeSouthWest");function va({rect:r,delta:i,aspectRatio:t,imageBox:e}){let[s,n]=i,{x:o,y:a,width:c,height:h}=r;return o+c+s>e.x+e.width&&(s=e.x+e.width-o-c),a+h+n>e.y+e.height&&(n=e.y+e.height-a-h),c+=s,h+=n,t&&Math.abs(c/h)>t?(n=c/t-h,h+=n,a+h>=e.y+e.height&&(h=e.y+e.height-a,c=h*t,o=r.x,a=e.y+e.height-h)):t&&(s=h*t-c,c+=s,o+c>=e.x+e.width&&(c=e.x+e.width-o,h=c/t,o=e.x+e.width-c,a=r.y)),h<w&&(h=w,t&&(c=h*t)),c<w&&(c=w,t&&(h=c/t)),{x:o,y:a,width:c,height:h}}l(va,"resizeSouthEast");function kn({direction:r,...i}){switch(r){case"n":return pa(i);case"w":return fa(i);case"s":return ma(i);case"e":return ga(i);case"nw":return ba(i);case"ne":return _a(i);case"sw":return ya(i);case"se":return va(i);default:return i.rect}}l(kn,"resizeRect");function Ln(r,[i,t]){return r.x<=i&&i<=r.x+r.width&&r.y<=t&&t<=r.y+r.height}l(Ln,"rectContainsPoint");function Pn(r,i){return r.x>=i.x&&r.y>=i.y&&r.x+r.width<=i.x+i.width&&r.y+r.height<=i.y+i.height}l(Pn,"isRectInsideRect");function Un(r,i){return Math.abs(r.width/r.height-i)<.1}l(Un,"isRectMatchesAspectRatio");function Ht({width:r,height:i},t){let e=t/90%2!==0;return{width:e?i:r,height:e?r:i}}l(Ht,"rotateSize");function Rn(r,i,t){let e=r/i,s,n;e>t?(s=Math.round(i*t),n=i):(s=r,n=Math.round(r/t));let o=Math.round((r-s)/2),a=Math.round((i-n)/2);return o+s>r&&(s=r-o),a+n>i&&(n=i-a),{x:o,y:a,width:s,height:n}}l(Rn,"calculateMaxCenteredCropFrame");function Gt(r){return{x:Math.round(r.x),y:Math.round(r.y),width:Math.round(r.width),height:Math.round(r.height)}}l(Gt,"roundRect");function At(r,i,t){return Math.min(Math.max(r,i),t)}l(At,"clamp");var wi=l(r=>{if(!r)return[];let[i,t]=r.split(":").map(Number);if(!Number.isFinite(i)||!Number.isFinite(t)){console.error(`Invalid crop preset: ${r}`);return}return[{type:"aspect-ratio",width:i,height:t}]},"parseCropPreset");var W=Object.freeze({LOCAL:"local",DROP_AREA:"drop-area",URL_TAB:"url-tab",CAMERA:"camera",EXTERNAL:"external",API:"js-api"});function Mn(r){return as({...r,libraryName:Ae,libraryVersion:Ee})}l(Mn,"customUserAgent");var Dn=l(({type:r,message:i,...t})=>({type:r,message:i,...t}),"buildOutputError"),Pt=Dn,Ai=Dn;var Ei=["image/*","image/heif","image/heif-sequence","image/heic","image/heic-sequence","image/avif","image/avif-sequence",".heif",".heifs",".heic",".heics",".avif",".avifs"],Ss=l(r=>r?r.filter(i=>typeof i=="string").map(i=>R(i)).flat():[],"mergeFileTypes"),$s=l((r,i)=>i.some(t=>t.endsWith("*")?(t=t.replace("*",""),r.startsWith(t)):r===t),"matchMimeType"),Nn=l((r,i)=>i.some(t=>t.startsWith(".")?r.toLowerCase().endsWith(t.toLowerCase()):!1),"matchExtension"),Is=l(r=>{let i=r==null?void 0:r.type;return i?$s(i,Ei):!1},"fileIsImage");var rt=1e3,Ut=Object.freeze({AUTO:"auto",BYTE:"byte",KB:"kb",MB:"mb",GB:"gb",TB:"tb",PB:"pb"}),$e=l(r=>Math.ceil(r*100)/100,"round"),Fn=l((r,i=Ut.AUTO)=>{let t=i===Ut.AUTO;if(i===Ut.BYTE||t&&r<rt**1){let e=ni("en-US",r),s={one:"byte",other:"bytes"}[e];return`${r} ${s}`}return i===Ut.KB||t&&r<rt**2?`${$e(r/rt**1)} KB`:i===Ut.MB||t&&r<rt**3?`${$e(r/rt**2)} MB`:i===Ut.GB||t&&r<rt**4?`${$e(r/rt**3)} GB`:i===Ut.TB||t&&r<rt**5?`${$e(r/rt**4)} TB`:`${$e(r/rt**5)} PB`},"prettyBytes");var Bn=new Set;function xi(r){Bn.has(r)||(Bn.add(r),console.warn(r))}l(xi,"warnOnce");var zn="[Typed State] Wrong property name: ",Ca="[Typed State] Wrong property type: ",Os=class Os{constructor(i,t){this.__typedSchema=i,this.__ctxId=t||It.generate(),this.__schema=Object.keys(i).reduce((e,s)=>(e[s]=i[s].value,e),{}),this.__data=T.registerCtx(this.__schema,this.__ctxId)}get uid(){return this.__ctxId}setValue(i,t){if(!this.__typedSchema.hasOwnProperty(i)){console.warn(zn+i);return}let e=this.__typedSchema[i];if((t==null?void 0:t.constructor)===e.type||t instanceof e.type||e.nullable&&t===null){this.__data.pub(i,t);return}console.warn(Ca+i)}setMultipleValues(i){for(let t in i)this.setValue(t,i[t])}getValue(i){if(!this.__typedSchema.hasOwnProperty(i)){console.warn(zn+i);return}return this.__data.read(i)}subscribe(i,t){return this.__data.sub(i,t)}remove(){T.deleteCtx(this.__ctxId)}};l(Os,"TypedData");var Ti=Os;var ks=class ks{constructor(i){this.__typedSchema=i.typedSchema,this.__ctxId=i.ctxName||It.generate(),this.__data=T.registerCtx({},this.__ctxId),this.__watchList=i.watchList||[],this.__subsMap=Object.create(null),this.__propertyObservers=new Set,this.__collectionObservers=new Set,this.__items=new Set,this.__removed=new Set,this.__added=new Set;let t=Object.create(null);this.__notifyObservers=(e,s)=>{this.__observeTimeout&&window.clearTimeout(this.__observeTimeout),t[e]||(t[e]=new Set),t[e].add(s),this.__observeTimeout=window.setTimeout(()=>{Object.keys(t).length!==0&&(this.__propertyObservers.forEach(n=>{n({...t})}),t=Object.create(null))})}}notify(){this.__notifyTimeout&&window.clearTimeout(this.__notifyTimeout),this.__notifyTimeout=window.setTimeout(()=>{let i=new Set(this.__added),t=new Set(this.__removed);this.__added.clear(),this.__removed.clear();for(let e of this.__collectionObservers)e==null||e([...this.__items],i,t)})}observeCollection(i){return this.__collectionObservers.add(i),this.__items.size>0&&this.notify(),()=>{this.unobserveCollection(i)}}unobserveCollection(i){var t;(t=this.__collectionObservers)==null||t.delete(i)}add(i){let t=new Ti(this.__typedSchema);for(let e in i)t.setValue(e,i[e]);return this.__items.add(t.uid),this.notify(),this.__data.add(t.uid,t),this.__added.add(t),this.__watchList.forEach(e=>{this.__subsMap[t.uid]||(this.__subsMap[t.uid]=[]),this.__subsMap[t.uid].push(t.subscribe(e,()=>{this.__notifyObservers(e,t.uid)}))}),t.uid}read(i){return this.__data.read(i)}readProp(i,t){return this.read(i).getValue(t)}publishProp(i,t,e){this.read(i).setValue(t,e)}remove(i){this.__removed.add(this.__data.read(i)),this.__items.delete(i),this.notify(),this.__data.pub(i,null),delete this.__subsMap[i]}clearAll(){this.__items.forEach(i=>{this.remove(i)})}observeProperties(i){return this.__propertyObservers.add(i),()=>{this.unobserveProperties(i)}}unobserveProperties(i){var t;(t=this.__propertyObservers)==null||t.delete(i)}findItems(i){let t=[];return this.__items.forEach(e=>{let s=this.read(e);i(s)&&t.push(e)}),t}items(){return[...this.__items]}get size(){return this.__items.size}destroy(){T.deleteCtx(this.__ctxId),this.__propertyObservers=null,this.__collectionObservers=null;for(let i in this.__subsMap)this.__subsMap[i].forEach(t=>{t.remove()}),delete this.__subsMap[i]}};l(ks,"TypedCollection");var Si=ks;var Vn=l(r=>{let i=new Map;return(...t)=>{let e=JSON.stringify(t);if(i.has(e))return i.get(e);let s=r(...t);return i.set(e,s),s}},"memoize");function wa(r){let i=!1;return setTimeout(()=>{i=!0},0),l(e=>(...s)=>(i&&xi(r),e(...s)),"withAssert")}l(wa,"createAsyncAssertWrapper");function jn(r){let i={progress:()=>r.$["*commonProgress"],errors:()=>r.$["*collectionErrors"],group:()=>r.$["*groupInfo"],totalCount:()=>r.uploadCollection.size,failedCount:()=>t.failedEntries.length,successCount:()=>t.successEntries.length,uploadingCount:()=>t.uploadingEntries.length,status:()=>t.isFailed?"failed":t.isUploading?"uploading":t.isSuccess?"success":"idle",isSuccess:()=>t.errors.length===0&&t.successEntries.length===t.allEntries.length,isUploading:()=>t.allEntries.some(s=>s.status==="uploading"),isFailed:()=>t.errors.length>0||t.failedEntries.length>0,allEntries:()=>r.getOutputData(),successEntries:()=>t.allEntries.filter(s=>s.status==="success"),failedEntries:()=>t.allEntries.filter(s=>s.status==="failed"),uploadingEntries:()=>t.allEntries.filter(s=>s.status==="uploading"),idleEntries:()=>t.allEntries.filter(s=>s.status==="idle")},t={},e=wa("You're trying to access the OutputCollectionState asynchronously. In this case, the data you retrieve will be newer than it was when the OutputCollectionState was created or when the event was dispatched. If you want to retain the state at a specific moment in time, you should use the spread operator like this: `{...outputCollectionState}` or `{...e.detail}`");for(let[s,n]of Object.entries(i)){let o=s,c=Vn(e(n));Object.defineProperty(t,o,{get:c,enumerable:!0})}return t}l(jn,"buildOutputCollectionState");var Hn=Object.freeze({file:{type:File,value:null},externalUrl:{type:String,value:null},fileName:{type:String,value:null,nullable:!0},fileSize:{type:Number,value:null,nullable:!0},lastModified:{type:Number,value:Date.now()},uploadProgress:{type:Number,value:0},uuid:{type:String,value:null},isImage:{type:Boolean,value:!1},mimeType:{type:String,value:null,nullable:!0},ctxName:{type:String,value:null},cdnUrl:{type:String,value:null},cdnUrlModifiers:{type:String,value:null},fileInfo:{type:dt,value:null},isUploading:{type:Boolean,value:!1},abortController:{type:AbortController,value:null,nullable:!0},thumbUrl:{type:String,value:null,nullable:!0},silent:{type:Boolean,value:!1},source:{type:String,value:!1,nullable:!0},fullPath:{type:String,value:null,nullable:!0},metadata:{type:Object,value:null,nullable:!0},errors:{type:Array,value:[]},uploadError:{type:Error,value:null,nullable:!0},isRemoved:{type:Boolean,value:!1}});var Aa=/[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}/i,Ea=new RegExp(`^/?(${Aa.source})(?:/(-/(?:[^/]+/)+)?([^/]*))?$`,"i"),Gn=l(({url:r,cdnBase:i})=>{let t=new URL(i),e=new URL(r);if(t.host!==e.host)return null;let[,s,n,o]=Ea.exec(e.pathname);return{uuid:s,cdnUrlModifiers:n||"",filename:o||null}},"parseCdnUrl");var $i=class $i extends _{constructor(){super(...arguments);u(this,"couldBeCtxOwner",!1);u(this,"isCtxOwner",!1);u(this,"init$",gi(this));u(this,"__initialUploadMetadata",null);u(this,"_fileValidators",[this._validateIsImage.bind(this),this._validateFileType.bind(this),this._validateMaxSizeLimit.bind(this),this._validateUploadError.bind(this)]);u(this,"_collectionValidators",[t=>{let e=t.size,s=this.cfg.multiple?this.cfg.multipleMin:0,n=this.cfg.multiple?this.cfg.multipleMax:1;if(s&&e<s){let o=this.l10n("files-count-limit-error-too-few",{min:s,max:n,total:e});return Ai({type:"TOO_FEW_FILES",message:o,total:e,min:s,max:n})}if(n&&e>n){let o=this.l10n("files-count-limit-error-too-many",{min:s,max:n,total:e});return Ai({type:"TOO_MANY_FILES",message:o,total:e,min:s,max:n})}},t=>{if(t.items().some(e=>t.readProp(e,"errors").length>0))return Ai({type:"SOME_FILES_HAS_ERRORS",message:this.l10n("some-files-were-not-uploaded")})}]);u(this,"uploadAll",l(()=>{let t=this.uploadCollection.items().filter(e=>{let s=this.uploadCollection.read(e);return!s.getValue("isRemoved")&&!s.getValue("isUploading")&&!s.getValue("fileInfo")});t.length!==0&&(this.$["*uploadTrigger"]=new Set(t),this.emit(I.COMMON_UPLOAD_START,this.getOutputCollectionState()))},"uploadAll"));u(this,"_flushOutputItems",k(async()=>{if(this.getOutputData().length!==this.uploadCollection.size)return;let e=this.getOutputCollectionState();this.$["*collectionState"]=e,this.emit(I.CHANGE,()=>this.getOutputCollectionState(),{debounce:!0}),this.cfg.groupOutput&&e.totalCount>0&&e.status==="success"&&this._createGroup(e)},300));u(this,"_handleCollectionUpdate",l((t,e,s)=>{var n;(e.size||s.size)&&(this.$["*groupInfo"]=null),this._runFileValidators(),this._runCollectionValidators();for(let o of e)o.getValue("silent")||this.emit(I.FILE_ADDED,this.getOutputItem(o.uid));for(let o of s)this.$["*uploadTrigger"].delete(o.uid),(n=o.getValue("abortController"))==null||n.abort(),o.setMultipleValues({isRemoved:!0,abortController:null,isUploading:!1,uploadProgress:0}),URL.revokeObjectURL(o==null?void 0:o.getValue("thumbUrl")),this.emit(I.FILE_REMOVED,this.getOutputItem(o.uid));this.$["*uploadList"]=t.map(o=>({uid:o})),this._flushCommonUploadProgress(),this._flushOutputItems()},"_handleCollectionUpdate"));u(this,"_handleCollectionPropertiesUpdate",l(t=>{this._flushOutputItems();let e=this.uploadCollection,s=[...new Set(Object.entries(t).filter(([n])=>["uploadError","fileInfo"].includes(n)).map(([,n])=>[...n]).flat())];if(s.length>0&&setTimeout(()=>{this._runFileValidators(s)}),t.uploadProgress){for(let n of t.uploadProgress){let{isUploading:o,silent:a}=T.getCtx(n).store;o&&!a&&this.emit(I.FILE_UPLOAD_PROGRESS,this.getOutputItem(n))}this._flushCommonUploadProgress()}if(t.isUploading)for(let n of t.isUploading){let{isUploading:o,silent:a}=T.getCtx(n).store;o&&!a&&this.emit(I.FILE_UPLOAD_START,this.getOutputItem(n))}if(t.fileInfo){for(let a of t.fileInfo){let{fileInfo:c,silent:h}=T.getCtx(a).store;c&&!h&&this.emit(I.FILE_UPLOAD_SUCCESS,this.getOutputItem(a))}this.cfg.cropPreset&&this.setInitialCrop();let n=e.findItems(a=>!!a.getValue("fileInfo"));e.findItems(a=>a.getValue("errors").length>0).length===0&&e.size===n.length&&this.emit(I.COMMON_UPLOAD_SUCCESS,this.getOutputCollectionState())}if(t.errors)for(let n of t.errors){let{errors:o}=T.getCtx(n).store;o.length>0&&(this.emit(I.FILE_UPLOAD_FAILED,this.getOutputItem(n)),this.emit(I.COMMON_UPLOAD_FAILED,()=>this.getOutputCollectionState(),{debounce:!0}))}t.cdnUrl&&([...t.cdnUrl].filter(o=>{var a;return!!((a=this.uploadCollection.read(o))!=null&&a.getValue("cdnUrl"))}).forEach(o=>{this.emit(I.FILE_URL_CHANGED,this.getOutputItem(o))}),this.$["*groupInfo"]=null)},"_handleCollectionPropertiesUpdate"));u(this,"_flushCommonUploadProgress",l(()=>{let t=0,s=[...this.$["*uploadTrigger"]].filter(o=>!!this.uploadCollection.read(o));s.forEach(o=>{let a=this.uploadCollection.readProp(o,"uploadProgress");t+=a});let n=s.length?Math.round(t/s.length):0;this.$["*commonProgress"]!==n&&(this.$["*commonProgress"]=n,this.emit(I.COMMON_UPLOAD_PROGRESS,this.getOutputCollectionState()))},"_flushCommonUploadProgress"))}setUploadMetadata(t){xi("setUploadMetadata is deprecated. Use `metadata` instance property on `lr-config` block instead. See migration guide: https://uploadcare.com/docs/file-uploader/migration-to-0.25.0/"),this.connectedOnce?this.$["*uploadMetadata"]=t:this.__initialUploadMetadata=t}get hasCtxOwner(){return this.hasBlockInCtx(t=>t instanceof $i?t.isCtxOwner&&t.isConnected&&t!==this:!1)}initCallback(){if(super.initCallback(),!this.$["*uploadCollection"]){let t=new Si({typedSchema:Hn,watchList:["uploadProgress","uploadError","fileInfo","errors","cdnUrl","isUploading"]});this.$["*uploadCollection"]=t}!this.hasCtxOwner&&this.couldBeCtxOwner&&this.initCtxOwner()}destroyCtxCallback(){var t,e;(t=this._unobserveCollectionProperties)==null||t.call(this),(e=this._unobserveCollection)==null||e.call(this),this.uploadCollection.destroy(),this.$["*uploadCollection"]=null,super.destroyCtxCallback()}initCtxOwner(){this.isCtxOwner=!0,this._unobserveCollection=this.uploadCollection.observeCollection(this._handleCollectionUpdate),this._unobserveCollectionProperties=this.uploadCollection.observeProperties(this._handleCollectionPropertiesUpdate);let t=l(()=>{this._runFileValidators(),this._runCollectionValidators()},"runAllValidators");this.subConfigValue("maxLocalFileSizeBytes",t),this.subConfigValue("multipleMin",t),this.subConfigValue("multipleMax",t),this.subConfigValue("multiple",t),this.subConfigValue("imgOnly",t),this.subConfigValue("accept",t),this.subConfigValue("maxConcurrentRequests",e=>{this.$["*uploadQueue"].concurrency=Number(e)||1}),this.__initialUploadMetadata&&(this.$["*uploadMetadata"]=this.__initialUploadMetadata)}addFileFromUrl(t,{silent:e,fileName:s,source:n}={}){let o=this.uploadCollection.add({externalUrl:t,fileName:s!=null?s:null,silent:e!=null?e:!1,source:n!=null?n:W.API});return this.getOutputItem(o)}addFileFromUuid(t,{silent:e,fileName:s,source:n}={}){let o=this.uploadCollection.add({uuid:t,fileName:s!=null?s:null,silent:e!=null?e:!1,source:n!=null?n:W.API});return this.getOutputItem(o)}addFileFromCdnUrl(t,{silent:e,fileName:s,source:n}={}){var c;let o=Gn({url:t,cdnBase:this.cfg.cdnCname});if(!o)throw new Error("Invalid CDN URL");let a=this.uploadCollection.add({uuid:o.uuid,cdnUrl:t,cdnUrlModifiers:o.cdnUrlModifiers,fileName:(c=s!=null?s:o.filename)!=null?c:null,silent:e!=null?e:!1,source:n!=null?n:W.API});return this.getOutputItem(a)}addFileFromObject(t,{silent:e,fileName:s,source:n,fullPath:o}={}){let a=this.uploadCollection.add({file:t,isImage:Is(t),mimeType:t.type,fileName:s!=null?s:t.name,fileSize:t.size,silent:e!=null?e:!1,source:n!=null?n:W.API,fullPath:o!=null?o:null});return this.getOutputItem(a)}addFiles(t){return console.warn("`addFiles` method is deprecated. Please use `addFileFromObject`, `addFileFromUrl` or `addFileFromUuid` instead."),t.map(e=>{let s=this.uploadCollection.add({file:e,isImage:Is(e),mimeType:e.type,fileName:e.name,fileSize:e.size});return this.getOutputItem(s)})}removeFileByInternalId(t){if(!this.uploadCollection.read(t))throw new Error(`File with internalId ${t} not found`);this.uploadCollection.remove(t)}removeAllFiles(){this.uploadCollection.clearAll()}openSystemDialog(t={}){var s;let e=zt(Ss([(s=this.cfg.accept)!=null?s:"",...this.cfg.imgOnly?Ei:[]]));this.cfg.accept&&this.cfg.imgOnly&&console.warn("There could be a mistake.\nBoth `accept` and `imgOnly` parameters are set.\nThe value of `accept` will be concatenated with the internal image mime types list."),this.fileInput=document.createElement("input"),this.fileInput.type="file",this.fileInput.multiple=this.cfg.multiple,t.captureCamera?(this.fileInput.capture=this.cfg.cameraCapture,this.fileInput.accept="image/*"):this.fileInput.accept=e,this.fileInput.dispatchEvent(new MouseEvent("click")),this.fileInput.onchange=()=>{[...this.fileInput.files].forEach(n=>this.addFileFromObject(n,{source:t.captureCamera?W.CAMERA:W.LOCAL})),this.$["*currentActivity"]=_.activities.UPLOAD_LIST,this.setOrAddState("*modalActive",!0),this.fileInput.value="",this.fileInput=null}}get sourceList(){let t=[];return this.cfg.sourceList&&(t=R(this.cfg.sourceList)),t}initFlow(t=!1){var e;if(this.uploadCollection.size>0&&!t)this.set$({"*currentActivity":_.activities.UPLOAD_LIST}),this.setOrAddState("*modalActive",!0);else if(((e=this.sourceList)==null?void 0:e.length)===1){let s=this.sourceList[0];if(s==="local"){this.$["*currentActivity"]=_.activities.UPLOAD_LIST,this==null||this.openSystemDialog();return}let n=this.$["*blocksRegistry"],o=l(c=>"type"in c&&c.type===s,"isSourceBtn"),a=[...n].find(o);a==null||a.activate(),this.$["*currentActivity"]&&this.setOrAddState("*modalActive",!0)}else this.set$({"*currentActivity":_.activities.START_FROM}),this.setOrAddState("*modalActive",!0)}doneFlow(){this.set$({"*currentActivity":this.doneActivity,"*history":this.doneActivity?[this.doneActivity]:[]}),this.$["*currentActivity"]||this.setOrAddState("*modalActive",!1)}get uploadCollection(){return this.$["*uploadCollection"]}_validateFileType(t){let e=this.cfg.imgOnly,s=this.cfg.accept,n=Ss([...e?Ei:[],s]);if(!n.length)return;let o=t.mimeType,a=t.name;if(!o||!a)return;let c=$s(o,n),h=Nn(a,n);if(!c&&!h)return Pt({type:"FORBIDDEN_FILE_TYPE",message:this.l10n("file-type-not-allowed"),entry:t})}_validateMaxSizeLimit(t){let e=this.cfg.maxLocalFileSizeBytes,s=t.size;if(e&&s&&s>e)return Pt({type:"FILE_SIZE_EXCEEDED",message:this.l10n("files-max-size-limit-error",{maxFileSize:Fn(e)}),entry:t})}_validateUploadError(t,e){let s=e==null?void 0:e.getValue("uploadError");if(s){if(s instanceof N)return Pt({type:"UPLOAD_ERROR",message:s.message,entry:t,error:s});if(s instanceof Ft)return Pt({type:"NETWORK_ERROR",message:s.message,entry:t,error:s});{let n=s instanceof Error?s:new Error("Unknown error",{cause:s});return Pt({type:"UNKNOWN_ERROR",message:n.message,entry:t,error:n})}}}_validateIsImage(t){let e=this.cfg.imgOnly,s=t.isImage;if(!(!e||s)&&!(!t.fileInfo&&t.externalUrl)&&!(!t.fileInfo&&!t.mimeType))return Pt({type:"NOT_AN_IMAGE",message:this.l10n("images-only-accepted"),entry:t})}_runFileValidatorsForEntry(t){let e=this.getOutputItem(t.uid),s=[];for(let n of this._fileValidators){let o=n(e,t);o&&s.push(o)}t.setValue("errors",s)}_runFileValidators(t){let e=t!=null?t:this.uploadCollection.items();for(let s of e){let n=this.uploadCollection.read(s);n&&this._runFileValidatorsForEntry(n)}}_runCollectionValidators(){let t=this.uploadCollection,e=[];for(let s of this._collectionValidators){let n=s(t);n&&(Array.isArray(n)?e.push(...n):e.push(n))}this.$["*collectionErrors"]=e,e.length>0&&this.emit(I.COMMON_UPLOAD_FAILED,()=>this.getOutputCollectionState(),{debounce:!0})}async _createGroup(t){let e=this.getUploadClientOptions(),s=t.allEntries.map(c=>c.uuid+(c.cdnUrlModifiers?`/${c.cdnUrlModifiers}`:"")),n=new AbortController,o=await ln(s,{...e,signal:n.signal});if(this.$["*collectionState"]!==t){n.abort();return}this.$["*groupInfo"]=o;let a=this.getOutputCollectionState();this.emit(I.GROUP_CREATED,a),this.emit(I.CHANGE,()=>this.getOutputCollectionState(),{debounce:!0}),this.$["*collectionState"]=a}setInitialCrop(){let t=wi(this.cfg.cropPreset);if(t){let[e]=t,s=this.uploadCollection.findItems(n=>{var o;return n.getValue("fileInfo")&&n.getValue("isImage")&&!((o=n.getValue("cdnUrlModifiers"))!=null&&o.includes("/crop/"))}).map(n=>this.uploadCollection.read(n));for(let n of s){let o=n.getValue("fileInfo"),{width:a,height:c}=o.imageInfo,h=e.width/e.height,d=Rn(a,c,h),p=F(`crop/${d.width}x${d.height}/${d.x},${d.y}`,"preview");n.setMultipleValues({cdnUrlModifiers:p,cdnUrl:L(n.getValue("cdnUrl"),p)}),this.uploadCollection.size===1&&this.cfg.useCloudImageEditor&&this.hasBlockInCtx(f=>f.activityType===_.activities.CLOUD_IMG_EDIT)&&(this.$["*focusedEntry"]=n,this.$["*currentActivity"]=_.activities.CLOUD_IMG_EDIT)}}}async getMetadataFor(t){var s;let e=(s=this.cfg.metadata)!=null?s:this.$["*uploadMetadata"];if(typeof e=="function"){let n=this.getOutputItem(t);return await e(n)}return e}getUploadClientOptions(){return{store:this.cfg.store,publicKey:this.cfg.pubkey,baseCDN:this.cfg.cdnCname,baseURL:this.cfg.baseUrl,userAgent:Mn,integration:this.cfg.userAgentIntegration,secureSignature:this.cfg.secureSignature,secureExpire:this.cfg.secureExpire,retryThrottledRequestMaxTimes:this.cfg.retryThrottledRequestMaxTimes,multipartMinFileSize:this.cfg.multipartMinFileSize,multipartChunkSize:this.cfg.multipartChunkSize,maxConcurrentRequests:this.cfg.multipartMaxConcurrentRequests,multipartMaxAttempts:this.cfg.multipartMaxAttempts,checkForUrlDuplicates:!!this.cfg.checkForUrlDuplicates,saveUrlForRecurrentUploads:!!this.cfg.saveUrlForRecurrentUploads}}getOutputItem(t){var a,c,h,d,p,f,g,m,b,v;let e=T.getCtx(t).store,s=e.fileInfo,n=e.isRemoved?"removed":e.errors.length>0?"failed":e.fileInfo?"success":e.isUploading?"uploading":"idle";return{uuid:(c=(a=s==null?void 0:s.uuid)!=null?a:e.uuid)!=null?c:null,internalId:t,name:(h=s==null?void 0:s.originalFilename)!=null?h:e.fileName,size:(d=s==null?void 0:s.size)!=null?d:e.fileSize,isImage:(p=s==null?void 0:s.isImage)!=null?p:e.isImage,mimeType:(f=s==null?void 0:s.mimeType)!=null?f:e.mimeType,file:e.file,externalUrl:e.externalUrl,cdnUrlModifiers:e.cdnUrlModifiers,cdnUrl:(m=(g=e.cdnUrl)!=null?g:s==null?void 0:s.cdnUrl)!=null?m:null,fullPath:e.fullPath,uploadProgress:e.uploadProgress,fileInfo:s!=null?s:null,metadata:(v=(b=e.metadata)!=null?b:s==null?void 0:s.metadata)!=null?v:null,isSuccess:n==="success",isUploading:n==="uploading",isFailed:n==="failed",isRemoved:n==="removed",errors:e.errors,status:n}}getOutputData(t){return(t?this.uploadCollection.findItems(t):this.uploadCollection.items()).map(n=>this.getOutputItem(n))}getOutputCollectionState(){return jn(this)}};l($i,"UploaderBlock");var S=$i;S.extSrcList=Object.freeze({FACEBOOK:"facebook",DROPBOX:"dropbox",GDRIVE:"gdrive",GPHOTOS:"gphotos",INSTAGRAM:"instagram",FLICKR:"flickr",VK:"vk",EVERNOTE:"evernote",BOX:"box",ONEDRIVE:"onedrive",HUDDLE:"huddle"});S.sourceTypes=Object.freeze({LOCAL:"local",URL:"url",CAMERA:"camera",DRAW:"draw",...S.extSrcList});var Wt=l(r=>{var i;return(i=r.match(/[A-Z]{2,}(?=[A-Z][a-z]+[0-9]*|\b)|[A-Z]?[a-z]+[0-9]*|[A-Z]|[0-9]+/g))==null?void 0:i.map(t=>t.toLowerCase()).join("-")},"toKebabCase");var M=l(r=>String(r),"asString"),nt=l(r=>{let i=Number(r);if(Number.isNaN(i))throw new Error(`Invalid number: "${r}"`);return i},"asNumber"),O=l(r=>{if(typeof r=="undefined"||r===null)return!1;if(typeof r=="boolean")return r;if(r==="true"||r==="")return!0;if(r==="false")return!1;throw new Error(`Invalid boolean: "${r}"`)},"asBoolean"),xa=l(r=>r==="auto"?r:O(r),"asStore"),Ta=l(r=>{let i=M(r);if(i!=="user"&&i!=="environment"&&i!=="")throw new Error(`Invalid "cameraCapture" value: "${i}"`);return i},"asCameraCapture"),Sa=l(r=>{if(typeof r=="object"&&!Array.isArray(r)||typeof r=="function")return r;throw new Error("Invalid metadata value. Must be an object or function.")},"asMetadata"),$a=l(r=>{if(typeof r=="object")return r;throw new Error("Invalid localeDefinitionOverride value. Must be an object.")},"asLocaleDefinitionOverride"),Ia={pubkey:M,multiple:O,multipleMin:nt,multipleMax:nt,confirmUpload:O,imgOnly:O,accept:M,externalSourcesPreferredTypes:M,store:xa,cameraMirror:O,cameraCapture:Ta,sourceList:M,maxLocalFileSizeBytes:nt,thumbSize:nt,showEmptyList:O,useLocalImageEditor:O,useCloudImageEditor:O,cloudImageEditorTabs:M,removeCopyright:O,cropPreset:M,imageShrink:M,modalScrollLock:O,modalBackdropStrokes:O,sourceListWrap:O,remoteTabSessionKey:M,cdnCname:M,baseUrl:M,socialBaseUrl:M,secureSignature:M,secureExpire:M,secureDeliveryProxy:M,retryThrottledRequestMaxTimes:nt,multipartMinFileSize:nt,multipartChunkSize:nt,maxConcurrentRequests:nt,multipartMaxConcurrentRequests:nt,multipartMaxAttempts:nt,checkForUrlDuplicates:O,saveUrlForRecurrentUploads:O,groupOutput:O,userAgentIntegration:M,debug:O,localeName:M,metadata:Sa,localeDefinitionOverride:$a},Wn=l((r,i)=>{if(!(typeof i=="undefined"||i===null))try{return Ia[r](i)}catch(t){return console.error(`Invalid value for config key "${r}".`,t),Q[r]}},"normalizeConfigValue");var Ls=[...new Set(["debug",...Object.keys(Q)])],Oa=["metadata","localeDefinitionOverride"],ka=l(r=>Oa.includes(r),"isComplexKey"),Xt=Ls.filter(r=>!ka(r)),La={...Object.fromEntries(Xt.map(r=>[Wt(r),r])),...Object.fromEntries(Xt.map(r=>[r.toLowerCase(),r]))},Pa={...Object.fromEntries(Xt.map(r=>[Wt(r),H(r)])),...Object.fromEntries(Xt.map(r=>[r.toLowerCase(),H(r)]))},Xn=l(r=>"__"+r,"getLocalPropName"),Ps=class Ps extends y{constructor(){super();u(this,"requireCtxName",!0);this.init$={...this.init$,...Object.fromEntries(Object.entries(Q).map(([t,e])=>[H(t),e]))}}_flushValueToAttribute(t,e){if(Xt.includes(t)){let s=[...new Set([Wt(t),t.toLowerCase()])];for(let n of s)typeof e=="undefined"||e===null?this.removeAttribute(n):this.getAttribute(n)!==e.toString()&&this.setAttribute(n,e.toString())}}_flushValueToState(t,e){this.$[H(t)]!==e&&(typeof e=="undefined"||e===null?this.$[H(t)]=Q[t]:this.$[H(t)]=e)}_setValue(t,e){let s=this,n=Wn(t,e),o=Xn(t);s[o]!==n&&(this._assertSameValueDifferentReference(t,s[o],n),s[o]=n,this._flushValueToAttribute(t,n),this._flushValueToState(t,n),this.debugPrint(`[lr-config] "${t}"`,n))}_getValue(t){let e=this,s=Xn(t);return e[s]}_assertSameValueDifferentReference(t,e,s){this.cfg.debug&&JSON.stringify(s)===JSON.stringify(e)&&(console.warn(`[lr-config] Option "${t}" value is the same as the previous one but the reference is different`),console.warn("[lr-config] You should avoid changing the reference of the object to prevent unnecessary calculations"),console.warn(`[lr-config] "${t}" previous value:`,e),console.warn(`[lr-config] "${t}" new value:`,s))}initCallback(){var e;super.initCallback();let t=this;for(let s of Xt)this.sub(H(s),n=>{this._setValue(s,n)},!1);for(let s of Ls){let n=(e=t[s])!=null?e:this.$[H(s)];n!==Q[s]&&this._setValue(s,n),Object.defineProperty(this,s,{set:o=>{this._setValue(s,o)},get:()=>this._getValue(s)})}}attributeChangedCallback(t,e,s){if(e===s)return;let n=this,o=La[t];n[o]=s}};l(Ps,"ConfigClass");var Ie=Ps;Ie.bindAttributes(Pa);for(let r of Ls)Ie.prototype[r]=void 0;var qn=Ie;var Us=class Us extends y{constructor(){super(...arguments);u(this,"init$",{...this.init$,name:"",path:"",size:"24",viewBox:""})}initCallback(){super.initCallback(),this.sub("name",t=>{if(!t)return;let e=this.getCssData(`--icon-${t}`);e&&(this.$.path=e)}),this.sub("path",t=>{if(!t)return;t.trimStart().startsWith("<")?(this.setAttribute("raw",""),this.ref.svg.innerHTML=t):(this.removeAttribute("raw"),this.ref.svg.innerHTML=`<path fill-rule="evenodd" d="${t}"></path>`)}),this.sub("size",t=>{this.$.viewBox=`0 0 ${t} ${t}`})}};l(Us,"Icon");var qt=Us;qt.template=`<svg ref="svg" xmlns="http://www.w3.org/2000/svg" set="@viewBox: viewBox; @height: size; @width: size"></svg>`;qt.bindAttributes({name:"name",size:"size"});var Kn=l(r=>[...new Set(r)],"uniqueArray");var Yn=l(r=>Object.entries(r).filter(([i,t])=>t!==void 0&&t!=="").map(([i,t])=>i==="cdn-operations"||i==="analytics"?t:`${i}/${t}`),"parseObjectToString");var Ua="https://ucarecdn.com",Oe=Object.freeze({"dev-mode":{},pubkey:{},uuid:{},src:{},lazy:{default:1},intersection:{},breakpoints:{},"cdn-cname":{default:Ua},"proxy-cname":{},"secure-delivery-proxy":{},"hi-res-support":{default:1},"ultra-res-support":{},format:{},"cdn-operations":{},progressive:{},quality:{},"is-background-for":{},"is-preview-blur":{default:1}});var Kt="--lr-img-",Rs="unresolved";var Ms=!window.location.host.trim()||window.location.host.includes(":")||window.location.hostname.includes("localhost"),Ds=3e3,Ns=5e3,Fs=Object.freeze({PREVIEW:"PREVIEW",MAIN:"MAIN"});var Zn=Object.create(null),Jn;for(let r in Oe)Zn[Kt+r]=((Jn=Oe[r])==null?void 0:Jn.default)||"";var Bs=class Bs extends Ot{constructor(){super(...arguments);u(this,"cssInit$",Zn)}$$(t){return this.$[Kt+t]}set$$(t){for(let e in t)this.$[Kt+e]=t[e]}sub$$(t,e){this.sub(Kt+t,s=>{s===null||s===""||e(s)})}analyticsParams(){return`-/@clib/${Ae}/${Ee}/lr-img/`}initAttributes(t){[...this.attributes].forEach(e=>{Oe[e.name]||t.setAttribute(e.name,e.value)})}initIntersection(t,e){let s={root:null,rootMargin:"0px"};this._isnObserver=new IntersectionObserver(n=>{n.forEach(o=>{o.isIntersecting&&(e(),this._isnObserver.unobserve(t))})},s),this._isnObserver.observe(t),this._observed||(this._observed=new Set),this._observed.add(t)}destroyCallback(){super.destroyCallback(),this._isnObserver&&(this._observed.forEach(t=>{this._isnObserver.unobserve(t)}),this._isnObserver=null),T.deleteCtx(this)}static get observedAttributes(){return Object.keys(Oe)}attributeChangedCallback(t,e,s){window.setTimeout(()=>{this.$[Kt+t]=s})}};l(Bs,"ImgConfig");var Ii=Bs;var zs=class zs extends Ii{constructor(){super(...arguments);u(this,"_img",new Image);u(this,"_imgPreview",new Image)}_fmtAbs(t){return!t.includes("//")&&!Ms&&(t=new URL(t,document.baseURI).href),t}_validateSize(t){if((t==null?void 0:t.trim())!==""){let e=t.match(/\d+/)[0],s=t.match(/[a-zA-Z]+/)[0],n=parseInt(e,10);if(Number(n)>Ns&&this.hasFormatJPG)return Ns+s;if(Number(n)>Ds&&!this.hasFormatJPG)return Ds+s}return t}_getCdnModifiers(t,e){let s={format:this.$$("format"),quality:this.$$("quality"),resize:this._validateSize(t),blur:e,"cdn-operations":this.$$("cdn-operations"),analytics:this.analyticsParams()};return F(...Yn(s))}_getUrlBase(t="",e=""){if(this.$$("src").startsWith("data:")||this.$$("src").startsWith("blob:"))return this.$$("src");if(Ms&&this.$$("src")&&!this.$$("src").includes("//"))return this._proxyUrl(this.$$("src"));let s=this._getCdnModifiers(t,e);if(this.$$("src").startsWith(this.$$("cdn-cname")))return L(this.$$("src"),s);if(this.$$("cdn-cname")&&this.$$("uuid"))return this._proxyUrl(L(Ct(this.$$("cdn-cname"),this.$$("uuid")),s));if(this.$$("uuid"))return this._proxyUrl(L(Ct(this.$$("cdn-cname"),this.$$("uuid")),s));if(this.$$("proxy-cname"))return this._proxyUrl(L(this.$$("proxy-cname"),s,this._fmtAbs(this.$$("src"))));if(this.$$("pubkey"))return this._proxyUrl(L(`https://${this.$$("pubkey")}.ucr.io/`,s,this._fmtAbs(this.$$("src"))))}_proxyUrl(t){return this.$$("secure-delivery-proxy")?ve(this.$$("secure-delivery-proxy"),{previewUrl:t},{transform:s=>window.encodeURIComponent(s)}):t}_getElSize(t,e=1,s=!0){let n=t.getBoundingClientRect(),o=e*Math.round(n.width),a=s?"":e*Math.round(n.height);return o||a?`${o||""}x${a||""}`:null}_setupEventProxy(t){let e=l(n=>{n.stopPropagation();let o=new Event(n.type,n);this.dispatchEvent(o)},"proxifyEvent"),s=["load","error"];for(let n of s)t.addEventListener(n,e)}get img(){return this.hasPreviewImage||(this._setupConfigForImage({elNode:this._img}),this.appendChild(this._img)),this._img}get currentImg(){return this.hasPreviewImage?{type:Fs.PREVIEW,img:this._imgPreview}:{type:Fs.MAIN,img:this.img}}get hasPreviewImage(){return this.$$("is-preview-blur")}get bgSelector(){return this.$$("is-background-for")}get breakpoints(){if(this.$$("breakpoints")){let t=R(this.$$("breakpoints"));return Kn(t.map(e=>parseInt(e,10)))}else return null}get hasFormatJPG(){return this.$$("format").toLowerCase()==="jpeg"}renderBg(t){let e=new Set;e.add(`url("${this._getUrlBase(this._getElSize(t))}") 1x`),this.$$("hi-res-support")&&e.add(`url("${this._getUrlBase(this._getElSize(t,2))}") ${2}x`),this.$$("ultra-res-support")&&e.add(`url("${this._getUrlBase(this._getElSize(t,3))}") ${3}x`);let s=`image-set(${[...e].join(", ")})`;t.style.setProperty("background-image",s),t.style.setProperty("background-image","-webkit-"+s)}getSrcset(){let t=new Set;return this.breakpoints?this.breakpoints.forEach(e=>{t.add(this._getUrlBase(e+"x")+` ${this._validateSize(e+"w")}`),this.$$("hi-res-support")&&t.add(this._getUrlBase(e*2+"x")+` ${this._validateSize(e*2+"w")}`),this.$$("ultra-res-support")&&t.add(this._getUrlBase(e*3+"x")+` ${this._validateSize(e*3+"w")}`)}):(t.add(this._getUrlBase(this._getElSize(this.currentImg.img))+" 1x"),this.$$("hi-res-support")&&t.add(this._getUrlBase(this._getElSize(this.currentImg.img,2))+" 2x"),this.$$("ultra-res-support")&&t.add(this._getUrlBase(this._getElSize(this.currentImg.img,3))+" 3x")),[...t].join()}getSrc(){return this._getUrlBase()}get srcUrlPreview(){return this._getUrlBase("100x","100")}renderBackground(){[...document.querySelectorAll(this.bgSelector)].forEach(t=>{this.$$("intersection")?this.initIntersection(t,()=>{this.renderBg(t)}):this.renderBg(t)})}_appendURL({elNode:t,src:e,srcset:s}){e&&(t.src=e),s&&(t.srcset=s)}_setupConfigForImage({elNode:t}){this._setupEventProxy(t),this.initAttributes(t)}loaderImage({src:t,srcset:e,elNode:s}){return new Promise((n,o)=>{this._setupConfigForImage({elNode:s}),s.setAttribute(Rs,""),s.addEventListener("load",()=>{s.removeAttribute(Rs),n(s)}),s.addEventListener("error",()=>{o(!1)}),this._appendURL({elNode:s,src:t,srcset:e})})}async renderImage(){var t,e;if(this.$$("intersection")){this.hasPreviewImage&&(this._setupConfigForImage({elNode:this._imgPreview}),this.appendChild(this._imgPreview)),this.initIntersection(this.currentImg.img,async()=>{var s;this.hasPreviewImage&&(this._imgPreview.src=this.srcUrlPreview);try{await this.loaderImage({src:this.getSrc(),srcset:this.getSrcset(),elNode:this._img}),this.hasPreviewImage&&await this._imgPreview.remove(),this.appendChild(this._img)}catch{this.hasPreviewImage&&await((s=this._imgPreview)==null?void 0:s.remove()),this.appendChild(this._img)}});return}try{this.hasPreviewImage&&(await this.loaderImage({src:this.srcUrlPreview,elNode:this._imgPreview}),this.appendChild(this._imgPreview)),await this.loaderImage({src:this.getSrc(),srcset:this.getSrcset(),elNode:this._img}),this.hasPreviewImage&&await((t=this._imgPreview)==null?void 0:t.remove()),this.appendChild(this._img)}catch{this.hasPreviewImage&&await((e=this._imgPreview)==null?void 0:e.remove()),this.appendChild(this._img)}}init(){this.bgSelector?this.renderBackground():this.renderImage()}};l(zs,"ImgBase");var Li=zs;var Vs=class Vs extends Li{initCallback(){super.initCallback(),this.sub$$("src",()=>{this.init()}),this.sub$$("uuid",()=>{this.init()}),this.sub$$("lazy",i=>{!this.$$("is-background-for")&&!this.$$("is-preview-blur")&&(this.img.loading=i?"lazy":"eager")})}};l(Vs,"Img");var Pi=Vs;var js=class js extends S{constructor(){super();u(this,"couldBeCtxOwner",!0);this.init$={...this.init$,withDropZone:!0,onClick:()=>{this.initFlow()},"button-text":""}}initCallback(){super.initCallback(),this.defineAccessor("dropzone",t=>{typeof t!="undefined"&&(this.$.withDropZone=O(t))}),this.subConfigValue("multiple",t=>{this.$["button-text"]=t?"upload-files":"upload-file"})}};l(js,"SimpleBtn");var Yt=js;Yt.template=`<lr-drop-area set="@disabled: !withDropZone"><button type="button" set="onclick: onClick"><lr-icon name="upload"></lr-icon><span l10n="button-text"></span><slot></slot><div class="visual-drop-area" l10n="drop-files-here"></div></button></lr-drop-area>`;Yt.bindAttributes({dropzone:null});var Hs=class Hs extends _{constructor(){super(...arguments);u(this,"historyTracked",!0);u(this,"activityType","start-from")}initCallback(){super.initCallback(),this.registerActivity(this.activityType)}};l(Hs,"StartFrom");var ke=Hs;ke.template='<div class="content"><slot></slot></div>';function Ra(r){return new Promise(i=>{typeof window.FileReader!="function"&&i(!1);try{let t=new FileReader;t.onerror=()=>{i(!0)};let e=l(s=>{s.type!=="loadend"&&t.abort(),i(!1)},"onLoad");t.onloadend=e,t.onprogress=e,t.readAsDataURL(r)}catch{i(!1)}})}l(Ra,"checkIsDirectory");function Ma(r,i){return new Promise(t=>{let e=0,s=[],n=l(a=>{a||(console.warn("Unexpectedly received empty content entry",{scope:"drag-and-drop"}),t(null)),a.isFile?(e++,a.file(c=>{e--;let h=new File([c],c.name,{type:c.type||i});s.push({type:"file",file:h,fullPath:a.fullPath}),e===0&&t(s)})):a.isDirectory&&o(a.createReader())},"readEntry"),o=l(a=>{e++,a.readEntries(c=>{e--;for(let h of c)n(h);e===0&&t(s)})},"readReaderContent");n(r)})}l(Ma,"readEntryContentAsync");function Qn(r){let i=[],t=[];for(let e=0;e<r.items.length;e++){let s=r.items[e];if(s)if(s.kind==="file"){let n=s.type;if(typeof s.webkitGetAsEntry=="function"||typeof s.getAsEntry=="function"){let a=typeof s.webkitGetAsEntry=="function"?s.webkitGetAsEntry():s.getAsEntry();t.push(Ma(a,n).then(c=>{c&&i.push(...c)}));continue}let o=s.getAsFile();o&&t.push(Ra(o).then(a=>{a||i.push({type:"file",file:o})}))}else s.kind==="string"&&s.type.match("^text/uri-list")&&t.push(new Promise(n=>{s.getAsString(o=>{i.push({type:"url",url:o}),n(void 0)})}))}return Promise.all(t).then(()=>i)}l(Qn,"getDropItems");var B={ACTIVE:0,INACTIVE:1,NEAR:2,OVER:3},to=["focus"],Da=100,Gs=new Map;function Na(r,i){let t=Math.max(Math.min(r[0],i.x+i.width),i.x),e=Math.max(Math.min(r[1],i.y+i.height),i.y);return Math.sqrt((r[0]-t)*(r[0]-t)+(r[1]-e)*(r[1]-e))}l(Na,"distance");function Ws(r){let i=0,t=document.body,e=new Set,s=l(m=>e.add(m),"handleSwitch"),n=B.INACTIVE,o=l(m=>{r.shouldIgnore()&&m!==B.INACTIVE||(n!==m&&e.forEach(b=>b(m)),n=m)},"setState"),a=l(()=>i>0,"isDragging");s(m=>r.onChange(m));let c=l(()=>{i=0,o(B.INACTIVE)},"onResetEvent"),h=l(()=>{i+=1,n===B.INACTIVE&&o(B.ACTIVE)},"onDragEnter"),d=l(()=>{i-=1,a()||o(B.INACTIVE)},"onDragLeave"),p=l(m=>{m.preventDefault(),i=0,o(B.INACTIVE)},"onDrop"),f=l(m=>{if(r.shouldIgnore())return;a()||(i+=1);let b=[m.x,m.y],v=r.element.getBoundingClientRect(),x=Math.floor(Na(b,v)),C=x<Da,E=m.composedPath().includes(r.element);Gs.set(r.element,x);let z=Math.min(...Gs.values())===x;E&&z?(m.preventDefault(),o(B.OVER)):o(C&&z?B.NEAR:B.ACTIVE)},"onDragOver"),g=l(async m=>{if(r.shouldIgnore())return;m.preventDefault();let b=await Qn(m.dataTransfer);r.onItems(b),o(B.INACTIVE)},"onElementDrop");return t.addEventListener("drop",p),t.addEventListener("dragleave",d),t.addEventListener("dragenter",h),t.addEventListener("dragover",f),r.element.addEventListener("drop",g),to.forEach(m=>{window.addEventListener(m,c)}),()=>{Gs.delete(r.element),t.removeEventListener("drop",p),t.removeEventListener("dragleave",d),t.removeEventListener("dragenter",h),t.removeEventListener("dragover",f),r.element.removeEventListener("drop",g),to.forEach(m=>{window.removeEventListener(m,c)})}}l(Ws,"addDropzone");var eo="lr-drop-area",Jt=`${eo}/registry`,Xs=class Xs extends S{constructor(){super(),this.init$={...this.init$,state:B.INACTIVE,withIcon:!1,isClickable:!1,isFullscreen:!1,isEnabled:!0,isVisible:!0,text:"",[Jt]:null}}isActive(){if(!this.$.isEnabled)return!1;let i=this.getBoundingClientRect(),t=i.width>0&&i.height>0,e=i.top>=0&&i.left>=0&&i.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&i.right<=(window.innerWidth||document.documentElement.clientWidth),s=window.getComputedStyle(this),n=s.visibility!=="hidden"&&s.display!=="none";return t&&n&&e}initCallback(){super.initCallback(),this.bindL10n("text",()=>this.l10n("drop-files-here")),this.$[Jt]||(this.$[Jt]=new Set),this.$[Jt].add(this),this.defineAccessor("disabled",t=>{this.set$({isEnabled:!O(t)})}),this.defineAccessor("clickable",t=>{this.set$({isClickable:O(t)})}),this.defineAccessor("with-icon",t=>{this.set$({withIcon:O(t)})}),this.defineAccessor("fullscreen",t=>{this.set$({isFullscreen:O(t)})}),this.defineAccessor("text",t=>{typeof t=="string"?this.bindL10n("text",()=>this.l10n(t)||t):this.bindL10n("text",()=>this.l10n("drop-files-here"))}),this._destroyDropzone=Ws({element:this,shouldIgnore:()=>this._shouldIgnore(),onChange:t=>{this.$.state=t},onItems:t=>{t.length&&(t.forEach(e=>{e.type==="url"?this.addFileFromUrl(e.url,{source:W.DROP_AREA}):e.type==="file"&&this.addFileFromObject(e.file,{source:W.DROP_AREA,fullPath:e.fullPath})}),this.uploadCollection.size&&(this.set$({"*currentActivity":_.activities.UPLOAD_LIST}),this.setOrAddState("*modalActive",!0)))}});let i=this.ref["content-wrapper"];i&&(this._destroyContentWrapperDropzone=Ws({element:i,onChange:t=>{var s;let e=(s=Object.entries(B).find(([,n])=>n===t))==null?void 0:s[0].toLowerCase();e&&i.setAttribute("drag-state",e)},onItems:()=>{},shouldIgnore:()=>this._shouldIgnore()})),this.sub("state",t=>{var s;let e=(s=Object.entries(B).find(([,n])=>n===t))==null?void 0:s[0].toLowerCase();e&&this.setAttribute("drag-state",e)}),this.subConfigValue("sourceList",t=>{let e=R(t);this.$.isEnabled=e.includes(S.sourceTypes.LOCAL),this.$.isVisible=this.$.isEnabled||!this.querySelector("[data-default-slot]")}),this.sub("isVisible",t=>{this.toggleAttribute("hidden",!t)}),this.sub("isClickable",t=>{this.toggleAttribute("clickable",t)}),this.$.isClickable&&(this._onAreaClicked=()=>{this.openSystemDialog()},this.addEventListener("click",this._onAreaClicked))}_shouldIgnore(){return!this.$.isEnabled||!this._couldHandleFiles()?!0:this.$.isFullscreen?[...this.$[Jt]].filter(e=>e!==this).filter(e=>e.isActive()).length>0:!1}_couldHandleFiles(){let i=this.cfg.multiple,t=this.cfg.multipleMax,e=this.uploadCollection.size;return!(i&&t&&e>=t||!i&&e>0)}destroyCallback(){var t,e;super.destroyCallback();let i=this.$[Jt];i&&(i.delete(this),i.size===0&&T.deleteCtx(eo)),(t=this._destroyDropzone)==null||t.call(this),(e=this._destroyContentWrapperDropzone)==null||e.call(this),this._onAreaClicked&&this.removeEventListener("click",this._onAreaClicked)}};l(Xs,"DropArea");var Zt=Xs;Zt.template=`<slot><div data-default-slot hidden></div><div ref="content-wrapper" class="content-wrapper" set="@hidden: !isVisible"><div class="icon-container" set="@hidden: !withIcon"><lr-icon name="default"></lr-icon><lr-icon name="arrow-down"></lr-icon></div><span class="text">{{text}}</span></div></slot>`;Zt.bindAttributes({"with-icon":null,clickable:null,text:null,fullscreen:null,disabled:null});var Fa="src-type-",qs=class qs extends S{constructor(){super();u(this,"couldBeCtxOwner",!0);u(this,"type");u(this,"_registeredTypes",{});this.init$={...this.init$,iconName:"default","src-type":""}}initTypes(){this.registerType({type:S.sourceTypes.LOCAL,activate:()=>(this.openSystemDialog(),!1)}),this.registerType({type:S.sourceTypes.URL,activity:_.activities.URL,textKey:"from-url"}),this.registerType({type:S.sourceTypes.CAMERA,activity:_.activities.CAMERA,activate:()=>{let t="capture"in document.createElement("input");return t&&this.openSystemDialog({captureCamera:!0}),!t}}),this.registerType({type:"draw",activity:_.activities.DRAW,icon:"edit-draw"});for(let t of Object.values(S.extSrcList))this.registerType({type:t,activity:_.activities.EXTERNAL,activityParams:{externalSourceType:t}})}initCallback(){super.initCallback(),this.initTypes(),this.setAttribute("role","button"),this.defineAccessor("type",t=>{t&&this.applyType(t)})}registerType(t){this._registeredTypes[t.type]=t}getType(t){return this._registeredTypes[t]}activate(){if(!this.type)return;let t=this._registeredTypes[this.type],{activity:e,activate:s,activityParams:n={}}=t;(s?s():!!e)&&this.set$({"*currentActivityParams":n,"*currentActivity":e})}applyType(t){let e=this._registeredTypes[t];if(!e){console.warn("Unsupported source type: "+t);return}let{textKey:s=t,icon:n=t}=e;this.$["src-type"]=`${Fa}${s}`,this.$.iconName=n,this.onclick=()=>{this.activate()}}};l(qs,"SourceBtn");var Qt=qs;Qt.template=`<lr-icon set="@name: iconName"></lr-icon><div class="txt" l10n="src-type"></div>`;Qt.bindAttributes({type:null});var Ks=class Ks extends y{initCallback(){super.initCallback(),this.subConfigValue("sourceList",i=>{let t=R(i),e="";t.forEach(s=>{e+=`<lr-source-btn type="${s}"></lr-source-btn>`}),this.cfg.sourceListWrap?this.innerHTML=e:this.outerHTML=e})}};l(Ks,"SourceList");var Ui=Ks;var Mi=l(()=>{let r=[];return{stack:r,promiseReadJpegChunks:l(t=>new Promise((e,s)=>{let n=2,o=l((h,d)=>{let p=new FileReader;p.addEventListener("load",()=>{d(new DataView(p.result))}),p.addEventListener("error",f=>{s(`Reader error: ${f}`)}),p.readAsArrayBuffer(h)},"readToView"),a=l(()=>o(t.slice(n,n+128),h=>{let d,p,f;for(d=p=0,f=h.byteLength;f>=0?p<f:p>f;d=f>=0?++p:--p)if(h.getUint8(d)===255){n+=d;break}c()}),"readNext"),c=l(()=>{let h=n;return o(t.slice(n,n+=4),d=>{if(d.byteLength!==4||d.getUint8(0)!==255){s("Corrupted");return}let p=d.getUint8(1);if(p===218){e(!0);return}let f=d.getUint16(2)-2;return o(t.slice(n,n+=f),g=>{if(g.byteLength!==f){s("Corrupted");return}r.push({startPos:h,length:f,marker:p,view:g}),a()})})},"readNextChunk");FileReader&&DataView||s("Not Support"),o(t.slice(0,2),h=>{h.getUint16(0)!==65496&&s("Not jpeg"),a()})}),"promiseReadJpegChunks")}},"readJpegChunks"),Ba=l(async r=>{let i=[],{promiseReadJpegChunks:t,stack:e}=Mi();return await t(r),e.forEach(({marker:s,view:n})=>{s===226&&n.getUint32(0)===1229144927&&n.getUint32(4)===1347571526&&n.getUint32(8)===1229735168&&i.push(n)}),i},"getIccProfile"),so=l(async(r,i,t)=>{{let e=[],s=[],{promiseReadJpegChunks:n,stack:o}=Mi();await n(r),o.forEach(h=>{if(h.marker===i)return e.push(h.startPos),s.push(h.length)});let a=[r.slice(0,2)];for(let h of t){let d=new DataView(new ArrayBuffer(4));d.setUint16(0,65280+i),d.setUint16(2,h.byteLength+2),a.push(d.buffer),a.push(h)}let c=2;for(let h=0;h<e.length;h++)e[h]>c&&a.push(r.slice(c,e[h])),c=e[h]+s[h]+4;return a.push(r.slice(c,r.size)),new Blob(a,{type:r.type})}},"replaceJpegChunk"),za=226,ro=l((r,i)=>so(r,za,i.map(t=>t.buffer)),"replaceIccProfile"),Va=l(async r=>{try{return await ro(r,[])}catch(i){throw new Error(`Failed to strip ICC profile: ${i}`)}},"stripIccProfile"),ja=l((r,i,t)=>new Promise((e,s)=>{let n=l(o=>{if(!o){s("Failed to convert canvas to blob");return}e(o)},"callback");r.toBlob(n,i,t),r.width=r.height=1}),"canvasToBlob"),Le=l(()=>{let r=document.createElement("canvas"),i=r.getContext("2d");return{canvas:r,ctx:i}},"createCanvas"),Ha=l(r=>{let{ctx:t,canvas:e}=Le();e.width=e.height=50,t.drawImage(r,0,0,50,50);let s=t.getImageData(0,0,50,50).data;e.width=e.height=1;for(let n=3;n<s.length;n+=4)if(s[n]<254)return!0;return!1},"hasTransparency"),Ga=l(async r=>{let i=null,{promiseReadJpegChunks:t,stack:e}=Mi();return await t(r),e.forEach(({marker:s,view:n})=>{if(!i&&s===225&&n.byteLength>=14&&n.getUint32(0)===1165519206&&n.getUint16(4)===0){i=n;return}}),i},"getExif"),Wa="data:image/jpg;base64,/9j/4AAQSkZJRgABAQEASABIAAD/4QA6RXhpZgAATU0AKgAAAAgAAwESAAMAAAABAAYAAAEoAAMAAAABAAIAAAITAAMAAAABAAEAAAAAAAD/2wBDAP//////////////////////////////////////////////////////////////////////////////////////wAALCAABAAIBASIA/8QAJgABAAAAAAAAAAAAAAAAAAAAAxABAAAAAAAAAAAAAAAAAAAAAP/aAAgBAQAAPwBH/9k=",Ri,Xa=l(()=>new Promise(r=>{if(Ri!==void 0)r(Ri);else{let i=new Image;i.addEventListener("load",()=>{Ri=i.naturalWidth<i.naturalHeight,i.src="//:0",r(Ri)}),i.src=Wa}}),"isBrowserApplyExifOrientation"),qa=l((r,i)=>{let t,e,s,n;if(!r||r.byteLength<14||r.getUint32(0)!==1165519206||r.getUint16(4)!==0)return;if(r.getUint16(6)===18761)e=!0;else if(r.getUint16(6)===19789)e=!1;else return;if(r.getUint16(8,e)!==42)return;s=8+r.getUint32(10,e);let o=r.getUint16(s-2,e);for(t=0,n=o;n>=0?t<n:t>n;n>=0?++t:--t){if(r.byteLength<s+10)return;r.getUint16(s,e)===274&&i(s+8,e),s+=12}},"findExifOrientation"),Ka=l((r,i)=>{qa(r,(t,e)=>r.setUint16(t,i,e))},"setExifOrientation"),Ya=l(async(r,i,t)=>(t&&Ka(i,1),so(r,225,[i.buffer])),"replaceExif"),Ja=l((r,i)=>new Promise((t,e)=>{i&&(r.src=i),r.complete?t(r):(r.addEventListener("load",()=>{t(r)}),r.addEventListener("error",()=>{e(new Error("Failed to load image. Probably not an image."))}))}),"processImage"),Za=l(r=>Ja(new Image,r),"imageLoader"),Qa=[1,3],tc=[192,193,194,195,197,198,199,201,202,203,205,206,207],io={squareSide:[Math.floor(Math.sqrt(5*1e3*1e3)),4096,8192,11180,10836,11402,14188,16384],dimension:[4096,8192,16384,32767,65535]},ec=l(async r=>{let i=!1,{promiseReadJpegChunks:t,stack:e}=Mi();return await t(r).then(()=>(e.forEach(({marker:s,view:n})=>{if(!i&&tc.indexOf(s)>=0){let o=n.getUint8(5);Qa.indexOf(o)<0&&(i=!0)}}),i)).catch(()=>i)},"shouldSkipShrink"),no=l((r,i)=>{let t={};return(...e)=>{let s=i(e,t);return s in t?t[s]:t[s]=r(...e)}},"memoize"),oo=l((r,i)=>{let[t]=r,e=Object.keys(i).map(s=>parseInt(s,10)).sort((s,n)=>s-n);for(let s=0;s<e.length;s++){let n=e[s],o=!!i[n];if(n>t&&o||n<t&&!o)return n}return t},"memoKeySerializer"),Et={R:55,G:110,B:165,A:255},ic=`rgba(${Et.R}, ${Et.G}, ${Et.B}, ${Et.A/255})`,lo=l((r,i)=>{try{let t=[r-1,i-1,1,1],{canvas:e,ctx:s}=Le();e.width=1,e.height=1;let{canvas:n,ctx:o}=Le();n.width=r,n.height=i,o&&(o.fillStyle=ic,o.fillRect(...t),s.drawImage(n,r-1,i-1,1,1,0,0,1,1));let a=s&&s.getImageData(0,0,1,1).data,c=!1;return a&&(c=a[0]===Et.R&&a[1]===Et.G&&a[2]===Et.B&&a[3]===Et.A),n.width=n.height=1,c}catch{return console.error(`Failed to test for max canvas size of ${r}x${i}.`),!1}},"canvasTest");function ao(r){return(...i)=>new Promise(t=>{setTimeout(()=>{let e=r(...i);t(e)},0)})}l(ao,"wrapAsync");var sc=ao(no(lo,oo)),rc=ao(no(lo,oo)),co=l(async(r,i)=>{let t=io.squareSide.find(o=>o*o>=r*i),e=io.dimension.find(o=>o>=r&&o>=i);if(!t||!e)throw new Error("Not supported");let[s,n]=await Promise.all([sc(t,t),rc(e,1)]);if(s&&n)return!0;throw new Error("Not supported")},"testCanvasSize"),ho=l(async(r,i,t)=>{try{let{ctx:e,canvas:s}=Le();return s.width=i,s.height=t,e.imageSmoothingQuality="high",e.drawImage(r,0,0,i,t),r instanceof HTMLImageElement&&(r.src="//:0"),r instanceof HTMLCanvasElement&&(r.width=r.height=1),s}catch(e){throw new Error("Canvas resize error",{cause:e})}},"canvasResize"),nc=l(({img:r,targetW:i,targetH:t})=>ho(r,i,t),"native"),oc=l(function({sourceW:r,targetW:i,targetH:t,step:e}){let s=[],n=i,o=t;do s.push([n,o]),n=Math.round(n/e),o=Math.round(o/e);while(n<r*e);return s.reverse()},"calcShrinkSteps"),lc=l(({img:r,sourceW:i,targetW:t,targetH:e,step:s})=>oc({sourceW:i,targetW:t,targetH:e,step:s}).reduce((o,[a,c])=>o.then(h=>co(a,c).then(()=>ho(h,a,c)).catch(()=>h)),Promise.resolve(r)),"fallback"),ac=l(()=>/iPad|iPhone|iPod/.test(navigator.platform)?!0:navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&/MacIntel/.test(navigator.platform),"isIOS"),cc=navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&/MacIntel/.test(navigator.platform),Ys=.71,hc=l((r,i)=>{if(r.width*Ys*r.height*Ys<i.size)throw new Error("Not required");let t=r.width,e=r.height,s=t/e,n=Math.floor(Math.sqrt(i.size*s)),o=Math.floor(i.size/Math.sqrt(i.size*s));return co(n,o).then(()=>{let{ctx:a}=Le();return"imageSmoothingQuality"in a&&!ac()&&!cc?nc({img:r,targetW:n,targetH:o}):lc({img:r,sourceW:t,targetW:n,targetH:o,step:Ys})}).catch(()=>Promise.reject("Not supported"))},"shrinkImage"),uo=l(async(r,i)=>{try{if(await ec(r))throw new Error("Should skipped");let e=await Promise.allSettled([Ga(r),Xa(),Ba(r)]),n=!e.some(b=>b.status==="rejected"),[o,a,c]=e,h=await Va(r).catch(()=>r),d=await Za(URL.createObjectURL(h));URL.revokeObjectURL(d.src);let p=await hc(d,i),f="image/jpeg",g=(i==null?void 0:i.quality)||.8;!n&&Ha(p)&&(f="image/png",g=void 0);let m=await ja(p,f,g);if(n&&o.status==="fulfilled"&&o.value){let b=o.value,v=a.status==="fulfilled"?a.value:!1;m=await Ya(m,b,v)}return n&&c.status==="fulfilled"&&c.value.length>0&&(m=await ro(m,c.value)),m}catch(t){let e;throw t instanceof Error&&(e=t.message),typeof t=="string"&&(e=t),new Error(`Failed to shrink image. ${e?`Message: "${e}".`:""}`,{cause:t})}},"shrinkFile");function po(r){let i=new Blob([r],{type:"image/svg+xml"});return URL.createObjectURL(i)}l(po,"createSvgBlobUrl");function fo(r="#fff",i="rgba(0, 0, 0, .1)"){return po(`<svg height="20" width="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><rect x="0" y="0" width="20" height="20" fill="${r}" /><rect x="0" y="0" width="10" height="10" fill="${i}" /><rect x="10" y="10" width="10" height="10" fill="${i}" /></svg>`)}l(fo,"checkerboardCssBg");function Js(r="hsl(209, 21%, 65%)",i=32,t=32){return po(`<svg width="${i}" height="${t}" viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" fill="${r}" d="M9.68848 8.70068C9.68848 8.42454 9.91233 8.20068 10.1885 8.20068H15.0885C15.2211 8.20068 15.3483 8.25336 15.442 8.34713L20.342 13.2471C20.4358 13.3409 20.4885 13.4681 20.4885 13.6007V21.3007C20.4885 21.5768 20.2646 21.8007 19.9885 21.8007H10.1885C9.91233 21.8007 9.68848 21.5768 9.68848 21.3007V8.70068ZM10.6885 9.20068V20.8007H19.4885V14.1007L15.0885 14.1007C14.8123 14.1007 14.5885 13.8768 14.5885 13.6007L14.5885 9.20068H10.6885ZM15.5885 9.90779L18.7814 13.1007L15.5885 13.1007L15.5885 9.90779Z"/></svg>`)}l(Js,"fileCssBg");function mo(r,i=40){if(r.type==="image/svg+xml")return URL.createObjectURL(r);let t=document.createElement("canvas"),e=t.getContext("2d"),s=new Image,n=new Promise((o,a)=>{s.onload=()=>{let c=s.height/s.width;c>1?(t.width=i,t.height=i*c):(t.height=i,t.width=i/c),e.fillStyle="rgb(240, 240, 240)",e.fillRect(0,0,t.width,t.height),e.drawImage(s,0,0,t.width,t.height),t.toBlob(h=>{if(!h){a();return}let d=URL.createObjectURL(h);o(d)})},s.onerror=c=>{a(c)}});return s.src=URL.createObjectURL(r),n}l(mo,"generateThumb");var uc=/^([0-9]+)x([0-9]+)(?:\s+(\d{1,2}|100)%)?$/i,go=l(r=>{let i=uc.exec(r==null?void 0:r.toLocaleLowerCase())||[];if(!i.length)return!1;let t=i[1]*i[2],e=16384*16384;return t>e?(console.warn(`Shrinked size can not be larger than ${Math.floor(e/1e3/1e3)}MP. You have set ${i[1]}x${i[2]} (${Math.ceil(t/1e3/100)/10}MP).`),!1):{quality:i[3]?i[3]/100:void 0,size:t}},"parseShrink");var J=Object.freeze({FINISHED:Symbol(0),FAILED:Symbol(1),UPLOADING:Symbol(2),IDLE:Symbol(3)}),te=class te extends S{constructor(){super();u(this,"couldBeCtxOwner",!0);u(this,"pauseRender",!0);u(this,"_entrySubs",new Set);u(this,"_entry",null);u(this,"_isIntersecting",!1);u(this,"_debouncedGenerateThumb",k(this._generateThumbnail.bind(this),100));u(this,"_debouncedCalculateState",k(this._calculateState.bind(this),100));u(this,"_renderedOnce",!1);this.init$={...this.init$,uid:"",itemName:"",errorText:"",thumbUrl:"",progressValue:0,progressVisible:!1,badgeIcon:"",isFinished:!1,isFailed:!1,isUploading:!1,isFocused:!1,isEditable:!1,state:J.IDLE,onEdit:()=>{this.set$({"*focusedEntry":this._entry}),this.hasBlockInCtx(t=>t.activityType===_.activities.DETAILS)?this.$["*currentActivity"]=_.activities.DETAILS:this.$["*currentActivity"]=_.activities.CLOUD_IMG_EDIT},onRemove:()=>{this.uploadCollection.remove(this.$.uid)},onUpload:()=>{this.upload()}}}_reset(){for(let t of this._entrySubs)t.remove();this._debouncedGenerateThumb.cancel(),this._debouncedCalculateState.cancel(),this._entrySubs=new Set,this._entry=null}_observerCallback(t){let[e]=t;this._isIntersecting=e.isIntersecting,e.isIntersecting&&!this._renderedOnce&&(this.render(),this._renderedOnce=!0),e.intersectionRatio===0?this._debouncedGenerateThumb.cancel():this._debouncedGenerateThumb()}_calculateState(){if(!this._entry)return;let t=this._entry,e=J.IDLE;t.getValue("errors").length>0?e=J.FAILED:t.getValue("isUploading")?e=J.UPLOADING:t.getValue("fileInfo")&&(e=J.FINISHED),this.$.state=e}async _generateThumbnail(){var e;if(!this._entry)return;let t=this._entry;if(t.getValue("fileInfo")&&t.getValue("isImage")){let s=this.cfg.thumbSize,n=this.proxyUrl(L(Ct(this.cfg.cdnCname,this._entry.getValue("uuid")),F(t.getValue("cdnUrlModifiers"),`scale_crop/${s}x${s}/center`))),o=t.getValue("thumbUrl");o!==n&&(t.setValue("thumbUrl",n),o!=null&&o.startsWith("blob:")&&URL.revokeObjectURL(o));return}if(!t.getValue("thumbUrl"))if((e=t.getValue("file"))!=null&&e.type.includes("image"))try{let s=await mo(t.getValue("file"),this.cfg.thumbSize);t.setValue("thumbUrl",s)}catch{let n=window.getComputedStyle(this).getPropertyValue("--clr-generic-file-icon");t.setValue("thumbUrl",Js(n))}else{let s=window.getComputedStyle(this).getPropertyValue("--clr-generic-file-icon");t.setValue("thumbUrl",Js(s))}}_subEntry(t,e){let s=this._entry.subscribe(t,n=>{this.isConnected&&e(n)});this._entrySubs.add(s)}_handleEntryId(t){var s;this._reset();let e=(s=this.uploadCollection)==null?void 0:s.read(t);this._entry=e,e&&(this._subEntry("uploadProgress",n=>{this.$.progressValue=n}),this._subEntry("fileName",n=>{this.$.itemName=n||e.getValue("externalUrl")||this.l10n("file-no-name"),this._debouncedCalculateState()}),this._subEntry("externalUrl",n=>{this.$.itemName=e.getValue("fileName")||n||this.l10n("file-no-name")}),this._subEntry("fileInfo",n=>{this._debouncedCalculateState(),n&&this._isIntersecting&&this._debouncedGenerateThumb()}),this._subEntry("cdnUrlModifiers",()=>{this._isIntersecting&&this._debouncedGenerateThumb()}),this._subEntry("thumbUrl",n=>{this.$.thumbUrl=n?`url(${n})`:""}),this._subEntry("errors",()=>this._debouncedCalculateState()),this._subEntry("isUploading",()=>this._debouncedCalculateState()),this._subEntry("fileSize",()=>this._debouncedCalculateState()),this._subEntry("mimeType",()=>this._debouncedCalculateState()),this._subEntry("isImage",()=>this._debouncedCalculateState()),this._isIntersecting&&this._debouncedGenerateThumb())}initCallback(){super.initCallback(),this.sub("uid",t=>{this._handleEntryId(t)}),this.sub("state",t=>{this._handleState(t)}),this.subConfigValue("useCloudImageEditor",()=>this._debouncedCalculateState()),this.onclick=()=>{te.activeInstances.forEach(t=>{t===this?t.setAttribute("focused",""):t.removeAttribute("focused")})},this.sub("*uploadTrigger",t=>{t.has(this._entry.uid)&&setTimeout(()=>this.isConnected&&this.upload())}),te.activeInstances.add(this)}_handleState(t){var e,s,n,o;t===J.FAILED?this.$.badgeIcon="badge-error":t===J.FINISHED&&(this.$.badgeIcon="badge-success"),t===J.UPLOADING?this.$.isFocused=!1:this.$.progressValue=0,this.set$({isFailed:t===J.FAILED,isUploading:t===J.UPLOADING,isFinished:t===J.FINISHED,progressVisible:t===J.UPLOADING,isEditable:this.cfg.useCloudImageEditor&&((e=this._entry)==null?void 0:e.getValue("isImage"))&&((s=this._entry)==null?void 0:s.getValue("cdnUrl")),errorText:(o=(n=this._entry.getValue("errors"))==null?void 0:n[0])==null?void 0:o.message})}destroyCallback(){super.destroyCallback(),te.activeInstances.delete(this),this._reset()}connectedCallback(){super.connectedCallback(),this._observer=new window.IntersectionObserver(this._observerCallback.bind(this),{root:this.parentElement,rootMargin:"50% 0px 50% 0px",threshold:[0,1]}),this._observer.observe(this)}disconnectedCallback(){var t;super.disconnectedCallback(),this._debouncedGenerateThumb.cancel(),(t=this._observer)==null||t.disconnect()}_settingsOfShrink(){return go(this.cfg.imageShrink)}_processShrink(t){return uo(t,this._settingsOfShrink())}async upload(){var s,n,o,a,c;let t=this._entry;if(!this.uploadCollection.read(t.uid)||t.getValue("fileInfo")||t.getValue("isUploading")||t.getValue("errors").length>0)return;let e=this.cfg.multiple?this.cfg.multipleMax:1;if(!(e&&this.uploadCollection.size>e)){this._debouncedCalculateState(),t.setValue("isUploading",!0),t.setValue("errors",[]);try{let h=new AbortController;t.setValue("abortController",h);let d=l(async()=>{let f=t.getValue("file");f&&this.cfg.imageShrink&&(f=await this._processShrink(f).catch(()=>f));let g=f||t.getValue("externalUrl")||t.getValue("uuid"),b={...this.getUploadClientOptions(),fileName:t.getValue("fileName"),source:t.getValue("source"),onProgress:v=>{if(v.isComputable){let x=v.value*100;t.setValue("uploadProgress",x)}},signal:h.signal,metadata:await this.getMetadataFor(t.uid)};return this.debugPrint("upload options",g,b),ps(g,b)},"uploadTask"),p=await this.$["*uploadQueue"].add(d);t.setMultipleValues({fileInfo:p,isUploading:!1,fileName:p.originalFilename,fileSize:p.size,isImage:p.isImage,mimeType:(o=(n=(s=p.contentInfo)==null?void 0:s.mime)==null?void 0:n.mime)!=null?o:p.mimeType,uuid:p.uuid,cdnUrl:(a=t.getValue("cdnUrl"))!=null?a:p.cdnUrl,cdnUrlModifiers:(c=t.getValue("cdnUrlModifiers"))!=null?c:"",uploadProgress:100}),t===this._entry&&this._debouncedCalculateState()}catch(h){h instanceof _t&&h.isCancel?t.setMultipleValues({isUploading:!1,uploadProgress:0}):t.setMultipleValues({isUploading:!1,uploadProgress:0,uploadError:h}),t===this._entry&&this._debouncedCalculateState()}}}};l(te,"FileItem");var ee=te;ee.template=`<div class="inner" set="@finished: isFinished; @uploading: isUploading; @failed: isFailed; @focused: isFocused"><div class="thumb" set="style.backgroundImage: thumbUrl"><div class="badge"><lr-icon set="@name: badgeIcon"></lr-icon></div></div><div class="file-name-wrapper"><span class="file-name" set="@title: itemName">{{itemName}}</span><span class="file-error" set="@hidden: !errorText">{{errorText}}</span></div><div class="file-actions"><button type="button" class="edit-btn mini-btn" set="onclick: onEdit; @hidden: !isEditable"><lr-icon name="edit-file"></lr-icon></button><button type="button" class="remove-btn mini-btn" set="onclick: onRemove;"><lr-icon name="remove-file"></lr-icon></button><button type="button" class="upload-btn mini-btn" set="onclick: onUpload;"><lr-icon name="upload"></lr-icon></button></div><lr-progress-bar class="progress-bar" set="value: progressValue; visible: progressVisible;"></lr-progress-bar></div>`;ee.activeInstances=new Set;var Di=class Di extends y{constructor(){super();u(this,"_handleBackdropClick",l(()=>{this._closeDialog()},"_handleBackdropClick"));u(this,"_closeDialog",l(()=>{this.setOrAddState("*modalActive",!1)},"_closeDialog"));u(this,"_handleDialogClose",l(()=>{this._closeDialog()},"_handleDialogClose"));u(this,"_handleDialogMouseDown",l(t=>{this._mouseDownTarget=t.target},"_handleDialogMouseDown"));u(this,"_handleDialogMouseUp",l(t=>{t.target===this.ref.dialog&&t.target===this._mouseDownTarget&&this._closeDialog()},"_handleDialogMouseUp"));this.init$={...this.init$,"*modalActive":!1,isOpen:!1,closeClicked:this._handleDialogClose}}show(){this.ref.dialog.showModal?this.ref.dialog.showModal():this.ref.dialog.setAttribute("open","")}hide(){this.ref.dialog.close?this.ref.dialog.close():this.ref.dialog.removeAttribute("open")}initCallback(){if(super.initCallback(),typeof HTMLDialogElement=="function")this.ref.dialog.addEventListener("close",this._handleDialogClose),this.ref.dialog.addEventListener("mousedown",this._handleDialogMouseDown),this.ref.dialog.addEventListener("mouseup",this._handleDialogMouseUp);else{this.setAttribute("dialog-fallback","");let t=document.createElement("div");t.className="backdrop",this.appendChild(t),t.addEventListener("click",this._handleBackdropClick)}this.sub("*modalActive",t=>{this.$.isOpen!==t&&(this.$.isOpen=t),t&&this.cfg.modalScrollLock?document.body.style.overflow="hidden":document.body.style.overflow=""}),this.subConfigValue("modalBackdropStrokes",t=>{t?this.setAttribute("strokes",""):this.removeAttribute("strokes")}),this.sub("isOpen",t=>{t?this.show():this.hide()})}destroyCallback(){super.destroyCallback(),document.body.style.overflow="",this._mouseDownTarget=void 0,this.ref.dialog.removeEventListener("close",this._handleDialogClose),this.ref.dialog.removeEventListener("mousedown",this._handleDialogMouseDown),this.ref.dialog.removeEventListener("mouseup",this._handleDialogMouseUp)}};l(Di,"Modal"),u(Di,"StateConsumerScope","modal");var Pe=Di;Pe.template=`<dialog ref="dialog"><slot></slot></dialog>`;var Ni=l((r,i)=>{let t,e,s,n=l((...o)=>{t?(clearTimeout(e),e=setTimeout(()=>{Date.now()-s>=i&&(r(...o),s=Date.now())},Math.max(i-(Date.now()-s),0))):(r(...o),s=Date.now(),t=!0)},"throttled");return Object.defineProperty(n,"cancel",{configurable:!1,writable:!1,enumerable:!1,value:()=>{clearTimeout(e)}}),n},"throttle");var Zs=class Zs extends S{constructor(){super();u(this,"couldBeCtxOwner",!0);u(this,"historyTracked",!0);u(this,"activityType",_.activities.UPLOAD_LIST);u(this,"_throttledHandleCollectionUpdate",Ni(()=>{this.isConnected&&(this._updateUploadsState(),!this.couldOpenActivity&&this.$["*currentActivity"]===this.activityType&&this.historyBack())},300));this.init$={...this.init$,doneBtnVisible:!1,doneBtnEnabled:!1,uploadBtnVisible:!1,addMoreBtnVisible:!1,addMoreBtnEnabled:!1,headerText:"",commonErrorMessage:"",hasFiles:!1,onAdd:()=>{this.initFlow(!0)},onUpload:()=>{this.emit(I.UPLOAD_CLICK),this.uploadAll(),this._throttledHandleCollectionUpdate()},onDone:()=>{this.emit(I.DONE_CLICK,this.getOutputCollectionState()),this.doneFlow()},onCancel:()=>{this.uploadCollection.clearAll()}}}_updateUploadsState(){let t=this.getOutputCollectionState(),e={total:t.totalCount,succeed:t.successCount,uploading:t.uploadingCount,failed:t.failedCount},s=!t.errors.some(f=>f.type==="TOO_MANY_FILES"||f.type==="TOO_FEW_FILES"),n=t.errors.some(f=>f.type==="TOO_MANY_FILES"),o=t.totalCount===(this.cfg.multiple?this.cfg.multipleMax:1),a=e.failed===0,c=!1,h=!1,d=!1;e.total-e.succeed-e.uploading-e.failed>0&&s?c=!0:(h=!0,d=e.total===e.succeed&&s&&a),this.set$({doneBtnVisible:h,doneBtnEnabled:d,uploadBtnVisible:c,addMoreBtnEnabled:e.total===0||!n&&!o,addMoreBtnVisible:!o||this.cfg.multiple}),this.bindL10n("headerText",()=>this._getHeaderText(e))}_getHeaderText(t){let e=l(s=>{let n=t[s];return this.l10n(`header-${s}`,{count:n})},"localizedText");return t.uploading>0?e("uploading"):t.failed>0?e("failed"):t.succeed>0?e("succeed"):e("total")}get couldOpenActivity(){return this.cfg.showEmptyList||this.uploadCollection.size>0}initCallback(){super.initCallback(),this.registerActivity(this.activityType),this.subConfigValue("multiple",this._throttledHandleCollectionUpdate),this.subConfigValue("multipleMin",this._throttledHandleCollectionUpdate),this.subConfigValue("multipleMax",this._throttledHandleCollectionUpdate),this.sub("*currentActivity",t=>{!this.couldOpenActivity&&t===this.activityType&&(this.$["*currentActivity"]=this.initActivity)}),this.uploadCollection.observeProperties(this._throttledHandleCollectionUpdate),this.sub("*uploadList",t=>{this._throttledHandleCollectionUpdate(),this.set$({hasFiles:t.length>0}),this.cfg.confirmUpload||this.uploadAll()},!1),this.sub("*collectionErrors",t=>{let e=t.filter(s=>s.type!=="SOME_FILES_HAS_ERRORS")[0];if(!e){this.set$({commonErrorMessage:null});return}this.set$({commonErrorMessage:e.message})})}destroyCallback(){super.destroyCallback(),this.uploadCollection.unobserveProperties(this._throttledHandleCollectionUpdate)}};l(Zs,"UploadList");var Ue=Zs;Ue.template=`<lr-activity-header><span class="header-text">{{headerText}}</span><button type="button" class="mini-btn close-btn" set="onclick: *closeModal"><lr-icon name="close"></lr-icon></button></lr-activity-header><div class="no-files" set="@hidden: hasFiles"><slot name="empty"><span l10n="no-files"></span></slot></div><div class="files" repeat="*uploadList" repeat-item-tag="lr-file-item"></div><div class="common-error" set="@hidden: !commonErrorMessage; textContent: commonErrorMessage;"></div><div class="toolbar"><button type="button" class="cancel-btn secondary-btn" set="onclick: onCancel;" l10n="clear"></button><div class="toolbar-spacer"></div><button type="button" class="add-more-btn secondary-btn" set="onclick: onAdd; @disabled: !addMoreBtnEnabled; @hidden: !addMoreBtnVisible" ><lr-icon name="add"></lr-icon><span l10n="add-more"></span></button><button type="button" class="upload-btn primary-btn" set="@hidden: !uploadBtnVisible; onclick: onUpload;" l10n="upload" ></button><button type="button" class="done-btn primary-btn" set="@hidden: !doneBtnVisible; onclick: onDone; @disabled: !doneBtnEnabled" l10n="done" ></button></div><lr-drop-area ghost></lr-drop-area>`;var Qs=class Qs extends S{constructor(){super(...arguments);u(this,"couldBeCtxOwner",!0);u(this,"activityType",_.activities.URL);u(this,"init$",{...this.init$,importDisabled:!0,onUpload:t=>{t.preventDefault();let e=this.ref.input.value;this.addFileFromUrl(e,{source:W.URL_TAB}),this.$["*currentActivity"]=_.activities.UPLOAD_LIST},onCancel:()=>{this.historyBack()},onInput:t=>{let e=t.target.value;this.set$({importDisabled:!e})}})}initCallback(){super.initCallback(),this.registerActivity(this.activityType,{onActivate:()=>{this.ref.input.value="",this.ref.input.focus()}})}};l(Qs,"UrlSource");var Re=Qs;Re.template=`<lr-activity-header><button type="button" class="mini-btn" set="onclick: *historyBack"><lr-icon name="back"></lr-icon></button><div><lr-icon name="url"></lr-icon><span l10n="caption-from-url"></span></div><button type="button" class="mini-btn close-btn" set="onclick: *closeModal"><lr-icon name="close"></lr-icon></button></lr-activity-header><form class="content"><input placeholder="https://" class="url-input" type="text" ref="input" set="oninput: onInput" /><button type="submit" class="url-upload-btn primary-btn" set="onclick: onUpload; @disabled: importDisabled" l10n="upload-url" ></button></form>`;var tr=l(()=>typeof navigator.permissions!="undefined","canUsePermissionsApi");var er=class er extends S{constructor(){super(...arguments);u(this,"couldBeCtxOwner",!0);u(this,"activityType",_.activities.CAMERA);u(this,"_unsubPermissions",null);u(this,"init$",{...this.init$,video:null,videoTransformCss:null,shotBtnDisabled:!0,videoHidden:!0,messageHidden:!0,requestBtnHidden:tr(),cameraSelectOptions:null,cameraSelectHidden:!0,l10nMessage:"",onCameraSelectChange:t=>{this._selectedCameraId=t.target.value,this._capture()},onCancel:()=>{this.historyBack()},onShot:()=>{this._shot()},onRequestPermissions:()=>{this._capture()}});u(this,"_onActivate",l(()=>{tr()&&this._subscribePermissions(),this._capture()},"_onActivate"));u(this,"_onDeactivate",l(()=>{this._unsubPermissions&&this._unsubPermissions(),this._stopCapture()},"_onDeactivate"));u(this,"_handlePermissionsChange",l(()=>{this._capture()},"_handlePermissionsChange"));u(this,"_setPermissionsState",k(t=>{this.classList.toggle("initialized",t==="granted"),t==="granted"?this.set$({videoHidden:!1,shotBtnDisabled:!1,messageHidden:!0}):t==="prompt"?(this.$.l10nMessage="camera-permissions-prompt",this.set$({videoHidden:!0,shotBtnDisabled:!0,messageHidden:!1}),this._stopCapture()):(this.$.l10nMessage="camera-permissions-denied",this.set$({videoHidden:!0,shotBtnDisabled:!0,messageHidden:!1}),this._stopCapture())},300))}async _subscribePermissions(){try{(await navigator.permissions.query({name:"camera"})).addEventListener("change",this._handlePermissionsChange)}catch(t){console.log("Failed to use permissions API. Fallback to manual request mode.",t),this._capture()}}async _capture(){let t={video:{width:{ideal:1920},height:{ideal:1080},frameRate:{ideal:30}},audio:!1};this._selectedCameraId&&(t.video.deviceId={exact:this._selectedCameraId}),this._canvas=document.createElement("canvas"),this._ctx=this._canvas.getContext("2d");try{this._setPermissionsState("prompt");let e=await navigator.mediaDevices.getUserMedia(t);e.addEventListener("inactive",()=>{this._setPermissionsState("denied")}),this.$.video=e,this._capturing=!0,this._setPermissionsState("granted")}catch(e){this._setPermissionsState("denied"),console.error("Failed to capture camera",e)}}_stopCapture(){var t;this._capturing&&((t=this.$.video)==null||t.getTracks()[0].stop(),this.$.video=null,this._capturing=!1)}_shot(){this._canvas.height=this.ref.video.videoHeight,this._canvas.width=this.ref.video.videoWidth,this._ctx.drawImage(this.ref.video,0,0);let t=Date.now(),e=`camera-${t}.jpeg`,s="image/jpeg";this._canvas.toBlob(n=>{let o=new File([n],e,{lastModified:t,type:s});this.addFileFromObject(o,{source:W.CAMERA}),this.set$({"*currentActivity":_.activities.UPLOAD_LIST})},s)}async initCallback(){var t;super.initCallback(),this.registerActivity(this.activityType,{onActivate:this._onActivate,onDeactivate:this._onDeactivate}),this.subConfigValue("cameraMirror",e=>{this.$.videoTransformCss=e?"scaleX(-1)":null});try{let s=(await navigator.mediaDevices.enumerateDevices()).filter(n=>n.kind==="videoinput").map((n,o)=>({text:n.label.trim()||`${this.l10n("caption-camera")} ${o+1}`,value:n.deviceId}));s.length>1&&(this.$.cameraSelectOptions=s,this.$.cameraSelectHidden=!1),this._selectedCameraId=(t=s[0])==null?void 0:t.value}catch{}}};l(er,"CameraSource");var Me=er;Me.template=`<lr-activity-header><button type="button" class="mini-btn" set="onclick: *historyBack"><lr-icon name="back"></lr-icon></button><div set="@hidden: !cameraSelectHidden"><lr-icon name="camera"></lr-icon><span l10n="caption-camera"></span></div><lr-select class="camera-select" set="$.options: cameraSelectOptions; @hidden: cameraSelectHidden; onchange: onCameraSelectChange" ></lr-select><button type="button" class="mini-btn close-btn" set="onclick: *closeModal"><lr-icon name="close"></lr-icon></button></lr-activity-header><div class="content"><video autoplay playsinline set="srcObject: video; style.transform: videoTransformCss; @hidden: videoHidden" ref="video" ></video><div class="message-box" set="@hidden: messageHidden"><span l10n="l10nMessage"></span><button type="button" set="onclick: onRequestPermissions; @hidden: requestBtnHidden" l10n="camera-permissions-request" ></button></div><button type="button" class="shot-btn" set="onclick: onShot; @disabled: shotBtnDisabled"><lr-icon name="camera"></lr-icon></button></div>`;var ir=class ir extends S{constructor(){super(...arguments);u(this,"requireCtxName",!0)}initCallback(){super.initCallback(),this.$["*eventEmitter"].bindTarget(this)}destroyCallback(){super.destroyCallback(),this.$["*eventEmitter"].unbindTarget(this)}};l(ir,"UploadCtxProviderClass");var Fi=ir;Fi.EventType=I;var bo=Fi;var rr=class rr{constructor(){u(this,"captionL10nStr","confirm-your-action");u(this,"messageL10Str","are-you-sure");u(this,"confirmL10nStr","yes");u(this,"denyL10nStr","no")}confirmAction(){console.log("Confirmed")}denyAction(){this.historyBack()}};l(rr,"UiConfirmation");var sr=rr,nr=class nr extends _{constructor(){super(...arguments);u(this,"activityType",_.activities.CONFIRMATION);u(this,"_defaults",new sr);u(this,"init$",{...this.init$,activityCaption:"",messageTxt:"",confirmBtnTxt:"",denyBtnTxt:"","*confirmation":null,onConfirm:this._defaults.confirmAction,onDeny:this._defaults.denyAction.bind(this)})}initCallback(){super.initCallback(),this.set$({messageTxt:this.l10n(this._defaults.messageL10Str),confirmBtnTxt:this.l10n(this._defaults.confirmL10nStr),denyBtnTxt:this.l10n(this._defaults.denyL10nStr)}),this.sub("*confirmation",t=>{t&&this.set$({"*currentActivity":_.activities.CONFIRMATION,activityCaption:this.l10n(t.captionL10nStr),messageTxt:this.l10n(t.messageL10Str),confirmBtnTxt:this.l10n(t.confirmL10nStr),denyBtnTxt:this.l10n(t.denyL10nStr),onDeny:()=>{t.denyAction()},onConfirm:()=>{t.confirmAction()}})})}};l(nr,"ConfirmationDialog");var De=nr;De.template=`<lr-activity-header><button type="button" class="mini-btn" set="onclick: *historyBack"><lr-icon name="back"></lr-icon></button><span>{{activityCaption}}</span><button type="button" class="mini-btn close-btn" set="onclick: *closeModal"><lr-icon name="close"></lr-icon></button></lr-activity-header><div class="message">{{messageTxt}}</div><div class="toolbar"><button type="button" class="deny-btn secondary-btn" set="onclick: onDeny">{{denyBtnTxt}}</button><button type="button" class="confirm-btn primary-btn" set="onclick: onConfirm">{{confirmBtnTxt}}</button></div>`;var or=class or extends S{constructor(){super(...arguments);u(this,"init$",{...this.init$,visible:!1,value:0,"*commonProgress":0})}initCallback(){super.initCallback(),this._unobserveCollection=this.uploadCollection.observeProperties(()=>{let t=this.uploadCollection.items().some(e=>this.uploadCollection.read(e).getValue("isUploading"));this.$.visible=t}),this.sub("visible",t=>{t?this.setAttribute("active",""):this.removeAttribute("active")}),this.sub("*commonProgress",t=>{this.$.value=t})}destroyCallback(){var t;super.destroyCallback(),(t=this._unobserveCollection)==null||t.call(this)}};l(or,"ProgressBarCommon");var Ne=or;Ne.template='<lr-progress-bar set="visible: visible; value: value"></lr-progress-bar>';var lr=class lr extends y{constructor(){super(...arguments);u(this,"_value",0);u(this,"init$",{...this.init$,width:0,opacity:0})}initCallback(){super.initCallback(),this.defineAccessor("value",t=>{if(t===void 0)return;let e=this._value;if(this._value=t,t===0&&e>0){this.ref.line.addEventListener("transitionend",()=>{this.style.setProperty("--l-width",this._value.toString())});return}this.style.setProperty("--l-width",this._value.toString())}),this.defineAccessor("visible",t=>{this.ref.line.classList.toggle("progress--hidden",!t)})}};l(lr,"ProgressBar");var Fe=lr;Fe.template='<div ref="line" class="progress"></div>';var K="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=";var ar=class ar extends y{constructor(){super();u(this,"init$",{...this.init$,checkerboard:!1,src:K})}initCallback(){super.initCallback(),this.sub("checkerboard",()=>{this.style.backgroundImage=this.hasAttribute("checkerboard")?`url(${fo()})`:"unset"})}destroyCallback(){super.destroyCallback(),URL.revokeObjectURL(this._lastObjectUrl)}setImage(t){this.$.src=t.src}setImageFile(t){let e=URL.createObjectURL(t);this.$.src=e,this._lastObjectUrl=e}setImageUrl(t){this.$.src=t}clear(){URL.revokeObjectURL(this._lastObjectUrl),this.$.src=K}};l(ar,"FilePreview");var ie=ar;ie.template='<lr-img class="img-view" ref="img" set="@src: src; style.aa: src;" />';ie.bindAttributes({checkerboard:"checkerboard"});function _o(...r){return r.reduce((i,t)=>{if(typeof t=="string")return i[t]=!0,i;for(let e of Object.keys(t))i[e]=t[e];return i},{})}l(_o,"normalize");function D(...r){let i=_o(...r);return Object.keys(i).reduce((t,e)=>(i[e]&&t.push(e),t),[]).join(" ")}l(D,"classNames");function yo(r,...i){let t=_o(...i);for(let e of Object.keys(t))r.classList.toggle(e,t[e])}l(yo,"applyClassNames");var vo=l(r=>{if(!r)return G;let i=En(r).filter(t=>G.includes(t));return i.length===0?G:i},"parseTabs");function Co(r){return{"*originalUrl":null,"*faderEl":null,"*cropperEl":null,"*imgEl":null,"*imgContainerEl":null,"*networkProblems":!1,"*imageSize":null,"*editorTransformations":{},"*cropPresetList":[],"*tabList":G,"*tabId":P.CROP,entry:null,extension:null,editorMode:!1,modalCaption:"",isImage:!1,msg:"",src:K,fileType:"",showLoader:!1,uuid:null,cdnUrl:null,cropPreset:"",tabs:zt(G),"presence.networkProblems":!1,"presence.modalCaption":!0,"presence.editorToolbar":!1,"presence.viewerToolbar":!0,"*on.retryNetwork":()=>{let i=r.querySelectorAll("img");for(let t of i){let e=t.src;t.src=K,t.src=e}r.$["*networkProblems"]=!1},"*on.apply":i=>{if(!i)return;let t=r.$["*originalUrl"],e=F(wt(i),"preview"),s=L(t,e),n={originalUrl:t,cdnUrlModifiers:e,cdnUrl:s,transformations:i};r.dispatchEvent(new CustomEvent("apply",{detail:n,bubbles:!0,composed:!0})),r.remove()},"*on.cancel":()=>{r.remove(),r.dispatchEvent(new CustomEvent("cancel",{bubbles:!0,composed:!0}))}}}l(Co,"initState");var wo=`<div class="wrapper wrapper_desktop"><lr-presence-toggle class="network_problems_splash" set="visible: presence.networkProblems;"><div class="network_problems_content"><div class="network_problems_icon"><lr-icon size="20" name="sad"></lr-icon></div><div class="network_problems_text">Network error</div></div><div class="network_problems_footer"><lr-btn-ui theme="primary" text="Retry" set="onclick: *on.retryNetwork"></lr-btn-ui></div></lr-presence-toggle><div class="viewport"><div class="file_type_outer"><div class="file_type">{{fileType}}</div></div><div class="image_container" ref="img-container-el"><img src="${K}" class="image image_visible_from_editor" ref="img-el" /><lr-editor-image-cropper ref="cropper-el"></lr-editor-image-cropper><lr-editor-image-fader ref="fader-el"></lr-editor-image-fader></div><div class="info_pan">{{msg}}</div></div><div class="toolbar"><lr-line-loader-ui set="active: showLoader"></lr-line-loader-ui><div class="toolbar_content toolbar_content__editor"><lr-editor-toolbar></lr-editor-toolbar></div></div></div>`;var Bi=class Bi extends y{constructor(){super();u(this,"ctxOwner",!0);u(this,"_debouncedShowLoader",k(this._showLoader.bind(this),300));this.init$={...this.init$,...Co(this)}}_showLoader(t){this.$.showLoader=t}_waitForSize(){return new Promise((e,s)=>{let n=setTimeout(()=>{s(new Error("[cloud-image-editor] timeout waiting for non-zero container size"))},3e3),o=new ResizeObserver(([a])=>{a.contentRect.width>0&&a.contentRect.height>0&&(e(),clearTimeout(n),o.disconnect())});o.observe(this)})}initCallback(){super.initCallback(),this.$["*faderEl"]=this.ref["fader-el"],this.$["*cropperEl"]=this.ref["cropper-el"],this.$["*imgContainerEl"]=this.ref["img-container-el"],this.initEditor()}async updateImage(){if(this.isConnected){if(await this._waitForSize(),this.$.cdnUrl){let t=pn(this.$.cdnUrl),e=Ct(this.$.cdnUrl,t);if(e===this.$["*originalUrl"])return;this.$["*originalUrl"]=e;let s=fn(this.$.cdnUrl),n=vn(s);this.$["*editorTransformations"]=n}else if(this.$.uuid){let t=Ct(this.cfg.cdnCname,this.$.uuid);if(t===this.$["*originalUrl"])return;this.$["*originalUrl"]=t,this.$["*editorTransformations"]={}}else throw new Error("No UUID nor CDN URL provided");this.$["*tabId"]===P.CROP?this.$["*cropperEl"].deactivate({reset:!0}):this.$["*faderEl"].deactivate();try{let t=L(this.$["*originalUrl"],F("json")),e=await fetch(t).then(o=>o.json()),{width:s,height:n}=e;this.$["*imageSize"]={width:s,height:n},this.$["*tabId"]===P.CROP?this.$["*cropperEl"].activate(this.$["*imageSize"]):this.$["*faderEl"].activate({url:this.$["*originalUrl"]})}catch(t){t&&console.error("Failed to load image info",t)}}}async initEditor(){try{await this._waitForSize()}catch(t){this.isConnected&&console.error(t.message);return}this.ref["img-el"].addEventListener("load",()=>{this._imgLoading=!1,this._debouncedShowLoader(!1),this.$.src!==K&&(this.$["*networkProblems"]=!1)}),this.ref["img-el"].addEventListener("error",()=>{this._imgLoading=!1,this._debouncedShowLoader(!1),this.$["*networkProblems"]=!0}),this.sub("src",t=>{let e=this.ref["img-el"];e.src!==t&&(this._imgLoading=!0,e.src=t||K)}),this.sub("cropPreset",t=>{this.$["*cropPresetList"]=wi(t)}),this.sub("tabs",t=>{this.$["*tabList"]=vo(t)}),this.sub("*tabId",t=>{this.ref["img-el"].className=D("image",{image_hidden_to_cropper:t===P.CROP,image_hidden_effects:t!==P.CROP})}),this.classList.add("editor_ON"),this.sub("*networkProblems",t=>{this.$["presence.networkProblems"]=t,this.$["presence.modalCaption"]=!t}),this.sub("*editorTransformations",t=>{if(Object.keys(t).length===0)return;let e=this.$["*originalUrl"],s=F(wt(t),"preview"),n=L(e,s),o={originalUrl:e,cdnUrlModifiers:s,cdnUrl:n,transformations:t};this.dispatchEvent(new CustomEvent("change",{detail:o,bubbles:!0,composed:!0}))},!1),this.sub("uuid",t=>t&&this.updateImage()),this.sub("cdnUrl",t=>t&&this.updateImage())}};l(Bi,"CloudImageEditorBlock"),u(Bi,"className","cloud-image-editor");var ot=Bi;ot.template=wo;ot.bindAttributes({uuid:"uuid","cdn-url":"cdnUrl","crop-preset":"cropPreset",tabs:"tabs"});var cr=class cr extends y{constructor(){super(),this.init$={...this.init$,dragging:!1},this._handlePointerUp=this._handlePointerUp_.bind(this),this._handlePointerMove=this._handlePointerMove_.bind(this),this._handleSvgPointerMove=this._handleSvgPointerMove_.bind(this)}_shouldThumbBeDisabled(i){let t=this.$["*imageBox"];if(!t)return;if(i===""&&t.height<=w&&t.width<=w)return!0;let e=t.height<=w&&(i.includes("n")||i.includes("s")),s=t.width<=w&&(i.includes("e")||i.includes("w"));return e||s}_createBackdrop(){let i=this.$["*cropBox"];if(!i)return;let{x:t,y:e,width:s,height:n}=i,o=this.ref["svg-el"],a=Y("mask",{id:"backdrop-mask"}),c=Y("rect",{x:0,y:0,width:"100%",height:"100%",fill:"white"}),h=Y("rect",{x:t,y:e,width:s,height:n,fill:"black"});a.appendChild(c),a.appendChild(h);let d=Y("rect",{x:0,y:0,width:"100%",height:"100%",fill:"var(--color-image-background)","fill-opacity":.85,mask:"url(#backdrop-mask)"});o.appendChild(d),o.appendChild(a),this._backdropMask=a,this._backdropMaskInner=h}_resizeBackdrop(){this._backdropMask&&(this._backdropMask.style.display="none",window.requestAnimationFrame(()=>{this._backdropMask&&(this._backdropMask.style.display="block")}))}_updateBackdrop(){let i=this.$["*cropBox"];if(!i)return;let{x:t,y:e,width:s,height:n}=i;this._backdropMaskInner&&Lt(this._backdropMaskInner,{x:t,y:e,width:s,height:n})}_updateFrame(){let i=this.$["*cropBox"];if(!(!i||!this._frameGuides||!this._frameThumbs)){for(let t of Object.values(this._frameThumbs)){let{direction:e,pathNode:s,interactionNode:n,groupNode:o}=t,a=e==="",c=e.length===2,{x:h,y:d,width:p,height:f}=i;if(a){let m={x:h+p/3,y:d+f/3,width:p/3,height:f/3};Lt(n,m)}else{let m=At(Math.min(p,f)/(24*2+34)/2,0,1),{d:b,center:v}=c?Sn(i,e,m):$n(i,e,m),x=Math.max(Ts*At(Math.min(p,f)/Ts/3,0,1),Tn);Lt(n,{x:v[0]-x,y:v[1]-x,width:x*2,height:x*2}),Lt(s,{d:b})}let g=this._shouldThumbBeDisabled(e);o.setAttribute("class",D("thumb",{"thumb--hidden":g,"thumb--visible":!g}))}Lt(this._frameGuides,{x:i.x-1*.5,y:i.y-1*.5,width:i.width+1,height:i.height+1})}}_createThumbs(){let i={};for(let t=0;t<3;t++)for(let e=0;e<3;e++){let s=`${["n","","s"][t]}${["w","","e"][e]}`,n=Y("g");n.classList.add("thumb"),n.setAttribute("with-effects","");let o=Y("rect",{fill:"transparent"}),a=Y("path",{stroke:"currentColor",fill:"none","stroke-width":3});n.appendChild(a),n.appendChild(o),i[s]={direction:s,pathNode:a,interactionNode:o,groupNode:n},o.addEventListener("pointerdown",this._handlePointerDown.bind(this,s))}return i}_createGuides(){let i=Y("svg"),t=Y("rect",{x:0,y:0,width:"100%",height:"100%",fill:"none",stroke:"#000000","stroke-width":1,"stroke-opacity":.5});i.appendChild(t);for(let e=1;e<=2;e++){let s=Y("line",{x1:`${Se*e}%`,y1:"0%",x2:`${Se*e}%`,y2:"100%",stroke:"#000000","stroke-width":1,"stroke-opacity":.3});i.appendChild(s)}for(let e=1;e<=2;e++){let s=Y("line",{x1:"0%",y1:`${Se*e}%`,x2:"100%",y2:`${Se*e}%`,stroke:"#000000","stroke-width":1,"stroke-opacity":.3});i.appendChild(s)}return i.classList.add("guides","guides--semi-hidden"),i}_createFrame(){let i=this.ref["svg-el"],t=document.createDocumentFragment(),e=this._createGuides();t.appendChild(e);let s=this._createThumbs();for(let{groupNode:n}of Object.values(s))t.appendChild(n);i.appendChild(t),this._frameThumbs=s,this._frameGuides=e}_handlePointerDown(i,t){if(!this._frameThumbs)return;let e=this._frameThumbs[i];if(this._shouldThumbBeDisabled(i))return;let s=this.$["*cropBox"],{x:n,y:o}=this.ref["svg-el"].getBoundingClientRect(),a=t.x-n,c=t.y-o;this.$.dragging=!0,this._draggingThumb=e,this._dragStartPoint=[a,c],this._dragStartCrop={...s}}_handlePointerUp_(i){this._updateCursor(),this.$.dragging&&(i.stopPropagation(),i.preventDefault(),this.$.dragging=!1)}_handlePointerMove_(i){if(!this.$.dragging||!this._dragStartPoint||!this._draggingThumb)return;i.stopPropagation(),i.preventDefault();let t=this.ref["svg-el"],{x:e,y:s}=t.getBoundingClientRect(),n=i.x-e,o=i.y-s,a=n-this._dragStartPoint[0],c=o-this._dragStartPoint[1],{direction:h}=this._draggingThumb,d=this._calcCropBox(h,[a,c]);d&&(this.$["*cropBox"]=d)}_calcCropBox(i,t){var h,d;let[e,s]=t,n=this.$["*imageBox"],o=(h=this._dragStartCrop)!=null?h:this.$["*cropBox"],a=(d=this.$["*cropPresetList"])==null?void 0:d[0],c=a?a.width/a.height:void 0;if(i===""?o=On({rect:o,delta:[e,s],imageBox:n}):o=kn({rect:o,delta:[e,s],direction:i,aspectRatio:c,imageBox:n}),!Object.values(o).every(p=>Number.isFinite(p)&&p>=0)){console.error("CropFrame is trying to create invalid rectangle",{payload:o});return}return jt(Gt(o),this.$["*imageBox"])}_handleSvgPointerMove_(i){if(!this._frameThumbs)return;let t=Object.values(this._frameThumbs).find(e=>{if(this._shouldThumbBeDisabled(e.direction))return!1;let n=e.interactionNode.getBoundingClientRect(),o={x:n.x,y:n.y,width:n.width,height:n.height};return Ln(o,[i.x,i.y])});this._hoverThumb=t,this._updateCursor()}_updateCursor(){let i=this._hoverThumb;this.ref["svg-el"].style.cursor=i?In(i.direction):"initial"}_render(){this._updateBackdrop(),this._updateFrame()}toggleThumbs(i){this._frameThumbs&&Object.values(this._frameThumbs).map(({groupNode:t})=>t).forEach(t=>{t.setAttribute("class",D("thumb",{"thumb--hidden":!i,"thumb--visible":i}))})}initCallback(){super.initCallback(),this._createBackdrop(),this._createFrame(),this.sub("*imageBox",()=>{this._resizeBackdrop(),window.requestAnimationFrame(()=>{this._render()})}),this.sub("*cropBox",i=>{i&&(this._guidesHidden=i.height<=w||i.width<=w,window.requestAnimationFrame(()=>{this._render()}))}),this.sub("dragging",i=>{this._frameGuides&&this._frameGuides.setAttribute("class",D({"guides--hidden":this._guidesHidden,"guides--visible":!this._guidesHidden&&i,"guides--semi-hidden":!this._guidesHidden&&!i}))}),this.ref["svg-el"].addEventListener("pointermove",this._handleSvgPointerMove,!0),document.addEventListener("pointermove",this._handlePointerMove,!0),document.addEventListener("pointerup",this._handlePointerUp,!0)}destroyCallback(){super.destroyCallback(),document.removeEventListener("pointermove",this._handlePointerMove),document.removeEventListener("pointerup",this._handlePointerUp)}};l(cr,"CropFrame");var Be=cr;Be.template='<svg class="svg" ref="svg-el" xmlns="http://www.w3.org/2000/svg"></svg>';var hr=class hr extends y{constructor(){super(...arguments);u(this,"init$",{...this.init$,active:!1,title:"",icon:"","on.click":null})}initCallback(){super.initCallback(),this._titleEl=this.ref["title-el"],this._iconEl=this.ref["icon-el"],this.setAttribute("role","button"),this.tabIndex===-1&&(this.tabIndex=0),this.sub("title",t=>{this._titleEl&&(this._titleEl.style.display=t?"block":"none")}),this.sub("active",t=>{this.className=D({active:t,not_active:!t})}),this.sub("on.click",t=>{this.onclick=t})}};l(hr,"EditorButtonControl");var gt=hr;gt.template=`<div class="before"></div><lr-icon size="20" set="@name: icon;"></lr-icon><div class="title" ref="title-el">{{title}}</div>`;function pc(r){let i=r+90;return i=i>=360?0:i,i}l(pc,"nextAngle");function fc(r,i){return r==="rotate"?pc(i):["mirror","flip"].includes(r)?!i:null}l(fc,"nextValue");var ur=class ur extends gt{initCallback(){super.initCallback(),this.defineAccessor("operation",i=>{i&&(this._operation=i,this.$.icon=i)}),this.$["on.click"]=i=>{let t=this.$["*cropperEl"].getValue(this._operation),e=fc(this._operation,t);this.$["*cropperEl"].setValue(this._operation,e)}}};l(ur,"EditorCropButtonControl");var se=ur;var ze={FILTER:"filter",COLOR_OPERATION:"color_operation"},lt="original",dr=class dr extends y{constructor(){super(...arguments);u(this,"init$",{...this.init$,disabled:!1,min:0,max:100,value:0,defaultValue:0,zero:0,"on.input":t=>{this.$["*faderEl"].set(t),this.$.value=t}})}setOperation(t,e){this._controlType=t==="filter"?ze.FILTER:ze.COLOR_OPERATION,this._operation=t,this._iconName=t,this._title=t.toUpperCase(),this._filter=e,this._initializeValues(),this.$["*faderEl"].activate({url:this.$["*originalUrl"],operation:this._operation,value:this._filter===lt?void 0:this.$.value,filter:this._filter===lt?void 0:this._filter,fromViewer:!1})}_initializeValues(){let{range:t,zero:e}=et[this._operation],[s,n]=t;this.$.min=s,this.$.max=n,this.$.zero=e;let o=this.$["*editorTransformations"][this._operation];if(this._controlType===ze.FILTER){let a=n;if(o){let{name:c,amount:h}=o;a=c===this._filter?h:n}this.$.value=a,this.$.defaultValue=a}if(this._controlType===ze.COLOR_OPERATION){let a=typeof o!="undefined"?o:e;this.$.value=a,this.$.defaultValue=a}}apply(){let t;this._controlType===ze.FILTER?this._filter===lt?t=null:t={name:this._filter,amount:this.$.value}:t=this.$.value;let e={...this.$["*editorTransformations"],[this._operation]:t};this.$["*editorTransformations"]=e}cancel(){this.$["*faderEl"].deactivate({hide:!1})}initCallback(){super.initCallback(),this.sub("*originalUrl",t=>{this._originalUrl=t}),this.sub("value",t=>{let e=`${this._filter||this._operation} ${t}`;this.$["*operationTooltip"]=e})}};l(dr,"EditorSlider");var Ve=dr;Ve.template=`<lr-slider-ui ref="slider-el" set="disabled: disabled; min: min; max: max; defaultValue: defaultValue; zero: zero; onInput: on.input;" ></lr-slider-ui>`;function je(r){let i=new Image;return{promise:new Promise((s,n)=>{i.src=r,i.onload=s,i.onerror=n}),image:i,cancel:l(()=>{i.naturalWidth===0&&(i.src=K)},"cancel")}}l(je,"preloadImage");function He(r){let i=[];for(let n of r){let o=je(n);i.push(o)}let t=i.map(n=>n.image);return{promise:Promise.allSettled(i.map(n=>n.promise)),images:t,cancel:l(()=>{i.forEach(n=>{n.cancel()})},"cancel")}}l(He,"batchPreloadImages");var pr=class pr extends gt{constructor(){super(...arguments);u(this,"init$",{...this.init$,active:!1,title:"",icon:"",isOriginal:!1,iconSize:"20","on.click":null})}_previewSrc(){let t=parseInt(window.getComputedStyle(this).getPropertyValue("--l-base-min-width"),10),e=window.devicePixelRatio,s=Math.ceil(e*t),n=e>=2?"lightest":"normal",o=100,a={...this.$["*editorTransformations"]};return a[this._operation]=this._filter!==lt?{name:this._filter,amount:o}:void 0,L(this._originalUrl,F(vi,wt(a),`quality/${n}`,`scale_crop/${s}x${s}/center`))}_observerCallback(t,e){if(t[0].isIntersecting){let n=this.proxyUrl(this._previewSrc()),o=this.ref["preview-el"],{promise:a,cancel:c}=je(n);this._cancelPreload=c,a.catch(h=>{this.$["*networkProblems"]=!0,console.error("Failed to load image",{error:h})}).finally(()=>{o.style.backgroundImage=`url(${n})`,o.setAttribute("loaded",""),e.unobserve(this)})}else this._cancelPreload&&this._cancelPreload()}initCallback(){super.initCallback(),this.$["on.click"]=e=>{this.$.active?this.$.isOriginal||(this.$["*sliderEl"].setOperation(this._operation,this._filter),this.$["*showSlider"]=!0):(this.$["*sliderEl"].setOperation(this._operation,this._filter),this.$["*sliderEl"].apply()),this.$["*currentFilter"]=this._filter},this.defineAccessor("filter",e=>{this._operation="filter",this._filter=e,this.$.isOriginal=e===lt,this.$.icon=this.$.isOriginal?"original":"slider"}),this._observer=new window.IntersectionObserver(this._observerCallback.bind(this),{threshold:[0,1]});let t=this.$["*originalUrl"];this._originalUrl=t,this.$.isOriginal?this.ref["icon-el"].classList.add("original-icon"):this._observer.observe(this),this.sub("*currentFilter",e=>{this.$.active=e&&e===this._filter}),this.sub("isOriginal",e=>{this.$.iconSize=e?40:20}),this.sub("active",e=>{if(this.$.isOriginal)return;let s=this.ref["icon-el"];s.style.opacity=e?"1":"0";let n=this.ref["preview-el"];e?n.style.opacity="0":n.style.backgroundImage&&(n.style.opacity="1")}),this.sub("*networkProblems",e=>{if(!e){let s=this.proxyUrl(this._previewSrc()),n=this.ref["preview-el"];n.style.backgroundImage&&(n.style.backgroundImage="none",n.style.backgroundImage=`url(${s})`)}})}destroyCallback(){var t;super.destroyCallback(),(t=this._observer)==null||t.disconnect(),this._cancelPreload&&this._cancelPreload()}};l(pr,"EditorFilterControl");var Mt=pr;Mt.template=`<div class="before"></div><div class="preview" ref="preview-el"></div><lr-icon size="40" ref="icon-el" set="@name: icon; @size: iconSize;"></lr-icon>`;var fr=class fr extends gt{constructor(){super(...arguments);u(this,"_operation","")}initCallback(){super.initCallback(),this.$["on.click"]=t=>{this.$["*sliderEl"].setOperation(this._operation),this.$["*showSlider"]=!0,this.$["*currentOperation"]=this._operation},this.defineAccessor("operation",t=>{t&&(this._operation=t,this.$.icon=t,this.bindL10n("title",()=>this.l10n(t)))}),this.sub("*editorTransformations",t=>{if(!this._operation)return;let{zero:e}=et[this._operation],s=t[this._operation],n=typeof s!="undefined"?s!==e:!1;this.$.active=n})}};l(fr,"EditorOperationControl");var re=fr;function Ao(r,i){let t={};for(let e of i){let s=r[e];(r.hasOwnProperty(e)||s!==void 0)&&(t[e]=s)}return t}l(Ao,"pick");function ne(r,i,t){let s=window.devicePixelRatio,n=Math.min(Math.ceil(i*s),3e3),o=s>=2?"lightest":"normal";return L(r,F(vi,wt(t),`quality/${o}`,`stretch/off/-/resize/${n}x`))}l(ne,"viewerImageSrc");function mc(r){return r?[({dimensions:t,coords:e})=>[...t,...e].every(s=>Number.isInteger(s)&&Number.isFinite(s)),({dimensions:t,coords:e})=>t.every(s=>s>0)&&e.every(s=>s>=0)].every(t=>t(r)):!0}l(mc,"validateCrop");var mr=class mr extends y{constructor(){super();u(this,"ctxOwner",!0);this.init$={...this.init$,image:null,"*padding":20,"*operations":{rotate:0,mirror:!1,flip:!1},"*imageBox":{x:0,y:0,width:0,height:0},"*cropBox":{x:0,y:0,width:0,height:0}},this._commitDebounced=k(this._commit.bind(this),300),this._handleResizeThrottled=Ni(this._handleResize.bind(this),100),this._imageSize={width:0,height:0}}_handleResize(){!this.isConnected||!this._isActive||(this._initCanvas(),this._syncTransformations(),this._alignImage(),this._alignCrop(),this._draw())}_syncTransformations(){let t=this.$["*editorTransformations"],e=Ao(t,Object.keys(this.$["*operations"])),s={...this.$["*operations"],...e};this.$["*operations"]=s}_initCanvas(){let t=this.ref["canvas-el"],e=t.getContext("2d"),s=this.offsetWidth,n=this.offsetHeight,o=window.devicePixelRatio;t.style.width=`${s}px`,t.style.height=`${n}px`,t.width=s*o,t.height=n*o,e==null||e.scale(o,o),this._canvas=t,this._ctx=e}_alignImage(){if(!this._isActive||!this.$.image)return;let t=this.$.image,e=this.$["*padding"],s=this.$["*operations"],{rotate:n}=s,o={width:this.offsetWidth,height:this.offsetHeight},a=Ht({width:t.naturalWidth,height:t.naturalHeight},n),c;if(a.width>o.width-e*2||a.height>o.height-e*2){let h=a.width/a.height,d=o.width/o.height;if(h>d){let p=o.width-e*2,f=p/h,g=0+e,m=e+(o.height-e*2)/2-f/2;c={x:g,y:m,width:p,height:f}}else{let p=o.height-e*2,f=p*h,g=e+(o.width-e*2)/2-f/2,m=0+e;c={x:g,y:m,width:f,height:p}}}else{let{width:h,height:d}=a,p=e+(o.width-e*2)/2-h/2,f=e+(o.height-e*2)/2-d/2;c={x:p,y:f,width:h,height:d}}this.$["*imageBox"]=Gt(c)}_alignCrop(){var f;let t=this.$["*cropBox"],e=this.$["*imageBox"],s=this.$["*operations"],{rotate:n}=s,o=this.$["*editorTransformations"].crop,{width:a,x:c,y:h}=this.$["*imageBox"];if(o){let{dimensions:[g,m],coords:[b,v]}=o,{width:x}=Ht(this._imageSize,n),C=a/x;t=jt(Gt({x:c+b*C,y:h+v*C,width:g*C,height:m*C}),this.$["*imageBox"])}let d=(f=this.$["*cropPresetList"])==null?void 0:f[0],p=d?d.width/d.height:void 0;if(!Pn(t,e)||p&&!Un(t,p)){let g=e.width/e.height,m=e.width,b=e.height;p&&(g>p?m=Math.min(e.height*p,e.width):b=Math.min(e.width/p,e.height)),t={x:e.x+e.width/2-m/2,y:e.y+e.height/2-b/2,width:m,height:b}}this.$["*cropBox"]=jt(Gt(t),this.$["*imageBox"])}_drawImage(){let t=this._ctx;if(!t)return;let e=this.$.image,s=this.$["*imageBox"],n=this.$["*operations"],{mirror:o,flip:a,rotate:c}=n,h=Ht({width:s.width,height:s.height},c);t.save(),t.translate(s.x+s.width/2,s.y+s.height/2),t.rotate(c*Math.PI*-1/180),t.scale(o?-1:1,a?-1:1),t.drawImage(e,-h.width/2,-h.height/2,h.width,h.height),t.restore()}_draw(){if(!this._isActive||!this.$.image||!this._canvas||!this._ctx)return;let t=this._canvas;this._ctx.clearRect(0,0,t.width,t.height),this._drawImage()}_animateIn({fromViewer:t}){this.$.image&&(this.ref["frame-el"].toggleThumbs(!0),this._transitionToImage(),setTimeout(()=>{this.className=D({active_from_viewer:t,active_from_editor:!t,inactive_to_editor:!1})}))}_getCropDimensions(){let t=this.$["*cropBox"],e=this.$["*imageBox"],s=this.$["*operations"],{rotate:n}=s,{width:o,height:a}=e,{width:c,height:h}=Ht(this._imageSize,n),{width:d,height:p}=t,f=o/c,g=a/h;return[At(Math.round(d/f),1,c),At(Math.round(p/g),1,h)]}_getCropTransformation(){let t=this.$["*cropBox"],e=this.$["*imageBox"],s=this.$["*operations"],{rotate:n}=s,{width:o,height:a,x:c,y:h}=e,{width:d,height:p}=Ht(this._imageSize,n),{x:f,y:g}=t,m=o/d,b=a/p,v=this._getCropDimensions(),x={dimensions:v,coords:[At(Math.round((f-c)/m),0,d-v[0]),At(Math.round((g-h)/b),0,p-v[1])]};if(!mc(x)){console.error("Cropper is trying to create invalid crop object",{payload:x});return}if(!(v[0]===d&&v[1]===p))return x}_commit(){if(!this.isConnected)return;let t=this.$["*operations"],{rotate:e,mirror:s,flip:n}=t,o=this._getCropTransformation(),c={...this.$["*editorTransformations"],crop:o,rotate:e,mirror:s,flip:n};this.$["*editorTransformations"]=c}setValue(t,e){this.$["*operations"]={...this.$["*operations"],[t]:e},this._isActive&&(this._alignImage(),this._alignCrop(),this._draw())}getValue(t){return this.$["*operations"][t]}async activate(t,{fromViewer:e}={}){if(!this._isActive){this._isActive=!0,this._imageSize=t,this.removeEventListener("transitionend",this._reset);try{this.$.image=await this._waitForImage(this.$["*originalUrl"],this.$["*editorTransformations"]),this._syncTransformations(),this._animateIn({fromViewer:e})}catch(s){console.error("Failed to activate cropper",{error:s})}this._observer=new ResizeObserver(([s])=>{s.contentRect.width>0&&s.contentRect.height>0&&this._isActive&&this.$.image&&this._handleResizeThrottled()}),this._observer.observe(this)}}deactivate({reset:t=!1}={}){var e;this._isActive&&(!t&&this._commit(),this._isActive=!1,this._transitionToCrop(),this.className=D({active_from_viewer:!1,active_from_editor:!1,inactive_to_editor:!0}),this.ref["frame-el"].toggleThumbs(!1),this.addEventListener("transitionend",this._reset,{once:!0}),(e=this._observer)==null||e.disconnect())}_transitionToCrop(){let t=this._getCropDimensions(),e=Math.min(this.offsetWidth,t[0])/this.$["*cropBox"].width,s=Math.min(this.offsetHeight,t[1])/this.$["*cropBox"].height,n=Math.min(e,s),o=this.$["*cropBox"].x+this.$["*cropBox"].width/2,a=this.$["*cropBox"].y+this.$["*cropBox"].height/2;this.style.transform=`scale(${n}) translate(${(this.offsetWidth/2-o)/n}px, ${(this.offsetHeight/2-a)/n}px)`,this.style.transformOrigin=`${o}px ${a}px`}_transitionToImage(){let t=this.$["*cropBox"].x+this.$["*cropBox"].width/2,e=this.$["*cropBox"].y+this.$["*cropBox"].height/2;this.style.transform="scale(1)",this.style.transformOrigin=`${t}px ${e}px`}_reset(){this._isActive||(this.$.image=null)}_waitForImage(t,e){let s=this.offsetWidth;e={...e,crop:void 0,rotate:void 0,flip:void 0,mirror:void 0};let n=this.proxyUrl(ne(t,s,e)),{promise:o,cancel:a,image:c}=je(n),h=this._handleImageLoading(n);return c.addEventListener("load",h,{once:!0}),c.addEventListener("error",h,{once:!0}),this._cancelPreload&&this._cancelPreload(),this._cancelPreload=a,o.then(()=>c).catch(d=>(console.error("Failed to load image",{error:d}),this.$["*networkProblems"]=!0,Promise.resolve(c)))}_handleImageLoading(t){let e="crop",s=this.$["*loadingOperations"];return s.get(e)||s.set(e,new Map),s.get(e).get(t)||(s.set(e,s.get(e).set(t,!0)),this.$["*loadingOperations"]=s),()=>{var n;(n=s==null?void 0:s.get(e))!=null&&n.has(t)&&(s.get(e).delete(t),this.$["*loadingOperations"]=s)}}initCallback(){super.initCallback(),this.sub("*imageBox",()=>{this._draw()}),this.sub("*cropBox",()=>{this.$.image&&this._commitDebounced()}),this.sub("*cropPresetList",()=>{this._alignCrop()}),setTimeout(()=>{this.sub("*networkProblems",t=>{t||this._isActive&&this.activate(this._imageSize,{fromViewer:!1})})},0)}destroyCallback(){var t;super.destroyCallback(),(t=this._observer)==null||t.disconnect()}};l(mr,"EditorImageCropper");var Ge=mr;Ge.template=`<canvas class="canvas" ref="canvas-el"></canvas><lr-crop-frame ref="frame-el"></lr-crop-frame>`;function gr(r,i,t){let e=Array(t);t--;for(let s=t;s>=0;s--)e[s]=Math.ceil((s*i+(t-s)*r)/t);return e}l(gr,"linspace");function gc(r){return r.reduce((i,t,e)=>e<r.length-1?[...i,[t,r[e+1]]]:i,[])}l(gc,"splitBySections");function bc(r,i,t){let e=gc(r).find(([s,n])=>s<=i&&i<=n);return r.map(s=>{let n=Math.abs(e[0]-e[1]),o=Math.abs(i-e[0])/n;return e[0]===s?i>t?1:1-o:e[1]===s?i>=t?o:1:0})}l(bc,"calculateOpacities");function _c(r,i){return r.map((t,e)=>t<i?r.length-e:e)}l(_c,"calculateZIndices");function Eo(r,i){let t=et[r].keypointsNumber,{range:e,zero:s}=et[r];return[...new Set([...gr(e[0],s,t+1),...gr(s,e[1],t+1),s,i])].sort((n,o)=>n-o)}l(Eo,"keypointsRange");var br=class br extends y{constructor(){super(),this._isActive=!1,this._hidden=!0,this._addKeypointDebounced=k(this._addKeypoint.bind(this),600),this.classList.add("inactive_to_cropper")}_handleImageLoading(i){let t=this._operation,e=this.$["*loadingOperations"];return e.get(t)||e.set(t,new Map),e.get(t).get(i)||(e.set(t,e.get(t).set(i,!0)),this.$["*loadingOperations"]=e),()=>{var s;(s=e==null?void 0:e.get(t))!=null&&s.has(i)&&(e.get(t).delete(i),this.$["*loadingOperations"]=e)}}_flush(){window.cancelAnimationFrame(this._raf),this._raf=window.requestAnimationFrame(()=>{for(let i of this._keypoints){let{image:t}=i;t&&(t.style.opacity=i.opacity.toString(),t.style.zIndex=i.zIndex.toString())}})}_imageSrc({url:i=this._url,filter:t=this._filter,operation:e,value:s}={}){let n={...this._transformations};e&&(n[e]=t?{name:t,amount:s}:s);let o=this.offsetWidth;return this.proxyUrl(ne(i,o,n))}_constructKeypoint(i,t){return{src:this._imageSrc({operation:i,value:t}),image:null,opacity:0,zIndex:0,value:t}}_isSame(i,t){return this._operation===i&&this._filter===t}_addKeypoint(i,t,e){let s=l(()=>!this._isSame(i,t)||this._value!==e||!!this._keypoints.find(c=>c.value===e),"shouldSkip");if(s())return;let n=this._constructKeypoint(i,e),o=new Image;o.src=n.src;let a=this._handleImageLoading(n.src);o.addEventListener("load",a,{once:!0}),o.addEventListener("error",a,{once:!0}),n.image=o,o.classList.add("fader-image"),o.addEventListener("load",()=>{if(s())return;let c=this._keypoints,h=c.findIndex(p=>p.value>e),d=h<c.length?c[h].image:null;!this._container||d&&!this._container.contains(d)||(c.splice(h,0,n),this._container.insertBefore(o,d),this._update(i,e))},{once:!0}),o.addEventListener("error",()=>{this.$["*networkProblems"]=!0},{once:!0})}set(i){i=typeof i=="string"?parseInt(i,10):i,this._update(this._operation,i),this._addKeypointDebounced(this._operation,this._filter,i)}_update(i,t){this._operation=i,this._value=t;let{zero:e}=et[i],s=this._keypoints.map(a=>a.value),n=bc(s,t,e),o=_c(s,e);for(let[a,c]of Object.entries(this._keypoints))c.opacity=n[a],c.zIndex=o[a];this._flush()}_createPreviewImage(){let i=new Image;return i.classList.add("fader-image","fader-image--preview"),i.style.opacity="0",i}async _initNodes(){let i=document.createDocumentFragment();this._previewImage=this._previewImage||this._createPreviewImage(),!this.contains(this._previewImage)&&i.appendChild(this._previewImage);let t=document.createElement("div");i.appendChild(t);let e=this._keypoints.map(h=>h.src),{images:s,promise:n,cancel:o}=He(e);s.forEach(h=>{let d=this._handleImageLoading(h.src);h.addEventListener("load",d),h.addEventListener("error",d)}),this._cancelLastImages=()=>{o(),this._cancelLastImages=void 0};let a=this._operation,c=this._filter;await n,this._isActive&&this._isSame(a,c)&&(this._container&&this._container.remove(),this._container=t,this._keypoints.forEach((h,d)=>{let p=s[d];p.classList.add("fader-image"),h.image=p,this._container.appendChild(p)}),this.appendChild(i),this._flush())}setTransformations(i){if(this._transformations=i,this._previewImage){let t=this._imageSrc(),e=this._handleImageLoading(t);this._previewImage.src=t,this._previewImage.addEventListener("load",e,{once:!0}),this._previewImage.addEventListener("error",e,{once:!0}),this._previewImage.style.opacity="1",this._previewImage.addEventListener("error",()=>{this.$["*networkProblems"]=!0},{once:!0})}}preload({url:i,filter:t,operation:e,value:s}){this._cancelBatchPreload&&this._cancelBatchPreload();let o=Eo(e,s).map(c=>this._imageSrc({url:i,filter:t,operation:e,value:c})),{cancel:a}=He(o);this._cancelBatchPreload=a}_setOriginalSrc(i){let t=this._previewImage||this._createPreviewImage();if(!this.contains(t)&&this.appendChild(t),this._previewImage=t,t.src===i){t.style.opacity="1",t.style.transform="scale(1)",this.className=D({active_from_viewer:this._fromViewer,active_from_cropper:!this._fromViewer,inactive_to_cropper:!1});return}t.style.opacity="0";let e=this._handleImageLoading(i);t.addEventListener("error",e,{once:!0}),t.src=i,t.addEventListener("load",()=>{e(),t&&(t.style.opacity="1",t.style.transform="scale(1)",this.className=D({active_from_viewer:this._fromViewer,active_from_cropper:!this._fromViewer,inactive_to_cropper:!1}))},{once:!0}),t.addEventListener("error",()=>{this.$["*networkProblems"]=!0},{once:!0})}activate({url:i,operation:t,value:e,filter:s,fromViewer:n}){if(this._isActive=!0,this._hidden=!1,this._url=i,this._operation=t||"initial",this._value=e,this._filter=s,this._fromViewer=n,typeof e!="number"&&!s){let a=this._imageSrc({operation:t,value:e});this._setOriginalSrc(a),this._container&&this._container.remove();return}this._keypoints=Eo(t,e).map(a=>this._constructKeypoint(t,a)),this._update(t,e),this._initNodes()}deactivate({hide:i=!0}={}){this._isActive=!1,this._cancelLastImages&&this._cancelLastImages(),this._cancelBatchPreload&&this._cancelBatchPreload(),i&&!this._hidden?(this._hidden=!0,this._previewImage&&(this._previewImage.style.transform="scale(1)"),this.className=D({active_from_viewer:!1,active_from_cropper:!1,inactive_to_cropper:!0}),this.addEventListener("transitionend",()=>{this._container&&this._container.remove()},{once:!0})):this._container&&this._container.remove()}};l(br,"EditorImageFader");var zi=br;var yc=1,_r=class _r extends y{initCallback(){super.initCallback(),this.addEventListener("wheel",i=>{i.preventDefault();let{deltaY:t,deltaX:e}=i;Math.abs(e)>yc?this.scrollLeft+=e:this.scrollLeft+=t})}};l(_r,"EditorScroller");var We=_r;We.template=" <slot></slot> ";function vc(r){return`<lr-presence-toggle class="tab-toggle" set="visible: presence.tabToggle.${r}; styles: presence.tabToggleStyles;"><lr-btn-ui theme="boring" ref="tab-toggle-${r}" data-id="${r}" icon="${r}" tabindex="0" set="onclick: on.clickTab;" ></lr-btn-ui></lr-presence-toggle>`}l(vc,"renderTabToggle");function Cc(r){return`<lr-presence-toggle class="tab-content" set="visible: presence.tabContent.${r}; styles: presence.tabContentStyles"><lr-editor-scroller hidden-scrollbar><div class="controls-list_align"><div class="controls-list_inner" ref="controls-list-${r}"></div></div></lr-editor-scroller></lr-presence-toggle>`}l(Cc,"renderTabContent");var yr=class yr extends y{constructor(){super();u(this,"_updateInfoTooltip",k(()=>{var o,a;let t=this.$["*editorTransformations"],e=this.$["*currentOperation"],s="",n=!1;if(this.$["*tabId"]===P.FILTERS)if(n=!0,this.$["*currentFilter"]&&((o=t==null?void 0:t.filter)==null?void 0:o.name)===this.$["*currentFilter"]){let c=((a=t==null?void 0:t.filter)==null?void 0:a.amount)||100;s=this.$["*currentFilter"]+" "+c}else s=this.l10n(lt);else if(this.$["*tabId"]===P.TUNING&&e){n=!0;let c=(t==null?void 0:t[e])||et[e].zero;s=this.l10n(e)+" "+c}n&&(this.$["*operationTooltip"]=s),this.ref["tooltip-el"].classList.toggle("info-tooltip_visible",n)},0));this.init$={...this.init$,"*sliderEl":null,"*loadingOperations":new Map,"*showSlider":!1,"*currentFilter":lt,"*currentOperation":null,showLoader:!1,filters:wn,colorOperations:Cn,cropOperations:An,"*operationTooltip":null,"presence.mainToolbar":!0,"presence.subToolbar":!1,"presence.tabToggles":!0,"presence.tabContent.crop":!1,"presence.tabContent.tuning":!1,"presence.tabContent.filters":!1,"presence.tabToggle.crop":!0,"presence.tabToggle.tuning":!0,"presence.tabToggle.filters":!0,"presence.subTopToolbarStyles":{hidden:"sub-toolbar--top-hidden",visible:"sub-toolbar--visible"},"presence.subBottomToolbarStyles":{hidden:"sub-toolbar--bottom-hidden",visible:"sub-toolbar--visible"},"presence.tabContentStyles":{hidden:"tab-content--hidden",visible:"tab-content--visible"},"presence.tabToggleStyles":{hidden:"tab-toggle--hidden",visible:"tab-toggle--visible"},"presence.tabTogglesStyles":{hidden:"tab-toggles--hidden",visible:"tab-toggles--visible"},"on.cancel":()=>{this._cancelPreload&&this._cancelPreload(),this.$["*on.cancel"]()},"on.apply":()=>{this.$["*on.apply"](this.$["*editorTransformations"])},"on.applySlider":()=>{this.ref["slider-el"].apply(),this._onSliderClose()},"on.cancelSlider":()=>{this.ref["slider-el"].cancel(),this._onSliderClose()},"on.clickTab":t=>{let e=t.currentTarget.getAttribute("data-id");e&&this._activateTab(e,{fromViewer:!1})}},this._debouncedShowLoader=k(this._showLoader.bind(this),500)}_onSliderClose(){this.$["*showSlider"]=!1,this.$["*tabId"]===P.TUNING&&this.ref["tooltip-el"].classList.toggle("info-tooltip_visible",!1)}_createOperationControl(t){let e=new re;return e.operation=t,e}_createFilterControl(t){let e=new Mt;return e.filter=t,e}_createToggleControl(t){let e=new se;return e.operation=t,e}_renderControlsList(t){let e=this.ref[`controls-list-${t}`],s=document.createDocumentFragment();t===P.CROP?this.$.cropOperations.forEach(n=>{let o=this._createToggleControl(n);s.appendChild(o)}):t===P.FILTERS?[lt,...this.$.filters].forEach(n=>{let o=this._createFilterControl(n);s.appendChild(o)}):t===P.TUNING&&this.$.colorOperations.forEach(n=>{let o=this._createOperationControl(n);s.appendChild(o)}),[...s.children].forEach((n,o)=>{o===s.childNodes.length-1&&n.classList.add("controls-list_last-item")}),e.innerHTML="",e.appendChild(s)}_activateTab(t,{fromViewer:e}){this.$["*tabId"]=t,t===P.CROP?(this.$["*faderEl"].deactivate(),this.$["*cropperEl"].activate(this.$["*imageSize"],{fromViewer:e})):(this.$["*faderEl"].activate({url:this.$["*originalUrl"],fromViewer:e}),this.$["*cropperEl"].deactivate());for(let s of G){let n=s===t,o=this.ref[`tab-toggle-${s}`];o.active=n,n?(this._renderControlsList(t),this._syncTabIndicator()):this._unmountTabControls(s),this.$[`presence.tabContent.${s}`]=n}}_unmountTabControls(t){let e=this.ref[`controls-list-${t}`];e&&(e.innerHTML="")}_syncTabIndicator(){let t=this.ref[`tab-toggle-${this.$["*tabId"]}`],e=this.ref["tabs-indicator"];e.style.transform=`translateX(${t.offsetLeft}px)`}_preloadEditedImage(){if(this.$["*imgContainerEl"]&&this.$["*originalUrl"]){let t=this.$["*imgContainerEl"].offsetWidth,e=this.proxyUrl(ne(this.$["*originalUrl"],t,this.$["*editorTransformations"]));this._cancelPreload&&this._cancelPreload();let{cancel:s}=He([e]);this._cancelPreload=()=>{s(),this._cancelPreload=void 0}}}_showLoader(t){this.$.showLoader=t}initCallback(){super.initCallback(),this.$["*sliderEl"]=this.ref["slider-el"],this.sub("*imageSize",t=>{t&&setTimeout(()=>{this._activateTab(this.$["*tabId"],{fromViewer:!0})},0)}),this.sub("*editorTransformations",t=>{var s;let e=(s=t==null?void 0:t.filter)==null?void 0:s.name;this.$["*currentFilter"]!==e&&(this.$["*currentFilter"]=e)}),this.sub("*currentFilter",()=>{this._updateInfoTooltip()}),this.sub("*currentOperation",()=>{this._updateInfoTooltip()}),this.sub("*tabId",()=>{this._updateInfoTooltip()}),this.sub("*originalUrl",()=>{this.$["*faderEl"]&&this.$["*faderEl"].deactivate()}),this.sub("*editorTransformations",t=>{this._preloadEditedImage(),this.$["*faderEl"]&&this.$["*faderEl"].setTransformations(t)}),this.sub("*loadingOperations",t=>{let e=!1;for(let[,s]of t.entries()){if(e)break;for(let[,n]of s.entries())if(n){e=!0;break}}this._debouncedShowLoader(e)}),this.sub("*showSlider",t=>{this.$["presence.subToolbar"]=t,this.$["presence.mainToolbar"]=!t}),this.sub("*tabList",t=>{this.$["presence.tabToggles"]=t.length>1;for(let e of G){this.$[`presence.tabToggle.${e}`]=t.includes(e);let s=this.ref[`tab-toggle-${e}`];s.style.gridColumn=t.indexOf(e)+1}t.includes(this.$["*tabId"])||this._activateTab(t[0],{fromViewer:!1})}),this._updateInfoTooltip()}};l(yr,"EditorToolbar");var Xe=yr;Xe.template=`<lr-line-loader-ui set="active: showLoader"></lr-line-loader-ui><div class="info-tooltip_container"><div class="info-tooltip_wrapper"><div ref="tooltip-el" class="info-tooltip info-tooltip_hidden">{{*operationTooltip}}</div></div></div><div class="toolbar-container"><lr-presence-toggle class="sub-toolbar" set="visible: presence.mainToolbar; styles: presence.subTopToolbarStyles"><div class="tab-content-row">${G.map(Cc).join("")}</div><div class="controls-row"><lr-btn-ui theme="boring" icon="closeMax" set="onclick: on.cancel"></lr-btn-ui><lr-presence-toggle class="tab-toggles" set="visible: presence.tabToggles; styles: presence.tabTogglesStyles"><div ref="tabs-indicator" class="tab-toggles_indicator"></div> ${G.map(vc).join("")} </lr-presence-toggle><lr-btn-ui theme="primary" icon="done" set="onclick: on.apply"></lr-btn-ui></div></lr-presence-toggle><lr-presence-toggle class="sub-toolbar" set="visible: presence.subToolbar; styles: presence.subBottomToolbarStyles"><div class="slider"><lr-editor-slider ref="slider-el"></lr-editor-slider></div><div class="controls-row"><lr-btn-ui theme="boring" set="onclick: on.cancelSlider;" l10n="@text:cancel"></lr-btn-ui><lr-btn-ui theme="primary" set="onclick: on.applySlider;" l10n="@text:apply"></lr-btn-ui></div></lr-presence-toggle></div>`;var vr=class vr extends y{constructor(){super(),this._iconReversed=!1,this._iconSingle=!1,this._iconHidden=!1,this.init$={...this.init$,text:"",icon:"",iconCss:this._iconCss(),theme:null},this.defineAccessor("active",i=>{i?this.setAttribute("active",""):this.removeAttribute("active")})}_iconCss(){return D("icon",{icon_left:!this._iconReversed,icon_right:this._iconReversed,icon_hidden:this._iconHidden,icon_single:this._iconSingle})}initCallback(){super.initCallback(),this.sub("icon",i=>{this._iconSingle=!this.$.text,this._iconHidden=!i,this.$.iconCss=this._iconCss()}),this.sub("theme",i=>{i!=="custom"&&(this.className=i)}),this.sub("text",i=>{this._iconSingle=!1}),this.setAttribute("role","button"),this.tabIndex===-1&&(this.tabIndex=0),this.hasAttribute("theme")||this.setAttribute("theme","default")}set reverse(i){this.hasAttribute("reverse")?(this.style.flexDirection="row-reverse",this._iconReversed=!0):(this._iconReversed=!1,this.style.flexDirection=null)}};l(vr,"LrBtnUi");var oe=vr;oe.bindAttributes({text:"text",icon:"icon",reverse:"reverse",theme:"theme"});oe.template=`<lr-icon size="20" set="className: iconCss; @name: icon;"></lr-icon><div class="text">{{text}}</div>`;var Cr=class Cr extends y{constructor(){super(),this._active=!1,this._handleTransitionEndRight=()=>{let i=this.ref["line-el"];i.style.transition="initial",i.style.opacity="0",i.style.transform="translateX(-101%)",this._active&&this._start()}}initCallback(){super.initCallback(),this.defineAccessor("active",i=>{typeof i=="boolean"&&(i?this._start():this._stop())})}_start(){this._active=!0;let{width:i}=this.getBoundingClientRect(),t=this.ref["line-el"];t.style.transition="transform 1s",t.style.opacity="1",t.style.transform=`translateX(${i}px)`,t.addEventListener("transitionend",this._handleTransitionEndRight,{once:!0})}_stop(){this._active=!1}};l(Cr,"LineLoaderUi");var qe=Cr;qe.template=`<div class="inner"><div class="line" ref="line-el"></div></div>`;var Vi={transition:"transition",visible:"visible",hidden:"hidden"},wr=class wr extends y{constructor(){super(),this._visible=!1,this._visibleStyle=Vi.visible,this._hiddenStyle=Vi.hidden,this._externalTransitions=!1,this.defineAccessor("styles",i=>{i&&(this._externalTransitions=!0,this._visibleStyle=i.visible,this._hiddenStyle=i.hidden)}),this.defineAccessor("visible",i=>{typeof i=="boolean"&&(this._visible=i,this._handleVisible())})}_handleVisible(){this.style.visibility=this._visible?"inherit":"hidden",yo(this,{[Vi.transition]:!this._externalTransitions,[this._visibleStyle]:this._visible,[this._hiddenStyle]:!this._visible}),this.setAttribute("aria-hidden",this._visible?"false":"true")}initCallback(){super.initCallback(),this.setAttribute("hidden",""),this._externalTransitions||this.classList.add(Vi.transition),this._handleVisible(),setTimeout(()=>this.removeAttribute("hidden"),0)}};l(wr,"PresenceToggle");var Ke=wr;Ke.template=" <slot></slot> ";var Ar=class Ar extends y{constructor(){super();u(this,"init$",{...this.init$,disabled:!1,min:0,max:100,onInput:null,onChange:null,defaultValue:null,"on.sliderInput":()=>{let t=parseInt(this.ref["input-el"].value,10);this._updateValue(t),this.$.onInput&&this.$.onInput(t)},"on.sliderChange":()=>{let t=parseInt(this.ref["input-el"].value,10);this.$.onChange&&this.$.onChange(t)}});this.setAttribute("with-effects","")}initCallback(){super.initCallback(),this.defineAccessor("disabled",e=>{this.$.disabled=e}),this.defineAccessor("min",e=>{this.$.min=e}),this.defineAccessor("max",e=>{this.$.max=e}),this.defineAccessor("defaultValue",e=>{this.$.defaultValue=e,this.ref["input-el"].value=e,this._updateValue(e)}),this.defineAccessor("zero",e=>{this._zero=e}),this.defineAccessor("onInput",e=>{e&&(this.$.onInput=e)}),this.defineAccessor("onChange",e=>{e&&(this.$.onChange=e)}),this._updateSteps(),this._observer=new ResizeObserver(()=>{this._updateSteps();let e=parseInt(this.ref["input-el"].value,10);this._updateValue(e)}),this._observer.observe(this),this._thumbSize=parseInt(window.getComputedStyle(this).getPropertyValue("--l-thumb-size"),10),setTimeout(()=>{let e=parseInt(this.ref["input-el"].value,10);this._updateValue(e)},0),this.sub("disabled",e=>{let s=this.ref["input-el"];e?s.setAttribute("disabled","disabled"):s.removeAttribute("disabled")});let t=this.ref["input-el"];t.addEventListener("focus",()=>{this.style.setProperty("--color-effect","var(--hover-color-rgb)")}),t.addEventListener("blur",()=>{this.style.setProperty("--color-effect","var(--idle-color-rgb)")})}_updateValue(t){this._updateZeroDot(t);let{width:e}=this.getBoundingClientRect(),o=100/(this.$.max-this.$.min)*(t-this.$.min)*(e-this._thumbSize)/100;window.requestAnimationFrame(()=>{this.ref["thumb-el"].style.transform=`translateX(${o}px)`})}_updateZeroDot(t){if(!this._zeroDotEl)return;t===this._zero?this._zeroDotEl.style.opacity="0":this._zeroDotEl.style.opacity="0.2";let{width:e}=this.getBoundingClientRect(),o=100/(this.$.max-this.$.min)*(this._zero-this.$.min)*(e-this._thumbSize)/100;window.requestAnimationFrame(()=>{this._zeroDotEl.style.transform=`translateX(${o}px)`})}_updateSteps(){let e=this.ref["steps-el"],{width:s}=e.getBoundingClientRect(),n=Math.ceil(s/2),o=Math.ceil(n/15)-2;if(this._stepsCount===o)return;let a=document.createDocumentFragment(),c=document.createElement("div"),h=document.createElement("div");c.className="minor-step",h.className="border-step",a.appendChild(h);for(let p=0;p<o;p++)a.appendChild(c.cloneNode());a.appendChild(h.cloneNode());for(let p=0;p<o;p++)a.appendChild(c.cloneNode());a.appendChild(h.cloneNode());let d=document.createElement("div");d.className="zero-dot",a.appendChild(d),this._zeroDotEl=d,e.innerHTML="",e.appendChild(a),this._stepsCount=o}destroyCallback(){var t;(t=this._observer)==null||t.disconnect()}};l(Ar,"SliderUi");var Ye=Ar;Ye.template=`<div class="steps" ref="steps-el"></div><div ref="thumb-el" class="thumb"></div><input class="input" type="range" ref="input-el" tabindex="0" set="oninput: on.sliderInput; onchange: on.sliderChange; @min: min; @max: max; @value: defaultValue;" />`;var Er=class Er extends S{constructor(){super();u(this,"couldBeCtxOwner",!0);u(this,"activityType",_.activities.CLOUD_IMG_EDIT);this.init$={...this.init$,cdnUrl:null}}initCallback(){super.initCallback(),this.registerActivity(this.activityType,{onActivate:()=>this.mountEditor(),onDeactivate:()=>this.unmountEditor()}),this.sub("*focusedEntry",t=>{t&&(this.entry=t,this.entry.subscribe("cdnUrl",e=>{e&&(this.$.cdnUrl=e)}))}),this.subConfigValue("cropPreset",t=>{this._instance&&this._instance.getAttribute("crop-preset")!==t&&this._instance.setAttribute("crop-preset",t)}),this.subConfigValue("cloudImageEditorTabs",t=>{this._instance&&this._instance.getAttribute("tabs")!==t&&this._instance.setAttribute("tabs",t)})}handleApply(t){if(!this.entry)return;let e=t.detail;this.entry.setMultipleValues({cdnUrl:e.cdnUrl,cdnUrlModifiers:e.cdnUrlModifiers}),this.historyBack()}handleCancel(){this.historyBack()}mountEditor(){let t=new ot,e=this.$.cdnUrl,s=this.cfg.cropPreset,n=this.cfg.cloudImageEditorTabs;t.setAttribute("ctx-name",this.ctxName),t.setAttribute("cdn-url",e),s&&t.setAttribute("crop-preset",s),n&&t.setAttribute("tabs",n),t.addEventListener("apply",o=>{let a=o;this.handleApply(a),this.debugPrint('editor event "apply"',a.detail)}),t.addEventListener("cancel",o=>{let a=o;this.handleCancel(),this.debugPrint('editor event "cancel"',a.detail)}),t.addEventListener("change",o=>{let a=o;this.debugPrint('editor event "change"',a.detail)}),this.innerHTML="",this.appendChild(t),this._mounted=!0,this._instance=t}unmountEditor(){this._instance=void 0,this.innerHTML=""}};l(Er,"CloudImageEditorActivity");var ji=Er;var wc=l(function(r){return r.replace(/[\\-\\[]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},"escapeRegExp"),xo=l(function(r,i="i"){let t=r.split("*").map(wc);return new RegExp("^"+t.join(".+")+"$",i)},"wildcardRegexp");var Ac=l(r=>Object.keys(r).reduce((t,e)=>{let s=r[e],n=Object.keys(s).reduce((o,a)=>{let c=s[a];return o+`${a}: ${c};`},"");return t+`${e}{${n}}`},""),"styleToCss");function To({textColor:r,backgroundColor:i,linkColor:t,linkColorHover:e,shadeColor:s}){let n=`solid 1px ${s}`;return Ac({body:{color:r,"background-color":i},".side-bar":{background:"inherit","border-right":n},".main-content":{background:"inherit"},".main-content-header":{background:"inherit"},".main-content-footer":{background:"inherit"},".list-table-row":{color:"inherit"},".list-table-row:hover":{background:s},".list-table-row .list-table-cell-a, .list-table-row .list-table-cell-b":{"border-top":n},".list-table-body .list-items":{"border-bottom":n},".bread-crumbs a":{color:t},".bread-crumbs a:hover":{color:e},".main-content.loading":{background:`${i} url(/static/images/loading_spinner.gif) center no-repeat`,"background-size":"25px 25px"},".list-icons-item":{"background-color":s},".source-gdrive .side-bar-menu a, .source-gphotos .side-bar-menu a":{color:t},".source-gdrive .side-bar-menu a, .source-gphotos .side-bar-menu a:hover":{color:e},".side-bar-menu a":{color:t},".side-bar-menu a:hover":{color:e},".source-gdrive .side-bar-menu .current, .source-gdrive .side-bar-menu a:hover, .source-gphotos .side-bar-menu .current, .source-gphotos .side-bar-menu a:hover":{color:e},".source-vk .side-bar-menu a":{color:t},".source-vk .side-bar-menu a:hover":{color:e,background:"none"}})}l(To,"buildStyles");var xt={};window.addEventListener("message",r=>{let i;try{i=JSON.parse(r.data)}catch{return}if((i==null?void 0:i.type)in xt){let t=xt[i.type];for(let[e,s]of t)r.source===e&&s(i)}});var So=l(function(r,i,t){r in xt||(xt[r]=[]),xt[r].push([i,t])},"registerMessage"),$o=l(function(r,i){r in xt&&(xt[r]=xt[r].filter(t=>t[0]!==i))},"unregisterMessage");function Io(r){let i=[];for(let[t,e]of Object.entries(r))e==null||typeof e=="string"&&e.length===0||i.push(`${t}=${encodeURIComponent(e)}`);return i.join("&")}l(Io,"queryString");var xr=class xr extends S{constructor(){super();u(this,"couldBeCtxOwner",!0);u(this,"activityType",_.activities.EXTERNAL);u(this,"_iframe",null);this.init$={...this.init$,activityIcon:"",activityCaption:"",selectedList:[],counter:0,multiple:!1,onDone:()=>{for(let t of this.$.selectedList){let e=this.extractUrlFromMessage(t),{filename:s}=t,{externalSourceType:n}=this.activityParams;this.addFileFromUrl(e,{fileName:s,source:n})}this.$["*currentActivity"]=_.activities.UPLOAD_LIST},onCancel:()=>{this.historyBack()}}}initCallback(){super.initCallback(),this.registerActivity(this.activityType,{onActivate:()=>{let{externalSourceType:t}=this.activityParams;this.set$({activityCaption:`${t==null?void 0:t[0].toUpperCase()}${t==null?void 0:t.slice(1)}`,activityIcon:t}),this.mountIframe()}}),this.sub("*currentActivity",t=>{t!==this.activityType&&this.unmountIframe()}),this.sub("selectedList",t=>{this.$.counter=t.length}),this.subConfigValue("multiple",t=>{this.$.multiple=t})}extractUrlFromMessage(t){if(t.alternatives){let e=R(this.cfg.externalSourcesPreferredTypes);for(let s of e){let n=xo(s);for(let[o,a]of Object.entries(t.alternatives))if(n.test(o))return a}}return t.url}sendMessage(t){var e,s;(s=(e=this._iframe)==null?void 0:e.contentWindow)==null||s.postMessage(JSON.stringify(t),"*")}async handleFileSelected(t){!this.$.multiple&&this.$.selectedList.length||(this.$.selectedList=[...this.$.selectedList,t],this.$.multiple||this.$.onDone())}handleIframeLoad(){this.applyStyles()}getCssValue(t){return window.getComputedStyle(this).getPropertyValue(t).trim()}applyStyles(){let t={backgroundColor:this.getCssValue("--clr-background-light"),textColor:this.getCssValue("--clr-txt"),shadeColor:this.getCssValue("--clr-shade-lv1"),linkColor:"#157cfc",linkColorHover:"#3891ff"};this.sendMessage({type:"embed-css",style:To(t)})}remoteUrl(){var h,d;let{pubkey:t,remoteTabSessionKey:e,socialBaseUrl:s}=this.cfg,{externalSourceType:n}=this.activityParams,a={lang:((d=(h=this.l10n("social-source-lang"))==null?void 0:h.split("-"))==null?void 0:d[0])||"en",public_key:t,images_only:"false",pass_window_open:!1,session_key:e},c=new URL(`/window3/${n}`,s);return c.search=Io(a),c.toString()}mountIframe(){let t=be({tag:"iframe",attributes:{src:this.remoteUrl(),marginheight:0,marginwidth:0,frameborder:0,allowTransparency:!0}});t.addEventListener("load",this.handleIframeLoad.bind(this)),this.ref.iframeWrapper.innerHTML="",this.ref.iframeWrapper.appendChild(t),So("file-selected",t.contentWindow,this.handleFileSelected.bind(this)),this._iframe=t,this.$.selectedList=[]}unmountIframe(){this._iframe&&$o("file-selected",this._iframe.contentWindow),this.ref.iframeWrapper.innerHTML="",this._iframe=null,this.$.selectedList=[],this.$.counter=0}};l(xr,"ExternalSource");var Je=xr;Je.template=`<lr-activity-header><button type="button" class="mini-btn" set="onclick: *historyBack"><lr-icon name="back"></lr-icon></button><div><lr-icon set="@name: activityIcon"></lr-icon><span>{{activityCaption}}</span></div><button type="button" class="mini-btn close-btn" set="onclick: *historyBack"><lr-icon name="close"></lr-icon></button></lr-activity-header><div class="content"><div ref="iframeWrapper" class="iframe-wrapper"></div><div class="toolbar"><button type="button" class="cancel-btn secondary-btn" set="onclick: onCancel" l10n="cancel"></button><div></div><div set="@hidden: !multiple" class="selected-counter"><span l10n="selected-count"></span>{{counter}}</div><button type="button" class="done-btn primary-btn" set="onclick: onDone; @disabled: !counter"><lr-icon name="check"></lr-icon></button></div></div>`;var Tr=class Tr extends y{setCurrentTab(i){if(!i)return;[...this.ref.context.querySelectorAll("[tab-ctx]")].forEach(e=>{e.getAttribute("tab-ctx")===i?e.removeAttribute("hidden"):e.setAttribute("hidden","")});for(let e in this._tabMap)e===i?this._tabMap[e].setAttribute("current",""):this._tabMap[e].removeAttribute("current")}initCallback(){super.initCallback(),this._tabMap={},this.defineAccessor("tab-list",i=>{if(!i)return;R(i).forEach(e=>{let s=be({tag:"div",attributes:{class:"tab"},properties:{onclick:()=>{this.setCurrentTab(e)}}});s.textContent=this.l10n(e),this.ref.row.appendChild(s),this._tabMap[e]=s})}),this.defineAccessor("default",i=>{this.setCurrentTab(i)}),this.hasAttribute("default")||this.setCurrentTab(Object.keys(this._tabMap)[0])}};l(Tr,"Tabs");var le=Tr;le.bindAttributes({"tab-list":null,default:null});le.template=`<div ref="row" class="tabs-row"></div><div ref="context" class="tabs-context"><slot></slot></div>`;var Sr=class Sr extends S{constructor(){super(...arguments);u(this,"requireCtxName",!0)}_createValidationInput(){let t=document.createElement("input");return t.type="text",t.name=this.ctxName,t.required=this.cfg.multipleMin>0,t.tabIndex=-1,Qi(t,{opacity:0,height:0,width:0}),t}initCallback(){super.initCallback(),this._validationInputElement=this._createValidationInput(),this.appendChild(this._validationInputElement),this.sub("*collectionState",t=>{var e;{if(this._dynamicInputsContainer||(this._dynamicInputsContainer=document.createElement("div"),this.appendChild(this._dynamicInputsContainer)),!this._validationInputElement){let a=this._createValidationInput();this.appendChild(a),this._validationInputElement=a}if(this._dynamicInputsContainer.innerHTML="",t.status==="uploading"||t.status==="idle"){this._validationInputElement.value="",this._validationInputElement.setCustomValidity("");return}if(t.status==="failed"){let a=(e=t.errors[0])==null?void 0:e.message;this._validationInputElement.value="",this._validationInputElement.setCustomValidity(a);return}let s=t.group?t.group:null;if(s){this._validationInputElement.value=s.cdnUrl,this._validationInputElement.setCustomValidity("");return}let n=t.allEntries.map(a=>a.cdnUrl);if(!this.cfg.multiple&&n.length===1){this._validationInputElement.value=n[0],this._validationInputElement.setCustomValidity("");return}this._validationInputElement.remove(),this._validationInputElement=null;let o=new DocumentFragment;for(let a of n){let c=document.createElement("input");c.type="hidden",c.name=`${this.ctxName}[]`,c.value=a,o.appendChild(c)}this._dynamicInputsContainer.replaceChildren(o)}},!1)}};l(Sr,"FormInput");var Hi=Sr;var $r=class $r extends _{};l($r,"ActivityHeader");var Gi=$r;var Ir=class Ir extends y{constructor(){super(...arguments);u(this,"init$",{...this.init$,currentText:"",options:[],selectHtml:"",onSelect:t=>{var e;t.preventDefault(),t.stopPropagation(),this.value=this.ref.select.value,this.$.currentText=((e=this.$.options.find(s=>s.value==this.value))==null?void 0:e.text)||"",this.dispatchEvent(new Event("change"))}})}initCallback(){super.initCallback(),this.sub("options",t=>{var s;this.$.currentText=((s=t==null?void 0:t[0])==null?void 0:s.text)||"";let e="";t==null||t.forEach(n=>{e+=`<option value="${n.value}">${n.text}</option>`}),this.$.selectHtml=e})}};l(Ir,"Select");var Ze=Ir;Ze.template=`<button> {{currentText}} <lr-icon name="select"></lr-icon><select ref="select" set="innerHTML: selectHtml; onchange: onSelect"></select></button>`;var X={PLAY:"play",PAUSE:"pause",FS_ON:"fullscreen-on",FS_OFF:"fullscreen-off",VOL_ON:"unmute",VOL_OFF:"mute",CAP_ON:"captions",CAP_OFF:"captions-off"},Oo={requestFullscreen:r=>{r.requestFullscreen?r.requestFullscreen():r.webkitRequestFullscreen&&r.webkitRequestFullscreen()},exitFullscreen:()=>{document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()}},Tt=class Tt extends y{constructor(){super(...arguments);u(this,"init$",{...this.init$,src:"",ppIcon:X.PLAY,fsIcon:X.FS_ON,volIcon:X.VOL_ON,capIcon:X.CAP_OFF,totalTime:"00:00",currentTime:"00:00",progressCssWidth:"0",hasSubtitles:!1,volumeDisabled:!1,volumeValue:0,onPP:()=>{this.togglePlay()},onFs:()=>{this.toggleFullscreen()},onCap:()=>{this.toggleCaptions()},onMute:()=>{this.toggleSound()},onVolChange:t=>{let e=parseFloat(t.currentTarget.$.value);this.setVolume(e)},progressClicked:t=>{let e=this.progress.getBoundingClientRect();this._video.currentTime=this._video.duration*(t.offsetX/e.width)}})}togglePlay(){this._video.paused||this._video.ended?this._video.play():this._video.pause()}toggleFullscreen(){(document.fullscreenElement||document.webkitFullscreenElement)===this?Oo.exitFullscreen():Oo.requestFullscreen(this)}toggleCaptions(){this.$.capIcon===X.CAP_OFF?(this.$.capIcon=X.CAP_ON,this._video.textTracks[0].mode="showing",window.localStorage.setItem(Tt.is+":captions","1")):(this.$.capIcon=X.CAP_OFF,this._video.textTracks[0].mode="hidden",window.localStorage.removeItem(Tt.is+":captions"))}toggleSound(){this.$.volIcon===X.VOL_ON?(this.$.volIcon=X.VOL_OFF,this.$.volumeDisabled=!0,this._video.muted=!0):(this.$.volIcon=X.VOL_ON,this.$.volumeDisabled=!1,this._video.muted=!1)}setVolume(t){window.localStorage.setItem(Tt.is+":volume",t);let e=t?t/100:0;this._video.volume=e}get progress(){return this.ref.progress}_getUrl(t){return t.includes("/")?t:`https://ucarecdn.com/${t}/`}_desc2attrs(t){let e=[];for(let s in t){let n=s==="src"?this._getUrl(t[s]):t[s];e.push(`${s}="${n}"`)}return e.join(" ")}_timeFmt(t){let e=new Date(Math.round(t)*1e3);return[e.getMinutes(),e.getSeconds()].map(s=>s<10?"0"+s:s).join(":")}_initTracks(){[...this._video.textTracks].forEach(t=>{t.mode="hidden"}),window.localStorage.getItem(Tt.is+":captions")&&this.toggleCaptions()}_castAttributes(){let t=["autoplay","loop","muted"];[...this.attributes].forEach(e=>{t.includes(e.name)&&this._video.setAttribute(e.name,e.value)})}initCallback(){super.initCallback(),this._video=this.ref.video,this._castAttributes(),this._video.addEventListener("play",()=>{this.$.ppIcon=X.PAUSE,this.setAttribute("playback","")}),this._video.addEventListener("pause",()=>{this.$.ppIcon=X.PLAY,this.removeAttribute("playback")}),this.addEventListener("fullscreenchange",e=>{console.log(e),document.fullscreenElement===this?this.$.fsIcon=X.FS_OFF:this.$.fsIcon=X.FS_ON}),this.sub("src",e=>{if(!e)return;let s=this._getUrl(e);this._video.src=s}),this.sub("video",async e=>{if(!e)return;let s=await(await window.fetch(this._getUrl(e))).json();s.poster&&(this._video.poster=this._getUrl(s.poster));let n="";s==null||s.sources.forEach(o=>{n+=`<source ${this._desc2attrs(o)} />`}),s.tracks&&(s.tracks.forEach(o=>{n+=`<track ${this._desc2attrs(o)} />`}),this.$.hasSubtitles=!0),this._video.innerHTML+=n,this._initTracks(),console.log(s)}),this._video.addEventListener("loadedmetadata",e=>{this.$.currentTime=this._timeFmt(this._video.currentTime),this.$.totalTime=this._timeFmt(this._video.duration)}),this._video.addEventListener("timeupdate",e=>{let s=Math.round(100*(this._video.currentTime/this._video.duration));this.$.progressCssWidth=s+"%",this.$.currentTime=this._timeFmt(this._video.currentTime)});let t=window.localStorage.getItem(Tt.is+":volume");if(t){let e=parseFloat(t);this.setVolume(e),this.$.volumeValue=e}}};l(Tt,"Video");var ae=Tt;ae.template=`<div class="video-wrapper"><video ref="video" preload="metadata" crossorigin="anonymous"></video></div><div class="toolbar"><div class="progress" ref="progress" set -onclick="progressClicked"><div class="bar" set -style.width="progressCssWidth"></div></div><div class="tb-block"><button set -onclick="onPP"><lr-icon set -@name="ppIcon"></lr-icon></button><div class="timer">{{currentTime}} / {{totalTime}}</div></div><div class="tb-block"><button set -onclick="onCap" -@hidden="!hasSubtitles"><lr-icon set -@name="capIcon"></lr-icon></button><button set -onclick="onMute"><lr-icon set -@name="volIcon"></lr-icon></button><lr-range type="range" set -onchange="onVolChange" -@disabled="volumeDisabled" -value="volumeValue"></lr-range><button set -onclick="onFs"><lr-icon set -@name="fsIcon"></lr-icon></button></div></div>`;ae.bindAttributes({video:"video",src:"src"});var Xi=class Xi extends y{initCallback(){super.initCallback(),this.subConfigValue("removeCopyright",i=>{this.toggleAttribute("hidden",!!i)})}};l(Xi,"Copyright"),u(Xi,"template",`<a href="https://uploadcare.com/?utm_source=copyright&utm_medium=referral&utm_campaign=v4" target="_blank noopener" class="credits" >Powered by Uploadcare</a >`);var Wi=Xi;var Or=class Or extends y{constructor(){super(...arguments);u(this,"requireCtxName",!0);u(this,"init$",gi(this));u(this,"_template",null)}static set template(t){this._template=t+"<slot></slot>"}static get template(){return this._template}};l(Or,"SolutionBlock");var St=Or;var kr=class kr extends St{initCallback(){super.initCallback(),this.sub("*modalActive",i=>{this._lastModalActive!==i&&this.emit(i?I.MODAL_OPEN:I.MODAL_CLOSE,void 0,{debounce:!0}),this._lastModalActive=i},!1)}};l(kr,"FileUploaderRegular");var Qe=kr;Qe.template=`<lr-simple-btn></lr-simple-btn><lr-modal strokes block-body-scrolling><lr-start-from><lr-drop-area with-icon clickable></lr-drop-area><lr-source-list wrap></lr-source-list><button type="button" l10n="start-from-cancel" class="secondary-btn" set="onclick: *historyBack"></button><lr-copyright></lr-copyright></lr-start-from><lr-upload-list></lr-upload-list><lr-camera-source></lr-camera-source><lr-url-source></lr-url-source><lr-external-source></lr-external-source><lr-cloud-image-editor-activity></lr-cloud-image-editor-activity></lr-modal><lr-progress-bar-common></lr-progress-bar-common>`;var Lr=class Lr extends St{initCallback(){super.initCallback();let i=this.ref.uBlock;this.sub("*currentActivity",t=>{t||(this.$["*currentActivity"]=i.initActivity||_.activities.START_FROM)}),this.sub("*uploadList",t=>{(t==null?void 0:t.length)>0?this.$["*currentActivity"]=_.activities.UPLOAD_LIST:this.$["*currentActivity"]=i.initActivity||_.activities.START_FROM}),this.subConfigValue("sourceList",t=>{t!=="local"&&(this.cfg.sourceList="local")}),this.subConfigValue("confirmUpload",t=>{t!==!1&&(this.cfg.confirmUpload=!1)})}};l(Lr,"FileUploaderMinimal");var ti=Lr;ti.template=`<lr-start-from><lr-drop-area clickable l10n="choose-file"></lr-drop-area><lr-copyright></lr-copyright></lr-start-from><lr-upload-list ref="uBlock"></lr-upload-list>`;var Pr=class Pr extends St{constructor(){super(),this.init$={...this.init$,couldCancel:!1,cancel:()=>{this.couldHistoryBack?this.$["*historyBack"]():this.couldShowList&&(this.$["*currentActivity"]=_.activities.UPLOAD_LIST)}}}get couldHistoryBack(){let i=this.$["*history"];return i.length>1&&i[i.length-1]!==_.activities.START_FROM}get couldShowList(){return this.cfg.showEmptyList||this.$["*uploadList"].length>0}initCallback(){super.initCallback();let i=this.ref.uBlock;this.sub("*currentActivity",t=>{t||(this.$["*currentActivity"]=i.initActivity||_.activities.START_FROM)}),this.sub("*uploadList",t=>{(t==null?void 0:t.length)>0&&this.$["*currentActivity"]===(i.initActivity||_.activities.START_FROM)&&(this.$["*currentActivity"]=_.activities.UPLOAD_LIST)}),this.sub("*history",()=>{this.$.couldCancel=this.couldHistoryBack||this.couldShowList})}};l(Pr,"FileUploaderInline");var ei=Pr;ei.template=`<lr-start-from><lr-drop-area with-icon clickable></lr-drop-area><lr-source-list wrap></lr-source-list><button type="button" l10n="start-from-cancel" class="cancel-btn secondary-btn" set="onclick: cancel; @hidden: !couldCancel" ></button><lr-copyright></lr-copyright></lr-start-from><lr-upload-list ref="uBlock"></lr-upload-list><lr-camera-source></lr-camera-source><lr-url-source></lr-url-source><lr-external-source></lr-external-source><lr-progress-bar></lr-progress-bar><lr-cloud-image-editor-activity></lr-cloud-image-editor-activity>`;var Ur=class Ur extends ot{initCallback(){super.initCallback(),this.__shadowReady=!0,this.$["*faderEl"]=this.ref["fader-el"],this.$["*cropperEl"]=this.ref["cropper-el"],this.$["*imgContainerEl"]=this.ref["img-container-el"],this.initEditor()}async initEditor(){this.__shadowReady&&await super.initEditor()}};l(Ur,"CloudImageEditor");var qi=Ur;function Ki(r){for(let i in r){let t=[...i].reduce((e,s)=>(s.toUpperCase()===s&&(s="-"+s.toLowerCase()),e+=s),"");t.startsWith("-")&&(t=t.replace("-","")),t.startsWith("lr-")||(t="lr-"+t),r[i].reg&&r[i].reg(t)}}l(Ki,"registerBlocks");var Rr="LR";async function ko(r,i=!1){return new Promise((t,e)=>{if(typeof document!="object"){t(null);return}if(typeof window=="object"&&window[Rr]){t(window[Rr]);return}let s=document.createElement("script");s.async=!0,s.src=r,s.onerror=()=>{e()},s.onload=()=>{let n=window[Rr];i&&Ki(n),t(n)},document.head.appendChild(s)})}l(ko,"connectBlocksFrom");return Fo(Ec);})();