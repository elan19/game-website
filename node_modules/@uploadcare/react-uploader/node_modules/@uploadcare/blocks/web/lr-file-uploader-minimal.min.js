/**
 * @license
 * MIT License
 * 
 * Copyright (c) 2022 Uploadcare (hello@uploadcare.com). All rights reserved.
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 * 
 */
var ir=Object.defineProperty;var rr=(e,i,t)=>i in e?ir(e,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[i]=t;var h=(e,i,t)=>(rr(e,typeof i!="symbol"?i+"":i,t),t);function sr(e){for(let i in e){let t=[...i].reduce((r,s)=>(s.toUpperCase()===s&&(s="-"+s.toLowerCase()),r+=s),"");t.startsWith("-")&&(t=t.replace("-","")),t.startsWith("lr-")||(t="lr-"+t),e[i].reg&&e[i].reg(t)}}var bt={"locale-id":"en","social-source-lang":"en","upload-file":"Upload file","upload-files":"Upload files","choose-file":"Choose file","choose-files":"Choose files","drop-files-here":"Drop files here","select-file-source":"Select file source",selected:"Selected",upload:"Upload","add-more":"Add more",cancel:"Cancel","start-from-cancel":"Cancel",clear:"Clear","camera-shot":"Shot","upload-url":"Import","upload-url-placeholder":"Paste link here","edit-image":"Edit image","edit-detail":"Details",back:"Back",done:"Done",ok:"Ok","remove-from-list":"Remove",no:"No",yes:"Yes","confirm-your-action":"Confirm your action","are-you-sure":"Are you sure?","selected-count":"Selected:","upload-error":"Upload error","validation-error":"Validation error","no-files":"No files selected",browse:"Browse","not-uploaded-yet":"Not uploaded yet...",file__one:"file",file__other:"files",error__one:"error",error__other:"errors","header-uploading":"Uploading {{count}} {{plural:file(count)}}","header-failed":"{{count}} {{plural:error(count)}}","header-succeed":"{{count}} {{plural:file(count)}} uploaded","header-total":"{{count}} {{plural:file(count)}} selected","src-type-local":"From device","src-type-from-url":"From link","src-type-camera":"Camera","src-type-draw":"Draw","src-type-facebook":"Facebook","src-type-dropbox":"Dropbox","src-type-gdrive":"Google Drive","src-type-gphotos":"Google Photos","src-type-instagram":"Instagram","src-type-flickr":"Flickr","src-type-vk":"VK","src-type-evernote":"Evernote","src-type-box":"Box","src-type-onedrive":"Onedrive","src-type-huddle":"Huddle","src-type-other":"Other","caption-from-url":"Import from link","caption-camera":"Camera","caption-draw":"Draw","caption-edit-file":"Edit file","file-no-name":"No name...","toggle-fullscreen":"Toggle fullscreen","toggle-guides":"Toggle guides",rotate:"Rotate","flip-vertical":"Flip vertical","flip-horizontal":"Flip horizontal",apply:"Apply",brightness:"Brightness",contrast:"Contrast",saturation:"Saturation",exposure:"Exposure",gamma:"Gamma",vibrance:"Vibrance",warmth:"Warmth",enhance:"Enhance",original:"Original",resize:"Resize image",crop:"Crop","select-color":"Select color",text:"Text",draw:"Draw","cancel-edit":"Cancel edit","tab-view":"Preview","tab-details":"Details","file-name":"Name","file-size":"Size","cdn-url":"CDN URL","file-size-unknown":"Unknown","camera-permissions-denied":"Camera access denied","camera-permissions-prompt":"Please allow access to the camera","camera-permissions-request":"Request access","files-count-limit-error-title":"Files count limit overflow","files-count-limit-error-too-few":"You\u2019ve chosen {{total}} {{plural:file(total)}}. At least {{min}} {{plural:file(min)}} required.","files-count-limit-error-too-many":"You\u2019ve chosen too many files. {{max}} {{plural:file(max)}} is maximum.","files-max-size-limit-error":"File is too big. Max file size is {{maxFileSize}}.","has-validation-errors":"File validation error ocurred. Please, check your files before upload.","images-only-accepted":"Only image files are accepted.","file-type-not-allowed":"Uploading of these file types is not allowed.","some-files-were-not-uploaded":"Some files were not uploaded."};var It=new Map,ae=new Map,Ve=(e,i)=>{It.has(e)&&console.log(`Locale ${e} is already defined. Overwriting...`),It.set(e,{...bt,...i})},nr=(e,i)=>{ae.set(e,i)},ze=(e,i)=>{typeof i=="function"?nr(e,i):Ve(e,i)},je=async e=>{if(!It.has(e)){if(!ae.has(e))throw new Error(`Locale ${e} is not defined`);let t=await ae.get(e)();Ve(e,t)}return It.get(e)};ze("en",bt);function N(e,i){let t,r=(...s)=>{clearTimeout(t),t=setTimeout(()=>e(...s),i)};return r.cancel=()=>{clearTimeout(t)},r}var T=Object.freeze({FILE_ADDED:"file-added",FILE_REMOVED:"file-removed",FILE_UPLOAD_START:"file-upload-start",FILE_UPLOAD_PROGRESS:"file-upload-progress",FILE_UPLOAD_SUCCESS:"file-upload-success",FILE_UPLOAD_FAILED:"file-upload-failed",FILE_URL_CHANGED:"file-url-changed",MODAL_OPEN:"modal-open",MODAL_CLOSE:"modal-close",DONE_CLICK:"done-click",UPLOAD_CLICK:"upload-click",ACTIVITY_CHANGE:"activity-change",COMMON_UPLOAD_START:"common-upload-start",COMMON_UPLOAD_PROGRESS:"common-upload-progress",COMMON_UPLOAD_SUCCESS:"common-upload-success",COMMON_UPLOAD_FAILED:"common-upload-failed",CHANGE:"change",GROUP_CREATED:"group-created"}),Ut=class{constructor(i){h(this,"_timeoutStore",new Map);h(this,"_targets",new Set);h(this,"_debugPrint",null);this._debugPrint=i}bindTarget(i){this._targets.add(i)}unbindTarget(i){this._targets.delete(i)}_dispatch(i,t){var r;for(let s of this._targets)s.dispatchEvent(new CustomEvent(i,{detail:t}));(r=this._debugPrint)==null||r.call(this,()=>{let s=t&&typeof t=="object"?{...t}:t;return[`event "${i}"`,s]})}emit(i,t,{debounce:r}={}){if(typeof r!="number"&&!r){this._dispatch(i,typeof t=="function"?t():t);return}this._timeoutStore.has(i)&&window.clearTimeout(this._timeoutStore.get(i));let s=typeof r=="number"?r:20,n=window.setTimeout(()=>{this._dispatch(i,typeof t=="function"?t():t),this._timeoutStore.delete(i)},s);this._timeoutStore.set(i,n)}};var or=Object.defineProperty,lr=(e,i,t)=>i in e?or(e,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[i]=t,ue=(e,i,t)=>(lr(e,typeof i!="symbol"?i+"":i,t),t);function ar(e){let i=t=>{var r;for(let s in t)((r=t[s])==null?void 0:r.constructor)===Object&&(t[s]=i(t[s]));return{...t}};return i(e)}var A=class{constructor(e){e.constructor===Object?this.store=ar(e):(this._storeIsProxy=!0,this.store=e),this.callbackMap=Object.create(null)}static warn(e,i){console.warn(`Symbiote Data: cannot ${e}. Prop name: `+i)}read(e){return!this._storeIsProxy&&!this.store.hasOwnProperty(e)?(A.warn("read",e),null):this.store[e]}has(e){return this._storeIsProxy?this.store[e]!==void 0:this.store.hasOwnProperty(e)}add(e,i,t=!1){!t&&Object.keys(this.store).includes(e)||(this.store[e]=i,this.notify(e))}pub(e,i){if(!this._storeIsProxy&&!this.store.hasOwnProperty(e)){A.warn("publish",e);return}this.store[e]=i,this.notify(e)}multiPub(e){for(let i in e)this.pub(i,e[i])}notify(e){this.callbackMap[e]&&this.callbackMap[e].forEach(i=>{i(this.store[e])})}sub(e,i,t=!0){return!this._storeIsProxy&&!this.store.hasOwnProperty(e)?(A.warn("subscribe",e),null):(this.callbackMap[e]||(this.callbackMap[e]=new Set),this.callbackMap[e].add(i),t&&i(this.store[e]),{remove:()=>{this.callbackMap[e].delete(i),this.callbackMap[e].size||delete this.callbackMap[e]},callback:i})}static registerCtx(e,i=Symbol()){let t=A.globalStore.get(i);return t?console.warn('State: context UID "'+i+'" already in use'):(t=new A(e),A.globalStore.set(i,t)),t}static deleteCtx(e){A.globalStore.delete(e)}static getCtx(e,i=!0){return A.globalStore.get(e)||(i&&console.warn('State: wrong context UID - "'+e+'"'),null)}};A.globalStore=new Map;var _=Object.freeze({BIND_ATTR:"set",ATTR_BIND_PRFX:"@",EXT_DATA_CTX_PRFX:"*",NAMED_DATA_CTX_SPLTR:"/",CTX_NAME_ATTR:"ctx-name",CTX_OWNER_ATTR:"ctx-owner",CSS_CTX_PROP:"--ctx-name",EL_REF_ATTR:"ref",AUTO_TAG_PRFX:"sym",REPEAT_ATTR:"repeat",REPEAT_ITEM_TAG_ATTR:"repeat-item-tag",SET_LATER_KEY:"__toSetLater__",USE_TPL:"use-template",ROOT_STYLE_ATTR_NAME:"sym-component"}),He="1234567890QWERTYUIOPASDFGHJKLZXCVBNMqwertyuiopasdfghjklzxcvbnm",cr=He.length-1,Ct=class{static generate(e="XXXXXXXXX-XXX"){let i="";for(let t=0;t<e.length;t++)i+=e[t]==="-"?e[t]:He.charAt(Math.random()*cr);return i}};function Xe(e,i,t){let r=!0,s,n=i.split(".");return n.forEach((o,l)=>{l<n.length-1?e=e[o]:s=o}),e?e[s]=t:r=!1,r}function ur(e){return e.split("-").map((i,t)=>i&&t?i[0].toUpperCase()+i.slice(1):i).join("").split("_").map((i,t)=>i&&t?i.toUpperCase():i).join("")}function hr(e,i){[...e.querySelectorAll(`[${_.REPEAT_ATTR}]`)].forEach(t=>{let r=t.getAttribute(_.REPEAT_ITEM_TAG_ATTR),s;if(r&&(s=window.customElements.get(r)),!s){s=class extends i.BaseComponent{constructor(){super(),r||(this.style.display="contents")}};let o=t.innerHTML;s.template=o,s.reg(r)}for(;t.firstChild;)t.firstChild.remove();let n=t.getAttribute(_.REPEAT_ATTR);i.sub(n,o=>{if(!o){for(;t.firstChild;)t.firstChild.remove();return}let l=[...t.children],a,c=u=>{u.forEach((f,m)=>{if(l[m])if(l[m].set$)setTimeout(()=>{l[m].set$(f)});else for(let p in f)l[m][p]=f[p];else{a||(a=new DocumentFragment);let p=new s;Object.assign(p.init$,f),a.appendChild(p)}}),a&&t.appendChild(a);let d=l.slice(u.length,l.length);for(let f of d)f.remove()};if(o.constructor===Array)c(o);else if(o.constructor===Object){let u=[];for(let d in o){let f=o[d];Object.defineProperty(f,"_KEY_",{value:d,enumerable:!0}),u.push(f)}c(u)}else console.warn("Symbiote repeat data type error:"),console.log(o)}),t.removeAttribute(_.REPEAT_ATTR),t.removeAttribute(_.REPEAT_ITEM_TAG_ATTR)})}var Be="__default__";function dr(e,i){if(i.shadowRoot)return;let t=[...e.querySelectorAll("slot")];if(!t.length)return;let r={};t.forEach(s=>{let n=s.getAttribute("name")||Be;r[n]={slot:s,fr:document.createDocumentFragment()}}),i.initChildren.forEach(s=>{var n;let o=Be;s instanceof Element&&s.hasAttribute("slot")&&(o=s.getAttribute("slot"),s.removeAttribute("slot")),(n=r[o])==null||n.fr.appendChild(s)}),Object.values(r).forEach(s=>{if(s.fr.childNodes.length)s.slot.parentNode.replaceChild(s.fr,s.slot);else if(s.slot.childNodes.length){let n=document.createDocumentFragment();n.append(...s.slot.childNodes),s.slot.parentNode.replaceChild(n,s.slot)}else s.slot.remove()})}function fr(e,i){[...e.querySelectorAll(`[${_.EL_REF_ATTR}]`)].forEach(t=>{let r=t.getAttribute(_.EL_REF_ATTR);i.ref[r]=t,t.removeAttribute(_.EL_REF_ATTR)})}function pr(e,i){[...e.querySelectorAll(`[${_.BIND_ATTR}]`)].forEach(t=>{let s=t.getAttribute(_.BIND_ATTR).split(";");[...t.attributes].forEach(n=>{if(n.name.startsWith("-")&&n.value){let o=ur(n.name.replace("-",""));s.push(o+":"+n.value),t.removeAttribute(n.name)}}),s.forEach(n=>{if(!n)return;let o=n.split(":").map(u=>u.trim()),l=o[0],a;l.indexOf(_.ATTR_BIND_PRFX)===0&&(a=!0,l=l.replace(_.ATTR_BIND_PRFX,""));let c=o[1].split(",").map(u=>u.trim());for(let u of c){let d;u.startsWith("!!")?(d="double",u=u.replace("!!","")):u.startsWith("!")&&(d="single",u=u.replace("!","")),i.sub(u,f=>{d==="double"?f=!!f:d==="single"&&(f=!f),a?(f==null?void 0:f.constructor)===Boolean?f?t.setAttribute(l,""):t.removeAttribute(l):t.setAttribute(l,f):Xe(t,l,f)||(t[_.SET_LATER_KEY]||(t[_.SET_LATER_KEY]=Object.create(null)),t[_.SET_LATER_KEY][l]=f)})}}),t.removeAttribute(_.BIND_ATTR)})}var Lt="{{",yt="}}",mr="skip-text";function gr(e){let i,t=[],r=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,{acceptNode:s=>{var n;return!((n=s.parentElement)!=null&&n.hasAttribute(mr))&&s.textContent.includes(Lt)&&s.textContent.includes(yt)&&1}});for(;i=r.nextNode();)t.push(i);return t}var _r=function(e,i){gr(e).forEach(r=>{let s=[],n;for(;r.textContent.includes(yt);)r.textContent.startsWith(Lt)?(n=r.textContent.indexOf(yt)+yt.length,r.splitText(n),s.push(r)):(n=r.textContent.indexOf(Lt),r.splitText(n)),r=r.nextSibling;s.forEach(o=>{let l=o.textContent.replace(Lt,"").replace(yt,"");o.textContent="",i.sub(l,a=>{o.textContent=a})})})},br=[hr,dr,fr,pr,_r],Pt="'",ft='"',yr=/\\([0-9a-fA-F]{1,6} ?)/g;function Cr(e){return(e[0]===ft||e[0]===Pt)&&(e[e.length-1]===ft||e[e.length-1]===Pt)}function Ar(e){return(e[0]===ft||e[0]===Pt)&&(e=e.slice(1)),(e[e.length-1]===ft||e[e.length-1]===Pt)&&(e=e.slice(0,-1)),e}function Er(e){let i="",t="";for(var r=0;r<e.length;r++){let s=e[r+1];e[r]==="\\"&&s==='"'?(i+='\\"',r++):e[r]==='"'&&t!=="\\"?i+='\\"':i+=e[r],t=e[r]}return i}function vr(e){let i=e;Cr(e)&&(i=Ar(i),i=i.replace(yr,(t,r)=>String.fromCodePoint(parseInt(r.trim(),16))),i=i.replaceAll(`\\
`,"\\n"),i=Er(i),i=ft+i+ft);try{return JSON.parse(i)}catch{throw new Error(`Failed to parse CSS property value: ${i}. Original input: ${e}`)}}var Ge=0,dt=null,W=null,it=class extends HTMLElement{constructor(){super(),ue(this,"updateCssData",()=>{var e;this.dropCssDataCache(),(e=this.__boundCssProps)==null||e.forEach(i=>{let t=this.getCssData(this.__extractCssName(i),!0);t!==null&&this.$[i]!==t&&(this.$[i]=t)})}),this.init$=Object.create(null),this.cssInit$=Object.create(null),this.tplProcessors=new Set,this.ref=Object.create(null),this.allSubs=new Set,this.pauseRender=!1,this.renderShadow=!1,this.readyToDestroy=!0,this.processInnerHtml=!1,this.allowCustomTemplate=!1,this.ctxOwner=!1}get BaseComponent(){return it}initCallback(){}__initCallback(){var e;this.__initialized||(this.__initialized=!0,(e=this.initCallback)==null||e.call(this))}render(e,i=this.renderShadow){let t;if((i||this.constructor.__shadowStylesUrl)&&!this.shadowRoot&&this.attachShadow({mode:"open"}),this.allowCustomTemplate){let s=this.getAttribute(_.USE_TPL);if(s){let n=this.getRootNode(),o=(n==null?void 0:n.querySelector(s))||document.querySelector(s);o?e=o.content.cloneNode(!0):console.warn(`Symbiote template "${s}" is not found...`)}}if(this.processInnerHtml)for(let s of this.tplProcessors)s(this,this);if(e||this.constructor.template){if(this.constructor.template&&!this.constructor.__tpl&&(this.constructor.__tpl=document.createElement("template"),this.constructor.__tpl.innerHTML=this.constructor.template),(e==null?void 0:e.constructor)===DocumentFragment)t=e;else if((e==null?void 0:e.constructor)===String){let s=document.createElement("template");s.innerHTML=e,t=s.content.cloneNode(!0)}else this.constructor.__tpl&&(t=this.constructor.__tpl.content.cloneNode(!0));for(let s of this.tplProcessors)s(t,this)}let r=()=>{t&&(i&&this.shadowRoot.appendChild(t)||this.appendChild(t)),this.__initCallback()};if(this.constructor.__shadowStylesUrl){i=!0;let s=document.createElement("link");s.rel="stylesheet",s.href=this.constructor.__shadowStylesUrl,s.onload=r,this.shadowRoot.prepend(s)}else r()}addTemplateProcessor(e){this.tplProcessors.add(e)}get autoCtxName(){return this.__autoCtxName||(this.__autoCtxName=Ct.generate(),this.style.setProperty(_.CSS_CTX_PROP,`'${this.__autoCtxName}'`)),this.__autoCtxName}get cssCtxName(){return this.getCssData(_.CSS_CTX_PROP,!0)}get ctxName(){var e;let i=((e=this.getAttribute(_.CTX_NAME_ATTR))==null?void 0:e.trim())||this.cssCtxName||this.__cachedCtxName||this.autoCtxName;return this.__cachedCtxName=i,i}get localCtx(){return this.__localCtx||(this.__localCtx=A.registerCtx({},this)),this.__localCtx}get nodeCtx(){return A.getCtx(this.ctxName,!1)||A.registerCtx({},this.ctxName)}static __parseProp(e,i){let t,r;if(e.startsWith(_.EXT_DATA_CTX_PRFX))t=i.nodeCtx,r=e.replace(_.EXT_DATA_CTX_PRFX,"");else if(e.includes(_.NAMED_DATA_CTX_SPLTR)){let s=e.split(_.NAMED_DATA_CTX_SPLTR);t=A.getCtx(s[0]),r=s[1]}else t=i.localCtx,r=e;return{ctx:t,name:r}}sub(e,i,t=!0){let r=n=>{this.isConnected&&i(n)},s=it.__parseProp(e,this);s.ctx.has(s.name)?this.allSubs.add(s.ctx.sub(s.name,r,t)):window.setTimeout(()=>{this.allSubs.add(s.ctx.sub(s.name,r,t))})}notify(e){let i=it.__parseProp(e,this);i.ctx.notify(i.name)}has(e){let i=it.__parseProp(e,this);return i.ctx.has(i.name)}add(e,i,t=!1){let r=it.__parseProp(e,this);r.ctx.add(r.name,i,t)}add$(e,i=!1){for(let t in e)this.add(t,e[t],i)}get $(){if(!this.__stateProxy){let e=Object.create(null);this.__stateProxy=new Proxy(e,{set:(i,t,r)=>{let s=it.__parseProp(t,this);return s.ctx.pub(s.name,r),!0},get:(i,t)=>{let r=it.__parseProp(t,this);return r.ctx.read(r.name)}})}return this.__stateProxy}set$(e,i=!1){for(let t in e){let r=e[t];i||![String,Number,Boolean].includes(r==null?void 0:r.constructor)?this.$[t]=r:this.$[t]!==r&&(this.$[t]=r)}}get __ctxOwner(){return this.ctxOwner||this.hasAttribute(_.CTX_OWNER_ATTR)&&this.getAttribute(_.CTX_OWNER_ATTR)!=="false"}__initDataCtx(){let e=this.constructor.__attrDesc;if(e)for(let i of Object.values(e))Object.keys(this.init$).includes(i)||(this.init$[i]="");for(let i in this.init$)if(i.startsWith(_.EXT_DATA_CTX_PRFX))this.nodeCtx.add(i.replace(_.EXT_DATA_CTX_PRFX,""),this.init$[i],this.__ctxOwner);else if(i.includes(_.NAMED_DATA_CTX_SPLTR)){let t=i.split(_.NAMED_DATA_CTX_SPLTR),r=t[0].trim(),s=t[1].trim();if(r&&s){let n=A.getCtx(r,!1);n||(n=A.registerCtx({},r)),n.add(s,this.init$[i])}}else this.localCtx.add(i,this.init$[i]);for(let i in this.cssInit$)this.bindCssData(i,this.cssInit$[i]);this.__dataCtxInitialized=!0}connectedCallback(){var e;if(this.isConnected){if(this.__disconnectTimeout&&window.clearTimeout(this.__disconnectTimeout),!this.connectedOnce){let i=(e=this.getAttribute(_.CTX_NAME_ATTR))==null?void 0:e.trim();if(i&&this.style.setProperty(_.CSS_CTX_PROP,`'${i}'`),this.__initDataCtx(),this[_.SET_LATER_KEY]){for(let t in this[_.SET_LATER_KEY])Xe(this,t,this[_.SET_LATER_KEY][t]);delete this[_.SET_LATER_KEY]}this.initChildren=[...this.childNodes];for(let t of br)this.addTemplateProcessor(t);if(this.pauseRender)this.__initCallback();else if(this.constructor.__rootStylesLink){let t=this.getRootNode();if(!t)return;if(t==null?void 0:t.querySelector(`link[${_.ROOT_STYLE_ATTR_NAME}="${this.constructor.is}"]`)){this.render();return}let s=this.constructor.__rootStylesLink.cloneNode(!0);s.setAttribute(_.ROOT_STYLE_ATTR_NAME,this.constructor.is),s.onload=()=>{this.render()},t.nodeType===Node.DOCUMENT_NODE?t.head.appendChild(s):t.prepend(s)}else this.render()}this.connectedOnce=!0}}destroyCallback(){}disconnectedCallback(){this.connectedOnce&&(this.dropCssDataCache(),this.readyToDestroy&&(this.__disconnectTimeout&&window.clearTimeout(this.__disconnectTimeout),this.__disconnectTimeout=window.setTimeout(()=>{this.destroyCallback();for(let e of this.allSubs)e.remove(),this.allSubs.delete(e);for(let e of this.tplProcessors)this.tplProcessors.delete(e);W==null||W.delete(this.updateCssData),W!=null&&W.size||(dt==null||dt.disconnect(),dt=null,W=null)},100)))}static reg(e,i=!1){e||(Ge++,e=`${_.AUTO_TAG_PRFX}-${Ge}`),this.__tag=e;let t=window.customElements.get(e);if(t){!i&&t!==this&&console.warn([`Element with tag name "${e}" already registered.`,`You're trying to override it with another class "${this.name}".`,"This is most likely a mistake.","New element will not be registered."].join(` `));return}window.customElements.define(e,i?class extends this{}:this)}static get is(){return this.__tag||this.reg(),this.__tag}static bindAttributes(e){this.observedAttributes=Object.keys(e),this.__attrDesc=e}attributeChangedCallback(e,i,t){var r;if(i===t)return;let s=(r=this.constructor.__attrDesc)==null?void 0:r[e];s?this.__dataCtxInitialized?this.$[s]=t:this.init$[s]=t:this[e]=t}getCssData(e,i=!1){if(this.__cssDataCache||(this.__cssDataCache=Object.create(null)),!Object.keys(this.__cssDataCache).includes(e)){this.__computedStyle||(this.__computedStyle=window.getComputedStyle(this));let t=this.__computedStyle.getPropertyValue(e).trim();try{this.__cssDataCache[e]=vr(t)}catch{!i&&console.warn(`CSS Data error: ${e}`),this.__cssDataCache[e]=null}}return this.__cssDataCache[e]}__extractCssName(e){return e.split("--").map((i,t)=>t===0?"":i).join("--")}__initStyleAttrObserver(){W||(W=new Set),W.add(this.updateCssData),dt||(dt=new MutationObserver(e=>{e[0].type==="attributes"&&W.forEach(i=>{i()})}),dt.observe(document,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["style"]}))}bindCssData(e,i=""){this.__boundCssProps||(this.__boundCssProps=new Set),this.__boundCssProps.add(e);let t=this.getCssData(this.__extractCssName(e),!0);t===null&&(t=i),this.add(e,t),this.__initStyleAttrObserver()}dropCssDataCache(){this.__cssDataCache=null,this.__computedStyle=null}defineAccessor(e,i,t){let r="__"+e;this[r]=this[e],Object.defineProperty(this,e,{set:s=>{this[r]=s,t?window.setTimeout(()=>{i==null||i(s)}):i==null||i(s)},get:()=>this[r]}),this[e]=this[r]}static set shadowStyles(e){let i=new Blob([e],{type:"text/css"});this.__shadowStylesUrl=URL.createObjectURL(i)}static set rootStyles(e){if(!this.__rootStylesLink){let i=new Blob([e],{type:"text/css"}),t=URL.createObjectURL(i),r=document.createElement("link");r.href=t,r.rel="stylesheet",this.__rootStylesLink=r}}},he=it;ue(he,"template");var ce=class{static _print(e){console.warn(e)}static setDefaultTitle(e){this.defaultTitle=e}static setRoutingMap(e){Object.assign(this.appMap,e);for(let i in this.appMap)!this.defaultRoute&&this.appMap[i].default===!0?this.defaultRoute=i:!this.errorRoute&&this.appMap[i].error===!0&&(this.errorRoute=i)}static set routingEventName(e){this.__routingEventName=e}static get routingEventName(){return this.__routingEventName||"sym-on-route"}static readAddressBar(){let e={route:null,options:{}};return window.location.search.split(this.separator).forEach(t=>{if(t.includes("?"))e.route=t.replace("?","");else if(t.includes("=")){let r=t.split("=");e.options[r[0]]=decodeURI(r[1])}else e.options[t]=!0}),e}static notify(){let e=this.readAddressBar(),i=this.appMap[e.route];if(i&&i.title&&(document.title=i.title),e.route===null&&this.defaultRoute){this.applyRoute(this.defaultRoute);return}else if(!i&&this.errorRoute){this.applyRoute(this.errorRoute);return}else if(!i&&this.defaultRoute){this.applyRoute(this.defaultRoute);return}else if(!i){this._print(`Route "${e.route}" not found...`);return}let t=new CustomEvent(ce.routingEventName,{detail:{route:e.route,options:Object.assign(i||{},e.options)}});window.dispatchEvent(t)}static reflect(e,i={}){let t=this.appMap[e];if(!t){this._print("Wrong route: "+e);return}let r="?"+e;for(let n in i)i[n]===!0?r+=this.separator+n:r+=this.separator+n+`=${i[n]}`;let s=t.title||this.defaultTitle||"";window.history.pushState(null,s,r),document.title=s}static applyRoute(e,i={}){this.reflect(e,i),this.notify()}static setSeparator(e){this._separator=e}static get separator(){return this._separator||"&"}static createRouterData(e,i){this.setRoutingMap(i);let t=A.registerCtx({route:null,options:null,title:null},e);return window.addEventListener(this.routingEventName,r=>{var s;t.multiPub({route:r.detail.route,options:r.detail.options,title:((s=r.detail.options)==null?void 0:s.title)||this.defaultTitle||""})}),ce.notify(),this.initPopstateListener(),t}static initPopstateListener(){this.__onPopstate||(this.__onPopstate=()=>{this.notify()},window.addEventListener("popstate",this.__onPopstate))}static removePopstateListener(){window.removeEventListener("popstate",this.__onPopstate),this.__onPopstate=null}};ce.appMap=Object.create(null);function qe(e,i){for(let t in i)t.includes("-")?e.style.setProperty(t,i[t]):e.style[t]=i[t]}var We="idb-store-ready",wr="symbiote-db",Tr="symbiote-idb-update_",Sr=class{_notifyWhenReady(e=null){window.dispatchEvent(new CustomEvent(We,{detail:{dbName:this.name,storeName:this.storeName,event:e}}))}get _updEventName(){return Tr+this.name}_getUpdateEvent(e){return new CustomEvent(this._updEventName,{detail:{key:this.name,newValue:e}})}_notifySubscribers(e){window.localStorage.removeItem(this.name),window.localStorage.setItem(this.name,e),window.dispatchEvent(this._getUpdateEvent(e))}constructor(e,i){this.name=e,this.storeName=i,this.version=1,this.request=window.indexedDB.open(this.name,this.version),this.request.onupgradeneeded=t=>{this.db=t.target.result,this.objStore=this.db.createObjectStore(i,{keyPath:"_key"}),this.objStore.transaction.oncomplete=r=>{this._notifyWhenReady(r)}},this.request.onsuccess=t=>{this.db=t.target.result,this._notifyWhenReady(t)},this.request.onerror=t=>{console.error(t)},this._subscriptionsMap={},this._updateHandler=t=>{t.key===this.name&&this._subscriptionsMap[t.newValue]&&this._subscriptionsMap[t.newValue].forEach(async s=>{s(await this.read(t.newValue))})},this._localUpdateHandler=t=>{this._updateHandler(t.detail)},window.addEventListener("storage",this._updateHandler),window.addEventListener(this._updEventName,this._localUpdateHandler)}read(e){let t=this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName).get(e);return new Promise((r,s)=>{t.onsuccess=n=>{var o;(o=n.target.result)!=null&&o._value?r(n.target.result._value):(r(null),console.warn(`IDB: cannot read "${e}"`))},t.onerror=n=>{s(n)}})}write(e,i,t=!1){let r={_key:e,_value:i},n=this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName).put(r);return new Promise((o,l)=>{n.onsuccess=a=>{t||this._notifySubscribers(e),o(a.target.result)},n.onerror=a=>{l(a)}})}delete(e,i=!1){let r=this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName).delete(e);return new Promise((s,n)=>{r.onsuccess=o=>{i||this._notifySubscribers(e),s(o)},r.onerror=o=>{n(o)}})}getAll(){let i=this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName).getAll();return new Promise((t,r)=>{i.onsuccess=s=>{let n=s.target.result;t(n.map(o=>o._value))},i.onerror=s=>{r(s)}})}subscribe(e,i){this._subscriptionsMap[e]||(this._subscriptionsMap[e]=new Set);let t=this._subscriptionsMap[e];return t.add(i),{remove:()=>{t.delete(i),t.size||delete this._subscriptionsMap[e]}}}stop(){window.removeEventListener("storage",this._updateHandler),this._subscriptionsMap=null,Ke.clear(this.name)}},Ke=class{static get readyEventName(){return We}static open(e=wr,i="store"){let t=e+"/"+i;return this._reg[t]||(this._reg[t]=new Sr(e,i)),this._reg[t]}static clear(e){window.indexedDB.deleteDatabase(e);for(let i in this._reg)i.split("/")[0]===e&&delete this._reg[i]}};ue(Ke,"_reg",Object.create(null));var Ye="--uploadcare-blocks-window-height",at=class{static registerClient(i){this.clientsRegistry.size===0&&this.attachTracker(),this.clientsRegistry.add(i)}static unregisterClient(i){this.clientsRegistry.delete(i),this.clientsRegistry.size===0&&this.detachTracker()}static attachTracker(){window.addEventListener("resize",this.flush,{passive:!0,capture:!0}),this.flush()}static detachTracker(){window.removeEventListener("resize",this.flush,{capture:!0}),document.documentElement.style.removeProperty(Ye)}};h(at,"clientsRegistry",new Set),h(at,"flush",N(()=>{document.documentElement.style.setProperty(Ye,`${window.innerHeight}px`)},100));var Je=e=>{var r;let i=new Intl.Locale(e),t="ltr";return typeof i.getTextInfo=="function"&&i.getTextInfo().direction?t=i.getTextInfo().direction:"textInfo"in i&&((r=i.textInfo)!=null&&r.direction)&&(t=i.textInfo.direction),t};var kt=(e,i)=>new Intl.PluralRules(e).select(i);var xr=e=>e,de="{{",Ze="}}",Qe="plural:";function fe(e,i,t={}){var o;let{openToken:r=de,closeToken:s=Ze,transform:n=xr}=t;for(let l in i){let a=(o=i[l])==null?void 0:o.toString();e=e.replaceAll(r+l+s,typeof a=="string"?n(a):a)}return e}function ti(e){let i=[],t=e.indexOf(de);for(;t!==-1;){let r=e.indexOf(Ze,t),s=e.substring(t+2,r);if(s.startsWith(Qe)){let n=e.substring(t+2,r).replace(Qe,""),o=n.substring(0,n.indexOf("(")),l=n.substring(n.indexOf("(")+1,n.indexOf(")"));i.push({variable:s,pluralKey:o,countVariable:l})}t=e.indexOf(de,r)}return i}var ei=({element:e,attribute:i,onSuccess:t,onTimeout:r,timeout:s=300})=>{let n=e.getAttribute(i);if(n!==null){t(n);return}let o=new MutationObserver(c=>{let u=c[c.length-1];a(u)});o.observe(e,{attributes:!0,attributeFilter:[i]});let l=setTimeout(()=>{o.disconnect(),r()},s),a=c=>{let u=e.getAttribute(i);c.type==="attributes"&&c.attributeName===i&&u!==null&&(clearTimeout(l),o.disconnect(),t(u))}};function ii(e){return Object.prototype.toString.call(e)==="[object Object]"}var Or=/\W|_/g;function Ir(e){return e.split(Or).map((i,t)=>i.charAt(0)[t>0?"toUpperCase":"toLowerCase"]()+i.slice(1)).join("")}function ri(e,{ignoreKeys:i}={ignoreKeys:[]}){return Array.isArray(e)?e.map(t=>J(t,{ignoreKeys:i})):e}function J(e,{ignoreKeys:i}={ignoreKeys:[]}){if(Array.isArray(e))return ri(e,{ignoreKeys:i});if(!ii(e))return e;let t={};for(let r of Object.keys(e)){let s=e[r];if(i.includes(r)){t[r]=s;continue}ii(s)?s=J(s,{ignoreKeys:i}):Array.isArray(s)&&(s=ri(s,{ignoreKeys:i})),t[Ir(r)]=s}return t}var Ur=e=>new Promise(i=>setTimeout(i,e));function Ce({libraryName:e,libraryVersion:i,userAgent:t,publicKey:r="",integration:s=""}){let n="JavaScript";if(typeof t=="string")return t;if(typeof t=="function")return t({publicKey:r,libraryName:e,libraryVersion:i,languageName:n,integration:s});let o=[e,i,r].filter(Boolean).join("/"),l=[n,s].filter(Boolean).join("; ");return`${o} (${l})`}var Lr={factor:2,time:100};function Pr(e,i=Lr){let t=0;function r(s){let n=Math.round(i.time*i.factor**t);return s({attempt:t,retry:l=>Ur(l!=null?l:n).then(()=>(t+=1,r(s)))})}return r(e)}var At=class extends Error{},pt=class e extends At{constructor(t){super();h(this,"originalProgressEvent");this.name="NetworkError",this.message="Network error",Object.setPrototypeOf(this,e.prototype),this.originalProgressEvent=t}},Mt=(e,i)=>{e&&(e.aborted?Promise.resolve().then(i):e.addEventListener("abort",()=>i(),{once:!0}))},rt=class e extends At{constructor(t="Request canceled"){super(t);h(this,"isCancel",!0);this.name="CancelError",Object.setPrototypeOf(this,e.prototype)}},kr=500,ni=({check:e,interval:i=kr,timeout:t,signal:r})=>new Promise((s,n)=>{let o,l;Mt(r,()=>{o&&clearTimeout(o),n(new rt("Poll cancelled"))}),t&&(l=setTimeout(()=>{o&&clearTimeout(o),n(new rt("Timed out"))},t));let a=()=>{try{Promise.resolve(e(r)).then(c=>{c?(l&&clearTimeout(l),s(c)):o=setTimeout(a,i)}).catch(c=>{l&&clearTimeout(l),n(c)})}catch(c){l&&clearTimeout(l),n(c)}};o=setTimeout(a,0)}),C={baseCDN:"https://ucarecdn.com",baseURL:"https://upload.uploadcare.com",maxContentLength:50*1024*1024,retryThrottledRequestMaxTimes:1,retryNetworkErrorMaxTimes:3,multipartMinFileSize:25*1024*1024,multipartChunkSize:5*1024*1024,multipartMinLastPartSize:1024*1024,maxConcurrentRequests:4,pollingTimeoutMilliseconds:1e4,pusherKey:"79ae88bd931ea68464d9"},Dt="application/octet-stream",oi="original",st=({method:e,url:i,data:t,headers:r={},signal:s,onProgress:n})=>new Promise((o,l)=>{let a=new XMLHttpRequest,c=(e==null?void 0:e.toUpperCase())||"GET",u=!1;a.open(c,i,!0),r&&Object.entries(r).forEach(d=>{let[f,m]=d;typeof m!="undefined"&&!Array.isArray(m)&&a.setRequestHeader(f,m)}),a.responseType="text",Mt(s,()=>{u=!0,a.abort(),l(new rt)}),a.onload=()=>{if(a.status!=200)l(new Error(`Error ${a.status}: ${a.statusText}`));else{let d={method:c,url:i,data:t,headers:r||void 0,signal:s,onProgress:n},f=a.getAllResponseHeaders().trim().split(/[\r\n]+/),m={};f.forEach(function(E){let v=E.split(": "),y=v.shift(),b=v.join(": ");y&&typeof y!="undefined"&&(m[y]=b)});let p=a.response,g=a.status;o({request:d,data:p,headers:m,status:g})}},a.onerror=d=>{u||l(new pt(d))},n&&typeof n=="function"&&(a.upload.onprogress=d=>{d.lengthComputable?n({isComputable:!0,value:d.loaded/d.total}):n({isComputable:!1})}),t?a.send(t):a.send()});function Rr(e,...i){return e}var Mr=({name:e})=>e?[e]:[],Dr=Rr,Fr=()=>new FormData,li=e=>!1,Ft=e=>typeof Blob!="undefined"&&e instanceof Blob,$t=e=>typeof File!="undefined"&&e instanceof File,Nt=e=>!!e&&typeof e=="object"&&!Array.isArray(e)&&"uri"in e&&typeof e.uri=="string",mt=e=>Ft(e)||$t(e)||li()||Nt(e),$r=e=>typeof e=="string"||typeof e=="number"||typeof e=="undefined",Nr=e=>!!e&&typeof e=="object"&&!Array.isArray(e),Vr=e=>!!e&&typeof e=="object"&&"data"in e&&mt(e.data);function ai(e,i,t){if(Array.isArray(t))for(let r of t)ai(e,`${i}[]`,r);else if(Vr(t)){let{name:r,contentType:s}=t,n=Dr(t.data,r,s!=null?s:Dt),o=Mr({name:r,contentType:s});e.push([i,n,...o])}else if(Nr(t))for(let[r,s]of Object.entries(t))typeof s!="undefined"&&e.push([`${i}[${r}]`,String(s)]);else $r(t)&&t&&e.push([i,t.toString()])}function zr(e){let i=[];for(let[t,r]of Object.entries(e))ai(i,t,r);return i}function Vt(e){let i=Fr(),t=zr(e);for(let r of t){let[s,n,...o]=r;i.append(s,n,...o)}return i}var L=class e extends At{constructor(t,r,s,n,o){super();h(this,"code");h(this,"request");h(this,"response");h(this,"headers");this.name="UploadError",this.message=t,this.code=r,this.request=s,this.response=n,this.headers=o,Object.setPrototypeOf(this,e.prototype)}},jr=e=>{let i=new URLSearchParams;for(let[t,r]of Object.entries(e))r&&typeof r=="object"&&!Array.isArray(r)?Object.entries(r).filter(s=>{var n;return(n=s[1])!=null?n:!1}).forEach(s=>i.set(`${t}[${s[0]}]`,String(s[1]))):Array.isArray(r)?r.forEach(s=>{i.append(`${t}[]`,s)}):typeof r=="string"&&r?i.set(t,r):typeof r=="number"&&i.set(t,r.toString());return i.toString()},K=(e,i,t)=>{let r=new URL(e);return r.pathname=(r.pathname+i).replace("//","/"),t&&(r.search=jr(t)),r.toString()},Br="6.14.1",Gr="UploadcareUploadClient",Hr=Br;function ct(e){return Ce({libraryName:Gr,libraryVersion:Hr,...e})}var Xr="RequestThrottledError",si=15e3,qr=1e3;function Wr(e){let{headers:i}=e||{};if(!i||typeof i["retry-after"]!="string")return si;let t=parseInt(i["retry-after"],10);return Number.isFinite(t)?t*1e3:si}function nt(e,i){let{retryThrottledRequestMaxTimes:t,retryNetworkErrorMaxTimes:r}=i;return Pr(({attempt:s,retry:n})=>e().catch(o=>{if("response"in o&&(o==null?void 0:o.code)===Xr&&s<t)return n(Wr(o));if(o instanceof pt&&s<r)return n((s+1)*qr);throw o}))}var ci=e=>{let i="";return(Ft(e)||$t(e)||Nt(e))&&(i=e.type),i||Dt},ui=e=>{let i="";return $t(e)&&e.name?i=e.name:Ft(e)||li()?i="":Nt(e)&&e.name&&(i=e.name),i||oi};function Ae(e){return typeof e=="undefined"||e==="auto"?"auto":e?"1":"0"}function Kr(e,{publicKey:i,fileName:t,contentType:r,baseURL:s=C.baseURL,secureSignature:n,secureExpire:o,store:l,signal:a,onProgress:c,source:u="local",integration:d,userAgent:f,retryThrottledRequestMaxTimes:m=C.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:p=C.retryNetworkErrorMaxTimes,metadata:g}){return nt(()=>st({method:"POST",url:K(s,"/base/",{jsonerrors:1}),headers:{"X-UC-User-Agent":ct({publicKey:i,integration:d,userAgent:f})},data:Vt({file:{data:e,name:t||ui(e),contentType:r||ci(e)},UPLOADCARE_PUB_KEY:i,UPLOADCARE_STORE:Ae(l),signature:n,expire:o,source:u,metadata:g}),signal:a,onProgress:c}).then(({data:E,headers:v,request:y})=>{let b=J(JSON.parse(E));if("error"in b)throw new L(b.error.content,b.error.errorCode,y,b,v);return b}),{retryNetworkErrorMaxTimes:p,retryThrottledRequestMaxTimes:m})}var ge;(function(e){e.Token="token",e.FileInfo="file_info"})(ge||(ge={}));function Yr(e,{publicKey:i,baseURL:t=C.baseURL,store:r,fileName:s,checkForUrlDuplicates:n,saveUrlForRecurrentUploads:o,secureSignature:l,secureExpire:a,source:c="url",signal:u,integration:d,userAgent:f,retryThrottledRequestMaxTimes:m=C.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:p=C.retryNetworkErrorMaxTimes,metadata:g}){return nt(()=>st({method:"POST",headers:{"X-UC-User-Agent":ct({publicKey:i,integration:d,userAgent:f})},url:K(t,"/from_url/",{jsonerrors:1,pub_key:i,source_url:e,store:Ae(r),filename:s,check_URL_duplicates:n?1:void 0,save_URL_duplicates:o?1:void 0,signature:l,expire:a,source:c,metadata:g}),signal:u}).then(({data:E,headers:v,request:y})=>{let b=J(JSON.parse(E));if("error"in b)throw new L(b.error.content,b.error.errorCode,y,b,v);return b}),{retryNetworkErrorMaxTimes:p,retryThrottledRequestMaxTimes:m})}var M;(function(e){e.Unknown="unknown",e.Waiting="waiting",e.Progress="progress",e.Error="error",e.Success="success"})(M||(M={}));var Jr=e=>"status"in e&&e.status===M.Error;function Qr(e,{publicKey:i,baseURL:t=C.baseURL,signal:r,integration:s,userAgent:n,retryThrottledRequestMaxTimes:o=C.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:l=C.retryNetworkErrorMaxTimes}={}){return nt(()=>st({method:"GET",headers:i?{"X-UC-User-Agent":ct({publicKey:i,integration:s,userAgent:n})}:void 0,url:K(t,"/from_url/status/",{jsonerrors:1,token:e}),signal:r}).then(({data:a,headers:c,request:u})=>{let d=J(JSON.parse(a));if("error"in d&&!Jr(d))throw new L(d.error.content,d.error.errorCode,u,d,c);return d}),{retryNetworkErrorMaxTimes:l,retryThrottledRequestMaxTimes:o})}function Zr(e,{publicKey:i,baseURL:t=C.baseURL,jsonpCallback:r,secureSignature:s,secureExpire:n,signal:o,source:l,integration:a,userAgent:c,retryThrottledRequestMaxTimes:u=C.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:d=C.retryNetworkErrorMaxTimes}){return nt(()=>st({method:"POST",headers:{"X-UC-User-Agent":ct({publicKey:i,integration:a,userAgent:c})},url:K(t,"/group/",{jsonerrors:1}),data:Vt({files:e,callback:r,pub_key:i,signature:s,expire:n,source:l}),signal:o}).then(({data:f,headers:m,request:p})=>{let g=J(JSON.parse(f));if("error"in g)throw new L(g.error.content,g.error.errorCode,p,g,m);return g}),{retryNetworkErrorMaxTimes:d,retryThrottledRequestMaxTimes:u})}function hi(e,{publicKey:i,baseURL:t=C.baseURL,signal:r,source:s,integration:n,userAgent:o,retryThrottledRequestMaxTimes:l=C.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:a=C.retryNetworkErrorMaxTimes}){return nt(()=>st({method:"GET",headers:{"X-UC-User-Agent":ct({publicKey:i,integration:n,userAgent:o})},url:K(t,"/info/",{jsonerrors:1,pub_key:i,file_id:e,source:s}),signal:r}).then(({data:c,headers:u,request:d})=>{let f=J(JSON.parse(c));if("error"in f)throw new L(f.error.content,f.error.errorCode,d,f,u);return f}),{retryThrottledRequestMaxTimes:l,retryNetworkErrorMaxTimes:a})}function ts(e,{publicKey:i,contentType:t,fileName:r,multipartChunkSize:s=C.multipartChunkSize,baseURL:n="",secureSignature:o,secureExpire:l,store:a,signal:c,source:u="local",integration:d,userAgent:f,retryThrottledRequestMaxTimes:m=C.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:p=C.retryNetworkErrorMaxTimes,metadata:g}){return nt(()=>st({method:"POST",url:K(n,"/multipart/start/",{jsonerrors:1}),headers:{"X-UC-User-Agent":ct({publicKey:i,integration:d,userAgent:f})},data:Vt({filename:r||oi,size:e,content_type:t||Dt,part_size:s,UPLOADCARE_STORE:Ae(a),UPLOADCARE_PUB_KEY:i,signature:o,expire:l,source:u,metadata:g}),signal:c}).then(({data:E,headers:v,request:y})=>{let b=J(JSON.parse(E));if("error"in b)throw new L(b.error.content,b.error.errorCode,y,b,v);return b.parts=Object.keys(b.parts).map(k=>b.parts[Number(k)]),b}),{retryThrottledRequestMaxTimes:m,retryNetworkErrorMaxTimes:p})}function es(e,i,{contentType:t,signal:r,onProgress:s,retryThrottledRequestMaxTimes:n=C.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:o=C.retryNetworkErrorMaxTimes}){return nt(()=>st({method:"PUT",url:i,data:e,onProgress:s,signal:r,headers:{"Content-Type":t||Dt}}).then(l=>(s&&s({isComputable:!0,value:1}),l)).then(({status:l})=>({code:l})),{retryThrottledRequestMaxTimes:n,retryNetworkErrorMaxTimes:o})}function is(e,{publicKey:i,baseURL:t=C.baseURL,source:r="local",signal:s,integration:n,userAgent:o,retryThrottledRequestMaxTimes:l=C.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:a=C.retryNetworkErrorMaxTimes}){return nt(()=>st({method:"POST",url:K(t,"/multipart/complete/",{jsonerrors:1}),headers:{"X-UC-User-Agent":ct({publicKey:i,integration:n,userAgent:o})},data:Vt({uuid:e,UPLOADCARE_PUB_KEY:i,source:r}),signal:s}).then(({data:c,headers:u,request:d})=>{let f=J(JSON.parse(c));if("error"in f)throw new L(f.error.content,f.error.errorCode,d,f,u);return f}),{retryThrottledRequestMaxTimes:l,retryNetworkErrorMaxTimes:a})}function Ee(e,{publicKey:i,baseURL:t,source:r,integration:s,userAgent:n,retryThrottledRequestMaxTimes:o,retryNetworkErrorMaxTimes:l,signal:a,onProgress:c}){return ni({check:u=>hi(e,{publicKey:i,baseURL:t,signal:u,source:r,integration:s,userAgent:n,retryThrottledRequestMaxTimes:o,retryNetworkErrorMaxTimes:l}).then(d=>d.isReady?d:(c&&c({isComputable:!0,value:1}),!1)),signal:a})}function rs(e){return"defaultEffects"in e}var Y=class{constructor(i,{baseCDN:t=C.baseCDN,fileName:r}={}){h(this,"uuid");h(this,"name",null);h(this,"size",null);h(this,"isStored",null);h(this,"isImage",null);h(this,"mimeType",null);h(this,"cdnUrl",null);h(this,"s3Url",null);h(this,"originalFilename",null);h(this,"imageInfo",null);h(this,"videoInfo",null);h(this,"contentInfo",null);h(this,"metadata",null);h(this,"s3Bucket",null);h(this,"defaultEffects",null);let{uuid:s,s3Bucket:n}=i,o=K(t,`${s}/`),l=n?K(`https://${n}.s3.amazonaws.com/`,`${s}/${i.filename}`):null;this.uuid=s,this.name=r||i.filename,this.size=i.size,this.isStored=i.isStored,this.isImage=i.isImage,this.mimeType=i.mimeType,this.cdnUrl=o,this.originalFilename=i.originalFilename,this.imageInfo=i.imageInfo,this.videoInfo=i.videoInfo,this.contentInfo=i.contentInfo,this.metadata=i.metadata||null,this.s3Bucket=n||null,this.s3Url=l,rs(i)&&(this.defaultEffects=i.defaultEffects)}},ss=(e,{publicKey:i,fileName:t,baseURL:r,secureSignature:s,secureExpire:n,store:o,contentType:l,signal:a,onProgress:c,source:u,integration:d,userAgent:f,retryThrottledRequestMaxTimes:m,retryNetworkErrorMaxTimes:p,baseCDN:g,metadata:E})=>Kr(e,{publicKey:i,fileName:t,contentType:l,baseURL:r,secureSignature:s,secureExpire:n,store:o,signal:a,onProgress:c,source:u,integration:d,userAgent:f,retryThrottledRequestMaxTimes:m,retryNetworkErrorMaxTimes:p,metadata:E}).then(({file:v})=>Ee(v,{publicKey:i,baseURL:r,source:u,integration:d,userAgent:f,retryThrottledRequestMaxTimes:m,retryNetworkErrorMaxTimes:p,onProgress:c,signal:a})).then(v=>new Y(v,{baseCDN:g})),ns=(e,{publicKey:i,fileName:t,baseURL:r,signal:s,onProgress:n,source:o,integration:l,userAgent:a,retryThrottledRequestMaxTimes:c,retryNetworkErrorMaxTimes:u,baseCDN:d})=>hi(e,{publicKey:i,baseURL:r,signal:s,source:o,integration:l,userAgent:a,retryThrottledRequestMaxTimes:c,retryNetworkErrorMaxTimes:u}).then(f=>new Y(f,{baseCDN:d,fileName:t})).then(f=>(n&&n({isComputable:!0,value:1}),f)),os=(e,{signal:i}={})=>{let t=null,r=null,s=e.map(()=>new AbortController),n=o=>()=>{r=o,s.forEach((l,a)=>a!==o&&l.abort())};return Mt(i,()=>{s.forEach(o=>o.abort())}),Promise.all(e.map((o,l)=>{let a=n(l);return Promise.resolve().then(()=>o({stopRace:a,signal:s[l].signal})).then(c=>(a(),c)).catch(c=>(t=c,null))})).then(o=>{if(r===null)throw t;return o[r]})},ls=window.WebSocket,_e=class{constructor(){h(this,"events",Object.create({}))}emit(i,t){var r;(r=this.events[i])==null||r.forEach(s=>s(t))}on(i,t){this.events[i]=this.events[i]||[],this.events[i].push(t)}off(i,t){t?this.events[i]=this.events[i].filter(r=>r!==t):this.events[i]=[]}},as=(e,i)=>e==="success"?{status:M.Success,...i}:e==="progress"?{status:M.Progress,...i}:{status:M.Error,...i},be=class{constructor(i,t=3e4){h(this,"key");h(this,"disconnectTime");h(this,"ws");h(this,"queue",[]);h(this,"isConnected",!1);h(this,"subscribers",0);h(this,"emmitter",new _e);h(this,"disconnectTimeoutId",null);this.key=i,this.disconnectTime=t}connect(){if(this.disconnectTimeoutId&&clearTimeout(this.disconnectTimeoutId),!this.isConnected&&!this.ws){let i=`wss://ws.pusherapp.com/app/${this.key}?protocol=5&client=js&version=1.12.2`;this.ws=new ls(i),this.ws.addEventListener("error",t=>{this.emmitter.emit("error",new Error(t.message))}),this.emmitter.on("connected",()=>{this.isConnected=!0,this.queue.forEach(t=>this.send(t.event,t.data)),this.queue=[]}),this.ws.addEventListener("message",t=>{let r=JSON.parse(t.data.toString());switch(r.event){case"pusher:connection_established":{this.emmitter.emit("connected",void 0);break}case"pusher:ping":{this.send("pusher:pong",{});break}case"progress":case"success":case"fail":this.emmitter.emit(r.channel,as(r.event,JSON.parse(r.data)))}})}}disconnect(){let i=()=>{var t;(t=this.ws)==null||t.close(),this.ws=void 0,this.isConnected=!1};this.disconnectTime?this.disconnectTimeoutId=setTimeout(()=>{i()},this.disconnectTime):i()}send(i,t){var s;let r=JSON.stringify({event:i,data:t});(s=this.ws)==null||s.send(r)}subscribe(i,t){this.subscribers+=1,this.connect();let r=`task-status-${i}`,s={event:"pusher:subscribe",data:{channel:r}};this.emmitter.on(r,t),this.isConnected?this.send(s.event,s.data):this.queue.push(s)}unsubscribe(i){this.subscribers-=1;let t=`task-status-${i}`,r={event:"pusher:unsubscribe",data:{channel:t}};this.emmitter.off(t),this.isConnected?this.send(r.event,r.data):this.queue=this.queue.filter(s=>s.data.channel!==t),this.subscribers===0&&this.disconnect()}onError(i){return this.emmitter.on("error",i),()=>this.emmitter.off("error",i)}},pe=null,ve=e=>{if(!pe){let i=typeof window=="undefined"?0:3e4;pe=new be(e,i)}return pe},cs=e=>{ve(e).connect()};function us({token:e,publicKey:i,baseURL:t,integration:r,userAgent:s,retryThrottledRequestMaxTimes:n,retryNetworkErrorMaxTimes:o,onProgress:l,signal:a}){return ni({check:c=>Qr(e,{publicKey:i,baseURL:t,integration:r,userAgent:s,retryThrottledRequestMaxTimes:n,retryNetworkErrorMaxTimes:o,signal:c}).then(u=>{switch(u.status){case M.Error:return new L(u.error,u.errorCode);case M.Waiting:return!1;case M.Unknown:return new L(`Token "${e}" was not found.`);case M.Progress:return l&&(u.total==="unknown"?l({isComputable:!1}):l({isComputable:!0,value:u.done/u.total})),!1;case M.Success:return l&&l({isComputable:!0,value:u.done/u.total}),u;default:throw new Error("Unknown status")}}),signal:a})}var hs=({token:e,pusherKey:i,signal:t,onProgress:r})=>new Promise((s,n)=>{let o=ve(i),l=o.onError(n),a=()=>{l(),o.unsubscribe(e)};Mt(t,()=>{a(),n(new rt("pusher cancelled"))}),o.subscribe(e,c=>{switch(c.status){case M.Progress:{r&&(c.total==="unknown"?r({isComputable:!1}):r({isComputable:!0,value:c.done/c.total}));break}case M.Success:{a(),r&&r({isComputable:!0,value:c.done/c.total}),s(c);break}case M.Error:a(),n(new L(c.msg,c.error_code))}})}),ds=(e,{publicKey:i,fileName:t,baseURL:r,baseCDN:s,checkForUrlDuplicates:n,saveUrlForRecurrentUploads:o,secureSignature:l,secureExpire:a,store:c,signal:u,onProgress:d,source:f,integration:m,userAgent:p,retryThrottledRequestMaxTimes:g,pusherKey:E=C.pusherKey,metadata:v})=>Promise.resolve(cs(E)).then(()=>Yr(e,{publicKey:i,fileName:t,baseURL:r,checkForUrlDuplicates:n,saveUrlForRecurrentUploads:o,secureSignature:l,secureExpire:a,store:c,signal:u,source:f,integration:m,userAgent:p,retryThrottledRequestMaxTimes:g,metadata:v})).catch(y=>{let b=ve(E);return b==null||b.disconnect(),Promise.reject(y)}).then(y=>y.type===ge.FileInfo?y:os([({signal:b})=>us({token:y.token,publicKey:i,baseURL:r,integration:m,userAgent:p,retryThrottledRequestMaxTimes:g,onProgress:d,signal:b}),({signal:b})=>hs({token:y.token,pusherKey:E,signal:b,onProgress:d})],{signal:u})).then(y=>{if(y instanceof L)throw y;return y}).then(y=>Ee(y.uuid,{publicKey:i,baseURL:r,integration:m,userAgent:p,retryThrottledRequestMaxTimes:g,onProgress:d,signal:u})).then(y=>new Y(y,{baseCDN:s})),me=new WeakMap,fs=async e=>{if(me.has(e))return me.get(e);let i=await fetch(e.uri).then(t=>t.blob());return me.set(e,i),i},di=async e=>{if($t(e)||Ft(e))return e.size;if(Nt(e))return(await fs(e)).size;throw new Error("Unknown file type. Cannot determine file size.")},ps=(e,i=C.multipartMinFileSize)=>e>=i,fi=e=>{let i="[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}",t=new RegExp(i);return!mt(e)&&t.test(e)},we=e=>{let i="^(?:\\w+:)?\\/\\/([^\\s\\.]+\\.\\S{2}|localhost[\\:?\\d]*)\\S*$",t=new RegExp(i);return!mt(e)&&t.test(e)},ms=(e,i)=>new Promise((t,r)=>{let s=[],n=!1,o=i.length,l=[...i],a=()=>{let c=i.length-l.length,u=l.shift();u&&u().then(d=>{n||(s[c]=d,o-=1,o?a():t(s))}).catch(d=>{n=!0,r(d)})};for(let c=0;c<e;c++)a()}),gs=(e,i,t,r)=>{let s=r*i,n=Math.min(s+r,t);return e.slice(s,n)},_s=async(e,i,t)=>r=>gs(e,r,i,t),bs=(e,i,{publicKey:t,contentType:r,onProgress:s,signal:n,integration:o,retryThrottledRequestMaxTimes:l,retryNetworkErrorMaxTimes:a})=>es(e,i,{publicKey:t,contentType:r,onProgress:s,signal:n,integration:o,retryThrottledRequestMaxTimes:l,retryNetworkErrorMaxTimes:a}),ys=async(e,{publicKey:i,fileName:t,fileSize:r,baseURL:s,secureSignature:n,secureExpire:o,store:l,signal:a,onProgress:c,source:u,integration:d,userAgent:f,retryThrottledRequestMaxTimes:m,retryNetworkErrorMaxTimes:p,contentType:g,multipartChunkSize:E=C.multipartChunkSize,maxConcurrentRequests:v=C.maxConcurrentRequests,baseCDN:y,metadata:b})=>{let k=r!=null?r:await di(e),X,lt=(x,R)=>{if(!c)return;X||(X=Array(x).fill(0));let $=z=>z.reduce((q,le)=>q+le,0);return z=>{z.isComputable&&(X[R]=z.value,c({isComputable:!0,value:$(X)/x}))}};return g||(g=ci(e)),ts(k,{publicKey:i,contentType:g,fileName:t||ui(e),baseURL:s,secureSignature:n,secureExpire:o,store:l,signal:a,source:u,integration:d,userAgent:f,retryThrottledRequestMaxTimes:m,retryNetworkErrorMaxTimes:p,metadata:b}).then(async({uuid:x,parts:R})=>{let $=await _s(e,k,E);return Promise.all([x,ms(v,R.map((z,q)=>()=>bs($(q),z,{publicKey:i,contentType:g,onProgress:lt(R.length,q),signal:a,integration:d,retryThrottledRequestMaxTimes:m,retryNetworkErrorMaxTimes:p})))])}).then(([x])=>is(x,{publicKey:i,baseURL:s,source:u,integration:d,userAgent:f,retryThrottledRequestMaxTimes:m,retryNetworkErrorMaxTimes:p})).then(x=>x.isReady?x:Ee(x.uuid,{publicKey:i,baseURL:s,source:u,integration:d,userAgent:f,retryThrottledRequestMaxTimes:m,retryNetworkErrorMaxTimes:p,onProgress:c,signal:a})).then(x=>new Y(x,{baseCDN:y}))};async function Te(e,{publicKey:i,fileName:t,baseURL:r=C.baseURL,secureSignature:s,secureExpire:n,store:o,signal:l,onProgress:a,source:c,integration:u,userAgent:d,retryThrottledRequestMaxTimes:f,retryNetworkErrorMaxTimes:m,contentType:p,multipartMinFileSize:g,multipartChunkSize:E,maxConcurrentRequests:v,baseCDN:y=C.baseCDN,checkForUrlDuplicates:b,saveUrlForRecurrentUploads:k,pusherKey:X,metadata:lt}){if(mt(e)){let x=await di(e);return ps(x,g)?ys(e,{publicKey:i,contentType:p,multipartChunkSize:E,fileSize:x,fileName:t,baseURL:r,secureSignature:s,secureExpire:n,store:o,signal:l,onProgress:a,source:c,integration:u,userAgent:d,maxConcurrentRequests:v,retryThrottledRequestMaxTimes:f,retryNetworkErrorMaxTimes:m,baseCDN:y,metadata:lt}):ss(e,{publicKey:i,fileName:t,contentType:p,baseURL:r,secureSignature:s,secureExpire:n,store:o,signal:l,onProgress:a,source:c,integration:u,userAgent:d,retryThrottledRequestMaxTimes:f,retryNetworkErrorMaxTimes:m,baseCDN:y,metadata:lt})}if(we(e))return ds(e,{publicKey:i,fileName:t,baseURL:r,baseCDN:y,checkForUrlDuplicates:b,saveUrlForRecurrentUploads:k,secureSignature:s,secureExpire:n,store:o,signal:l,onProgress:a,source:c,integration:u,userAgent:d,retryThrottledRequestMaxTimes:f,retryNetworkErrorMaxTimes:m,pusherKey:X,metadata:lt});if(fi(e))return ns(e,{publicKey:i,fileName:t,baseURL:r,signal:l,onProgress:a,source:c,integration:u,userAgent:d,retryThrottledRequestMaxTimes:f,retryNetworkErrorMaxTimes:m,baseCDN:y});throw new TypeError(`File uploading from "${e}" is not supported`)}var ye=class{constructor(i,{baseCDN:t=C.baseCDN}={}){h(this,"uuid");h(this,"filesCount");h(this,"totalSize");h(this,"isStored");h(this,"isImage");h(this,"cdnUrl");h(this,"files");h(this,"createdAt");h(this,"storedAt",null);this.uuid=i.id,this.filesCount=i.filesCount;let r=i.files.filter(Boolean);this.totalSize=Object.values(r).reduce((s,n)=>s+n.size,0),this.isStored=!!i.datetimeStored,this.isImage=!!Object.values(r).filter(s=>s.isImage).length,this.cdnUrl=i.cdnUrl,this.files=r.map(s=>new Y(s,{baseCDN:t})),this.createdAt=i.datetimeCreated,this.storedAt=i.datetimeStored}},Cs=e=>{for(let i of e)if(!mt(i))return!1;return!0},As=e=>{for(let i of e)if(!fi(i))return!1;return!0},Es=e=>{for(let i of e)if(!we(i))return!1;return!0};function pi(e,{publicKey:i,fileName:t,baseURL:r=C.baseURL,secureSignature:s,secureExpire:n,store:o,signal:l,onProgress:a,source:c,integration:u,userAgent:d,retryThrottledRequestMaxTimes:f,retryNetworkErrorMaxTimes:m,contentType:p,multipartChunkSize:g=C.multipartChunkSize,baseCDN:E=C.baseCDN,checkForUrlDuplicates:v,saveUrlForRecurrentUploads:y,jsonpCallback:b}){if(!Cs(e)&&!Es(e)&&!As(e))throw new TypeError(`Group uploading from "${e}" is not supported`);let k,X=!0,lt=e.length,x=(R,$)=>{if(!a)return;k||(k=Array(R).fill(0));let z=q=>q.reduce((le,er)=>le+er)/R;return q=>{if(!q.isComputable||!X){X=!1,a({isComputable:!1});return}k[$]=q.value,a({isComputable:!0,value:z(k)})}};return Promise.all(e.map((R,$)=>mt(R)||we(R)?Te(R,{publicKey:i,fileName:t,baseURL:r,secureSignature:s,secureExpire:n,store:o,signal:l,onProgress:x(lt,$),source:c,integration:u,userAgent:d,retryThrottledRequestMaxTimes:f,retryNetworkErrorMaxTimes:m,contentType:p,multipartChunkSize:g,baseCDN:E,checkForUrlDuplicates:v,saveUrlForRecurrentUploads:y}).then(z=>z.uuid):R)).then(R=>Zr(R,{publicKey:i,baseURL:r,jsonpCallback:b,secureSignature:s,secureExpire:n,signal:l,source:c,integration:u,userAgent:d,retryThrottledRequestMaxTimes:f,retryNetworkErrorMaxTimes:m}).then($=>new ye($,{baseCDN:E})).then($=>(a&&a({isComputable:!0,value:1}),$)))}var Rt=class{constructor(i){h(this,"_concurrency",1);h(this,"_pending",[]);h(this,"_running",0);h(this,"_resolvers",new Map);h(this,"_rejectors",new Map);this._concurrency=i}_run(){let i=this._concurrency-this._running;for(let t=0;t<i;t++){let r=this._pending.shift();if(!r)return;let s=this._resolvers.get(r),n=this._rejectors.get(r);if(!s||!n)throw new Error("Unexpected behavior: resolver or rejector is undefined");this._running+=1,r().finally(()=>{this._resolvers.delete(r),this._rejectors.delete(r),this._running-=1,this._run()}).then(o=>s(o)).catch(o=>n(o))}}add(i){return new Promise((t,r)=>{this._resolvers.set(i,t),this._rejectors.set(i,r),this._pending.push(i),this._run()})}get pending(){return this._pending.length}get running(){return this._running}set concurrency(i){this._concurrency=i,this._run()}get concurrency(){return this._concurrency}};var Se=()=>({}),xe=e=>({...Se(),"*currentActivity":"","*currentActivityParams":{},"*history":[],"*historyBack":null,"*closeModal":()=>{e.set$({"*modalActive":!1,"*currentActivity":""})}}),zt=e=>({...xe(e),"*commonProgress":0,"*uploadList":[],"*focusedEntry":null,"*uploadMetadata":null,"*uploadQueue":new Rt(1),"*uploadCollection":null,"*collectionErrors":[],"*collectionState":null,"*groupInfo":null,"*uploadTrigger":new Set});var Q=e=>`*l10n/${e}`,vs="en",jt=class{constructor(i){h(this,"_blockInstance",null);h(this,"_localeName","");h(this,"_callbacks",new Set);h(this,"_boundBlocks",new Map);this._blockInstance=i;for(let[t,r]of Object.entries(bt))this._blockInstance.add(Q(t),r,!1);setTimeout(()=>{i.subConfigValue("localeName",async t=>{var n;if(!this._blockInstance||!t)return;this._localeName=t;let r=await je(t);if(t!==vs&&this._localeName!==t)return;let s=(n=this._blockInstance.cfg.localeDefinitionOverride)==null?void 0:n[t];for(let[o,l]of Object.entries(r)){let a=s==null?void 0:s[o];this._blockInstance.add(Q(o),a!=null?a:l,!0);for(let c of this._callbacks)c()}}),i.subConfigValue("localeDefinitionOverride",t=>{var s;if(!t)return;let r=t[this._localeName];if(r)for(let[n,o]of Object.entries(r)){(s=this._blockInstance)==null||s.add(Q(n),o,!0);for(let l of this._callbacks)l()}})})}onLocaleChange(i){let t=N(i,0);return this._callbacks.add(t),()=>{this._callbacks.delete(t)}}bindL10n(i,t,r){var n,o,l;i.$[t]=r(),this._boundBlocks.has(i)||this._boundBlocks.set(i,new Map),(o=(n=this._boundBlocks.get(i))==null?void 0:n.get(t))==null||o();let s=this.onLocaleChange(()=>{i.$[t]=r()});(l=this._boundBlocks.get(i))==null||l.set(t,s)}destroyL10nBindings(i){let t=this._boundBlocks.get(i);if(t){for(let r of t.values())r();this._boundBlocks.delete(i)}}destroy(){this._callbacks.clear()}};function mi(e,i){[...e.querySelectorAll("[l10n]")].forEach(t=>{let r=t.getAttribute("l10n");if(!r)return;let s="textContent",n=!1;if(r.includes(":")){let a=r.split(":");s=a[0],r=a[1],s.startsWith("@")&&(s=s.slice(1),n=!0)}let o=r;i.has(o)&&i.sub(o,a=>{if(!a)return;i.l10nProcessorSubs.has(o)||i.l10nProcessorSubs.set(o,new Set);let c=i.l10nProcessorSubs.get(o);c==null||c.forEach(f=>{f.remove(),c.delete(f),i.allSubs.delete(f)});let u=Q(a).replace("*","");i.nodeCtx.has(u)||i.nodeCtx.add(u,a);let d=i.nodeCtx.sub(u,()=>{t[s]=i.l10n(a)});c==null||c.add(d),i.allSubs.add(d),t.removeAttribute("l10n")});let l=Q(r);i.has(l)||i.add(l,""),i.sub(l,()=>{r=r,n?t.setAttribute(s,i.l10n(r)):t[s]=i.l10n(r)}),t.removeAttribute("l10n")})}var D=e=>`*cfg/${e}`;var gi="blocks",_i="0.39.1";var ws=e=>{if(typeof e!="string"||!e)return"";let i=e.trim();return i.startsWith("-/")?i=i.slice(2):i.startsWith("/")&&(i=i.slice(1)),i.endsWith("/")&&(i=i.slice(0,i.length-1)),i},Oe=(...e)=>e.filter(i=>typeof i=="string"&&i).map(i=>ws(i)).join("/-/"),Bt=(...e)=>{let i=Oe(...e);return i?`-/${i}/`:""};function bi(e){let i=new URL(e),t=i.pathname+i.search+i.hash,r=t.lastIndexOf("http"),s=t.lastIndexOf("/"),n="";return r>=0?n=t.slice(r):s>=0&&(n=t.slice(s+1)),n}function Ts(e){let i=new URL(e),t=bi(e),r=yi(t)?Ci(t).pathname:t;return i.pathname=i.pathname.replace(r,""),i.search="",i.hash="",i.toString()}function yi(e){return e.startsWith("http")}function Ci(e){let i=new URL(e);return{pathname:i.origin+i.pathname||"",search:i.search||"",hash:i.hash||""}}var Gt=(e,i,t)=>{let r=new URL(Ts(e));if(t=t||bi(e),r.pathname.startsWith("//")&&(r.pathname=r.pathname.replace("//","/")),yi(t)){let s=Ci(t);r.pathname=r.pathname+(i||"")+(s.pathname||""),r.search=s.search,r.hash=s.hash}else r.pathname=r.pathname+(i||"")+(t||"");return r.toString()},Ai=(e,i)=>{let t=new URL(e);return t.pathname=i+"/",t.toString()};var Z=(e,i=",")=>e.trim().split(i).map(t=>t.trim()).filter(t=>t.length>0);var j=Object.freeze({brightness:0,exposure:0,gamma:100,contrast:0,saturation:0,vibrance:0,warmth:0,enhance:0,filter:0,rotate:0,mirror:!1,flip:!1,crop:void 0});var uo=Oe("format/auto","progressive/yes"),tt=([e])=>typeof e!="undefined"?Number(e):void 0,Ei=()=>!0,Ss=([e,i])=>({name:e,amount:typeof i!="undefined"?Number(i):100}),xs=([e,i])=>{if(!/\d+x\d+/.test(e)||!/\d+,\d+/.test(i))throw new Error("Crop by aspect ratio, percentage or alignment shortcuts is not supported.");return{dimensions:Z(e,"x").map(Number),coords:Z(i).map(Number)}},ho=Object.freeze({enhance:tt,brightness:tt,exposure:tt,gamma:tt,contrast:tt,saturation:tt,vibrance:tt,warmth:tt,filter:Ss,mirror:Ei,flip:Ei,rotate:tt,crop:xs});var Ie=Object.freeze({CROP:"crop",TUNING:"tuning",FILTERS:"filters"}),vi=[Ie.CROP,Ie.TUNING,Ie.FILTERS];var mo=Object.freeze({brightness:{zero:j.brightness,range:[-100,100],keypointsNumber:2},exposure:{zero:j.exposure,range:[-500,500],keypointsNumber:2},gamma:{zero:j.gamma,range:[0,1e3],keypointsNumber:2},contrast:{zero:j.contrast,range:[-100,500],keypointsNumber:2},saturation:{zero:j.saturation,range:[-100,500],keypointsNumber:1},vibrance:{zero:j.vibrance,range:[-100,500],keypointsNumber:1},warmth:{zero:j.warmth,range:[-100,100],keypointsNumber:1},enhance:{zero:j.enhance,range:[0,100],keypointsNumber:1},filter:{zero:j.filter,range:[0,100],keypointsNumber:1}});var Ht=e=>e?e.join(","):"";var Os="https://ucarecdn.com",Is="https://upload.uploadcare.com",Us="https://social.uploadcare.com",V={pubkey:"",multiple:!0,multipleMin:0,multipleMax:Number.MAX_SAFE_INTEGER,confirmUpload:!1,imgOnly:!1,accept:"",externalSourcesPreferredTypes:"",store:"auto",cameraMirror:!1,cameraCapture:"",sourceList:"local, url, camera, dropbox, gdrive",cloudImageEditorTabs:Ht(vi),maxLocalFileSizeBytes:0,thumbSize:76,showEmptyList:!1,useLocalImageEditor:!1,useCloudImageEditor:!0,removeCopyright:!1,cropPreset:"",imageShrink:"",modalScrollLock:!0,modalBackdropStrokes:!1,sourceListWrap:!0,remoteTabSessionKey:"",cdnCname:Os,baseUrl:Is,socialBaseUrl:Us,secureSignature:"",secureExpire:"",secureDeliveryProxy:"",retryThrottledRequestMaxTimes:1,multipartMinFileSize:26214400,multipartChunkSize:5242880,maxConcurrentRequests:10,multipartMaxConcurrentRequests:4,multipartMaxAttempts:3,checkForUrlDuplicates:!1,saveUrlForRecurrentUploads:!1,groupOutput:!1,userAgentIntegration:"",debug:!1,metadata:null,localeName:"en",localeDefinitionOverride:null};var Ue="lr-",I=class extends he{constructor(){super();h(this,"requireCtxName",!1);h(this,"allowCustomTemplate",!0);h(this,"activityType",null);h(this,"init$",Se());this.l10nProcessorSubs=new Map,this.addTemplateProcessor(mi)}l10n(t,r={}){if(!t)return"";let s=this.$[Q(t)]||t,n=ti(s);for(let l of n)r[l.variable]=this.pluralize(l.pluralKey,Number(r[l.countVariable]));return fe(s,r)}pluralize(t,r){let s=this.l10n("locale-id")||"en",n=kt(s,r);return this.l10n(`${t}__${n}`)}bindL10n(t,r){var s;(s=this.localeManager)==null||s.bindL10n(this,t,r)}emit(t,r,s){let n=this.has("*eventEmitter")&&this.$["*eventEmitter"];n&&n.emit(t,r,s)}hasBlockInCtx(t){let r=this.$["*blocksRegistry"];for(let s of r)if(t(s))return!0;return!1}setOrAddState(t,r){this.add$({[t]:r},!0)}setActivity(t){if(this.hasBlockInCtx(r=>r.activityType===t)){this.$["*currentActivity"]=t;return}console.warn(`Activity type "${t}" not found in the context`)}connectedCallback(){let t=this.constructor.className;t&&this.classList.toggle(`${Ue}${t}`,!0),this.hasAttribute("retpl")&&(this.constructor.template=null,this.processInnerHtml=!0),this.requireCtxName?ei({element:this,attribute:"ctx-name",onSuccess:()=>{super.connectedCallback()},onTimeout:()=>{console.error("Attribute `ctx-name` is required and it is not set.")}}):super.connectedCallback(),at.registerClient(this)}disconnectedCallback(){super.disconnectedCallback(),at.unregisterClient(this)}initCallback(){this.has("*blocksRegistry")||this.add("*blocksRegistry",new Set),this.$["*blocksRegistry"].add(this),this.has("*eventEmitter")||this.add("*eventEmitter",new Ut(this.debugPrint.bind(this))),this.has("*localeManager")||this.add("*localeManager",new jt(this)),this.sub(Q("locale-id"),r=>{this.style.direction=Je(r)})}get localeManager(){return this.has("*localeManager")?this.$["*localeManager"]:null}destroyCallback(){var r;let t=this.$["*blocksRegistry"];t.delete(this),(r=this.localeManager)==null||r.destroyL10nBindings(this),this.l10nProcessorSubs=new Map,A.deleteCtx(this),t.size===0&&setTimeout(()=>{this.destroyCtxCallback()},0)}destroyCtxCallback(){var t;A.deleteCtx(this.ctxName),(t=this.localeManager)==null||t.destroy()}fileSizeFmt(t,r=2){let s=["B","KB","MB","GB","TB"];if(t===0)return`0 ${s[0]}`;let n=1024,o=r<0?0:r,l=Math.floor(Math.log(t)/Math.log(n));return parseFloat((t/n**l).toFixed(o))+" "+s[l]}proxyUrl(t){let r=this.cfg.secureDeliveryProxy;return r?fe(r,{previewUrl:t},{transform:s=>window.encodeURIComponent(s)}):t}get cfg(){if(!this.__cfgProxy){let t=Object.create(null);this.__cfgProxy=new Proxy(t,{set:(r,s,n)=>{if(typeof s!="string")return!1;let o=D(s);return this.has(o)||this.add(o,V[s]),this.$[o]=n,!0},get:(r,s)=>{let n=D(s);return this.has(n)||this.add(n,V[s]),this.$[D(s)]}})}return this.__cfgProxy}subConfigValue(t,r){let s=D(t);this.has(s)||this.add(s,V[t]),this.sub(s,r)}debugPrint(...t){if(!this.cfg.debug)return;let r=t;if(typeof(t==null?void 0:t[0])=="function"){let s=t[0];r=s()}console.log(`[${this.ctxName}]`,...r)}static reg(t){if(!t){super.reg();return}super.reg(t.startsWith(Ue)?t:Ue+t)}};h(I,"StateConsumerScope",null),h(I,"className","");var wi="active",Et="___ACTIVITY_IS_ACTIVE___",et=class et extends I{constructor(){super(...arguments);h(this,"historyTracked",!1);h(this,"init$",xe(this));h(this,"_debouncedHistoryFlush",N(this._historyFlush.bind(this),10))}_deactivate(){var r;let t=et._activityCallbacks.get(this);this[Et]=!1,this.removeAttribute(wi),(r=t==null?void 0:t.deactivateCallback)==null||r.call(t)}_activate(){var r;let t=et._activityCallbacks.get(this);this.$["*historyBack"]=this.historyBack.bind(this),this[Et]=!0,this.setAttribute(wi,""),(r=t==null?void 0:t.activateCallback)==null||r.call(t),this._debouncedHistoryFlush(),this.emit(T.ACTIVITY_CHANGE,{activity:this.activityType})}initCallback(){super.initCallback(),this.hasAttribute("current-activity")&&this.sub("*currentActivity",t=>{this.setAttribute("current-activity",t)}),this.activityType&&(this.hasAttribute("activity")||this.setAttribute("activity",this.activityType),this.sub("*currentActivity",t=>{this.activityType!==t&&this[Et]?this._deactivate():this.activityType===t&&!this[Et]&&this._activate(),t||(this.$["*history"]=[])}),this.has("*modalActive")&&this.sub("*modalActive",t=>{!t&&this.activityType===this.$["*currentActivity"]&&(this.$["*currentActivity"]=null)}))}_historyFlush(){let t=this.$["*history"];t&&(t.length>10&&(t=t.slice(t.length-11,t.length-1)),this.historyTracked&&t[t.length-1]!==this.activityType&&t.push(this.activityType),this.$["*history"]=t)}_isActivityRegistered(){return this.activityType&&et._activityCallbacks.has(this)}get isActivityActive(){return this[Et]}get couldOpenActivity(){return!0}registerActivity(t,r={}){let{onActivate:s,onDeactivate:n}=r;et._activityCallbacks.set(this,{activateCallback:s,deactivateCallback:n})}unregisterActivity(){this.isActivityActive&&this._deactivate(),et._activityCallbacks.delete(this)}destroyCallback(){super.destroyCallback(),this._isActivityRegistered()&&this.unregisterActivity();let t=this.$["*currentActivity"];!![...this.$["*blocksRegistry"]].find(n=>n instanceof et&&n.activityType===t)||(this.$["*currentActivity"]=null)}get activityKey(){return this.ctxName+this.activityType}get activityParams(){return this.$["*currentActivityParams"]}get initActivity(){return this.getCssData("--cfg-init-activity")}get doneActivity(){return this.getCssData("--cfg-done-activity")}historyBack(){var r;let t=this.$["*history"];if(t){let s=t.pop();for(;s===this.activityType;)s=t.pop();let n=!!s;if(s){let l=[...this.$["*blocksRegistry"]].find(a=>a.activityType===s);n=(r=l==null?void 0:l.couldOpenActivity)!=null?r:!1}s=n?s:void 0,this.$["*currentActivity"]=s,this.$["*history"]=t,s||this.setOrAddState("*modalActive",!1)}}};h(et,"_activityCallbacks",new Map);var w=et;w.activities=Object.freeze({START_FROM:"start-from",CAMERA:"camera",DRAW:"draw",UPLOAD_LIST:"upload-list",URL:"url",CONFIRMATION:"confirmation",CLOUD_IMG_EDIT:"cloud-image-edit",EXTERNAL:"external",DETAILS:"details"});var Xt=class extends I{constructor(){super(...arguments);h(this,"requireCtxName",!0);h(this,"init$",zt(this));h(this,"_template",null)}static set template(t){this._template=t+"<slot></slot>"}static get template(){return this._template}};var qt=class extends Xt{initCallback(){super.initCallback();let i=this.ref.uBlock;this.sub("*currentActivity",t=>{t||(this.$["*currentActivity"]=i.initActivity||w.activities.START_FROM)}),this.sub("*uploadList",t=>{(t==null?void 0:t.length)>0?this.$["*currentActivity"]=w.activities.UPLOAD_LIST:this.$["*currentActivity"]=i.initActivity||w.activities.START_FROM}),this.subConfigValue("sourceList",t=>{t!=="local"&&(this.cfg.sourceList="local")}),this.subConfigValue("confirmUpload",t=>{t!==!1&&(this.cfg.confirmUpload=!1)})}};qt.template=`<lr-start-from><lr-drop-area clickable l10n="choose-file"></lr-drop-area><lr-copyright></lr-copyright></lr-start-from><lr-upload-list ref="uBlock"></lr-upload-list>`;var Wt=class extends w{constructor(){super(...arguments);h(this,"historyTracked",!0);h(this,"activityType","start-from")}initCallback(){super.initCallback(),this.registerActivity(this.activityType)}};Wt.template='<div class="content"><slot></slot></div>';function Ti(e,i,t){let r=e/i,s,n;r>t?(s=Math.round(i*t),n=i):(s=e,n=Math.round(e/t));let o=Math.round((e-s)/2),l=Math.round((i-n)/2);return o+s>e&&(s=e-o),l+n>i&&(n=i-l),{x:o,y:l,width:s,height:n}}var Si=e=>{if(!e)return[];let[i,t]=e.split(":").map(Number);if(!Number.isFinite(i)||!Number.isFinite(t)){console.error(`Invalid crop preset: ${e}`);return}return[{type:"aspect-ratio",width:i,height:t}]};var B=Object.freeze({LOCAL:"local",DROP_AREA:"drop-area",URL_TAB:"url-tab",CAMERA:"camera",EXTERNAL:"external",API:"js-api"});function xi(e){return Ce({...e,libraryName:gi,libraryVersion:_i})}var Oi=({type:e,message:i,...t})=>({type:e,message:i,...t}),ut=Oi,Kt=Oi;var Yt=["image/*","image/heif","image/heif-sequence","image/heic","image/heic-sequence","image/avif","image/avif-sequence",".heif",".heifs",".heic",".heics",".avif",".avifs"],Le=e=>e?e.filter(i=>typeof i=="string").map(i=>Z(i)).flat():[],Pe=(e,i)=>i.some(t=>t.endsWith("*")?(t=t.replace("*",""),e.startsWith(t)):e===t),Ii=(e,i)=>i.some(t=>t.startsWith(".")?e.toLowerCase().endsWith(t.toLowerCase()):!1),ke=e=>{let i=e==null?void 0:e.type;return i?Pe(i,Yt):!1};var G=1e3,ht=Object.freeze({AUTO:"auto",BYTE:"byte",KB:"kb",MB:"mb",GB:"gb",TB:"tb",PB:"pb"}),vt=e=>Math.ceil(e*100)/100,Ui=(e,i=ht.AUTO)=>{let t=i===ht.AUTO;if(i===ht.BYTE||t&&e<G**1){let r=kt("en-US",e),s={one:"byte",other:"bytes"}[r];return`${e} ${s}`}return i===ht.KB||t&&e<G**2?`${vt(e/G**1)} KB`:i===ht.MB||t&&e<G**3?`${vt(e/G**2)} MB`:i===ht.GB||t&&e<G**4?`${vt(e/G**3)} GB`:i===ht.TB||t&&e<G**5?`${vt(e/G**4)} TB`:`${vt(e/G**5)} PB`};var Li=new Set;function Jt(e){Li.has(e)||(Li.add(e),console.warn(e))}var Pi="[Typed State] Wrong property name: ",Ls="[Typed State] Wrong property type: ",Qt=class{constructor(i,t){this.__typedSchema=i,this.__ctxId=t||Ct.generate(),this.__schema=Object.keys(i).reduce((r,s)=>(r[s]=i[s].value,r),{}),this.__data=A.registerCtx(this.__schema,this.__ctxId)}get uid(){return this.__ctxId}setValue(i,t){if(!this.__typedSchema.hasOwnProperty(i)){console.warn(Pi+i);return}let r=this.__typedSchema[i];if((t==null?void 0:t.constructor)===r.type||t instanceof r.type||r.nullable&&t===null){this.__data.pub(i,t);return}console.warn(Ls+i)}setMultipleValues(i){for(let t in i)this.setValue(t,i[t])}getValue(i){if(!this.__typedSchema.hasOwnProperty(i)){console.warn(Pi+i);return}return this.__data.read(i)}subscribe(i,t){return this.__data.sub(i,t)}remove(){A.deleteCtx(this.__ctxId)}};var Zt=class{constructor(i){this.__typedSchema=i.typedSchema,this.__ctxId=i.ctxName||Ct.generate(),this.__data=A.registerCtx({},this.__ctxId),this.__watchList=i.watchList||[],this.__subsMap=Object.create(null),this.__propertyObservers=new Set,this.__collectionObservers=new Set,this.__items=new Set,this.__removed=new Set,this.__added=new Set;let t=Object.create(null);this.__notifyObservers=(r,s)=>{this.__observeTimeout&&window.clearTimeout(this.__observeTimeout),t[r]||(t[r]=new Set),t[r].add(s),this.__observeTimeout=window.setTimeout(()=>{Object.keys(t).length!==0&&(this.__propertyObservers.forEach(n=>{n({...t})}),t=Object.create(null))})}}notify(){this.__notifyTimeout&&window.clearTimeout(this.__notifyTimeout),this.__notifyTimeout=window.setTimeout(()=>{let i=new Set(this.__added),t=new Set(this.__removed);this.__added.clear(),this.__removed.clear();for(let r of this.__collectionObservers)r==null||r([...this.__items],i,t)})}observeCollection(i){return this.__collectionObservers.add(i),this.__items.size>0&&this.notify(),()=>{this.unobserveCollection(i)}}unobserveCollection(i){var t;(t=this.__collectionObservers)==null||t.delete(i)}add(i){let t=new Qt(this.__typedSchema);for(let r in i)t.setValue(r,i[r]);return this.__items.add(t.uid),this.notify(),this.__data.add(t.uid,t),this.__added.add(t),this.__watchList.forEach(r=>{this.__subsMap[t.uid]||(this.__subsMap[t.uid]=[]),this.__subsMap[t.uid].push(t.subscribe(r,()=>{this.__notifyObservers(r,t.uid)}))}),t.uid}read(i){return this.__data.read(i)}readProp(i,t){return this.read(i).getValue(t)}publishProp(i,t,r){this.read(i).setValue(t,r)}remove(i){this.__removed.add(this.__data.read(i)),this.__items.delete(i),this.notify(),this.__data.pub(i,null),delete this.__subsMap[i]}clearAll(){this.__items.forEach(i=>{this.remove(i)})}observeProperties(i){return this.__propertyObservers.add(i),()=>{this.unobserveProperties(i)}}unobserveProperties(i){var t;(t=this.__propertyObservers)==null||t.delete(i)}findItems(i){let t=[];return this.__items.forEach(r=>{let s=this.read(r);i(s)&&t.push(r)}),t}items(){return[...this.__items]}get size(){return this.__items.size}destroy(){A.deleteCtx(this.__ctxId),this.__propertyObservers=null,this.__collectionObservers=null;for(let i in this.__subsMap)this.__subsMap[i].forEach(t=>{t.remove()}),delete this.__subsMap[i]}};var ki=e=>{let i=new Map;return(...t)=>{let r=JSON.stringify(t);if(i.has(r))return i.get(r);let s=e(...t);return i.set(r,s),s}};function Ps(e){let i=!1;return setTimeout(()=>{i=!0},0),r=>(...s)=>(i&&Jt(e),r(...s))}function Ri(e){let i={progress:()=>e.$["*commonProgress"],errors:()=>e.$["*collectionErrors"],group:()=>e.$["*groupInfo"],totalCount:()=>e.uploadCollection.size,failedCount:()=>t.failedEntries.length,successCount:()=>t.successEntries.length,uploadingCount:()=>t.uploadingEntries.length,status:()=>t.isFailed?"failed":t.isUploading?"uploading":t.isSuccess?"success":"idle",isSuccess:()=>t.errors.length===0&&t.successEntries.length===t.allEntries.length,isUploading:()=>t.allEntries.some(s=>s.status==="uploading"),isFailed:()=>t.errors.length>0||t.failedEntries.length>0,allEntries:()=>e.getOutputData(),successEntries:()=>t.allEntries.filter(s=>s.status==="success"),failedEntries:()=>t.allEntries.filter(s=>s.status==="failed"),uploadingEntries:()=>t.allEntries.filter(s=>s.status==="uploading"),idleEntries:()=>t.allEntries.filter(s=>s.status==="idle")},t={},r=Ps("You're trying to access the OutputCollectionState asynchronously. In this case, the data you retrieve will be newer than it was when the OutputCollectionState was created or when the event was dispatched. If you want to retain the state at a specific moment in time, you should use the spread operator like this: `{...outputCollectionState}` or `{...e.detail}`");for(let[s,n]of Object.entries(i)){let o=s,a=ki(r(n));Object.defineProperty(t,o,{get:a,enumerable:!0})}return t}var Mi=Object.freeze({file:{type:File,value:null},externalUrl:{type:String,value:null},fileName:{type:String,value:null,nullable:!0},fileSize:{type:Number,value:null,nullable:!0},lastModified:{type:Number,value:Date.now()},uploadProgress:{type:Number,value:0},uuid:{type:String,value:null},isImage:{type:Boolean,value:!1},mimeType:{type:String,value:null,nullable:!0},ctxName:{type:String,value:null},cdnUrl:{type:String,value:null},cdnUrlModifiers:{type:String,value:null},fileInfo:{type:Y,value:null},isUploading:{type:Boolean,value:!1},abortController:{type:AbortController,value:null,nullable:!0},thumbUrl:{type:String,value:null,nullable:!0},silent:{type:Boolean,value:!1},source:{type:String,value:!1,nullable:!0},fullPath:{type:String,value:null,nullable:!0},metadata:{type:Object,value:null,nullable:!0},errors:{type:Array,value:[]},uploadError:{type:Error,value:null,nullable:!0},isRemoved:{type:Boolean,value:!1}});var ks=/[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}/i,Rs=new RegExp(`^/?(${ks.source})(?:/(-/(?:[^/]+/)+)?([^/]*))?$`,"i"),Di=({url:e,cdnBase:i})=>{let t=new URL(i),r=new URL(e);if(t.host!==r.host)return null;let[,s,n,o]=Rs.exec(r.pathname);return{uuid:s,cdnUrlModifiers:n||"",filename:o||null}};var U=class e extends w{constructor(){super(...arguments);h(this,"couldBeCtxOwner",!1);h(this,"isCtxOwner",!1);h(this,"init$",zt(this));h(this,"__initialUploadMetadata",null);h(this,"_fileValidators",[this._validateIsImage.bind(this),this._validateFileType.bind(this),this._validateMaxSizeLimit.bind(this),this._validateUploadError.bind(this)]);h(this,"_collectionValidators",[t=>{let r=t.size,s=this.cfg.multiple?this.cfg.multipleMin:0,n=this.cfg.multiple?this.cfg.multipleMax:1;if(s&&r<s){let o=this.l10n("files-count-limit-error-too-few",{min:s,max:n,total:r});return Kt({type:"TOO_FEW_FILES",message:o,total:r,min:s,max:n})}if(n&&r>n){let o=this.l10n("files-count-limit-error-too-many",{min:s,max:n,total:r});return Kt({type:"TOO_MANY_FILES",message:o,total:r,min:s,max:n})}},t=>{if(t.items().some(r=>t.readProp(r,"errors").length>0))return Kt({type:"SOME_FILES_HAS_ERRORS",message:this.l10n("some-files-were-not-uploaded")})}]);h(this,"uploadAll",()=>{let t=this.uploadCollection.items().filter(r=>{let s=this.uploadCollection.read(r);return!s.getValue("isRemoved")&&!s.getValue("isUploading")&&!s.getValue("fileInfo")});t.length!==0&&(this.$["*uploadTrigger"]=new Set(t),this.emit(T.COMMON_UPLOAD_START,this.getOutputCollectionState()))});h(this,"_flushOutputItems",N(async()=>{if(this.getOutputData().length!==this.uploadCollection.size)return;let r=this.getOutputCollectionState();this.$["*collectionState"]=r,this.emit(T.CHANGE,()=>this.getOutputCollectionState(),{debounce:!0}),this.cfg.groupOutput&&r.totalCount>0&&r.status==="success"&&this._createGroup(r)},300));h(this,"_handleCollectionUpdate",(t,r,s)=>{var n;(r.size||s.size)&&(this.$["*groupInfo"]=null),this._runFileValidators(),this._runCollectionValidators();for(let o of r)o.getValue("silent")||this.emit(T.FILE_ADDED,this.getOutputItem(o.uid));for(let o of s)this.$["*uploadTrigger"].delete(o.uid),(n=o.getValue("abortController"))==null||n.abort(),o.setMultipleValues({isRemoved:!0,abortController:null,isUploading:!1,uploadProgress:0}),URL.revokeObjectURL(o==null?void 0:o.getValue("thumbUrl")),this.emit(T.FILE_REMOVED,this.getOutputItem(o.uid));this.$["*uploadList"]=t.map(o=>({uid:o})),this._flushCommonUploadProgress(),this._flushOutputItems()});h(this,"_handleCollectionPropertiesUpdate",t=>{this._flushOutputItems();let r=this.uploadCollection,s=[...new Set(Object.entries(t).filter(([n])=>["uploadError","fileInfo"].includes(n)).map(([,n])=>[...n]).flat())];if(s.length>0&&setTimeout(()=>{this._runFileValidators(s)}),t.uploadProgress){for(let n of t.uploadProgress){let{isUploading:o,silent:l}=A.getCtx(n).store;o&&!l&&this.emit(T.FILE_UPLOAD_PROGRESS,this.getOutputItem(n))}this._flushCommonUploadProgress()}if(t.isUploading)for(let n of t.isUploading){let{isUploading:o,silent:l}=A.getCtx(n).store;o&&!l&&this.emit(T.FILE_UPLOAD_START,this.getOutputItem(n))}if(t.fileInfo){for(let l of t.fileInfo){let{fileInfo:a,silent:c}=A.getCtx(l).store;a&&!c&&this.emit(T.FILE_UPLOAD_SUCCESS,this.getOutputItem(l))}this.cfg.cropPreset&&this.setInitialCrop();let n=r.findItems(l=>!!l.getValue("fileInfo"));r.findItems(l=>l.getValue("errors").length>0).length===0&&r.size===n.length&&this.emit(T.COMMON_UPLOAD_SUCCESS,this.getOutputCollectionState())}if(t.errors)for(let n of t.errors){let{errors:o}=A.getCtx(n).store;o.length>0&&(this.emit(T.FILE_UPLOAD_FAILED,this.getOutputItem(n)),this.emit(T.COMMON_UPLOAD_FAILED,()=>this.getOutputCollectionState(),{debounce:!0}))}t.cdnUrl&&([...t.cdnUrl].filter(o=>{var l;return!!((l=this.uploadCollection.read(o))!=null&&l.getValue("cdnUrl"))}).forEach(o=>{this.emit(T.FILE_URL_CHANGED,this.getOutputItem(o))}),this.$["*groupInfo"]=null)});h(this,"_flushCommonUploadProgress",()=>{let t=0,s=[...this.$["*uploadTrigger"]].filter(o=>!!this.uploadCollection.read(o));s.forEach(o=>{let l=this.uploadCollection.readProp(o,"uploadProgress");t+=l});let n=s.length?Math.round(t/s.length):0;this.$["*commonProgress"]!==n&&(this.$["*commonProgress"]=n,this.emit(T.COMMON_UPLOAD_PROGRESS,this.getOutputCollectionState()))})}setUploadMetadata(t){Jt("setUploadMetadata is deprecated. Use `metadata` instance property on `lr-config` block instead. See migration guide: https://uploadcare.com/docs/file-uploader/migration-to-0.25.0/"),this.connectedOnce?this.$["*uploadMetadata"]=t:this.__initialUploadMetadata=t}get hasCtxOwner(){return this.hasBlockInCtx(t=>t instanceof e?t.isCtxOwner&&t.isConnected&&t!==this:!1)}initCallback(){if(super.initCallback(),!this.$["*uploadCollection"]){let t=new Zt({typedSchema:Mi,watchList:["uploadProgress","uploadError","fileInfo","errors","cdnUrl","isUploading"]});this.$["*uploadCollection"]=t}!this.hasCtxOwner&&this.couldBeCtxOwner&&this.initCtxOwner()}destroyCtxCallback(){var t,r;(t=this._unobserveCollectionProperties)==null||t.call(this),(r=this._unobserveCollection)==null||r.call(this),this.uploadCollection.destroy(),this.$["*uploadCollection"]=null,super.destroyCtxCallback()}initCtxOwner(){this.isCtxOwner=!0,this._unobserveCollection=this.uploadCollection.observeCollection(this._handleCollectionUpdate),this._unobserveCollectionProperties=this.uploadCollection.observeProperties(this._handleCollectionPropertiesUpdate);let t=()=>{this._runFileValidators(),this._runCollectionValidators()};this.subConfigValue("maxLocalFileSizeBytes",t),this.subConfigValue("multipleMin",t),this.subConfigValue("multipleMax",t),this.subConfigValue("multiple",t),this.subConfigValue("imgOnly",t),this.subConfigValue("accept",t),this.subConfigValue("maxConcurrentRequests",r=>{this.$["*uploadQueue"].concurrency=Number(r)||1}),this.__initialUploadMetadata&&(this.$["*uploadMetadata"]=this.__initialUploadMetadata)}addFileFromUrl(t,{silent:r,fileName:s,source:n}={}){let o=this.uploadCollection.add({externalUrl:t,fileName:s!=null?s:null,silent:r!=null?r:!1,source:n!=null?n:B.API});return this.getOutputItem(o)}addFileFromUuid(t,{silent:r,fileName:s,source:n}={}){let o=this.uploadCollection.add({uuid:t,fileName:s!=null?s:null,silent:r!=null?r:!1,source:n!=null?n:B.API});return this.getOutputItem(o)}addFileFromCdnUrl(t,{silent:r,fileName:s,source:n}={}){var a;let o=Di({url:t,cdnBase:this.cfg.cdnCname});if(!o)throw new Error("Invalid CDN URL");let l=this.uploadCollection.add({uuid:o.uuid,cdnUrl:t,cdnUrlModifiers:o.cdnUrlModifiers,fileName:(a=s!=null?s:o.filename)!=null?a:null,silent:r!=null?r:!1,source:n!=null?n:B.API});return this.getOutputItem(l)}addFileFromObject(t,{silent:r,fileName:s,source:n,fullPath:o}={}){let l=this.uploadCollection.add({file:t,isImage:ke(t),mimeType:t.type,fileName:s!=null?s:t.name,fileSize:t.size,silent:r!=null?r:!1,source:n!=null?n:B.API,fullPath:o!=null?o:null});return this.getOutputItem(l)}addFiles(t){return console.warn("`addFiles` method is deprecated. Please use `addFileFromObject`, `addFileFromUrl` or `addFileFromUuid` instead."),t.map(r=>{let s=this.uploadCollection.add({file:r,isImage:ke(r),mimeType:r.type,fileName:r.name,fileSize:r.size});return this.getOutputItem(s)})}removeFileByInternalId(t){if(!this.uploadCollection.read(t))throw new Error(`File with internalId ${t} not found`);this.uploadCollection.remove(t)}removeAllFiles(){this.uploadCollection.clearAll()}openSystemDialog(t={}){var s;let r=Ht(Le([(s=this.cfg.accept)!=null?s:"",...this.cfg.imgOnly?Yt:[]]));this.cfg.accept&&this.cfg.imgOnly&&console.warn("There could be a mistake.\nBoth `accept` and `imgOnly` parameters are set.\nThe value of `accept` will be concatenated with the internal image mime types list."),this.fileInput=document.createElement("input"),this.fileInput.type="file",this.fileInput.multiple=this.cfg.multiple,t.captureCamera?(this.fileInput.capture=this.cfg.cameraCapture,this.fileInput.accept="image/*"):this.fileInput.accept=r,this.fileInput.dispatchEvent(new MouseEvent("click")),this.fileInput.onchange=()=>{[...this.fileInput.files].forEach(n=>this.addFileFromObject(n,{source:t.captureCamera?B.CAMERA:B.LOCAL})),this.$["*currentActivity"]=w.activities.UPLOAD_LIST,this.setOrAddState("*modalActive",!0),this.fileInput.value="",this.fileInput=null}}get sourceList(){let t=[];return this.cfg.sourceList&&(t=Z(this.cfg.sourceList)),t}initFlow(t=!1){var r;if(this.uploadCollection.size>0&&!t)this.set$({"*currentActivity":w.activities.UPLOAD_LIST}),this.setOrAddState("*modalActive",!0);else if(((r=this.sourceList)==null?void 0:r.length)===1){let s=this.sourceList[0];if(s==="local"){this.$["*currentActivity"]=w.activities.UPLOAD_LIST,this==null||this.openSystemDialog();return}let n=this.$["*blocksRegistry"],o=a=>"type"in a&&a.type===s,l=[...n].find(o);l==null||l.activate(),this.$["*currentActivity"]&&this.setOrAddState("*modalActive",!0)}else this.set$({"*currentActivity":w.activities.START_FROM}),this.setOrAddState("*modalActive",!0)}doneFlow(){this.set$({"*currentActivity":this.doneActivity,"*history":this.doneActivity?[this.doneActivity]:[]}),this.$["*currentActivity"]||this.setOrAddState("*modalActive",!1)}get uploadCollection(){return this.$["*uploadCollection"]}_validateFileType(t){let r=this.cfg.imgOnly,s=this.cfg.accept,n=Le([...r?Yt:[],s]);if(!n.length)return;let o=t.mimeType,l=t.name;if(!o||!l)return;let a=Pe(o,n),c=Ii(l,n);if(!a&&!c)return ut({type:"FORBIDDEN_FILE_TYPE",message:this.l10n("file-type-not-allowed"),entry:t})}_validateMaxSizeLimit(t){let r=this.cfg.maxLocalFileSizeBytes,s=t.size;if(r&&s&&s>r)return ut({type:"FILE_SIZE_EXCEEDED",message:this.l10n("files-max-size-limit-error",{maxFileSize:Ui(r)}),entry:t})}_validateUploadError(t,r){let s=r==null?void 0:r.getValue("uploadError");if(s){if(s instanceof L)return ut({type:"UPLOAD_ERROR",message:s.message,entry:t,error:s});if(s instanceof pt)return ut({type:"NETWORK_ERROR",message:s.message,entry:t,error:s});{let n=s instanceof Error?s:new Error("Unknown error",{cause:s});return ut({type:"UNKNOWN_ERROR",message:n.message,entry:t,error:n})}}}_validateIsImage(t){let r=this.cfg.imgOnly,s=t.isImage;if(!(!r||s)&&!(!t.fileInfo&&t.externalUrl)&&!(!t.fileInfo&&!t.mimeType))return ut({type:"NOT_AN_IMAGE",message:this.l10n("images-only-accepted"),entry:t})}_runFileValidatorsForEntry(t){let r=this.getOutputItem(t.uid),s=[];for(let n of this._fileValidators){let o=n(r,t);o&&s.push(o)}t.setValue("errors",s)}_runFileValidators(t){let r=t!=null?t:this.uploadCollection.items();for(let s of r){let n=this.uploadCollection.read(s);n&&this._runFileValidatorsForEntry(n)}}_runCollectionValidators(){let t=this.uploadCollection,r=[];for(let s of this._collectionValidators){let n=s(t);n&&(Array.isArray(n)?r.push(...n):r.push(n))}this.$["*collectionErrors"]=r,r.length>0&&this.emit(T.COMMON_UPLOAD_FAILED,()=>this.getOutputCollectionState(),{debounce:!0})}async _createGroup(t){let r=this.getUploadClientOptions(),s=t.allEntries.map(a=>a.uuid+(a.cdnUrlModifiers?`/${a.cdnUrlModifiers}`:"")),n=new AbortController,o=await pi(s,{...r,signal:n.signal});if(this.$["*collectionState"]!==t){n.abort();return}this.$["*groupInfo"]=o;let l=this.getOutputCollectionState();this.emit(T.GROUP_CREATED,l),this.emit(T.CHANGE,()=>this.getOutputCollectionState(),{debounce:!0}),this.$["*collectionState"]=l}setInitialCrop(){let t=Si(this.cfg.cropPreset);if(t){let[r]=t,s=this.uploadCollection.findItems(n=>{var o;return n.getValue("fileInfo")&&n.getValue("isImage")&&!((o=n.getValue("cdnUrlModifiers"))!=null&&o.includes("/crop/"))}).map(n=>this.uploadCollection.read(n));for(let n of s){let o=n.getValue("fileInfo"),{width:l,height:a}=o.imageInfo,c=r.width/r.height,u=Ti(l,a,c),d=Bt(`crop/${u.width}x${u.height}/${u.x},${u.y}`,"preview");n.setMultipleValues({cdnUrlModifiers:d,cdnUrl:Gt(n.getValue("cdnUrl"),d)}),this.uploadCollection.size===1&&this.cfg.useCloudImageEditor&&this.hasBlockInCtx(f=>f.activityType===w.activities.CLOUD_IMG_EDIT)&&(this.$["*focusedEntry"]=n,this.$["*currentActivity"]=w.activities.CLOUD_IMG_EDIT)}}}async getMetadataFor(t){var s;let r=(s=this.cfg.metadata)!=null?s:this.$["*uploadMetadata"];if(typeof r=="function"){let n=this.getOutputItem(t);return await r(n)}return r}getUploadClientOptions(){return{store:this.cfg.store,publicKey:this.cfg.pubkey,baseCDN:this.cfg.cdnCname,baseURL:this.cfg.baseUrl,userAgent:xi,integration:this.cfg.userAgentIntegration,secureSignature:this.cfg.secureSignature,secureExpire:this.cfg.secureExpire,retryThrottledRequestMaxTimes:this.cfg.retryThrottledRequestMaxTimes,multipartMinFileSize:this.cfg.multipartMinFileSize,multipartChunkSize:this.cfg.multipartChunkSize,maxConcurrentRequests:this.cfg.multipartMaxConcurrentRequests,multipartMaxAttempts:this.cfg.multipartMaxAttempts,checkForUrlDuplicates:!!this.cfg.checkForUrlDuplicates,saveUrlForRecurrentUploads:!!this.cfg.saveUrlForRecurrentUploads}}getOutputItem(t){var l,a,c,u,d,f,m,p,g,E;let r=A.getCtx(t).store,s=r.fileInfo,n=r.isRemoved?"removed":r.errors.length>0?"failed":r.fileInfo?"success":r.isUploading?"uploading":"idle";return{uuid:(a=(l=s==null?void 0:s.uuid)!=null?l:r.uuid)!=null?a:null,internalId:t,name:(c=s==null?void 0:s.originalFilename)!=null?c:r.fileName,size:(u=s==null?void 0:s.size)!=null?u:r.fileSize,isImage:(d=s==null?void 0:s.isImage)!=null?d:r.isImage,mimeType:(f=s==null?void 0:s.mimeType)!=null?f:r.mimeType,file:r.file,externalUrl:r.externalUrl,cdnUrlModifiers:r.cdnUrlModifiers,cdnUrl:(p=(m=r.cdnUrl)!=null?m:s==null?void 0:s.cdnUrl)!=null?p:null,fullPath:r.fullPath,uploadProgress:r.uploadProgress,fileInfo:s!=null?s:null,metadata:(E=(g=r.metadata)!=null?g:s==null?void 0:s.metadata)!=null?E:null,isSuccess:n==="success",isUploading:n==="uploading",isFailed:n==="failed",isRemoved:n==="removed",errors:r.errors,status:n}}getOutputData(t){return(t?this.uploadCollection.findItems(t):this.uploadCollection.items()).map(n=>this.getOutputItem(n))}getOutputCollectionState(){return Ri(this)}};U.extSrcList=Object.freeze({FACEBOOK:"facebook",DROPBOX:"dropbox",GDRIVE:"gdrive",GPHOTOS:"gphotos",INSTAGRAM:"instagram",FLICKR:"flickr",VK:"vk",EVERNOTE:"evernote",BOX:"box",ONEDRIVE:"onedrive",HUDDLE:"huddle"});U.sourceTypes=Object.freeze({LOCAL:"local",URL:"url",CAMERA:"camera",DRAW:"draw",...U.extSrcList});var O=e=>String(e),H=e=>{let i=Number(e);if(Number.isNaN(i))throw new Error(`Invalid number: "${e}"`);return i},S=e=>{if(typeof e=="undefined"||e===null)return!1;if(typeof e=="boolean")return e;if(e==="true"||e==="")return!0;if(e==="false")return!1;throw new Error(`Invalid boolean: "${e}"`)},Ms=e=>e==="auto"?e:S(e),Ds=e=>{let i=O(e);if(i!=="user"&&i!=="environment"&&i!=="")throw new Error(`Invalid "cameraCapture" value: "${i}"`);return i},Fs=e=>{if(typeof e=="object"&&!Array.isArray(e)||typeof e=="function")return e;throw new Error("Invalid metadata value. Must be an object or function.")},$s=e=>{if(typeof e=="object")return e;throw new Error("Invalid localeDefinitionOverride value. Must be an object.")},Ns={pubkey:O,multiple:S,multipleMin:H,multipleMax:H,confirmUpload:S,imgOnly:S,accept:O,externalSourcesPreferredTypes:O,store:Ms,cameraMirror:S,cameraCapture:Ds,sourceList:O,maxLocalFileSizeBytes:H,thumbSize:H,showEmptyList:S,useLocalImageEditor:S,useCloudImageEditor:S,cloudImageEditorTabs:O,removeCopyright:S,cropPreset:O,imageShrink:O,modalScrollLock:S,modalBackdropStrokes:S,sourceListWrap:S,remoteTabSessionKey:O,cdnCname:O,baseUrl:O,socialBaseUrl:O,secureSignature:O,secureExpire:O,secureDeliveryProxy:O,retryThrottledRequestMaxTimes:H,multipartMinFileSize:H,multipartChunkSize:H,maxConcurrentRequests:H,multipartMaxConcurrentRequests:H,multipartMaxAttempts:H,checkForUrlDuplicates:S,saveUrlForRecurrentUploads:S,groupOutput:S,userAgentIntegration:O,debug:S,localeName:O,metadata:Fs,localeDefinitionOverride:$s},Fi=(e,i)=>{if(!(typeof i=="undefined"||i===null))try{return Ns[e](i)}catch(t){return console.error(`Invalid value for config key "${e}".`,t),V[e]}};function Vs(e){return new Promise(i=>{typeof window.FileReader!="function"&&i(!1);try{let t=new FileReader;t.onerror=()=>{i(!0)};let r=s=>{s.type!=="loadend"&&t.abort(),i(!1)};t.onloadend=r,t.onprogress=r,t.readAsDataURL(e)}catch{i(!1)}})}function zs(e,i){return new Promise(t=>{let r=0,s=[],n=l=>{l||(console.warn("Unexpectedly received empty content entry",{scope:"drag-and-drop"}),t(null)),l.isFile?(r++,l.file(a=>{r--;let c=new File([a],a.name,{type:a.type||i});s.push({type:"file",file:c,fullPath:l.fullPath}),r===0&&t(s)})):l.isDirectory&&o(l.createReader())},o=l=>{r++,l.readEntries(a=>{r--;for(let c of a)n(c);r===0&&t(s)})};n(e)})}function $i(e){let i=[],t=[];for(let r=0;r<e.items.length;r++){let s=e.items[r];if(s)if(s.kind==="file"){let n=s.type;if(typeof s.webkitGetAsEntry=="function"||typeof s.getAsEntry=="function"){let l=typeof s.webkitGetAsEntry=="function"?s.webkitGetAsEntry():s.getAsEntry();t.push(zs(l,n).then(a=>{a&&i.push(...a)}));continue}let o=s.getAsFile();o&&t.push(Vs(o).then(l=>{l||i.push({type:"file",file:o})}))}else s.kind==="string"&&s.type.match("^text/uri-list")&&t.push(new Promise(n=>{s.getAsString(o=>{i.push({type:"url",url:o}),n(void 0)})}))}return Promise.all(t).then(()=>i)}var P={ACTIVE:0,INACTIVE:1,NEAR:2,OVER:3},Ni=["focus"],js=100,Re=new Map;function Bs(e,i){let t=Math.max(Math.min(e[0],i.x+i.width),i.x),r=Math.max(Math.min(e[1],i.y+i.height),i.y);return Math.sqrt((e[0]-t)*(e[0]-t)+(e[1]-r)*(e[1]-r))}function Me(e){let i=0,t=document.body,r=new Set,s=p=>r.add(p),n=P.INACTIVE,o=p=>{e.shouldIgnore()&&p!==P.INACTIVE||(n!==p&&r.forEach(g=>g(p)),n=p)},l=()=>i>0;s(p=>e.onChange(p));let a=()=>{i=0,o(P.INACTIVE)},c=()=>{i+=1,n===P.INACTIVE&&o(P.ACTIVE)},u=()=>{i-=1,l()||o(P.INACTIVE)},d=p=>{p.preventDefault(),i=0,o(P.INACTIVE)},f=p=>{if(e.shouldIgnore())return;l()||(i+=1);let g=[p.x,p.y],E=e.element.getBoundingClientRect(),v=Math.floor(Bs(g,E)),y=v<js,b=p.composedPath().includes(e.element);Re.set(e.element,v);let k=Math.min(...Re.values())===v;b&&k?(p.preventDefault(),o(P.OVER)):o(y&&k?P.NEAR:P.ACTIVE)},m=async p=>{if(e.shouldIgnore())return;p.preventDefault();let g=await $i(p.dataTransfer);e.onItems(g),o(P.INACTIVE)};return t.addEventListener("drop",d),t.addEventListener("dragleave",u),t.addEventListener("dragenter",c),t.addEventListener("dragover",f),e.element.addEventListener("drop",m),Ni.forEach(p=>{window.addEventListener(p,a)}),()=>{Re.delete(e.element),t.removeEventListener("drop",d),t.removeEventListener("dragleave",u),t.removeEventListener("dragenter",c),t.removeEventListener("dragover",f),e.element.removeEventListener("drop",m),Ni.forEach(p=>{window.removeEventListener(p,a)})}}var Vi="lr-drop-area",gt=`${Vi}/registry`,wt=class extends U{constructor(){super(),this.init$={...this.init$,state:P.INACTIVE,withIcon:!1,isClickable:!1,isFullscreen:!1,isEnabled:!0,isVisible:!0,text:"",[gt]:null}}isActive(){if(!this.$.isEnabled)return!1;let i=this.getBoundingClientRect(),t=i.width>0&&i.height>0,r=i.top>=0&&i.left>=0&&i.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&i.right<=(window.innerWidth||document.documentElement.clientWidth),s=window.getComputedStyle(this),n=s.visibility!=="hidden"&&s.display!=="none";return t&&n&&r}initCallback(){super.initCallback(),this.bindL10n("text",()=>this.l10n("drop-files-here")),this.$[gt]||(this.$[gt]=new Set),this.$[gt].add(this),this.defineAccessor("disabled",t=>{this.set$({isEnabled:!S(t)})}),this.defineAccessor("clickable",t=>{this.set$({isClickable:S(t)})}),this.defineAccessor("with-icon",t=>{this.set$({withIcon:S(t)})}),this.defineAccessor("fullscreen",t=>{this.set$({isFullscreen:S(t)})}),this.defineAccessor("text",t=>{typeof t=="string"?this.bindL10n("text",()=>this.l10n(t)||t):this.bindL10n("text",()=>this.l10n("drop-files-here"))}),this._destroyDropzone=Me({element:this,shouldIgnore:()=>this._shouldIgnore(),onChange:t=>{this.$.state=t},onItems:t=>{t.length&&(t.forEach(r=>{r.type==="url"?this.addFileFromUrl(r.url,{source:B.DROP_AREA}):r.type==="file"&&this.addFileFromObject(r.file,{source:B.DROP_AREA,fullPath:r.fullPath})}),this.uploadCollection.size&&(this.set$({"*currentActivity":w.activities.UPLOAD_LIST}),this.setOrAddState("*modalActive",!0)))}});let i=this.ref["content-wrapper"];i&&(this._destroyContentWrapperDropzone=Me({element:i,onChange:t=>{var s;let r=(s=Object.entries(P).find(([,n])=>n===t))==null?void 0:s[0].toLowerCase();r&&i.setAttribute("drag-state",r)},onItems:()=>{},shouldIgnore:()=>this._shouldIgnore()})),this.sub("state",t=>{var s;let r=(s=Object.entries(P).find(([,n])=>n===t))==null?void 0:s[0].toLowerCase();r&&this.setAttribute("drag-state",r)}),this.subConfigValue("sourceList",t=>{let r=Z(t);this.$.isEnabled=r.includes(U.sourceTypes.LOCAL),this.$.isVisible=this.$.isEnabled||!this.querySelector("[data-default-slot]")}),this.sub("isVisible",t=>{this.toggleAttribute("hidden",!t)}),this.sub("isClickable",t=>{this.toggleAttribute("clickable",t)}),this.$.isClickable&&(this._onAreaClicked=()=>{this.openSystemDialog()},this.addEventListener("click",this._onAreaClicked))}_shouldIgnore(){return!this.$.isEnabled||!this._couldHandleFiles()?!0:this.$.isFullscreen?[...this.$[gt]].filter(r=>r!==this).filter(r=>r.isActive()).length>0:!1}_couldHandleFiles(){let i=this.cfg.multiple,t=this.cfg.multipleMax,r=this.uploadCollection.size;return!(i&&t&&r>=t||!i&&r>0)}destroyCallback(){var t,r;super.destroyCallback();let i=this.$[gt];i&&(i.delete(this),i.size===0&&A.deleteCtx(Vi)),(t=this._destroyDropzone)==null||t.call(this),(r=this._destroyContentWrapperDropzone)==null||r.call(this),this._onAreaClicked&&this.removeEventListener("click",this._onAreaClicked)}};wt.template=`<slot><div data-default-slot hidden></div><div ref="content-wrapper" class="content-wrapper" set="@hidden: !isVisible"><div class="icon-container" set="@hidden: !withIcon"><lr-icon name="default"></lr-icon><lr-icon name="arrow-down"></lr-icon></div><span class="text">{{text}}</span></div></slot>`;wt.bindAttributes({"with-icon":null,clickable:null,text:null,fullscreen:null,disabled:null});var zi=(e,i)=>{let t,r,s,n=(...o)=>{t?(clearTimeout(r),r=setTimeout(()=>{Date.now()-s>=i&&(e(...o),s=Date.now())},Math.max(i-(Date.now()-s),0))):(e(...o),s=Date.now(),t=!0)};return Object.defineProperty(n,"cancel",{configurable:!1,writable:!1,enumerable:!1,value:()=>{clearTimeout(r)}}),n};var te=class extends U{constructor(){super();h(this,"couldBeCtxOwner",!0);h(this,"historyTracked",!0);h(this,"activityType",w.activities.UPLOAD_LIST);h(this,"_throttledHandleCollectionUpdate",zi(()=>{this.isConnected&&(this._updateUploadsState(),!this.couldOpenActivity&&this.$["*currentActivity"]===this.activityType&&this.historyBack())},300));this.init$={...this.init$,doneBtnVisible:!1,doneBtnEnabled:!1,uploadBtnVisible:!1,addMoreBtnVisible:!1,addMoreBtnEnabled:!1,headerText:"",commonErrorMessage:"",hasFiles:!1,onAdd:()=>{this.initFlow(!0)},onUpload:()=>{this.emit(T.UPLOAD_CLICK),this.uploadAll(),this._throttledHandleCollectionUpdate()},onDone:()=>{this.emit(T.DONE_CLICK,this.getOutputCollectionState()),this.doneFlow()},onCancel:()=>{this.uploadCollection.clearAll()}}}_updateUploadsState(){let t=this.getOutputCollectionState(),r={total:t.totalCount,succeed:t.successCount,uploading:t.uploadingCount,failed:t.failedCount},s=!t.errors.some(f=>f.type==="TOO_MANY_FILES"||f.type==="TOO_FEW_FILES"),n=t.errors.some(f=>f.type==="TOO_MANY_FILES"),o=t.totalCount===(this.cfg.multiple?this.cfg.multipleMax:1),l=r.failed===0,a=!1,c=!1,u=!1;r.total-r.succeed-r.uploading-r.failed>0&&s?a=!0:(c=!0,u=r.total===r.succeed&&s&&l),this.set$({doneBtnVisible:c,doneBtnEnabled:u,uploadBtnVisible:a,addMoreBtnEnabled:r.total===0||!n&&!o,addMoreBtnVisible:!o||this.cfg.multiple}),this.bindL10n("headerText",()=>this._getHeaderText(r))}_getHeaderText(t){let r=s=>{let n=t[s];return this.l10n(`header-${s}`,{count:n})};return t.uploading>0?r("uploading"):t.failed>0?r("failed"):t.succeed>0?r("succeed"):r("total")}get couldOpenActivity(){return this.cfg.showEmptyList||this.uploadCollection.size>0}initCallback(){super.initCallback(),this.registerActivity(this.activityType),this.subConfigValue("multiple",this._throttledHandleCollectionUpdate),this.subConfigValue("multipleMin",this._throttledHandleCollectionUpdate),this.subConfigValue("multipleMax",this._throttledHandleCollectionUpdate),this.sub("*currentActivity",t=>{!this.couldOpenActivity&&t===this.activityType&&(this.$["*currentActivity"]=this.initActivity)}),this.uploadCollection.observeProperties(this._throttledHandleCollectionUpdate),this.sub("*uploadList",t=>{this._throttledHandleCollectionUpdate(),this.set$({hasFiles:t.length>0}),this.cfg.confirmUpload||this.uploadAll()},!1),this.sub("*collectionErrors",t=>{let r=t.filter(s=>s.type!=="SOME_FILES_HAS_ERRORS")[0];if(!r){this.set$({commonErrorMessage:null});return}this.set$({commonErrorMessage:r.message})})}destroyCallback(){super.destroyCallback(),this.uploadCollection.unobserveProperties(this._throttledHandleCollectionUpdate)}};te.template=`<lr-activity-header><span class="header-text">{{headerText}}</span><button type="button" class="mini-btn close-btn" set="onclick: *closeModal"><lr-icon name="close"></lr-icon></button></lr-activity-header><div class="no-files" set="@hidden: hasFiles"><slot name="empty"><span l10n="no-files"></span></slot></div><div class="files" repeat="*uploadList" repeat-item-tag="lr-file-item"></div><div class="common-error" set="@hidden: !commonErrorMessage; textContent: commonErrorMessage;"></div><div class="toolbar"><button type="button" class="cancel-btn secondary-btn" set="onclick: onCancel;" l10n="clear"></button><div class="toolbar-spacer"></div><button type="button" class="add-more-btn secondary-btn" set="onclick: onAdd; @disabled: !addMoreBtnEnabled; @hidden: !addMoreBtnVisible" ><lr-icon name="add"></lr-icon><span l10n="add-more"></span></button><button type="button" class="upload-btn primary-btn" set="@hidden: !uploadBtnVisible; onclick: onUpload;" l10n="upload" ></button><button type="button" class="done-btn primary-btn" set="@hidden: !doneBtnVisible; onclick: onDone; @disabled: !doneBtnEnabled" l10n="done" ></button></div><lr-drop-area ghost></lr-drop-area>`;var ie=()=>{let e=[];return{stack:e,promiseReadJpegChunks:t=>new Promise((r,s)=>{let n=2,o=(c,u)=>{let d=new FileReader;d.addEventListener("load",()=>{u(new DataView(d.result))}),d.addEventListener("error",f=>{s(`Reader error: ${f}`)}),d.readAsArrayBuffer(c)},l=()=>o(t.slice(n,n+128),c=>{let u,d,f;for(u=d=0,f=c.byteLength;f>=0?d<f:d>f;u=f>=0?++d:--d)if(c.getUint8(u)===255){n+=u;break}a()}),a=()=>{let c=n;return o(t.slice(n,n+=4),u=>{if(u.byteLength!==4||u.getUint8(0)!==255){s("Corrupted");return}let d=u.getUint8(1);if(d===218){r(!0);return}let f=u.getUint16(2)-2;return o(t.slice(n,n+=f),m=>{if(m.byteLength!==f){s("Corrupted");return}e.push({startPos:c,length:f,marker:d,view:m}),l()})})};FileReader&&DataView||s("Not Support"),o(t.slice(0,2),c=>{c.getUint16(0)!==65496&&s("Not jpeg"),l()})})}},Gs=async e=>{let i=[],{promiseReadJpegChunks:t,stack:r}=ie();return await t(e),r.forEach(({marker:s,view:n})=>{s===226&&n.getUint32(0)===1229144927&&n.getUint32(4)===1347571526&&n.getUint32(8)===1229735168&&i.push(n)}),i},Bi=async(e,i,t)=>{{let r=[],s=[],{promiseReadJpegChunks:n,stack:o}=ie();await n(e),o.forEach(c=>{if(c.marker===i)return r.push(c.startPos),s.push(c.length)});let l=[e.slice(0,2)];for(let c of t){let u=new DataView(new ArrayBuffer(4));u.setUint16(0,65280+i),u.setUint16(2,c.byteLength+2),l.push(u.buffer),l.push(c)}let a=2;for(let c=0;c<r.length;c++)r[c]>a&&l.push(e.slice(a,r[c])),a=r[c]+s[c]+4;return l.push(e.slice(a,e.size)),new Blob(l,{type:e.type})}};var Gi=(e,i)=>Bi(e,226,i.map(t=>t.buffer)),Hs=async e=>{try{return await Gi(e,[])}catch(i){throw new Error(`Failed to strip ICC profile: ${i}`)}},Xs=(e,i,t)=>new Promise((r,s)=>{let n=o=>{if(!o){s("Failed to convert canvas to blob");return}r(o)};e.toBlob(n,i,t),e.width=e.height=1}),Tt=()=>{let e=document.createElement("canvas"),i=e.getContext("2d");return{canvas:e,ctx:i}},qs=e=>{let{ctx:t,canvas:r}=Tt();r.width=r.height=50,t.drawImage(e,0,0,50,50);let s=t.getImageData(0,0,50,50).data;r.width=r.height=1;for(let n=3;n<s.length;n+=4)if(s[n]<254)return!0;return!1},Ws=async e=>{let i=null,{promiseReadJpegChunks:t,stack:r}=ie();return await t(e),r.forEach(({marker:s,view:n})=>{if(!i&&s===225&&n.byteLength>=14&&n.getUint32(0)===1165519206&&n.getUint16(4)===0){i=n;return}}),i},Ks="data:image/jpg;base64,/9j/4AAQSkZJRgABAQEASABIAAD/4QA6RXhpZgAATU0AKgAAAAgAAwESAAMAAAABAAYAAAEoAAMAAAABAAIAAAITAAMAAAABAAEAAAAAAAD/2wBDAP//////////////////////////////////////////////////////////////////////////////////////wAALCAABAAIBASIA/8QAJgABAAAAAAAAAAAAAAAAAAAAAxABAAAAAAAAAAAAAAAAAAAAAP/aAAgBAQAAPwBH/9k=",ee,Ys=()=>new Promise(e=>{if(ee!==void 0)e(ee);else{let i=new Image;i.addEventListener("load",()=>{ee=i.naturalWidth<i.naturalHeight,i.src="//:0",e(ee)}),i.src=Ks}}),Js=(e,i)=>{let t,r,s,n;if(!e||e.byteLength<14||e.getUint32(0)!==1165519206||e.getUint16(4)!==0)return;if(e.getUint16(6)===18761)r=!0;else if(e.getUint16(6)===19789)r=!1;else return;if(e.getUint16(8,r)!==42)return;s=8+e.getUint32(10,r);let o=e.getUint16(s-2,r);for(t=0,n=o;n>=0?t<n:t>n;n>=0?++t:--t){if(e.byteLength<s+10)return;e.getUint16(s,r)===274&&i(s+8,r),s+=12}},Qs=(e,i)=>{Js(e,(t,r)=>e.setUint16(t,i,r))},Zs=async(e,i,t)=>(t&&Qs(i,1),Bi(e,225,[i.buffer])),tn=(e,i)=>new Promise((t,r)=>{i&&(e.src=i),e.complete?t(e):(e.addEventListener("load",()=>{t(e)}),e.addEventListener("error",()=>{r(new Error("Failed to load image. Probably not an image."))}))}),en=e=>tn(new Image,e),rn=[1,3],sn=[192,193,194,195,197,198,199,201,202,203,205,206,207],ji={squareSide:[Math.floor(Math.sqrt(5*1e3*1e3)),4096,8192,11180,10836,11402,14188,16384],dimension:[4096,8192,16384,32767,65535]},nn=async e=>{let i=!1,{promiseReadJpegChunks:t,stack:r}=ie();return await t(e).then(()=>(r.forEach(({marker:s,view:n})=>{if(!i&&sn.indexOf(s)>=0){let o=n.getUint8(5);rn.indexOf(o)<0&&(i=!0)}}),i)).catch(()=>i)},Hi=(e,i)=>{let t={};return(...r)=>{let s=i(r,t);return s in t?t[s]:t[s]=e(...r)}},Xi=(e,i)=>{let[t]=e,r=Object.keys(i).map(s=>parseInt(s,10)).sort((s,n)=>s-n);for(let s=0;s<r.length;s++){let n=r[s],o=!!i[n];if(n>t&&o||n<t&&!o)return n}return t},ot={R:55,G:110,B:165,A:255},on=`rgba(${ot.R}, ${ot.G}, ${ot.B}, ${ot.A/255})`,qi=(e,i)=>{try{let t=[e-1,i-1,1,1],{canvas:r,ctx:s}=Tt();r.width=1,r.height=1;let{canvas:n,ctx:o}=Tt();n.width=e,n.height=i,o&&(o.fillStyle=on,o.fillRect(...t),s.drawImage(n,e-1,i-1,1,1,0,0,1,1));let l=s&&s.getImageData(0,0,1,1).data,a=!1;return l&&(a=l[0]===ot.R&&l[1]===ot.G&&l[2]===ot.B&&l[3]===ot.A),n.width=n.height=1,a}catch{return console.error(`Failed to test for max canvas size of ${e}x${i}.`),!1}};function Wi(e){return(...i)=>new Promise(t=>{setTimeout(()=>{let r=e(...i);t(r)},0)})}var ln=Wi(Hi(qi,Xi)),an=Wi(Hi(qi,Xi)),Ki=async(e,i)=>{let t=ji.squareSide.find(o=>o*o>=e*i),r=ji.dimension.find(o=>o>=e&&o>=i);if(!t||!r)throw new Error("Not supported");let[s,n]=await Promise.all([ln(t,t),an(r,1)]);if(s&&n)return!0;throw new Error("Not supported")},Yi=async(e,i,t)=>{try{let{ctx:r,canvas:s}=Tt();return s.width=i,s.height=t,r.imageSmoothingQuality="high",r.drawImage(e,0,0,i,t),e instanceof HTMLImageElement&&(e.src="//:0"),e instanceof HTMLCanvasElement&&(e.width=e.height=1),s}catch(r){throw new Error("Canvas resize error",{cause:r})}},cn=({img:e,targetW:i,targetH:t})=>Yi(e,i,t),un=function({sourceW:e,targetW:i,targetH:t,step:r}){let s=[],n=i,o=t;do s.push([n,o]),n=Math.round(n/r),o=Math.round(o/r);while(n<e*r);return s.reverse()},hn=({img:e,sourceW:i,targetW:t,targetH:r,step:s})=>un({sourceW:i,targetW:t,targetH:r,step:s}).reduce((o,[l,a])=>o.then(c=>Ki(l,a).then(()=>Yi(c,l,a)).catch(()=>c)),Promise.resolve(e)),dn=()=>/iPad|iPhone|iPod/.test(navigator.platform)?!0:navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&/MacIntel/.test(navigator.platform),fn=navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&/MacIntel/.test(navigator.platform),De=.71,pn=(e,i)=>{if(e.width*De*e.height*De<i.size)throw new Error("Not required");let t=e.width,r=e.height,s=t/r,n=Math.floor(Math.sqrt(i.size*s)),o=Math.floor(i.size/Math.sqrt(i.size*s));return Ki(n,o).then(()=>{let{ctx:l}=Tt();return"imageSmoothingQuality"in l&&!dn()&&!fn?cn({img:e,targetW:n,targetH:o}):hn({img:e,sourceW:t,targetW:n,targetH:o,step:De})}).catch(()=>Promise.reject("Not supported"))},Ji=async(e,i)=>{try{if(await nn(e))throw new Error("Should skipped");let r=await Promise.allSettled([Ws(e),Ys(),Gs(e)]),n=!r.some(g=>g.status==="rejected"),[o,l,a]=r,c=await Hs(e).catch(()=>e),u=await en(URL.createObjectURL(c));URL.revokeObjectURL(u.src);let d=await pn(u,i),f="image/jpeg",m=(i==null?void 0:i.quality)||.8;!n&&qs(d)&&(f="image/png",m=void 0);let p=await Xs(d,f,m);if(n&&o.status==="fulfilled"&&o.value){let g=o.value,E=l.status==="fulfilled"?l.value:!1;p=await Zs(p,g,E)}return n&&a.status==="fulfilled"&&a.value.length>0&&(p=await Gi(p,a.value)),p}catch(t){let r;throw t instanceof Error&&(r=t.message),typeof t=="string"&&(r=t),new Error(`Failed to shrink image. ${r?`Message: "${r}".`:""}`,{cause:t})}};function mn(e){let i=new Blob([e],{type:"image/svg+xml"});return URL.createObjectURL(i)}function Fe(e="hsl(209, 21%, 65%)",i=32,t=32){return mn(`<svg width="${i}" height="${t}" viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" fill="${e}" d="M9.68848 8.70068C9.68848 8.42454 9.91233 8.20068 10.1885 8.20068H15.0885C15.2211 8.20068 15.3483 8.25336 15.442 8.34713L20.342 13.2471C20.4358 13.3409 20.4885 13.4681 20.4885 13.6007V21.3007C20.4885 21.5768 20.2646 21.8007 19.9885 21.8007H10.1885C9.91233 21.8007 9.68848 21.5768 9.68848 21.3007V8.70068ZM10.6885 9.20068V20.8007H19.4885V14.1007L15.0885 14.1007C14.8123 14.1007 14.5885 13.8768 14.5885 13.6007L14.5885 9.20068H10.6885ZM15.5885 9.90779L18.7814 13.1007L15.5885 13.1007L15.5885 9.90779Z"/></svg>`)}function Qi(e,i=40){if(e.type==="image/svg+xml")return URL.createObjectURL(e);let t=document.createElement("canvas"),r=t.getContext("2d"),s=new Image,n=new Promise((o,l)=>{s.onload=()=>{let a=s.height/s.width;a>1?(t.width=i,t.height=i*a):(t.height=i,t.width=i/a),r.fillStyle="rgb(240, 240, 240)",r.fillRect(0,0,t.width,t.height),r.drawImage(s,0,0,t.width,t.height),t.toBlob(c=>{if(!c){l();return}let u=URL.createObjectURL(c);o(u)})},s.onerror=a=>{l(a)}});return s.src=URL.createObjectURL(e),n}var gn=/^([0-9]+)x([0-9]+)(?:\s+(\d{1,2}|100)%)?$/i,Zi=e=>{let i=gn.exec(e==null?void 0:e.toLocaleLowerCase())||[];if(!i.length)return!1;let t=i[1]*i[2],r=16384*16384;return t>r?(console.warn(`Shrinked size can not be larger than ${Math.floor(r/1e3/1e3)}MP. You have set ${i[1]}x${i[2]} (${Math.ceil(t/1e3/100)/10}MP).`),!1):{quality:i[3]?i[3]/100:void 0,size:t}};var F=Object.freeze({FINISHED:Symbol(0),FAILED:Symbol(1),UPLOADING:Symbol(2),IDLE:Symbol(3)}),St=class e extends U{constructor(){super();h(this,"couldBeCtxOwner",!0);h(this,"pauseRender",!0);h(this,"_entrySubs",new Set);h(this,"_entry",null);h(this,"_isIntersecting",!1);h(this,"_debouncedGenerateThumb",N(this._generateThumbnail.bind(this),100));h(this,"_debouncedCalculateState",N(this._calculateState.bind(this),100));h(this,"_renderedOnce",!1);this.init$={...this.init$,uid:"",itemName:"",errorText:"",thumbUrl:"",progressValue:0,progressVisible:!1,badgeIcon:"",isFinished:!1,isFailed:!1,isUploading:!1,isFocused:!1,isEditable:!1,state:F.IDLE,onEdit:()=>{this.set$({"*focusedEntry":this._entry}),this.hasBlockInCtx(t=>t.activityType===w.activities.DETAILS)?this.$["*currentActivity"]=w.activities.DETAILS:this.$["*currentActivity"]=w.activities.CLOUD_IMG_EDIT},onRemove:()=>{this.uploadCollection.remove(this.$.uid)},onUpload:()=>{this.upload()}}}_reset(){for(let t of this._entrySubs)t.remove();this._debouncedGenerateThumb.cancel(),this._debouncedCalculateState.cancel(),this._entrySubs=new Set,this._entry=null}_observerCallback(t){let[r]=t;this._isIntersecting=r.isIntersecting,r.isIntersecting&&!this._renderedOnce&&(this.render(),this._renderedOnce=!0),r.intersectionRatio===0?this._debouncedGenerateThumb.cancel():this._debouncedGenerateThumb()}_calculateState(){if(!this._entry)return;let t=this._entry,r=F.IDLE;t.getValue("errors").length>0?r=F.FAILED:t.getValue("isUploading")?r=F.UPLOADING:t.getValue("fileInfo")&&(r=F.FINISHED),this.$.state=r}async _generateThumbnail(){var r;if(!this._entry)return;let t=this._entry;if(t.getValue("fileInfo")&&t.getValue("isImage")){let s=this.cfg.thumbSize,n=this.proxyUrl(Gt(Ai(this.cfg.cdnCname,this._entry.getValue("uuid")),Bt(t.getValue("cdnUrlModifiers"),`scale_crop/${s}x${s}/center`))),o=t.getValue("thumbUrl");o!==n&&(t.setValue("thumbUrl",n),o!=null&&o.startsWith("blob:")&&URL.revokeObjectURL(o));return}if(!t.getValue("thumbUrl"))if((r=t.getValue("file"))!=null&&r.type.includes("image"))try{let s=await Qi(t.getValue("file"),this.cfg.thumbSize);t.setValue("thumbUrl",s)}catch{let n=window.getComputedStyle(this).getPropertyValue("--clr-generic-file-icon");t.setValue("thumbUrl",Fe(n))}else{let s=window.getComputedStyle(this).getPropertyValue("--clr-generic-file-icon");t.setValue("thumbUrl",Fe(s))}}_subEntry(t,r){let s=this._entry.subscribe(t,n=>{this.isConnected&&r(n)});this._entrySubs.add(s)}_handleEntryId(t){var s;this._reset();let r=(s=this.uploadCollection)==null?void 0:s.read(t);this._entry=r,r&&(this._subEntry("uploadProgress",n=>{this.$.progressValue=n}),this._subEntry("fileName",n=>{this.$.itemName=n||r.getValue("externalUrl")||this.l10n("file-no-name"),this._debouncedCalculateState()}),this._subEntry("externalUrl",n=>{this.$.itemName=r.getValue("fileName")||n||this.l10n("file-no-name")}),this._subEntry("fileInfo",n=>{this._debouncedCalculateState(),n&&this._isIntersecting&&this._debouncedGenerateThumb()}),this._subEntry("cdnUrlModifiers",()=>{this._isIntersecting&&this._debouncedGenerateThumb()}),this._subEntry("thumbUrl",n=>{this.$.thumbUrl=n?`url(${n})`:""}),this._subEntry("errors",()=>this._debouncedCalculateState()),this._subEntry("isUploading",()=>this._debouncedCalculateState()),this._subEntry("fileSize",()=>this._debouncedCalculateState()),this._subEntry("mimeType",()=>this._debouncedCalculateState()),this._subEntry("isImage",()=>this._debouncedCalculateState()),this._isIntersecting&&this._debouncedGenerateThumb())}initCallback(){super.initCallback(),this.sub("uid",t=>{this._handleEntryId(t)}),this.sub("state",t=>{this._handleState(t)}),this.subConfigValue("useCloudImageEditor",()=>this._debouncedCalculateState()),this.onclick=()=>{e.activeInstances.forEach(t=>{t===this?t.setAttribute("focused",""):t.removeAttribute("focused")})},this.sub("*uploadTrigger",t=>{t.has(this._entry.uid)&&setTimeout(()=>this.isConnected&&this.upload())}),e.activeInstances.add(this)}_handleState(t){var r,s,n,o;t===F.FAILED?this.$.badgeIcon="badge-error":t===F.FINISHED&&(this.$.badgeIcon="badge-success"),t===F.UPLOADING?this.$.isFocused=!1:this.$.progressValue=0,this.set$({isFailed:t===F.FAILED,isUploading:t===F.UPLOADING,isFinished:t===F.FINISHED,progressVisible:t===F.UPLOADING,isEditable:this.cfg.useCloudImageEditor&&((r=this._entry)==null?void 0:r.getValue("isImage"))&&((s=this._entry)==null?void 0:s.getValue("cdnUrl")),errorText:(o=(n=this._entry.getValue("errors"))==null?void 0:n[0])==null?void 0:o.message})}destroyCallback(){super.destroyCallback(),e.activeInstances.delete(this),this._reset()}connectedCallback(){super.connectedCallback(),this._observer=new window.IntersectionObserver(this._observerCallback.bind(this),{root:this.parentElement,rootMargin:"50% 0px 50% 0px",threshold:[0,1]}),this._observer.observe(this)}disconnectedCallback(){var t;super.disconnectedCallback(),this._debouncedGenerateThumb.cancel(),(t=this._observer)==null||t.disconnect()}_settingsOfShrink(){return Zi(this.cfg.imageShrink)}_processShrink(t){return Ji(t,this._settingsOfShrink())}async upload(){var s,n,o,l,a;let t=this._entry;if(!this.uploadCollection.read(t.uid)||t.getValue("fileInfo")||t.getValue("isUploading")||t.getValue("errors").length>0)return;let r=this.cfg.multiple?this.cfg.multipleMax:1;if(!(r&&this.uploadCollection.size>r)){this._debouncedCalculateState(),t.setValue("isUploading",!0),t.setValue("errors",[]);try{let c=new AbortController;t.setValue("abortController",c);let u=async()=>{let f=t.getValue("file");f&&this.cfg.imageShrink&&(f=await this._processShrink(f).catch(()=>f));let m=f||t.getValue("externalUrl")||t.getValue("uuid"),g={...this.getUploadClientOptions(),fileName:t.getValue("fileName"),source:t.getValue("source"),onProgress:E=>{if(E.isComputable){let v=E.value*100;t.setValue("uploadProgress",v)}},signal:c.signal,metadata:await this.getMetadataFor(t.uid)};return this.debugPrint("upload options",m,g),Te(m,g)},d=await this.$["*uploadQueue"].add(u);t.setMultipleValues({fileInfo:d,isUploading:!1,fileName:d.originalFilename,fileSize:d.size,isImage:d.isImage,mimeType:(o=(n=(s=d.contentInfo)==null?void 0:s.mime)==null?void 0:n.mime)!=null?o:d.mimeType,uuid:d.uuid,cdnUrl:(l=t.getValue("cdnUrl"))!=null?l:d.cdnUrl,cdnUrlModifiers:(a=t.getValue("cdnUrlModifiers"))!=null?a:"",uploadProgress:100}),t===this._entry&&this._debouncedCalculateState()}catch(c){c instanceof rt&&c.isCancel?t.setMultipleValues({isUploading:!1,uploadProgress:0}):t.setMultipleValues({isUploading:!1,uploadProgress:0,uploadError:c}),t===this._entry&&this._debouncedCalculateState()}}}};St.template=`<div class="inner" set="@finished: isFinished; @uploading: isUploading; @failed: isFailed; @focused: isFocused"><div class="thumb" set="style.backgroundImage: thumbUrl"><div class="badge"><lr-icon set="@name: badgeIcon"></lr-icon></div></div><div class="file-name-wrapper"><span class="file-name" set="@title: itemName">{{itemName}}</span><span class="file-error" set="@hidden: !errorText">{{errorText}}</span></div><div class="file-actions"><button type="button" class="edit-btn mini-btn" set="onclick: onEdit; @hidden: !isEditable"><lr-icon name="edit-file"></lr-icon></button><button type="button" class="remove-btn mini-btn" set="onclick: onRemove;"><lr-icon name="remove-file"></lr-icon></button><button type="button" class="upload-btn mini-btn" set="onclick: onUpload;"><lr-icon name="upload"></lr-icon></button></div><lr-progress-bar class="progress-bar" set="value: progressValue; visible: progressVisible;"></lr-progress-bar></div>`;St.activeInstances=new Set;var xt=class extends I{constructor(){super(...arguments);h(this,"init$",{...this.init$,name:"",path:"",size:"24",viewBox:""})}initCallback(){super.initCallback(),this.sub("name",t=>{if(!t)return;let r=this.getCssData(`--icon-${t}`);r&&(this.$.path=r)}),this.sub("path",t=>{if(!t)return;t.trimStart().startsWith("<")?(this.setAttribute("raw",""),this.ref.svg.innerHTML=t):(this.removeAttribute("raw"),this.ref.svg.innerHTML=`<path fill-rule="evenodd" d="${t}"></path>`)}),this.sub("size",t=>{this.$.viewBox=`0 0 ${t} ${t}`})}};xt.template=`<svg ref="svg" xmlns="http://www.w3.org/2000/svg" set="@viewBox: viewBox; @height: size; @width: size"></svg>`;xt.bindAttributes({name:"name",size:"size"});var re=class extends I{constructor(){super(...arguments);h(this,"_value",0);h(this,"init$",{...this.init$,width:0,opacity:0})}initCallback(){super.initCallback(),this.defineAccessor("value",t=>{if(t===void 0)return;let r=this._value;if(this._value=t,t===0&&r>0){this.ref.line.addEventListener("transitionend",()=>{this.style.setProperty("--l-width",this._value.toString())});return}this.style.setProperty("--l-width",this._value.toString())}),this.defineAccessor("visible",t=>{this.ref.line.classList.toggle("progress--hidden",!t)})}};re.template='<div ref="line" class="progress"></div>';var se=class extends I{initCallback(){super.initCallback(),this.subConfigValue("removeCopyright",i=>{this.toggleAttribute("hidden",!!i)})}};h(se,"template",`<a href="https://uploadcare.com/?utm_source=copyright&utm_medium=referral&utm_campaign=v4" target="_blank noopener" class="credits" >Powered by Uploadcare</a >`);var $e=class extends U{constructor(){super(...arguments);h(this,"requireCtxName",!0)}_createValidationInput(){let t=document.createElement("input");return t.type="text",t.name=this.ctxName,t.required=this.cfg.multipleMin>0,t.tabIndex=-1,qe(t,{opacity:0,height:0,width:0}),t}initCallback(){super.initCallback(),this._validationInputElement=this._createValidationInput(),this.appendChild(this._validationInputElement),this.sub("*collectionState",t=>{var r;{if(this._dynamicInputsContainer||(this._dynamicInputsContainer=document.createElement("div"),this.appendChild(this._dynamicInputsContainer)),!this._validationInputElement){let l=this._createValidationInput();this.appendChild(l),this._validationInputElement=l}if(this._dynamicInputsContainer.innerHTML="",t.status==="uploading"||t.status==="idle"){this._validationInputElement.value="",this._validationInputElement.setCustomValidity("");return}if(t.status==="failed"){let l=(r=t.errors[0])==null?void 0:r.message;this._validationInputElement.value="",this._validationInputElement.setCustomValidity(l);return}let s=t.group?t.group:null;if(s){this._validationInputElement.value=s.cdnUrl,this._validationInputElement.setCustomValidity("");return}let n=t.allEntries.map(l=>l.cdnUrl);if(!this.cfg.multiple&&n.length===1){this._validationInputElement.value=n[0],this._validationInputElement.setCustomValidity("");return}this._validationInputElement.remove(),this._validationInputElement=null;let o=new DocumentFragment;for(let l of n){let a=document.createElement("input");a.type="hidden",a.name=`${this.ctxName}[]`,a.value=l,o.appendChild(a)}this._dynamicInputsContainer.replaceChildren(o)}},!1)}};var ne=e=>{var i;return(i=e.match(/[A-Z]{2,}(?=[A-Z][a-z]+[0-9]*|\b)|[A-Z]?[a-z]+[0-9]*|[A-Z]|[0-9]+/g))==null?void 0:i.map(t=>t.toLowerCase()).join("-")};var Ne=[...new Set(["debug",...Object.keys(V)])],_n=["metadata","localeDefinitionOverride"],bn=e=>_n.includes(e),_t=Ne.filter(e=>!bn(e)),yn={...Object.fromEntries(_t.map(e=>[ne(e),e])),...Object.fromEntries(_t.map(e=>[e.toLowerCase(),e]))},Cn={...Object.fromEntries(_t.map(e=>[ne(e),D(e)])),...Object.fromEntries(_t.map(e=>[e.toLowerCase(),D(e)]))},tr=e=>"__"+e,Ot=class extends I{constructor(){super();h(this,"requireCtxName",!0);this.init$={...this.init$,...Object.fromEntries(Object.entries(V).map(([t,r])=>[D(t),r]))}}_flushValueToAttribute(t,r){if(_t.includes(t)){let s=[...new Set([ne(t),t.toLowerCase()])];for(let n of s)typeof r=="undefined"||r===null?this.removeAttribute(n):this.getAttribute(n)!==r.toString()&&this.setAttribute(n,r.toString())}}_flushValueToState(t,r){this.$[D(t)]!==r&&(typeof r=="undefined"||r===null?this.$[D(t)]=V[t]:this.$[D(t)]=r)}_setValue(t,r){let s=this,n=Fi(t,r),o=tr(t);s[o]!==n&&(this._assertSameValueDifferentReference(t,s[o],n),s[o]=n,this._flushValueToAttribute(t,n),this._flushValueToState(t,n),this.debugPrint(`[lr-config] "${t}"`,n))}_getValue(t){let r=this,s=tr(t);return r[s]}_assertSameValueDifferentReference(t,r,s){this.cfg.debug&&JSON.stringify(s)===JSON.stringify(r)&&(console.warn(`[lr-config] Option "${t}" value is the same as the previous one but the reference is different`),console.warn("[lr-config] You should avoid changing the reference of the object to prevent unnecessary calculations"),console.warn(`[lr-config] "${t}" previous value:`,r),console.warn(`[lr-config] "${t}" new value:`,s))}initCallback(){var r;super.initCallback();let t=this;for(let s of _t)this.sub(D(s),n=>{this._setValue(s,n)},!1);for(let s of Ne){let n=(r=t[s])!=null?r:this.$[D(s)];n!==V[s]&&this._setValue(s,n),Object.defineProperty(this,s,{set:o=>{this._setValue(s,o)},get:()=>this._getValue(s)})}}attributeChangedCallback(t,r,s){if(r===s)return;let n=this,o=yn[t];n[o]=s}};Ot.bindAttributes(Cn);for(let e of Ne)Ot.prototype[e]=void 0;var An=Ot;var oe=class extends U{constructor(){super(...arguments);h(this,"requireCtxName",!0)}initCallback(){super.initCallback(),this.$["*eventEmitter"].bindTarget(this)}destroyCallback(){super.destroyCallback(),this.$["*eventEmitter"].unbindTarget(this)}};oe.EventType=T;var En=oe;export{An as Config,se as Copyright,wt as DropArea,St as FileItem,qt as FileUploaderMinimal,$e as FormInput,xt as Icon,re as ProgressBar,Wt as StartFrom,En as UploadCtxProvider,te as UploadList,ze as defineLocale,sr as registerBlocks};